!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=86)}({7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"refreshAPIToken",value:function(){var e=this;return skuid.platform.services.getToken().then(function(t){var a=t.token,n=e.extractJWTPayload(a).exp;return e.apiToken={expiration:n,jwt:a}})}},{key:"extractJWTPayload",value:function(e){var t=e.split(".");if(3!=t.length)throw new Error("JWT not formatted correctly");return JSON.parse(atob(t[1]))}},{key:"getAPIToken",value:function(){var e=this.apiToken;return e&&this.isValid(e)?skuid.utils.resolve(e):this.refreshAPIToken()}},{key:"isValid",value:function(e){var t=void 0;return(t=skuid.utils.isString(e)?this.extractJWTPayload(e).exp:e.expiration)&&t>Date.now()/1e3}}]),e}();t.default=new r},86:function(e,t,a){"use strict";var n,r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=a(7),i=(n=o)&&n.__esModule?n:{default:n};function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(e){var t=e.snippet.register,a=e.componentType.register,n=e.$,o=e.utils,u=e.constants,c=u.MIME_TYPES.JSON,d=e.platform.getEntityFieldName,l=e.platform.getEntityFieldNames,f=u.SALESFORCE;function p(e){var t="",a=e.responseJSON;return a?(a.error&&(t+=a.error),a.message&&(t+=(t?": ":"")+a.message)):t+=e.responseText,t}function m(e){return o.reject({$PreviousAction:{error:p(e)}})}function h(){return i.default.getAPIToken().then(function(e){return{Accept:c,"Content-Type":c,Authorization:"Bearer "+e.jwt}})}function v(){return e.$M("stng__DataSources")||e.$M("stng__ModelDataSources")}function g(){return e.$M("stng__DataServices")}function y(){return e.$M("stng__SiteEnv")}function S(){return v().getFirstRow()}function _(t,a,n){var r=s({},e.platform.getEntityFieldName("data_service","is_active"),!0);if(n&&n.version&&(r[e.platform.getEntityFieldName("data_service","version")]=n.version),t&&a)return t.updateRow(a,r),t.save()}function b(){var e=v(),t=S(),a=g(),n=l("data_source"),r=n.data_service_id,o=n.data_service,i=e.getFieldValue(t,r,!0),u=e.getFieldValue(t,o,!0);if(!u&&i&&(u=t[o]=a.getRowById(i)),!i){var c,d=y().getFirstRow(),f=d.PLINY_WARDEN_HOST,p=d.PLINY_WARDEN_PORT,m=d.PLINY_WARDEN_VERSION,h=l("data_service"),_=h.host,b=h.port,T=h.version;s(c={},_,f),s(c,b,p),s(c,T,m),u=c}return u}function T(e){var t=e[d("data_service","host")],a=e[d("data_service","port")];return"https://"+t+(a?":"+a:"")}function w(){return T(b())}function P(){return k()+"/source-entity"}function k(){return w()+"/api/v2/datasources/"+function(){var t=S(),a=b()[e.platform.getEntityFieldName("data_service","version")];if(a){var n=a.split(".");if(3==n.length){var o=n.map(function(e){return parseInt(e,10)}),i=r(o,3),s=i[0],u=i[1],c=i[2];if(s>=0&&u>=2&&c>=3)return t[e.platform.getEntityFieldName("data_source","name")]}}return t[e.platform.getEntityFieldName("data_source","external_id")]}()}function x(e){return h().then(function(t){return n.ajax({url:P(),method:"PATCH",headers:t,data:JSON.stringify({operation:"import",payload:[{entity:e.name,schema:e.schema}]}),contentType:c,dataType:"json"}).catch(m)})}function D(e,t){var a=t?T(t):w();return h().then(function(r){return n.ajax({url:a+"/api/v2/ping",method:"GET",headers:r}).then(function(a){return _(e,t,a)})})}function O(t,a){return h().then(function(r){var i=e.utils.userInfo.organizationId,s=a?T(a):w(),c=n.extend(r,{"x-skuid-public-key-endpoint":e.platform.getPublicKeyEndpoint()});return o.inPlatform([u.VISUALFORCE,u.LIGHTNING])&&(c["x-skuid-session-id"]=e.utils.userInfo.sessionId),n.ajax({url:s+"/api/v2/site/"+i+"/register",method:"POST",headers:c}).then(function(e){return _(t,a,e)})})}function j(){var t=e.model.getModel("stng__ConnectionTest"),a=t.createRow();return a.status="Success!",a.message="The Data Source appears to be correctly configured.",t.save(),!0}function N(t){var a=e.model.getModel("stng__ConnectionTest"),n=a.createRow();return n.status="Unsuccessful.",n.message="Skuid could not connect to the Data Source.\n",n.message+="Please check all configuration values and make sure the Data Source ",n.message+="can be accessed from Skuid's web servers in your region.\n\n",t&&t.statusText&&"timeout"!==t.statusText&&(n.message+=t.statusText),a.save(),!0}function R(){var t=e.$M("stng__DataServiceSettings");return t.emptyData(),e.remote.promisify(e.remote(),"getDataServiceConfig").then(function(e){t.adoptRow(e)})}t("DSC_Value_Editor",function(t,a){"userinfo"===t.row.type?"read"===t.mode||"readonly"===t.mode?(t.required=!0,e.ui.fieldRenderers[t.metadata.displaytype].read(t,a)):(t.required=!0,t.metadata.picklistEntries=[{label:"First Name",value:"first_name"},{label:"Email",value:"email"},{label:"Last Name",value:"last_name"},{label:"Username",value:"username"},{label:"Federation Id",value:"federation_id"}],e.ui.fieldRenderers.PICKLIST.edit(t,a)):(t.required=!1,e.ui.fieldRenderers[t.metadata.displaytype][t.mode](t,a))}),t("Update_DSC_Value_Editor",function(e){var t=e.component,a=e.rowId,r=e.row,o=t.registeredFieldsByRowThenField[a].value;t.updateRow(r,"value",""),n.each(o,function(){this.render()})}),t("BuildProfilePermissionSummary",function(){var t=arguments[0].model,a=["createable","deleteable","queryable","updateable"],r=e.$M("Profile"),o={};n.each(t.data,function(e,t){var r=t.permission_set_id;o[r]={},n.each(a,function(e,a){o[r][a]=t[a]})});var i={};n.each(r.getRows(),function(e,t){var r=o[t[d("profile","name")]],s=i[t[d("profile","id")]]={};n.each(a,function(e,t){r&&(s[t]=r[t])})}),r.updateRows(i),r.hasChanged=!1,r.originals=n.extend({},r.changes),r.changes={},r.cancel()}),t("buildPermissionCache",function(){var t=arguments[0].model,a={},r=void 0,o=void 0,i=void 0;switch(t.id){case"DataSourceObjectPermissions":r="data_source_object_id",o="stng__DataSourceObjects",i={queryable:"queryable",createable:"createable",updateable:"updateable",deleteable:"deleteable"};break;case"DataSourceFieldPermissions":r="data_source_field_id",o="stng__DataSourceFields",i={queryable:"queryable",createable:"createable",updateable:"updateable"};break;case"DataSourceConditionPermissions":r="data_source_condition_id",o="stng__DataSourceConditions",i={alwaysOn:"always_on"}}if(r){var s=e.$M(o);n.each(t.data,function(e,t){var o=t[r];a[o]={},n.each(i,function(e,n){a[o][n]=t[e]})});var u={};n.each(s.getRows(),function(e,t){var r=a[t.id],o=u[t.id]={};n.each(i,function(e,t){r&&(o[t]=r[t])})}),s.updateRows(u),s.hasChanged=!1,s.originals=n.extend({},s.changes),s.changes={},s.cancel()}}),t("saveScheme",function(){var t=e.$M("stng__DataSource_Warden").getFirstRow(),a=e.$M("stng__DataSourceObjects").getFirstRow(),r=e.$M("stng__DataSourceFields"),o=e.$M("stng__DataSourceConditions"),i={name:e.$M("Profile").getFirstRow()[e.platform.getEntityFieldName("profile","name")],dataSourcePermissions:{}},s={dataSourceObjectPermissions:{}},u={createable:!!a.createable,queryable:!!a.queryable,updateable:!!a.updateable,deleteable:!!a.deleteable,dataSourceFieldPermissions:{},dataSourceConditionPermissions:{}};return n.each(r.data,function(e,t){u.dataSourceFieldPermissions[t.name]={createable:!!t.createable,queryable:!!t.queryable,updateable:!!t.updateable}}),n.each(o.data,function(e,t){u.dataSourceConditionPermissions[t.name]={alwaysOn:!!t.always_on}}),s.dataSourceObjectPermissions[a.name]=u,i.dataSourcePermissions[t.name]=s,h().then(function(e){return n.ajax({url:w()+"/api/v2/permissionsets",method:"PATCH",headers:e,data:JSON.stringify(i),contentType:c,dataType:"json"})})}),t("validateDataServiceName",function(){var t=e.component.getByType("skuidpage")[0],a=e.$M("stng__DataServices").changes,r=/^[a-z0-9_-]+$/i;return n.when().then(function(){n.each(a,function(e,a){if(a.Name&&"Name"in a&&!r.exec(a.Name)){var n="The name must only contain alpha-numeric characters, underscores, and dashes";throw t.addProblem(n),n}})})}),t("skuid.settings.dataSources.pingAndRegisterDataService",function(){var e=null,t=b();return t[d("data_service","id")]?e=g():t=null,D(e,t).catch(function(a){return p(a).startsWith("JWT Authorization")?O(e,t):m(a)})}),t("skuid.settings.dataSources.pingDataService",function(e){return D(e.model,e.row).catch(m)}),t("skuid.settings.dataSources.registerDataService",function(e){return O(e.model,e.row).catch(m)}),t("testConnection",function(){return h().then(function(e){return n.ajax({url:k()+"/poke",method:"GET",headers:e,contentType:c,dataType:"json"})}).then(j).catch(N)}),t("importDSO",function(e){return x(e.row)}),t("importMultipleDSOs",function(e){return n.when.all(e.rows.map(x))}),t("importDSOS",function(){var t=e.$;return h().then(function(a){return t.ajax({url:P(),headers:a}).then(function(a){var n=e.$M("stng__DSOImport");n.abandonAllRows(),n.adoptRows(t.map(a,function(e){return{name:e.tablename,schema:e.tableschema}}))}).catch(m)})}),a("outboundIPsComponent",function(e){var t=y(),a=t.getFirstRow(),r=a&&t.getFieldValue(a,"PLINY_OUTBOUND_IP_ADDRESSES");if(r&&r.length){var o=n("<h3>").text("Skuid Outbound Connection IP Addresses"),i=n("<p>").text("Skuid may use any one of the following static IP addresses to connect directly from the cloud to your datasources."),s=n("<p>").text("If you use a firewall for your datasources, these IP addresses may need to be whitelisted on your firewall."),u=n("<ul>");n.each(r,function(e,t){u.append(n("<li>").text(t))}),e.append(o,i,s,u)}}),t("testNewConn",function(){return t=e.model.getModel("stng__DataSource_Warden").getFirstRow(),a=S(),r={url:t.url,database_username:t.database_username,database_password:t.database_password,database_name:t.database_name,type:a[d("data_source","type")]},o=w()+"/api/v2/datasources/poke",h().then(function(e){return n.ajax({url:o,method:"POST",headers:e,data:JSON.stringify(r),contentType:c,dataType:"json"})}).then(j).catch(N);var t,a,r,o}),t("v1.importDSOS",function(){var t,a=e.$M("stng__DataSources").getFirstRow(),r=a.name,o=a.type,i={};return i[r]={},n.ajax({method:"POST",url:"/metadata/metaservice",data:JSON.stringify({dataSources:i}),contentType:"application/json",dataType:"json"}).then(function(a){var i=a.dataSourceTypes[o].dataSources[r];return t=i.dataServiceUrl,n.ajax({url:t+"/getSourceEntityList",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-data-source":r,"x-skuid-options-schemas":!0}})}).then(function(a){var o=e.$M("stng__DSOImport");o.abandonAllRows(),o.adoptRows(n.map(a,function(e){return{name:e.tablename,schema:e.tableschema,url:t,dsName:r}}))}).catch(function(e){var t=e.responseJSON;return n.Deferred().reject({$PreviousAction:{error:t.error+": "+t.message}}).promise()})}),t("v1.importDSO",function(t){var a=t.row;return n.ajax({url:a.url+"/getSourceEntityMetadata",method:"POST",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-data-source":a.dsName,"x-skuid-options-schemas":!0},data:JSON.stringify({entity:a.name,schema:a.schema}),contentType:"application/json",dataType:"json"}).then(function(e){return e.dataSource=a.dsName,n.ajax({url:"/api/v1/dso/import",method:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})}).catch(function(e){var t="",a=e.responseJSON;return a?(a.error&&(t+=a.error),a.message&&(t+=": "+a.message)):t+=e.responseText,n.Deferred().reject({$PreviousAction:{error:t}}).promise()})}),t("v1.importMultipleDSOs",function(t){var a=t.rows;function r(e){var t="",a=e.responseJSON;return a?(a.error&&(t+=a.error),a.message&&(t+=": "+a.message)):t+=e.responseText,n.Deferred().reject({$PreviousAction:{error:t}}).promise()}return n.when.apply(n,a.map(function(t){return n.ajax({url:t.url+"/getSourceEntityMetadata",method:"POST",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-data-source":t.dsName,"x-skuid-options-schemas":!0},data:JSON.stringify({entity:t.name,schema:t.schema}),contentType:"application/json",dataType:"json"}).then(function(e){return e.dataSource=t.dsName,n.ajax({url:"/api/v1/dso/import",method:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})}).catch(r)}))}),t("v1.testConn",function(){var t,a=e.$M("stng__DataSources").getFirstRow(),r=a.name,o=a.type,i={};i[r]={};var s=e.$M("stng__ConnectionTest"),u=s.createRow(),c=n.Deferred();return n.ajax({method:"POST",url:"/metadata/metaservice",data:JSON.stringify({dataSources:i}),contentType:"application/json",dataType:"json"}).then(function(a){var i=a.dataSourceTypes[o].dataSources[r];return t=i.dataServiceUrl,n.ajax({url:t+"/poke",headers:{"x-skuid-session-id":e.utils.userInfo.sessionId,"x-skuid-data-source":r,"x-skuid-options-schemas":!0},timeout:5e3})}).then(function(){return u.status="Success!",u.message="The Data Source appears to be correctly configured.",s.save(),c.resolve(!0)},function(e){return u.status="Unsuccessful.",u.message="Skuid could not connect to the Data Source.\n",u.message+="Please check all configuration values and make sure the Data Source ",u.message+="can be accessed from Skuid's web servers in your region.\n\n",e&&e.statusText&&"timeout"!==e.statusText&&(u.message+=e.statusText),s.save(),c.resolve(!0)}),c.promise()}),t("skuid.settings.dataSources.getCertificates",function(){return o.inPlatform(u.VISUALFORCE)?e.sfdc.api.query("SELECT DeveloperName,MasterLabel FROM Certificate ORDER BY MasterLabel",{useToolingApi:!0}).then(function(e){return e.records.map(function(e){var t=e.DeveloperName;return{label:e.MasterLabel,value:t}})}):o.resolve([])}),t("skuid.settings.dataSources.queryDataServiceConfig",R),t("skuid.settings.dataSources.modifyDataServiceConfig",function(){var t=e.$M("stng__ModifyDataServiceSettings"),a=t.getFirstRow(),n=t.getRowChanges(a),r=e.dataSource.get(f),i=e.dataSource.getType(f),s=void 0;function u(){return i.makeMetadataApiRequest({dataSource:r,body:"<checkDeployStatus><id>"+s+"</id></checkDeployStatus>"})}return e.remote.promisify(e.remote(),"modifyDataServiceConfig",JSON.stringify(n)).then(function(e){return s=e,function e(){return o.delay(500).then(u).then(function(t){if("true"===t.done){if("true"===t.success)return"Job Succeeded";throw"Job failed: "+t.details}return e()})}()}).then(R).catch(function(e){return o.reject({$PreviousAction:{error:e}})})}),e.events.subscribe("skuid.settings.jwtSigningCertificateChanged",i.default.refreshAPIToken)}(skuid)}});