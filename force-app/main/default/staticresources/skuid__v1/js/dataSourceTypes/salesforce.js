!function(a){var n={};function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return a[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=a,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=369)}({369:function(e,t,a){"use strict";var Qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(w){var p=w.constants,C=p.DISPLAY_TYPES,E=p.LIGHTNING,I=C.REFERENCE,j=p.SALESFORCE,d=p.VISUALFORCE,m=C.MULTIPICKLIST,h=C.TEXT,s=C.BOOLEAN,e=C.PICKLIST,N=C.INTEGER,T=C.DATE,A=C.DATETIME,i="x-salesforce-save-api-version",o=2,a="Could not upload file",f="compressedRecordTypeMetadata",g="picklistToIndexMapMetadata",b="_decompressedRecordTypeMetadata",v="_failedToGetRecordTypeMetadata",l="_recordTypeIdsAlreadyFetching",c="Removed",P=w.$,_=w.utils,O=_.inPlatform,u=_.toArray,y=w.dataSource.utils,S=y.splitAndTrimStringsToArray,R=y.validateEmailAddresses,F=y.partitionRecipients,x=_.mergeAsTextInContext,M=_.isString,t=w.sfdc,k=_.makeXMLDoc,L=_.getInvokable,U=_.encodeHTML,r=_.resolve,D=_.startsWith,V=t.api.version,n={},B={Case:"CaseNumber",ContentDocument:"Title",ContentVersion:"Title",CustomPermission:"MasterLabel",Event:"Subject",FeedItem:"Title",Idea:"Title",PartnerNetworkConnection:"ConnectionName",Solution:"SolutionName",Task:"Subject",WorkOrder:"WorkOrderNumber"},q={CampaignMember:1,AccountContactRole:1,OpportunityContactRole:1,ContractContactRole:1,CaseContactRole:1,CaseComment:1,CaseSolution:1,OpportunityLineItem:1},H="RecordType",W=H+"Id",z={};P.each([C.BUTTONGROUP,C.COMBOBOX,C.MULTIBUTTONGROUP,C.MULTIPICKLIST,C.PICKLIST],function(e,t){z[t]=!0});var Y=1,G=void 0;function J(e){return e===T||e===A}function $(e){if(!e)return!0;if(O([d,E])){if("string"==typeof e)return e===j;if("object"===(void 0===e?"undefined":Ze(e)))return e.name===j}return!1}function K(e){return $(e.getDataSource())}function X(){return!(!window.sforce||!sforce.one)&&sforce.one}function Q(e,t){return-1<_.getWindowLocation().href.indexOf("/lightning/")?"/lightning/r/"+t+"/"+e+"/view":"#/sObject/"+e+"/view"}function Z(e){e.element.off("click.skuidLinkHandler")}function ee(e,t){e.element.on("click.skuidLinkHandler","a",function(e){e.metaKey||(e.preventDefault(),t())})}function te(e,t){ee(e,function(){window.$A.get("e.force:navigateToSObject").setParams({recordId:t}).fire()})}function ae(e,t){ee(e,function(){sforce.one.navigateToSObject(t)})}function ne(){return O(E)&&!!window.$A}function re(e,t){var a,n,r,i=e.metadata.controllingField,o=e.model,s=i&&o.getField(i),l=e.metadata.picklistEntries,d=[];return i&&s?(n=o.getFieldValue(e.row,i,!0),t&&t.length&&(a={},P.each(t,function(){a[this.value]=1})),"BOOLEAN"===s.displaytype?r=n?1:0:P.each(s.picklistEntries,function(e,t){t.value===n&&(r=e)}),(r||0===r)&&l&&P.each(l,function(e,t){(function(e,t){return 0!=(new sforce.Base64Binary("").decode(t).charCodeAt(e>>3)&128>>e%8)})(r,t.validFor)&&(!a||t.value in a)&&d.push(t)}),d):t||l}function ie(t){var e=t.model,a=e.objectName,n=t.item,r=t.metadata,i=r.picklistEntries||[],o=n&&n.ValidRecordTypeIds?n.ValidRecordTypeIds:[],s=e.getFieldValue(t.row,W,!0);return r.uiOnly||r.overrideMetadata&&i.length&&r.customPicklistEntriesProvided?y.deferrable(i):(s&&!o.includes(s)&&o.push(s),o.length?Be(a,t.id,o,e).then(function(e){return e||(e=t.picklistEntries||t.metadata.picklistEntries),re(t,e)}):y.deferrable(re(t)))}function oe(){return!!(window.sforce&&window.sforce.console&&window.sforce.console.isInConsole())&&window.sforce.console}function se(e){for(;M(e);)try{e=JSON.parse(e)}catch(e){break}return e}function le(e){var t=e.split(".")[0];return _.endsWith(t,"__r")||_.endsWith(t,"__pr")?t.substring(0,t.length-1)+"c":t+"Id"}function de(e){return _.endsWith(e,"__c")||_.endsWith(e,"__pc")?e.substring(0,e.length-1)+"r":e.substring(0,e.length-2)}function ce(a){if(a&&a.fields&&a.fields.length){var e=a.getDataSource&&a.getDataSource(),n=e&&e.getCachedEntityMetadata(a.objectName);P.each(a.fields,function(e,t){!function a(n,e,t,r){if(e){var i,o,s,l,d,c,u=e.split("."),f=r.getDataSource&&r.getDataSource();if("childRelationship"===n.type)(l=n.referenceTo&&n.referenceTo.length&&n.referenceTo[0])&&(d=f&&f.getCachedEntityMetadata(l.o),(c=n.subFields)&&P.each(c,function(e,t){a(t,t.id,d,r)}));else if(1===u.length){if(i=t&&t.getField&&t.getField(e)){o=r.getOverrideableFieldMetadata(n);var p=n.id,m=n.name;P.extend(!0,n,i),p&&(n.id=p),m&&(n.name=m),o&&P.each(o,function(e,t){n[e]=t})}if(n&&n.function){var h=n.function;if(h){h=h.toUpperCase();var g=f&&f.getDisplayTypeForFieldFunction(h,n);0===h.lastIndexOf("COUNT",0)?n.displaytype=C.INTEGER:J(n.displaytype)&&g===N?n.displaytype=C.STRING:n.displaytype===A&&g===T&&(n.displaytype=T),n.required=n.createable=n.editable=!1}}var b,v,y,S;n&&n.displaytype===I&&(n.relationshipName||(n.relationshipName=n.rel),!n.ref&&n.referenceTo&&(b=n.referenceTo)&&b.length&&(v=[],y=[],S={c:"createable",o:"objectName",l:"label",k:"keyPrefix",p:"labelPlural",s:"searchable"},P.each(b,function(e,a){a.o&&(v.push(a.o),y.push(a.k),P.each(S,function(e,t){a[t]=a[e],delete a[e]}),a.accessible=!0)}),v.length&&(n.ref=v.join(",")),y.length&&(n.refprefix=y.join(","))))}else e=le(e=u.shift()),(i=t&&e&&t.getField&&t.getField(e))&&((s=i.referenceTo)&&1===s.length?t=f&&f.getCachedEntityMetadata(s[0].objectName||s[0].o):s&&1<s.length&&(t=f&&f.getCachedEntityMetadata("Name")),t&&a(n,u.join("."),t,r)),n.required=n.createable=n.editable=!1}}(t,t.id,n,a)})}return a}function ue(e){if(!e)return"";var t=e.statusCode,a=e.body,n=t&&e.status?t+" "+e.status+": ":"";return(a=se(a))instanceof Array&&1===a.length?n+=a[0].message:a&&a.message?n+=a.message:e.error&&(n+=e.error),n}function fe(d){var c=_.combineUrls(d.serviceUrl,"/services/apexrest/skuid/api/v1/");return d._sfdcRemote=[{name:"load",pathName:"models"},{name:"save",pathName:"models"},{name:"getModelMetadata",pathName:"models"},{name:"getEntityList",pathName:"models"},{name:"doSearch",pathName:"models"},{name:"checkMetadataApiAccess",pathName:"models"},{name:"approvalsProcessWorkItem",pathName:"approvals"},{name:"approvalsUnlockRecord",pathName:"approvals"},{name:"sendEmail",pathName:"models"}].reduce(function(e,t){return e[t.name]=function(s){var l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"models";return function(e){var t,a,n,r=P.Deferred(),i=e&&!M(e)?JSON.stringify(e):e||null,o=0;return d.name===j?(n=[],i&&n.push(i),n.push(function(e,t){var a;if(t.status){if(M(e))try{e=JSON.parse(e)}catch(e){}r.resolve(e)}else a=t.message,w.platform.isPlatformSessionError(a,d)?w.platform.attemptLogin(o).then(function(){o++,w.remote()[s].apply(window,n)}).catch(function(){r.reject(a)}):r.reject(a)},{escape:!1}),w.remote()[s].apply(window,n)):(a={method:t=i?"POST":"GET",url:c+l,headers:{"x-skuid-rest-service-method":s,"X-SKUID-REST-SERVICE-METHOD":s}},"POST"==t&&(a.body=i,a.contentType="application/json"),d.makeRequest(d.createHTTPRequest(a)).then(function(e){var t=e.body,a=e.statusCode;e.error?r.reject(e.error):t&&(t=se(t),P.inArray(a,[200,201,204])<0?r.reject(ue(e)):t&&t.error&&1===_.size(t)?"Invalid Skuid Model API request method: null"===t.error&&O(p.NATIVE)?r.reject("The version of Skuid installed in the target Salesforce org is not compatible with Skuid Platform. Please install the latest version of Skuid into this Salesforce org."):r.reject(t.error):r.resolve(t))},function(e){r.reject(ue(e))})),r.promise()}}(t.name,t.pathName),e},{})}function pe(e){var t=e._sfdcRemote;return t||(t=new fe(e)),t}function me(){return w.utils.userInfo}function he(e){var t=e.path,a=e.basePath||"";return e.dataSource&&e.dataSource.name===j&&(a=""),e.accessToken=e.accessToken||me().sessionId,e.url=_.getSafeRelativeUrl(a+"/services/data"+t),function(e){var t,a=e.fields,n=e.file,r=e.payloadField,i=e.url,o="formboundary"+Math.random().toString(36).substr(2,10),s=e.filename||n.name,l=e.dataSource;t=new Blob(["--boundary_"+o+'\nContent-Disposition: form-data; name="entity_content";\nContent-Type: application/json\n\n'+JSON.stringify(a)+"\n\n--boundary_"+o+"\nContent-Type: "+n.type+'\nContent-Disposition: form-data; name="'+r+'"; filename="'+s+'"\n\n',n,"\n--boundary_"+o+"--"],{type:'multipart/form-data; boundary="boundary_'+o+'"'});var d=l.createHTTPRequest({url:i,headers:{},method:"POST"});return d.headers.Accept="application/json",l.name===j&&(d.headers.Authorization="Bearer "+me().sessionId),P.extend(d,{body:t,cache:!1,contentType:!!l.useProxy&&'multipart/form-data; boundary="boundary_'+o+'"',processData:!1}),_._ie&&(d.contentType='multipart/form-data; boundary="boundary_'+o+'"'),l.makeRequest(d)}(e)}function ge(n,e,t,a){var r,i=[],o={errors:i},s=!0;function l(e,t){var a=n[e];if(a&&a.length===t)for(r=0;r<t;r++)a[r].success||(a[r].errors&&a[r].errors.length&&Array.prototype.push.apply(i,a[r].errors),s=!1);else s=!1}return e&&l("insertResults",e),t&&l("updateResults",t),a&&l("deleteResults",a),o.success=!i.length&&s,o}function be(e){var t=P.Deferred(),a=e.paramString||"",n=e.dataSource,r=e.fileField,i=e.context,o=void 0,s=void 0,l=void 0,d=void 0,c=void 0;if(i){var u=i.row,f=i.model;i.id?l=i.id:u&&(r?l=(d=f.getField(r))&&"REFERENCE"===d.displaytype?(s=r.substr(0,r.length-1),_.getObjectProperty(u,s+"r.skuid__AttachmentId__c")):_.getObjectProperty(u,r):f&&("skuid__Image__c"===(o=f.objectName)?l=u.skuid__AttachmentId__c:"Attachment"===o&&(l=f.getRowId(u))))}return l?n.name===j?t.resolve(_.getUrlFromAttachmentId(l+a)):(c=n.serviceUrl+"/services/data/v"+V+"/sobjects/Attachment/"+l+"/body",n.authenticate().then(function(){return n.makeRequest(n.createHTTPRequest({url:c,accept:"application/octet-stream"}))}).then(function(e){t.resolve("data:;base64,"+e.body)},function(e){t.reject(e)})):t.reject("No Attachment Id"),t.promise()}function ve(e,t){if(M(e))return t({message:a+": "+e});t({message:w.ajax.getErrorMessage(e,a)})}function ye(n,i,r,e,a,t){var o,s=r.uploadMethod.dataSource,l=i.model,d=i.row,c={model:l,row:d},u={createFields:!1},f=i.options.xmlDef,p=i.ownerIdField||f&&f.attr("owneridfield")||"",m=d&&p&&d[p]?d[p]:"",h=r.description?x(r.description,c,u):"",g=_.renameFileWhileKeepingExtension(n.name,r.fileNameOverride?_.mergeAsTextInContext(r.fileNameOverride,c):""),b=r.feedtext?x(r.feedtext,c,u):"",v=r.errMessageInLightning;function y(){var e=w.page?w.page.community:null;return e?e.id:null}function S(e){ve(e,a)}function C(e){var t={Origin:e,PathOnClient:g,Description:h},a=y();return l&&("ContentDocument"===l.objectName?t.ContentDocumentId=l.getRowId(d):"contentdocumentwithrecord"===r.storeAs&&(t.FirstPublishLocationId=l.getRowId(d))),a&&(t.NetworkId=a),he({path:"/v"+V+"/sobjects/ContentVersion",basePath:s&&s.serviceUrl,fields:t,payloadField:"VersionData",file:n,filename:g,dataSource:s})}if(e({fileName:g}),O(E))return a({message:v||"This file storage location is not supported in Lightning"}),!1;if("record"===r.storeAs){var I={ParentId:i.model.getRowId(i.row),Name:g,ContentType:n.type,Description:h};m&&(I.OwnerId=m),he({path:"/v"+V+"/sobjects/Attachment",basePath:s&&s.serviceUrl,fields:I,payloadField:"Body",file:n,filename:g,dataSource:s}).then(function(e){var t=(e&&_.parseAsJSONIfString(e.response||e.body)).id;a({newFileId:t,newFileName:g})},S,function(e){t(e)})}else if("field"===r.storeAs){var N,T,A="/v"+V+"/sobjects/Attachment",R=i.fieldValue,F=!1;(function(){var n=P.Deferred();if(R)n.resolve(R);else{var e=[],t={id:"updateObject",updates:{},type:i.model.objectName},a=i.model.getRowId(i.row);t.updates[a]={},t.updates[a][i.fieldName]="1",e.push({id:"imageImageInsert",inserts:{1:{}},type:"skuid__Image__c"},t),pe(s).save(JSON.stringify({operations:e,rollbackOnAnyError:!0})).then(function(e){var t,a="";e.globalErrors&&e.globalErrors.length?a+=e.globalErrors.join(", "):e.insertResults&&1===e.insertResults.length&&e.updateResults&&1===e.updateResults.length?e.insertResults[0].success&&e.updateResults[0].success?t=e.insertResults[0].id:(P.each(e.insertResults[0].errors,function(){a+=this.message}),P.each(e.updateResults[0].errors,function(){a+=this.message})):a+="Error Uploading File",t?n.resolve(t):n.reject(a)},function(e){n.reject(e&&e.error)})}return n.promise()})().then(function(e){var t=i.fileId;T=e,t&&e&&(F=!0,A+="/"+t+"?_HttpMethod=PATCH");var a={Name:g,ContentType:n.type,Description:h};return!t&&e&&(a.ParentId=e),he({path:A,basePath:s&&s.serviceUrl,fields:a,payloadField:"Body",file:n,filename:g,dataSource:s})}).then(function(e){var t=i.fileId,a=e&&(e.response||e.body);if(t?N=t:a&&(a=_.parseAsJSONIfString(a),N=a.id),F){var n=[],r={id:"updateObject",updates:{},type:"skuid__Image__c"};return r.updates[T]={Name:g},n.push(r),pe(s).save(JSON.stringify({operations:n,rollbackOnAnyError:!0}))}return P.when()}).then(function(){a({newFileId:N,newFileName:g,newFieldValue:T})},S,function(e){t(e)})}else"chatterfeed"===r.storeAs?he({path:"/v35.0"+((o=y())?"/connect/communities/"+o:"")+"/chatter/feed-elements",basePath:s&&s.serviceUrl,fields:{body:{messageSegments:[{type:"Text",text:b}]},capabilities:{content:{description:h,title:g}},feedElementType:"FeedItem",subjectId:i.model.getRowId(i.row)},payloadField:"feedElementFileUpload",file:n,filename:g,dataSource:s}).then(function(){if(a(),window.chatter&&s.name===j){var e=chatter.getFeed(),t=e.getConfig();e.refresh({feedType:t.feedType,isFullRefresh:!0,params:t})}},S,function(e){t(e)}):"chatterfiles"===r.storeAs?C("H").then(function(){a()},S,function(e){t(e)}):"contentdocument"!==r.storeAs&&"contentdocumentwithrecord"!==r.storeAs||C("C").then(function(){a()},S,function(e){t(e)})}function Se(e,t,a,n,o){var r=t.model,i=t.row,s=_.renameFileWhileKeepingExtension(e.name,a.fileNameOverride?_.mergeAsTextInContext(a.fileNameOverride,{model:r,row:i}):""),l=a.uploadMethod.dataSource,d=l&&l.serviceUrl?l.serviceUrl:"",c=a.description?x(a.description,null,null):"",u=function(e){ve(e,o)};n({fileName:s}),_.readFileAsBase64(e).then(function(e){var t,a,n,r=s.split("."),i="";1<r.length&&(i=r.pop().toUpperCase()),s=(t=(s=r.join("")+i).match(/[a-z]|[A-Z]|[0-9]/g))?t.join(""):"unnamedResource",/[0-9]/.test(s.charAt(0))&&(s="SR"+s),(a=l.createHTTPRequest({url:d+"/services/data/v"+V+"/sobjects/StaticResource",headers:{"Content-Type":"application/json"},method:"POST"})).headers.Accept="application/json",l.name===j&&(a.headers.Authorization="Bearer "+me().sessionId),n={Name:s,Description:c,ContentType:"application/"+i,Body:e,CacheControl:"Public"},P.extend(a,{body:JSON.stringify(n),contentType:"application/json"}),l.makeRequest(a).then(function(e){var t=e.body,a=t.id||t.Id;void 0!==a&&(n.Id=a),o({record:P.extend(n,e)})},function(t){var e="SELECT Id FROM StaticResource WHERE Name='"+s+"'";l.name===j?w.sfdc.api.query(e).then(function(e){if(e.records&&e.records[0]&&window.confirm('Static Resource "'+s+'" already exists, do you want to overwrite it?'))return n.Id=e.records[0].Id,new w.sfdc.api.SObject("StaticResource",n).update();return P.Deferred().reject(t).promise()}).then(function(){o({record:n})},function(e){u(e)}):u(t)})})}function Ce(e){return e&&e in B?B[e]:e in q||e&&_.endsWith(e,"__x")?"Id":"Name"}function Ie(){return"Id"}function Ne(e,t){var a={Case:["UseActiveAssignmentRule","SendAutoResponseEmails","SendUserNotificationEmails","AllowExternalEmails"],CaseComment:["AllowExternalEmails"],Event:["SendUserNotificationEmails","AllowExternalEmails"],Lead:["UseActiveAssignmentRule","SendAutoResponseEmails","SendUserNotificationEmails","AssignmentRuleId"],Task:["SendUserNotificationEmails"],User:["SendUserNotificationEmails"]};if(e&&e.operations)return t||(t=o),e.operations.forEach(function(e){var t=a[e.type],u=w.$M(e.id);["inserts","updates","changes"].forEach(function(c){e[c]&&P.each(e[c],function(l,d){if(P.each(d,function(e,t){if((_.endsWith(e,"__r")||_.endsWith(e,"__pr"))&&delete d[e],u){var a,n,r,i=u?u.getField(e):null,o=P.isArray(t),s=P.isPlainObject(t);if(n="changes"===c?(a=!!(r=u.getRecordById(l))&&r.isNew(),!!r&&(!r.isNew()&&!r.isMoribund())):(a="inserts"===c,"updates"===c),i){if(a&&!i.createable||n&&!i.editable)return delete d[e],!0;if(s&&i.displaytype===C.OBJECT||o&&i.displaytype===C.ARRAY)return d[e]=JSON.stringify(t),!0}(o||s)&&delete d[e]}}),u&&t){var a=u.changes[l];P.each(t,function(e,t){a.hasOwnProperty(t)&&(d[t]=a[t])})}})})}),t<2?function(e){return{operations:e.operations.map(function(e){var a={updates:e.returning.map(function(e){return{id:e}}),changes:{},id:e.id,type:e.type};return e.inserts&&P.each(e.inserts,function(e,t){a.changes[e]=t}),e.updates&&P.each(e.updates,function(e,t){a.changes[e]=t}),e.deletes&&P.each(e.deletes,function(e){a.changes[e]={__deleted:!0}}),a}),rollbackOnAnyError:e.rollbackOnAnyError}}(e):e}function Te(t,e,a){return function(e,t,a){return"Task"!==t&&"Event"!==t?Ae("/ui-api/object-info/"+t+"/picklist-values/"+a,e,"GET",function(){}).then(function(e){return function(e){var t=e.picklistFieldValues,n={};return P.each(t,function(e,t){var a=_.grab(t,"defaultValue","value");n[e]=P.map(t.values,function(e){return{value:e.value,label:e.label,defaultValue:a&&a===e.value}})}),n}(e)}):_.reject()}(t,e,a).then(function(e){if(!_.size(e))throw new Error;return e}).catch(function(){return function(e,t,a){return Ae("/sobjects/"+t+"/describe/layouts/"+a,e,"GET",function(){}).then(function(e){return function(e){var a={};return e.detailLayoutSections&&e.detailLayoutSections.forEach(function(e){e.layoutRows&&e.layoutRows.forEach(function(e){e.layoutItems&&e.layoutItems.forEach(function(e){e.layoutComponents&&e.layoutComponents.forEach(function(e){var t=_.grab(e,"details","type");t&&(-1<t.indexOf("picklist")||"combobox"===t)&&(a[e.details.name]=e.details.picklistValues)})})})}),a}(e)})}(t,e,a).catch(function(e){throw t[v]=!0,e})})}function Ae(e,t,a,n){var r={type:a=a||"GET",url:e,cache:"GET"===a,dataSource:t,error:n};return w.sfdc.api.makeRequest(r)}var Re=function(e,t){t&&t.addProblem?t.addProblem(e):w.component.getByType("skuidpage")[0].addProblem(e)},Fe=function(e,t){var a=(t=t||{}).needSObject,n=t.isStandard,r=t.sobject,i=t.actionName;return n&&!i&&(i=e),i=i||"",n?"/actions/standard/"+i:a?"/actions/custom/"+e+"/"+r+"/"+i:"/actions/custom/"+e+"/"+i},we=function(c,u,e,f,t){t=t||{};var p=e&&e.component,m=e&&e.propViewer,h=t.needSObject,g=t.isStandard;return{builderProps:function(){var e=[],t="sfdcactionname",a=L(u,"attr"),n=h&&(a("sobject")||"global"),r=y.makeLabelFromId(f),i=a(t),o=Fe(f,{needSObject:h,isStandard:g,sobject:n}),s=(i||g)&&Fe(f,{needSObject:h,isStandard:g,sobject:n,actionName:i}),l=function(e){return function(){_.removeAllAttrsExcept(u,["actionname","datasource","type"].concat(e)),p.save().rebuildProps(m)}};if(h&&e.push({id:"sobject",label:"SObject",type:"combobox",defaultValue:"Global",source:function(){return Ae("/actions/custom/"+f,c).then(function(e){return P.map(e,function(e,t){return{label:t,value:t}})})},onChange:l(["sobject"])}),g||e.push({id:t,label:r+" action",type:"combobox",source:function(){return Ae(o,c).then(function(e){return P.map(e.actions,function(e){return{label:e.label,value:e.name}})})},onChange:l([t,"sobject"])}),s){var d=w.sfdc.api.getCachedResult({type:"GET",url:s,dataSource:c});!d&&s?Ae(s,c).then(function(){p.rebuildProps(m)}):function(l,a,d,c){var u,f=c.children("inputs");if(f.length&&(u=f.children()),u&&u.length){var n=!1;P.each(u,function(e,t){0===a.filter(function(e){return e.name===P(t).attr("name")}).length&&(t.remove(),n=!0)}),n&&d.save()}P.each(a,function(e,t){var a=t.name,n=u?u.filter('[name="'+a+'"]'):[],r=n.length?n.attr("value"):null,i=(t.type||"TEXT").toLowerCase(),o=t.maxOccurs&&1<t.maxOccurs;"sobject"===i&&t.sobjectType&&(i="TEXT");var s={isStateless:!0,value:r,label:t.label,required:t.required,type:i.toLowerCase(),helptext:t.description,onChange:function(e){var t=!!f&&f.children('[name="'+a+'"]');e||!1===e||0===e?(t&&t.length||(t=k("<input/>").attr({name:a,displaytype:i}),(!f||f&&!f.length)&&(f=k("<inputs/>").appendTo(c)),t.appendTo(f)),o&&!t.attr("sendarray")&&t.attr("sendarray",!0),t.attr("value",e)):t.remove(),d.save()}};"picklist"!==i&&"combobox"!==i||(s.picklistEntries=t.picklistValues),l.push(s)})}(e,d.inputs,p,u)}return e},runtimeExecution:function(m,h,r){r=r||{};var g=function(e){var t;return e&&e.length?(t=e[0].outputValues)&&t.output&&t.output.attributes?t.output:t:null},b=function(e,t,a){var n=a.message||a.body;return"Error running "+e+" action"+(t?" "+t:"")+(a?(a.statusCode?": "+a.statusCode:"")+(n?': "'+n+'"':""):"")};return function(e,o,s){var l,d=e.attr("sfdcactionname")||h,t=e.attr("sobject")||"global",c=P.Deferred(),u={},f=!0,a=P.extend({},r,{sobject:t,actionName:d});if(e.children("inputs").children().each(function(){var e=L(P(this),"attr"),t=e("name"),a=e("value"),n=e("displaytype"),r=e("sendarray"),i=_.getContextToUse(o,s);if(!t)return c.reject({$CurrentAction:{error:'Invalid parameter name for Salesforce Action "'+d+'"'}}),f=!1;a=_.mergeAsDataInContext(a,i),n.toUpperCase()===C.BOOLEAN&&(a="true"===a),u[t]="true"===r?[a]:a}),!f)return c.promise();o&&o.button&&o.button.startProcessing();var n={inputs:[u]},p=Fe(h,a);return w.sfdc.api.makeRequest({type:"POST",url:p,dataSource:m,data:n,crossDomain:!0,success:function(e){l=g(e),c.resolve({$PreviousAction:{result:l}})},error:function(e){var r,t=_.parseAsJSONIfString(e.responseJSON);"string"==typeof t&&(t=e);var a=!("object"!==(void 0===t?"undefined":Ze(t))||t instanceof Array);if(t&&t.length||a){var n=a?t:t[0];if(n.errors&&n.errors.length||a){var i=a?n:n.errors[0];"apex"===h&&"INVALID_INPUT"===i.statusCode?(r=b(h,d,i)+". Attempting to run action one more time without the invalid input parameter.",Re(r,o),Ae(p,m,"GET").then(function(e){var n={};(e=_.parseAsJSONIfString(e)).inputs&&e.inputs.length&&P.each(e.inputs,function(e,t){for(var a in u)a===t.name&&(n[a]=u[a])});var t={inputs:[n]};w.sfdc.api.makeRequest({type:"POST",url:p,dataSource:m,data:t,crossDomain:!0,success:function(e){l=g(e),c.resolve({$PreviousAction:{result:l}})},error:function(e){var t,a=_.parseAsJSONIfString(e.responseJSON)[0];a.errors&&a.errors.length&&(t=a.errors[0]),r=b(h,d,t),Re(r,o);var n=t.message||"Error running custom Apex action "+d;c.reject({$CurrentAction:{error:n}})}})},function(){c.reject({$CurrentAction:{error:"Error getting updated inputs for custom Apex action"}})})):(r=b(h,d&&d!==h?d:null,i),Re(r,o),c.reject({$CurrentAction:{error:i.message||i.body}}))}else Re(r="Error running "+h+" action",o),c.reject({$CurrentAction:{error:"Unknown error with custom Apex action"}})}}}).always(function(){o&&o.button&&o.button.stopProcessing()}),c.promise()}}(c,f,t),label:t.label||y.makeLabelFromId(f),name:f}},Ee=function(d){return function(e,t,a,n){var r=e.attr("workitemid"),i=e.attr("comments"),o=e.attr("nextapproverid"),s=_.getContextToUse(t,a),l={actionType:d,workItemId:_.mergeAsDataInContext(r,s),comments:_.mergeAsDataInContext(i,s)};return d!==c&&o&&(l.nextApproverId=_.mergeAsDataInContext(o,s)),n.authenticate().then(function(){return pe(n).approvalsProcessWorkItem(JSON.stringify(l))}).catch(function(e){return Re(e,t),_.reject({$CurrentAction:{error:e}})})}},je=function(e,t,a,n){var r=_.getContextToUse(t,a),i=_.mergeAsDataInContext(e.attr("recordid"),r);if(i)return n.authenticate().then(function(){return pe(n).approvalsUnlockRecord(i)}).catch(function(e){return Re(e,t),_.reject({$CurrentAction:{error:e}})});var o="You must provide a valid record Id.";return Re(o,t),_.reject({$CurrentAction:{error:o}})},Pe=function(t,e,a,n){var r=function(e){return _.mergeAsDataInContext(t.attr(e),a)},i=r("to"),o=r("cc"),s=r("bcc"),l=r("prettySender"),d=r("subject"),c=r("body"),u=r("htmlBody"),f=r("replyTo"),p=S(i),m=S(o),h=S(s);if(R(p,h,m)){var g=[];if(p.length||g.push("Email must have recipients"),d.length||g.push("Email subject cannot be empty"),f.length||g.push("Reply To cannot be empty"),c.length||g.push("Email body cannot be empty"),g.length)return void w.component.getByType("skuidpage")[0].addProblem(g.join("\n"));var b={partitionedDestinations:F(p,m,h,10),prettySender:l,replyTo:f,subject:d,body:c,htmlBody:u};return pe(n).sendEmail(JSON.stringify(b))}},_e=function(e,t){return _.parseAsJSONIfString(e.getCacheProperty(t,"sessionStorage"))||{}},Oe=function(e){var a={};return P.each(e,function(e,t){a[t]=e}),a},xe={getMapOfPicklistValuesToEntries:function(e){if(!e)return{};var t=e.metadata&&e.metadata.picklistEntries||e.picklistEntries,a={};return P.each(t,function(e,t){a[t.value]=t}),a},getCurrentlyCachedFieldsMap:function(e,t){var a=e.getCachedEntityMetadata(t);return a?a.getFieldsMap():{}},getRecordTypeMetadata:function(e,t,a){var i=this,n=e[b];if(n||(n=e[b]={}),n[a])return n[a];var r=_e(e,f+"."+a);if(_.size(r)&&3===r.length){var o=r[0];if(!Ue({modstamp:r[1],__uid:r[2]},e)){var s=Oe(_e(e,g+".picklist")),l=Oe(_e(e,g+".value")),d=i.getCurrentlyCachedFieldsMap(e,t),c=_.isUndefined,u=n[a]={};return P.each(o,function(e,t){var a=s[t[0]],n=i.getMapOfPicklistValuesToEntries(d[a]),r=t[2];!c(a)&&d[a]&&(u[a]=P.map(t[1],function(e){var t=l[e];if(!c(t)&&(!n||n[t]&&n[t].active))return{value:t,label:n[t]&&n[t].label||t,defaultValue:e===r}}))}),u}}},storeRecordTypeMetadata:function(e,t,a){var n=a;Ve(n);var r=_e(e,g),o=r.value||{},s=r.picklist||{},l=Object.keys(o).length,d=Object.keys(s).length,c=[],u=_.isUndefined,i=[c,n.modstamp,n.__uid];P.each(n.metadata,function(e,t){var r=[],i=[],a=s[e];c.push(i),u(a)&&(a=s[e]=d,d++),i.push(a,r),P.each(t,function(e,t){var a=_.decodeHTML(t.value),n=o[a];u(n)&&(n=o[a]=l,l++),r.push(n),t.defaultValue&&i.push(n)})}),this.safeUpdateCache(e,g,"picklist",s),this.safeUpdateCache(e,g,"value",o),this.safeUpdateCache(e,f,n.id,i)},persistCache:function(e){e.persistBatchCache("sessionStorage")},safeUpdateCache:function(e,t,a,n){var r=e.getCacheProperty(t,"sessionStorage")||{};r[a]=n,e.batchCacheProperty(t,r,"sessionStorage")},clear:function(e){delete e[b],e.clearPropertiesCache()}};function Me(i,e,o){return _.isApiEnabled()&&!o[v]&&e&&e.length?P.when.all(P.map(e,function(a){var e=xe.getRecordTypeMetadata(o,i,a);if(e)return{metadata:e,id:a};var n=i+a,r=o[l]=o[l]||{},t=r[n];return t||(r[n]=Te(o,i,a).then(function(e){delete r[n];var t={metadata:e,id:a};return xe.storeRecordTypeMetadata(o,i,t),{metadata:xe.getRecordTypeMetadata(o,i,a),id:a}}).catch(function(e){throw delete r[n],e}))})).then(function(e){xe.persistCache(o);var a={};return P.each(e,function(e,t){a[t.id]=t.metadata}),a}).catch(function(){}):r()}function ke(e){var t=_.runningTests()?null:n[e];return t||((t=_.sessionStorage(e))?(t=JSON.parse(t),n[e]=t):null)}function Le(e,t){(n[e]=t)&&!t.__isFailure&&_.sessionStorage(e,JSON.stringify(t))}function Ue(e,t){var a=e.__uid,n=a===De()||a===function(e){if(e){var t=e.authentication,a=!!t&&t.responseBody;return a||(a=t.responseBody=e.getStoredAuthData()),a?a.access_token:void 0}}(t),r=!e.modstamp||w.page.modstamp&&e.modstamp<w.page.modstamp,i=t&&t._metadataCacheVersion&&t._metadataCacheVersion>e.modstamp;return!n||r||i}function De(){return G||(G=function(e){var t,a,n=0;if(0===e.length)return n;for(t=0,a=e.length;t<a;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}(me().sessionId)),G}function Ve(e,t){if(!e)return!1;var a=(new Date).getTime();a<w.page.modstamp&&(a=w.page.modstamp),e.modstamp=a,e.__uid=De()||_.grab(t,"authentication","responseBody","access_token")}function Be(e,o,t,a){var n=a&&a.dataSource||w.dataSource.get(j);return Me(e,t,n).then(function(n){if(n){var r={},i=[];return P.each(t,function(e,t){var a=n[t]&&n[t][o];a&&P.each(a,function(e,t){r[t.value]||(i.push(t),r[t.value]=!0)})}),i}})}function qe(e,t,a,n){var r,i=xe.getRecordTypeMetadata(n,a,t);if(i)return(r=i[e.id])?u(r):e.metadata?e.metadata.picklistEntries:e.picklistEntries}function He(e){var t=We(e);return t||ze(e),(t=We(e))&&t.recordTypeId}function We(e){return e._defaultRecordType||ze(e),e._defaultRecordType}function ze(e,t){var a,n,r=[];if(t||(t=P.map(e.conditions,function(e){if(!e.inactive)return e})),Ye(e)&&P.each(e.recordTypeInfos,function(){if(this.isDefaultRecordTypeMapping&&!this.isMaster)return a=this.recordTypeId,!1}),e.createable&&t&&P.each(t,function(e,t){!t.inactive&&t.field&&t.field===W&&t.value&&"null"!=t.value&&15<=t.value.length&&(a=t.value,r.unshift(e))}),a){var i=a.substring(0,15);P.each(e.recordTypeInfos,function(){if(this.recordTypeId.substring(0,15)===i)return a=(n=this).recordTypeId,!1})}return e._defaultRecordType=n,r.length&&P.each(r,function(){t.splice(this,1)}),n}function Ye(e){return e.recordTypeInfos&&1<e.recordTypeInfos.length}function Ge(e){var t=e.metadata||e,a=t&&t.picklistEntries;return!!(t.overrideMetadata&&a&&a.length&&t.customPicklistEntriesProvided)}function Je(e,t){var a=e.metadata||e;return Ye(t)&&function(e){return!!z[e.displaytype]}(a)&&!Ge(e)&&!a.uiOnly}function $e(e,t,a,n,r){r||(r={});var i=w.ui.getFieldRenderer(e),o=a.model,s=a.row,l=a.metadata,d=o.getDataSource(),c=a.row&&(s[W]||s[H]&&s[H].Id),u=!!r.picklistEntries,f=Ye(o)&&c,p=Ge(a);if(l.uiOnly||u||d[v]||p||!f||function(e,t,a,n){var r=n.metadata&&n.metadata.id,i=xe.getRecordTypeMetadata(e,t,a);return!!(i&&_.size(i)&&i[r])||(e[b]&&delete e[b][a],!1)}(o.dataSource,o.objectName,c,a))return e===m&&"edit"!==t?i[t](a,n,";",r):i[t](a,n,r);w.ui.fieldRenderers[h].read(a,w.$L("Loading")),ie(a).then(function(e){a.render({picklistEntries:e}),w.events.publish("salesforce.async.field.rendered",[a])}).catch(function(){a.render()})}function Ke(n){return{read:function(e,t,a){return $e(n,"read",e,t,a)},readonly:function(e,t,a){return $e(n,"readonly",e,t,a)},edit:function(e,t,a){return $e(n,"edit",e,t,a)}}}function Xe(e){var l=P.Deferred(),t='<?xml version="1.0" encoding="utf-8"?><env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><env:Header><urn:SessionHeader xmlns:urn="http://soap.sforce.com/2006/04/metadata"><urn:sessionId>'+sforce.connection.sessionId+"</urn:sessionId></urn:SessionHeader></env:Header><env:Body>"+e.body+"</env:Body></env:Envelope>";return e.dataSource.name!==j?y.deferrable():(P.ajax({type:"POST",url:"/services/Soap/m/40.0",beforeSend:function(e){e.setRequestHeader("SOAPAction",'""'),e.setRequestHeader("Content-Type","text/xml")},data:t}).done(function(e,t,a){var n="",r=k(a.responseText),i=r.find("errors"),o=r.find("result"),s={};i.length&&P.each(i,function(){n+=P(this).children("message").text()+"\n"}),n?l.reject(n):(P.each(o.children(),function(e,t){t=P(t),s[t.prop("tagName")]=t.text()}),l.resolve(s))}).fail(function(e,t,a){l.reject(a.status)}),l.promise())}new w.dataSource.DataSourceType({name:j,prefillMetadataForObject:function(e){ce(e.data)},getNameField:Ce,getIdField:Ie,getIdFieldForChildRelationship:function(){return"Id"},getKeyPrefix:function(e,t){return t.keyPrefix},getValueKeyPrefix:function(e){return e.substring(0,3)},getRowId:function(e,t){return t.getFieldValue(e,"Id",!0)},getRowName:function(e,t){return t.getFieldValue(e,Ce(t.objectName),!0)},getValidPicklistEntries:ie,getValidPicklistEntriesSync:function(e){var t=e.row,a=e.model.getDataSource(),n=e.model.objectName,r=t&&(t[W]||t[H]&&t[H].Id);return re(e,Ge(e)?e.metadata.picklistEntries:qe(e,r,n,a)||e.metadata.picklistEntries)},save:function(a,e){var n=e.dataSource,r=n.getCacheProperty(i);return r||(r=o,n.setPersistentCacheProperty(i,r)),n.authenticate().then(function(){return pe(n).save(Ne(a,r)).then(function(e){return e},function(e){if(e&&-1<e.indexOf("Invalid Skuid Save request - could not deserialize JSON into valid Save Request")){var t=2<=r?1:2;return pe(n).save(Ne(a,t)).then(function(e){return n.setPersistentCacheProperty(i,t),e})}return e})})},makeMetadataApiRequest:Xe,checkMetadataApiAccess:function(e){return pe(e).checkMetadataApiAccess()},addRemoteSiteSetting:function(e){var t=e.dataSource,a=e.url,n=e.name||a.substring(a.indexOf("://")+3).replace(/[\W]+/g,""),r='<createMetadata><metadata xsi:type="RemoteSiteSetting"><fullName>'+(40<n.length?n.substring(0,40):n)+"</fullName><description>"+e.description+"</description><disableProtocolSecurity>false</disableProtocolSecurity><isActive>true</isActive><url>"+a+"</url></metadata></createMetadata>";return t.name!==j?y.deferrable():Xe({dataSource:t,body:r})},fieldRenderers:function(){return{PICKLIST:Ke(e),MULTIPICKLIST:Ke(m)}},onSelectEntity:function(e,t,a,n){var r=e,i=n.getCachedEntityMetadata(r).getField(W),o=a.state.children("fields").empty();i&&(o.append(k('<field id="'+W+'"/>'),k('<field id="'+H+'.Name"/>')),n.getCachedEntityMetadata(H)||n.getEntityMetadata({entities:[H]}))},load:function(r,e){var t,i=e.dataSource;return i.authenticate().then(function(){var e,t=["conditionLogic","doQuery","forView","groupByMethod","havingLogic","id","objectName","orderByClause","offsetPageNumber","offsetPageSize","offsetSize","queryAllRows","recordsLimit","type"],a=P.map(r,function(i){var o={};for(var e in i)i.hasOwnProperty(e)&&-1<P.inArray(e,t)&&(o[e]=i[e]);return P.each(["fields","groupByFields"],function(e,t){var a,n=i[t];n&&n.length&&(a=o[t]=[],P.each(n,function(e,n){var r;n.uiOnly?r=n:"childRelationship"===n.type?(r={id:n.id,type:n.type},P.each(["recordsLimit","orderByClause","subConditionLogic"],function(e,t){n.hasOwnProperty(t)&&null!==n[t]&&void 0!==n[t]&&(r[t]=n[t])}),n.subConditions&&(r.subConditions=[],n.subConditions.length&&P.each(n.subConditions,function(e,t){var a={};for(var n in t)t.hasOwnProperty(n)&&null!==t[n]&&void 0!==t[n]&&(a[n]=t[n]);r.subConditions.push(a)})),n.subFields&&(r.subFields=[],n.subFields.length&&P.each(n.subFields,function(e,t){var a={id:t.id};void 0!==n.query&&null!==n.query&&(a.query=a.query),r.subFields.push(a)}))):(r={id:n.id},P.each(["name","function","query","convertToUserTimezone"],function(e,t){n.hasOwnProperty(t)&&null!==n[t]&&(r[t]=n[t])})),a.push(r)}))}),P.each(["conditions","havings"],function(e,t){var r,a=i[t];a&&a.length&&(r=o[t]=[],P.each(a,function(e,t){var a=P.extend({},t);for(var n in a)null===a[n]&&delete a[n];r.push(a)}))}),"OpportunityLineItem"===o.objectName&&"aggregate"!==i.type&&(o.fields=function(e){var t=e.fields;if("OpportunityLineItem"===e.objectName&&"aggregate"!==e.type){for(var a=0;a<t.length;a++)if("UnitPrice"===t[a].id)return t;t.push({id:"UnitPrice"})}return t}(o)),o}),n=function(d,c,u){var f=void 0,p=void 0;if(!u._metadataCacheVersion||0===u._metadataCacheVersion){for(f=0;f<c.length;f++)if(!c[f].hasMetadataLoaded())return!1;return!0}var e=function(){var e=d[f],t=c[f],a={},n=u.entityMetadataCache[e.objectName];if(t.hasMetadataLoaded())return"continue";if(!e.hasOwnProperty("accessible"))return{v:!1};if(!e.fields)return"continue";if(!(n&&n._m&&n._m.fields))return{v:!1};var r=n._m.fields;for(P.each(r,function(e,t){t.rel&&t.referenceTo&&(a[t.rel]={fieldFrom:t.id,entityAssociated:t.referenceTo[0].o?t.referenceTo[0].o:t.referenceTo[0].objectname}),a[t.id]=r[e]}),p=0;p<e.fields.length;p++){var i=e.fields[p];if(-1!==i.id.indexOf(".")){var o=le(i.id),s=n&&o&&n.getField&&n.getField(o);if(s){var l=s.referenceTo;if(l&&1===l.length?n=u&&u.getCachedEntityMetadata(l[0].objectName||l[0].o):l&&1<l.length&&(n=u&&u.getCachedEntityMetadata("Name")),!n)return{v:!1}}}else if(!a[i.id])return{v:!1}}t.setMetadataHasLoaded()};for(f=0;f<d.length;f++){var t=e();switch(t){case"continue":continue;default:if("object"===(void 0===t?"undefined":Ze(t)))return t.v}}return!0}(a,r,i);return e=n?{operationModels:a,options:{excludeMetadata:n}}:a,pe(i).load(e)}).then(function(e){var t;if(P.isArray(e))return e;if(e&&e.models)return(t=e.metadata)&&_.size(t)&&P.each(t,function(e,t){i.cacheEntityMetadata(e,t)}),e.models;throw"Invalid Response Format"}).then(function(e){return function(e,a){var t,r={};return P.each(e,function(e,t){if(!t.data||!t.data.length){var a=w.$M(t.id);if(a&&a.createRowIfNoneFound||t.createRowIfNoneFound){var n=He(t);n&&(r[t.objectName]||(r[t.objectName]={}),r[t.objectName][n]=!0)}}}),t=P.map(r,function(e,t){return Me(t,P.map(e,function(e,t){return t}),a)}),P.when.all(t)}(t=e,i)}).then(function(){return t})},getUserInfo:function(e){var t,a=e.authentication,n=a&&a.responseBody;return e.name===j&&_.inPlatform([d,E])?r(me()):(n&&(t=n.id),n&&t?(t=(t=t.replace("https://","")).substring(t.indexOf("/")),w.ajax.proxy(e.createHTTPRequest({url:_.combineUrls(e.serviceUrl,t),method:"GET",contentType:"application/json"})).then(function(e){var t=_.parseAsJSONIfString(e.body);return{email:t.email,firstName:t.first_name,lastName:t.last_name,name:t.display_name,userId:t.user_id,userName:t.username}})):r())},getUserInfoProperties:function(){return[{label:"First Name",value:"firstname"},{label:"Last Name",value:"lastname"},{label:"Email",value:"email"},{label:"Full Name",value:"name"},{label:"User Id",value:"userid",defaultValue:!0},{label:"User Name",value:"username"}]},getActions:function(e){var t=Fe("",{isStandard:!0}),s=_.mergeArrays;return Ae(t,e).then(function(o){return function(t,a,n){var r,e=(o&&o.actions||[]).filter(function(e){return"submit"!=e.name||(r=we(t,a,n,e.name,{isStandard:!0,label:e.label}),!1)}).map(function(e){return we(t,a,n,e.name,{isStandard:!0,label:e.label})}),i=[{label:"Standard",value:"-",disabled:!0}];return s(i,e),i.push({label:"",value:"-",disabled:!0},{label:"Custom",value:"-",disabled:!0},we(t,a,n,"apex"),we(t,a,n,"flow"),we(t,a,n,"emailAlert",{needSObject:!0}),we(t,a,n,"quickAction",{needSObject:!0}),{builderProps:[{id:"modelid",label:"Model",type:"model"},{id:"batchsize",label:"Batch Size",type:"number"},{id:"stepmessage",label:"Step Message",type:"template"},{id:"finishmessage",label:"Finish Message",type:"template"},{id:"cancelchanges",label:"Cancel Model Changes",type:"boolean",defaultValue:!1}],name:"loadAllRemainingRecords",label:"Load All Remaining Records",runtimeExecution:function(e,a,n){var t=e.attr(),r=t.modelid,i=t.batchsize,o=t.cancelchanges,s=w.$M(r),l=e.find("stepmessage").text(),d=e.find("finishmessage").text();if(i&&(i=parseInt(i,10)),!s)return _.reject('The model "'+r+'" could not be resolved.');a&&a.button&&a.button.startProcessing(),s.hasChanged&&"true"===o&&s.cancel();var c=s.data.length,u=P("<div>").text("Loading all remaining records for "+s.id);return P.blockUI({message:u}),P.when(s.loadAllRemainingRecords({isAction:!0,dataSourceLimit:function(e){return!(1e4<e.offsetPageSize*e.offsetPageNumber||i&&2e3<e.offsetPageSize*e.offsetPageNumber)},stepCallback:function(e,t){l?u.text(w.utils.mergeAsTextInContext(l,Qe({},n,{$CurrentAction:{nextStartRecord:e,nextFinishRecord:t}}))):u.text(w.label.merge(w.$L("Retrieving_records_a_to_b"),e,t))},finishCallback:function(e){d?(d=w.utils.mergeAsTextInContext(d,Qe({},n,{$CurrentAction:{totalRecords:e-c}})),u.text(d)):u.text(w.label.merge(w.$L("All_a_Rows_Loaded_For_b"),e,s.id)),setTimeout(function(){return P.unblockUI()},w.utils.runningTests()?1:1500)},batchSize:i},n)).then(function(e){if(e.models)for(var t in e.models)e.models[t].notifyEditorsOfDataRefresh();return a&&a.button&&a.button.stopProcessing(),e||_.reject("An error occurred when retrieving records")}).catch(function(e){return P.unblockUI(),a&&a.button&&a.button.stopProcessing(),_.reject({$PreviousAction:{error:e}})})}}),s(i,[{builderProps:[{id:"to",label:"To",type:"template",displayAs:"input",location:"attribute"},{id:"cc",label:"Cc",type:"template",displayAs:"input",location:"attribute"},{id:"bcc",label:"Bcc",type:"template",displayAs:"input",location:"attribute"},{id:"prettySender",label:"Email Display Name",helptext:"The name that will be displayed beside the email address of the sender. Typically the first and last name of the sender or the name of an organization.",type:"template",displayAs:"input",location:"attribute"},{id:"replyTo",label:"Reply To",helptext:"The address used when a recipient replies to an email.",type:"template",displayAs:"input",location:"attribute"},{id:"subject",label:"Subject",type:"template",location:"attribute"},{id:"body",label:"Plain Text Body",type:"template",location:"attribute"},{id:"htmlBody",label:"HTML Body",type:"template",location:"attribute"}],runtimeExecution:Pe,label:"Send HTML Email",name:"send-html-email"}]),i.push({label:"",value:"-",disabled:!0},{label:"Approvals",value:"-",disabled:!0}),r&&i.push(r),s(i,function(){var e=[{label:"Work Item Id",id:"workitemid",type:"template",location:"attribute",displayAs:"input",helptext:"The Id of the Salesforce ProcessInstanceWorkItem on which the action is being performed."},{label:"Comments",id:"comments",type:"template",location:"attribute",displayAs:"input",helptext:"(Optional) Adds comments to the approval history for this action."}];return[{name:"approvals-approve",label:"Approve",builderProps:e.concat([{label:"Next Approver Id",id:"nextapproverid",type:"template",location:"attribute",displayAs:"input",helptext:"(Optional) The user Id of the next approver. This property only applies if the next approval step allows users to manually choose a next approver."}]),runtimeExecution:Ee("Approve")},{name:"approvals-reject",label:"Reject",builderProps:e,runtimeExecution:Ee("Reject")},{name:"approvals-recall",label:"Recall",builderProps:e,runtimeExecution:Ee(c)},{name:"approvals-unlock",label:"Unlock Record",builderProps:[{label:"Record Id",id:"recordid",type:"template",location:"attribute",displayAs:"input",helptext:"Id of the record to unlock."}],runtimeExecution:je}]}()),i}})},getEntityList:function(e){var t=_.sObjectList,a=e.dataSource;return a.name===j&&t?P.Deferred().resolve(t).promise():a.authenticate().then(function(){return pe(a).getEntityList()})},handleDefaultReferenceFieldValue:function(e,a,t,n,r){var i=n.rel,o=a.value,s=_.getNameField(n.ref),l=a.nameFieldValue||!1;if(l||n.ref!==H||P.each(t.recordTypeInfos,function(){if(this.recordTypeId===o)return l=this.name,!1}),!l){if(a.model){var d=w.$M(a.model),c=d.getDataSourceType().name===j;d&&d.data.length&&P.each(d.data,function(e,t){if(o===d.getRowId(t)||c&&o===t.Id15){var a=d.getRecordForRow(t);return l=a?a.get():t,!1}})}if(!l){var u=_.getFieldReference(a.field,n);P.each(r,function(e,t){t===a||t.field!==u||t.inactive||!t.value||a.operator&&"="!==a.operator||(l=t.value)})}}var f,p={};l&&("object"===(void 0===l?"undefined":Ze(l))?f=l:(f={})[s]=l,p[i]=f);p[a.field]=o,t.updateRow(e,p)},coerceCreateRow:function(e,t,a){var n,r,i=t,o=e.row(),s={};o.Id=e.id(),ze(t,a),n=He(t),r=We(t);var l=_.grab(t,"fieldsMap",W);l&&l.overrideMetadata&&!_.isUndefined(l.defaultValue)||n&&(s[W]=n,r&&(s[H]={Name:r.name}),i.updateRow(o,s,{preventSetActive:!0}))},coerceUpdateRows:function(b,e,t){if(!t.preventTrackChanges)if("Opportunity"===b.objectName)P.each(e,function(e,a){var t="StageName",n="Probability",r="ForecastCategoryName",i="ForecastCategory",o=b.changes[e],s=o&&o[t],l=a[t],d=b.getField(t),c=d&&d.fieldMappings;if(l&&c){var u=b.getField(n),f=b.getField(r),p=b.getField(i);if(s){var m=!1,h=!1,g=!1;P.each(c,function(e,t){t.MasterLabel===s&&(n in o&&o[n]!==t.DefaultProbability&&(m=!0),r in o&&o[r]!==t[r]&&(h=!0),i in o&&o[i]!==t[r]&&(g=!0))}),m&&h&&g||P.each(c,function(e,t){t.MasterLabel===l&&(u&&!m&&(a[n]=t.DefaultProbability),f&&!h&&(a[r]=t[r]),p&&!g&&(a[i]=t[r]))})}else o?P.each(c,function(e,t){t.MasterLabel===l&&(u&&!o[n]&&(a[n]=t.DefaultProbability),f&&!o[r]&&(a[r]=t[r]),p&&!o[i]&&(a[i]=t[r]))}):P.each(c,function(e,t){t.MasterLabel===l&&(u&&(a[n]=t.DefaultProbability),f&&(a[r]=t[r]),p&&(a[i]=t[r]))})}});else if("OpportunityLineItem"===b.objectName&&"aggregate"!==b.type){var l="Quantity",d="UnitPrice",c="TotalPrice",u=!1;P.each(e,function(e,t){var a=b.changes[e],n=!1,r=!1,i=!1;if((l in t||a&&l in a)&&(n=!0),(d in t||a&&d in a)&&(r=!0),(c in t||a&&c in a)&&(i=!0),n&&!r&&!i){var o=b.getRowById(e),s=b.getFieldValue(o,d,!0);t.UnitPrice=s,u=!0}}),u&&(t.alwaysAddChanges=!0)}},coerceMassUpdate:function(n){"Opportunity"===n.objectName&&(n.getField("StageName")&&P.each(["ForecastCategory","ForecastCategoryName","Probability"],function(e,t){var a=n.getField(t);a&&(a.needsEditor=!0)}))},coerceDefaultValue:function(e,t){var a,n,r,i=e.displaytype,o=He(t);return Je(e,t)&&(r=qe(e,o,t.objectName,t.getDataSource()))&&r.length&&(P.each(r,function(e,t){if(t.defaultValue&&"false"!==t.defaultValue)return a=t.value,!1}),a&&0!==a&&"null"!=a&&(i===s&&(a=!0===a||"true"===a),n=a)),n},determineIfCreateRowNeedsMetadata:function(e){for(var t=e.fields,a=0;a<t.length;a++)if(Je(t[a],e))return!0},loadDefaultValueMetadata:function(e,t){if(Je(e,t)){var a=He(t);return this.getMetadataForRecordTypes(t.objectName,[a],t.dataSource)}return P.when()},getReferenceFieldNameFromRelationshipField:le,getReferenceFieldRelationshipName:de,isRelationshipField:function(e){return _.contains(e,".")},getReferenceFieldRelatedData:function(e,n,t,a,r){var i,o=e.id,s=de(o);if(void 0===r[s]){if(P.each(a.data,function(){if(this[o]&&(this[o]===n||this[o].length&&15<=this[o].length&&this[o].substr(0,15)===n)&&a.getFieldValue(this,s))return i=a.getFieldValue(this,s,!0),!1}),!i){var l=e.referenceTo,d=[],c=[];l&&l.length&&P.each(l,function(){d.push(this.keyPrefix),c.push(this.objectName)}),1<d.length&&15<=n.length&&(d=[n.substring(0,3)]),P.each(d,function(e,t){P.each(w.model.getModelsByKeyPrefix(t)||[],function(){var a=this;if(a.data&&a.data.forEach(function(e){if(a.getRowId(e)===n||e.Id15&&e.Id15===n){var t=a.getRecordForRow(e);return i=t?t.get():e,!1}}),i)return!1})})}if(!i){var u=a.dataSource&&a.dataSource.name;P.each(w.model.getModelsByDataSource(u),function(){var t=this,r=[];if(t!==a)return P.each(this.fields,function(){var a=this,n=a.referenceTo;n&&n.length&&P.each(c,function(e,t){P.each(n,function(){t===this.objectName&&r.push(a)})})}),r.length&&P.each(t.getRows(),function(){var e=this;if(P.each(r,function(){if(t.getFieldValue(e,this.id,!0)===n)return i=t.getFieldValue(e,this.rel,!0),!1}),i)return!1}),!i&&void 0})}return i}},search:function(t){var a=t.dataSource,n=t.returning;return delete t.dataSource,n&&Array.isArray(n)&&(t.returning=n.reduce(function(e,t){return t.objectName&&(e[t.objectName]=t),e},{})),pe(a).doSearch(t).then(function(e){return e.results&&e.results.forEach(function(e){var t=e.objectName,a=n[t];a&&(e.objectMapKey=a.objectMapKey,e.modelName=a.modelName)}),t.dataSource=a,e.request=t,e})},buildEntityMetadataRequest:function(e){var t=e.targetEntity;return!t&&e.model&&e.model.attr&&(t=e.model.attr("sobject")),{objectName:t}},clientSideCacheIsEnabled:function(e){return!(!e._metadataCacheVersion||0==e._metadataCacheVersion||null==e._metadataCacheVersion)},dataSourceProvidesLanguageDetails:function(){return me().language},getEntityMetadataLoadingMessageFromBreadcrumb:function(e){return"Loading metadata for object "+e.endsobject+"..."},getEntityMetadataCacheKey:function(e){return e.objectName},getEntityMetadata:function(e){var t=P.Deferred(),a=e.entities,o=e.dataSource,s=e.ignoreMetadataOverrides?"true":"false";return a?o.authenticate().then(function(){var i=[];P.each(a,function(e,t){var a=P.Deferred(),n=M(t)?t:t.objectName,r={sObjectName:n,loadChildRelationships:"true",loadPicklistValues:"false",ignoreMetadataOverrides:s};if(i.push(a.promise()),!n)return a.reject("Error: no Salesforce Object Name was specified for Model."),!0;t&&t.fields&&t.fields.length&&(r.fieldsToLoad=t.fields.join(","),P.isPlainObject(t.fields[0])&&(r.fieldsToLoad=t.fields.map(function(e){return e.id}).join(","))),pe(o).getModelMetadata(r).then(function(e){e?e instanceof Array&&e.length?a.resolve(P.map(e,function(e){return ce(e),e})):(ce(e),a.resolve(e)):a.resolve(e)},function(e){a.reject("There was an error retrieving metadata for object: "+n+": "+e)})}),P.when.all(i).then(function(e){t.resolve(e)},function(e){t.reject(e&&e.length?e.join(","):"")})},function(e){t.reject("Unable to authenticate to Salesforce. Metadata could not be retrieved. "+e)}):t.reject("No SObject provided."),t.promise()},getGroupingMethodsPicklistEntries:function(){return[{value:"simple",label:"Simple"},{value:"rollup",label:"Rollup"}]},getImageSources:function(e){var t={attachment:{label:"Attachment",needsRecordContext:!0,needsFieldContext:!0,relatedObjectName:"skuid__Image__c",automaticFieldMappings:{Attachment:!0,skuid__Image__c:!0},getSrc:be}};return e&&e.name===j&&(t.staticresource={label:"Static Resource",builderProps:function(e,t,a){var n=a.additionalOnRefresh,r=a.additionalOnRebuildAndRefresh,i=a.prefix||"",o=[],s=i+"resource",l=i+"resourceNamespace",d=i+"resourceContentType",c=i+"path",u={},f=!0;return u[s]="{{#NamespacePrefix}}{{{NamespacePrefix}}}__{{/NamespacePrefix}}{{{Name}}}",u[l]="{{{NamespacePrefix}}}",u[d]="{{{ContentType}}}",t.attr(d)&&(f=t.attr(d)===p.MIME_TYPES.ZIP),o.push(w.platform.builder.getStaticResourceProperty({id:s,valueTemplates:u,onChange:function(){t.attr(c)&&(t.removeAttr(c),e.save()),e.refresh().rebuildProps(),r&&r()}})),t.attr(s)&&f&&o.push(w.platform.builder.getNestedPathProperty({id:c,state:t,nameProperty:s,namespaceProperty:l,onChange:function(){e.refresh(),n&&n()}})),o},getSrc:function(e){var t,a,n=P.Deferred(),r=e.prefix||"",i=e.xmlDef&&e.xmlDef.attr(r+"resource"),o=e.xmlDef&&e.xmlDef.attr(r+"path"),s=e.context,l=e.mergeSettings;return o&&(o=_.mergeAsTextInContext(o,s,l)),i&&(i=_.mergeAsTextInContext(i,s,l))&&2===(a=i.split("__")).length&&(t=a[0],i=a[1]),i?n.resolve(_.getStaticResourceUrl(i,t,o)):n.reject("No Resource Provided"),n.promise()}}),t},getMetadataCacheVersion:function(){return Y},getReferenceHandler:function(){return{getBaseReferenceProps:function(e){return[{id:"targetobjects",type:"sobject",readonly:!1,label:"SObject Type",dataSourceName:w.dataSource.getDataSourceFromXML(e.state).name}]},getOverrideBatchProperties:function(){return[{type:"helptext",html:"Specify fields that will be added as related data. Any fields that are used in search or display templates will need to be added here."}]},getOverrideBatchNoItemsFunction:function(){return function(){return P("<div>").text("(Loading key field only.)")}},getOverrideBatchFieldChildrenFunction:function(t){return function(){return[{id:"batchfield",indent:1,linkedComponent:t,addtooltip:"Add New Batch Load Field",labelFunction:function(e){return e.attr("field")||"[No Field Selected]"},defaultStateFunction:function(){return k("<batchfield/>")},propsFunction:function(e){return[{id:"field",type:"field",label:"Field",sobject:t.state.attr("targetobjects"),dataSourceName:t.state.attr("datasource"),onChange:function(){e.refresh().rebuildProps()}}]}}]}},getMetadataHandler:function(e,t,a,n,r){var i,o=e.children("batchfields").first().children("batchfield"),s=e.attr("keyfield")||"Id",l=e.attr("targetobjects"),d=e.attr("ogdisplaytype"),c=e.attr("rel")||n+"__r";if(t.keyField=s,t.originalDisplayType=d,l&&(i=l.split(","),t.isNamePointing=1<i.length,(r||d&&d!==I)&&(t.relationshipName=t.rel=c),t.referenceTo=P.map(i,function(e){return{accessible:!0,objectName:e}}),t.ref=l),!r&&d&&d!==I){var u=w.dataSource.getDataSourceFromXML(e),f=new w.model.Model({dataSource:u});f.id="_ReferenceLabelModel_"+(new Date).getTime()+c,o&&o.length?f.fields=P.map(o,function(e){return{id:P(e).attr("field")}}):f.fields=[{id:s}],f.doQuery=!0,f.doClone=!1,f.objectName=l,f.initialize();var p=new w.model.Condition;p.name="__reference_batch",p.operator="in",f.addCondition(p),a.batchLabelModels||(a.batchLabelModels={}),a.batchLabelModels[n]=f}},getReferenceValue:function(e,t){return e[t.keyField||"Id"]},getRowFromReferenceValue:function(e,t,a){var n=e.getRows([{field:a.keyField||"Id",value:t}]);return n&&n.length?n[0]:{}},processReferenceLookupModel:function(e,t,a){e.objectName=a,"OwnerId"===t.id&&"Group"===a&&e.addCondition({field:"Type",value:"Queue",inactive:!1}),"recordtype"==a.toLowerCase()&&(e.rTypeFor=t.model.objectName,e.addCondition({field:"SObjectType",value:e.rTypeFor,inactive:!1,type:"fieldvalue"}))}}},getUploadMethods:function(e){var n={id:"autorefreshmodels",type:"boolean",label:"Auto-refresh related models on successful upload",defaultValue:!0,helptext:"If true, then upon successful file upload, Skuid will automatically attempt to find related models that are displaying file data, and Skuid will cancel changes in these models and then re-query them."},r={id:"uselightninguploader",type:"boolean",label:"Use Lightning's File Upload Component",platform:[d,E],defaultValue:!1,init:function(e){var t=e.component.state,a=e.propElem,n=e.label;t&&0<t.parents("popup").length&&(this.readonly=!0,n&&n.addClass("nx-basicfieldeditor-item-disabled"),a&&a.skootip("Property not supported in popups"))},helptext:"When checked, and user is in Lightning runtime, Salesforce's File Upload component is substituted for Skuid's File Upload component to bypass file size limitations. See documentation for details."},t=e&&e.name===w.platform.getDefaultDataSourceName()||!1;function a(e,t,a,n,r,i){e.size<65e4?function(g,b,v,y,S){var C=v.uploadMethod.dataSource;_.readFileAsBase64(g).then(function(e){var t,a,n,l,d,r=[],i={},o={},s={},c=b.model,u=b.row,f=b.options.xmlDef,p=b.ownerIdField||f&&f.attr("owneridfield")||"",m=u&&c?c.getRowId(u):null,h=u&&p&&u[p]?u[p]:"";i.id="imageAttachmentUpload",i.type="Attachment",o.id="imageImageInsert",o.type="skuid__Image__c",s.id="updateObject",s.type=c.objectName,a=v.description?x(v.description,{row:u,model:c},{createFields:!1}):"",l=_.renameFileWhileKeepingExtension(g.name,v.fileNameOverride?_.mergeAsTextInContext(v.fileNameOverride,{model:c,row:u}):"",{maxlen:255}),n=b.fieldValue,t=b.fileId,"field"===v.storeAs?d=t&&n?(o.id="imageImageUpdate",o.updates={},o.updates[n]={Name:l},i.deletes={},i.deletes[t]={Id:t},i.inserts={1:{ParentId:n,Body:e,Name:l,ContentType:g.type,Description:a}},r.push(i,o),"AttachmentUpdate"):n?(o.id="imageImageUpdate",o.updates={},o.updates[n]={Name:l},i.inserts={1:{ParentId:n,Body:e,Name:l,ContentType:g.type,Description:a}},r.push(i,o),"CreateAttachmentToImage"):(o.inserts={1:{}},i.inserts={2:{ParentId:"1",Body:e,Name:l,ContentType:g.type,Description:a}},s.updates={},s.updates[m]={},s.updates[m][b.fieldName]="1",r.push(o,i,s),"CreateFileAndAttachment"):"record"===v.storeAs&&(i.inserts={1:{ParentId:m,Body:e,Name:l,ContentType:g.type,Description:a}},h&&(i.inserts[1].OwnerId=h),r.push(i),d="CreateAttachment"),y({fileName:l}),pe(C).save(JSON.stringify({operations:r,rollbackOnAnyError:!0})).then(function(e){var t,a,n,r,i,o=e.insertResults,s=b.fieldValue;"AttachmentUpdate"===d?(i=ge(e,1,1,1)).success?(t=o[0].id,a=s):(r="Failure Updating Attachment",n=i.errors):"CreateAttachmentToImage"===d?(i=ge(e,1,1,0)).success?(t=o[0].id,a=s):(r="Failure Creating Attachment",n=i.errors):"CreateAttachment"===d?(i=ge(e,1,0,0)).success?t=o[0].id:(r="Failure Creating Attachment",n=i.errors):"CreateFileAndAttachment"===d&&((i=ge(e,2,1,0)).success?(t=o[1].id,a=o[0].id):(r="Failure Creating File and Attachment",n=i.errors)),r&&n&&n.length&&(r+=": "+P.map(n,function(e){return e.message}).join(", ")),S({newFileId:t,newFieldValue:a,newFileName:l,message:r})},function(e){S({message:e&&e.error})})},function(e){S(e)})}(e,t,a,n,r):ye(e,t,Qe(a,{errMessageInLightning:"Cannot upload large files in Lightning"}),n,r,i)}function i(e){var t=e.component,a=_.getContextToUse(t),n=t.fieldName,r=a.model,i=a.row,o=r.objectName,s=r.getRowId(i),l=this.dataSource,d=r.getFieldValue(a.row,n,!0),c={id:"objdelete",updates:{},type:o},u={id:"imagedelete",deletes:{},type:"skuid__Image__c"};return c.updates[s]={},c.updates[s][n]="",u.deletes[d]={},pe(l).save(JSON.stringify({operations:[c,u]}))}function o(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},r=e.model.getRowId(e.row),i=t.attr("id"),o=n.fileNameOverride&&_.mergeAsTextInContext(n.fileNameOverride,e),s=n.description&&_.mergeAsTextInContext(n.description,e,{createFields:!1});return this.dataSource.name===j?(w.page.runningOnForceSite?w.page.currentSiteUrl:"/")+"apex/UploadImage?id="+r+(a?"&objfield="+a:"")+"&elid="+i+(s?"&desc="+s:"")+(o?"&filenameoverride="+o:""):""}function s(){return this.dataSource.name===j}var l={record:{label:"In Attachment to Record",relatedObjectName:"Attachment",needsRecordContext:!0,forceStoreAsFileName:!0,upload:a,getSrc:be,deleteFile:i,supportsIframeUpload:s,getIframeSrc:o,builderProps:[{id:"owneridfield",helptext:"If left blank, owner of record will be creator of attachment",type:"field",addFieldToModel:!0,label:"Custom Owner Id Field",modelprop:"model"}]},chatterfeed:{label:"In Chatter Feed Item",relatedObjectName:"ContentVersion",needsRecordContext:!0,upload:ye,builderProps:[{id:"feedtext",type:"text",label:"Feed Text"}]},field:{label:"In Field on Record",needsRecordContext:!0,needsFieldContext:!0,upload:a,getSrc:be,deleteFile:i,supportsIframeUpload:s,getIframeSrc:o,getFileIdField:function(e){return e.substr(0,e.length-1)+"r.skuid__AttachmentId__c"},getFileNameField:function(e){return e.substr(0,e.length-1)+"r.Name"}},chatterfiles:{label:"In Chatter Files",relatedObjectName:"ContentVersion",upload:ye},contentdocument:{label:"In Content Document",relatedObjectName:"ContentVersion",upload:ye,supportsLightningUploader:t},contentdocumentwithrecord:{label:"In Content Document (with Record Context)",relatedObjectName:"ContentVersion",needsRecordContext:!0,upload:ye,supportsLightningUploader:t},staticresource:{label:"In Static Resource",canRunPostUploadSnippet:!0,upload:Se,hideInBuilder:!0}};return P.each(l,function(e,t){var a=t.builderProps;t.relatedObjectName&&(a||(a=t.builderProps=[]),a.push(n)),!0===t.supportsLightningUploader&&(a||(a=t.builderProps=[]),a.push(r))}),l},getDefaultFieldsForReferenceField:function(e,t,a){var n,r=t.referenceTo[0].objectName,i=[];return n=t.referenceTo.length<2?_.getFieldReference(e,t,a):_.getFieldRelationshipName(e,t)+".Name",i.push(n),"skuid__Image__c"===r&&i.push(_.getFieldRelationshipName(e,t)+".skuid__AttachmentId__c"),i},getNameFieldURLForReferenceField:function(e,t,a){var n,r,i=e.options.fieldXML,o=i&&i.attr("redirecttype")||"datasourcedefault",s=w.dataSource.DataSourceType.prototype.getNameFieldURLForReferenceField;return"datasourcedefault"!==o?s(e,t,a):K(e.model)&&t&&t.length?(r='<a href="',n=t.substring(0,3),Z(e),ne()?(r+=Q(t,e.metadata.referenceTo.find(function(e){return e.keyPrefix===n}).objectName),te(e,t)):X()?(r+=_.getSafeRelativeUrl("/"+t),ae(e,t)):oe()?(r+=_.getSafeRelativeUrl("/"+t),function(e,t){ee(e,function(){w.ui.openConsoleTabForField(e._GUID,e.model.id,t)})}(e,t)):r+=_.getSafeRelativeUrl("/"+t),r+='" tabindex="-1">'+a+"</a>"):void 0},getNameFieldURLForTextField:function(e,t,a){var n,r,i,o=e.metadata,s=e.model,l=a,d=e.row,c=s.getRowId(d),u=o&&"URL"===o.displaytype,f=ne(),p=X(),m=oe(),h=t,g=e.options.fieldXML;return"datasourcedefault"!==(g&&g.attr("redirecttype")||"datasourcedefault")?this.getNameFieldURLForReferenceField(e,t,a):(Z(e),!e.options.noLink&&!s.isSingleRow()&&K(s)&&_.userInfo.isAuthenticated&&(o&&o.nameField||["FirstName","LastName","Company"].includes(e.id))&&!s.isNewRow(d)&&-1===e.id.indexOf(".")?(h=l,l='<a href="',f?(l+=Q(c,s.objectName),te(e,c)):p?(l+=_.getSafeRelativeUrl("/"+c),ae(e,c)):m?(l+=_.getSafeRelativeUrl("/"+c),ee(e,function(){w.ui.openConsoleTabForNameField(c,s.id)})):l+=_.getSafeRelativeUrl("/"+c),l+'">'+U(h)+"</a>"):u?(n=l&&D(l,"/"),i=U(h),r=U(l),n&&ee(e,function(){f?window.$A.get("e.force:navigateToURL").setParams({url:h}).fire():p?sforce.one.navigateToURL(h):m&&w.ui.openConsoleTabForUrl(h,i)}),'<a href="'+i+'"'+(n?"":' target="blank"')+">"+r+"</a>"):void 0)},coerceStartingPageSize:function(e){2e3<e.recordsLimit?e.offsetPageSize=2e3:e.offsetPageSize=e.recordsLimit||100},getModelProperties:function(a,e,n){var r=this,t=w.builder.core,i=a.state,o=function(){return(i.attr("datasource")||i.attr("service")||j)===j},s=t.getUnsavedChangesWarningProperty({component:a}),l=t.getCoreModelBasicProperties({component:a,propViewer:e}),d=[];return l.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,dataSourceName:i.attr("datasource")||i.attr("service"),label:"Salesforce Object Name",onChange:function(e,t){r.onSelectEntity(e,t,a,n),a.refresh(),w.mobile&&w.mobile.processResponsiveElements()}},t.getModelTypeProperty({component:a}),t.getModelQueryOnPageLoadProperty({component:a,propViewer:e})),o()&&"aggregate"!==i.attr("type")&&d.push({id:"doclone",type:"picklist",label:"Clone data returned by Model query",helptext:"Should all data returned by querying this Model be 'cloned', meaning that data in the Model will be marked as 'New' so that when the Model is saved, new records will be created, rather than updates made to existing records?",picklistEntries:[{label:"Yes, always",value:"yes"},{label:"Yes, if 'clone' and 'id' parameters are present in URL",value:""},{label:"No",value:"no"}],defaultValue:""}),d.push({id:"queryallrows",type:"boolean",label:"Query Deleted / Archived records",helptext:'For developers: adds the SOQL "ALL ROWS" clause to your query. If true, then deleted records and/or archived Tasks will be included in your Model\'s query --- by default, they are not.'},{id:"forview",type:"boolean",label:'Update Salesforce "Recently Viewed" info',helptext:"For developers: adds the SOQL \"FOR VIEW\" clause to your query. Use this if you want this Model to feed into Salesforce's tracking of Recently Viewed Items. When this Model's query is run, the LastViewedDate for all records in this Model will be updated, and new records will be added to the RecentlyViewed object. "}),o()?(w.offline.isEnabled()||d.push({id:"processonclient",type:"boolean",defaultValue:t.pageModel&&t.pageModel.getFieldValue(t.pageRow,"skuid__MasterPage__c")&&"true"===t.getMasterPageXML().attr("cachepage"),label:"Process Model client-side",onChange:function(){a.refresh().rebuildProps()},helptext:"If this page, or its master page, has Page Caching enabled, this is HIGHLY RECOMMENDED, unless you expect this Model's data to rarely change. Causes Skuid to construct this Model client-side in JavaScript rather than server-side, which prevents your Model metadata and data from being cached, which could result in stale / inaccurate metadata/data being presented to your users."}),"true"===i.attr("processonclient")&&l.push(t.getAsyncLoadProperty({component:a})),d.push({defaultValue:!1,id:"nativeuiautosync",type:"boolean",label:"Auto-sync with other Lightning Components",helptext:"If enabled, then when this Skuid Page is used in Lightning Experience or Salesforce1, Skuid will automatically update this Model's data when other Lightning Components are refreshed, and Skuid will automatically notify other components whenever this Model is saved."})):l.push(t.getAsyncLoadProperty({component:a})),l.push(t.getModelLimitProperty(),t.getModelOrderByProperty(),t.getCreateDefaultRowProperty()),s&&d.push(s),Array.prototype.push.apply(d,t.getModelLabelProperties()),[{name:"Basic",props:l},{name:"Advanced",props:d}]},getAggregateFieldProperties:function(t,a){var n=t.state,r=w.builder.core;return[{id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:!0,picklistEntries:[{label:"COUNT",value:"COUNT"},{label:"COUNT DISTINCT",value:"COUNT_DISTINCT"},{label:"SUM",value:"SUM"},{label:"AVG",value:"AVG"},{label:"MAX",value:"MAX"},{label:"MIN",value:"MIN"}],onChange:function(e){e&&n.attr("name",r.getDefaultAliasName(n.attr("id"),e)),t.save().refresh().rebuildProps(a)}}]},getValidFieldFunctionsForField:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=e.displaytype,n=[],r=t.alwaysAddBlank;if(a&&J(a)){var i=a===A,o=!i||r;o&&n.push({label:"--None--",value:"",abbrev:"",defaultValue:!0}),n.push({label:"CALENDAR_MONTH",value:"CALENDAR_MONTH",abbrev:"cm",dt:N},{label:"CALENDAR_QUARTER",value:"CALENDAR_QUARTER",abbrev:"cq",dt:N},{label:"CALENDAR_YEAR",value:"CALENDAR_YEAR",abbrev:"cy",defaultValue:!o,dt:N},{label:"DAY_IN_MONTH",value:"DAY_IN_MONTH",abbrev:"dm",dt:N},{label:"DAY_IN_WEEK",value:"DAY_IN_WEEK",abbrev:"dw",dt:N},{label:"DAY_IN_YEAR",value:"DAY_IN_YEAR",abbrev:"dy",dt:N}),i&&n.push({label:"DAY_ONLY",value:"DAY_ONLY",abbrev:"do",dt:T}),n.push({label:"FISCAL_MONTH",value:"FISCAL_MONTH",abbrev:"fm",dt:N},{label:"FISCAL_QUARTER",value:"FISCAL_QUARTER",abbrev:"fq",dt:N},{label:"FISCAL_YEAR",value:"FISCAL_YEAR",abbrev:"fy",dt:N},{label:"HOUR_IN_DAY",value:"HOUR_IN_DAY",abbrev:"hd",dt:N},{label:"WEEK_IN_MONTH",value:"WEEK_IN_MONTH",abbrev:"wm",dt:N},{label:"WEEK_IN_YEAR",value:"WEEK_IN_YEAR",abbrev:"wy",dt:N})}return n},getFieldFunctionProperty:function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},r="DISTANCE",i=e.state;if(n.isCondition&&w.builder.core.isDistanceQueryable(a.displaytype)){var o=!1,s=function(e,t,a){(a||i.attr(e)!==t)&&(i.attr(e,t),o=!0)};return s("fieldfunction",r),i.attr("units")||s("units","mi",!0),i.attr("value")||s("value","5",!0),s("enclosevalueinquotes","false"),-1===P.inArray(i.attr("operator"),["lt","gt"])&&s("operator","lt",!0),o?(e.save(),n.handleChange&&n.handleChange(),n.handleRefresh&&n.handleRefresh(),!1):{id:"fieldfunction",defaultValue:r,type:"picklist",picklistEntries:[{value:r,label:r}],required:!0,readonly:!0,label:"Field Function"}}var l=Qe({alwaysAddBlank:n.isCondition},n);return w.dataSource.DataSourceType.prototype.getFieldFunctionProperty.apply(this,[e,t,a,l])},getAggregateGroupingProperties:function(e,t,a){var n=[];if(a){var r=this.getFieldFunctionProperty(e,t,a);r&&n.push(r),a.displaytype===A&&n.push({id:"convertToUserTimezone",type:"boolean",label:"Convert to User Timezone",helptext:"Converts date/time values to the running user's time zone before grouping results. The default behavior is to group results based on UTC values.",defaultValue:!1})}return n},processModelXMLExtensions:function(e,t){e.extensions={salesforce:{forView:"true"===t.attr("forview"),nativeUiAutoSync:"true"===t.attr("nativeuiautosync"),objectName:t.attr("sobject"),type:t.attr("type"),queryAllRows:"true"===t.attr("queryallrows")}}},isDataSourceNativeSalesforce:$,getMetadataForRecordTypes:Me,getPicklistEntriesValidForRecordTypes:Be,getAPIDescribeSObject:function(e){if(_.isApiEnabled()){var t="skuid_describeSObject_"+e,a=ke(t),n=!1;if(a?(Ue(a)&&(n=!0),(!a.modstamp||a.modstamp<w.page.modstamp)&&(n=!0)):n=!0,n)try{Ve(a=sforce.connection.describeSObject(e)),Le(t,a)}catch(e){a=null}return a}return!1},getAPIDescribeLayout:function(e){if(_.isApiEnabled()){var t="skuid_describeLayout_"+e,a=ke(t),n=!1;if(a?(Ue(a)&&(n=!0),(!a.modstamp||a.modstamp<w.page.modstamp)&&(n=!0)):n=!0,n)try{Ve(a=sforce.connection.describeLayout(e)),Le(t,a)}catch(e){a=null}return a}return!1},initialize:ce,initializeDataSource:function(e){e.metadataCacheVersion&&(e._metadataCacheVersion=e.metadataCacheVersion,delete e.metadataCacheVersion),e.name===j&&O(E)&&(e.serviceUrl="https://"+w.settings.site("host"))},properties:{composer:{supports:{childRelationships:!0},canFieldsBeSelected:function(e){return!!e.breadcrumb.endsobject||"Select an SObject for this Model"}},canAutoGenerateConditionsFromFields:!0,validConditionTypes:["fieldvalue","multiple","modelmerge","blank","param","userinfo","datasourceuserinfo","join"],canConditionsBeGrouped:!0,hasGlobalSearchEntities:!0,batchableEntityRequests:!0,serverSideModelMerge:!0,offsetLimit:2e3,offline:{createConditionsForConflicts:function(e){return[new w.model.Condition({encloseValueInParens:!0,encloseValueInQuotes:!0,field:"Id",inactive:!1,operator:"in",state:"filterableon",type:"multiple",values:P.map(e.updates,function(e,t){return t})})]}}},_recordTypeCacheStorage:xe,_setMetadataCacheVersion:function(e){Y=e}})}(skuid)}});