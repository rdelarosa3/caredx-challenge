!function(r){var a={};function n(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=r,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=368)}({368:function(e,t,r){"use strict";var L,I,A,a,n,M,E,u,O,F,N,U,c,q,h,f,m,D,o,y,i,x,d,C,w,l,b,g,v,S,p,R,T,j,P,k,_,s,B,V,G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};L=skuid,I=L.$,A=L.utils,a=L.dataSource.utils,n=a.REST,M=A.startsWith,E=A.endsWith,u=A.contains,O=A.isString,F=A.isUndefined,N=A.getObjectProperty,U=A.hasObjectProperty,c=A.makeXMLDoc,q=A.combineUrls,h=L.constants.MIME_TYPES.FORM_URL_ENCODED,f="readwrite",m=A.grab,D=function(){return L.builder?L.builder.core:null},o=function(r,e){var a,t=e.methods;return t&&t.length&&I.each(t,function(e,t){if(t.type===r)return a=t,!1}),a},y=function(e,t){var r=o(e,t);return r||{type:e,verb:t.verb,endpoint:t.endpoint}},i=function(e,t){return!!o(e,t)},x=function(e,t,r,a){return q(e,t)+"__"+r+(a?"__"+a:"")},d=function(e){var t=A.getDisplayTypeOfEntity(e);return"INTEGER"===t?"DOUBLE":t},C={},w=function(e){var t,r;if(e.type===f&&(t=(r=e.methods.filter(function(e){return"query"===e.type})).length?r[0]:!(!e.methods||!e.methods.length)&&e.methods[0]),!t){var a=e.extensions&&e.extensions.rest;t={endpoint:e.serviceUrl||e.endpoint,verb:e.verb,pathToContent:e.pathToContent,type:"query"},a&&(t.payloadSnippet=a.payloadSnippet,t.responseSnippet=a.responseSnippet,t.sendChanges=a.sendChanges,t.useResponseSnippet=a.useResponseSnippet,t.paginationMethod=a.paginationMethod,t.offsetParameter=a.offsetParameter,t.limitMethod=a.limitMethod,t.simpleRecordsLimitParameter=a.simpleRecordsLimitParameter,t.contentType=a.contentType,t.payloadContentType=a.payloadContentType,t.customRequestTemplate=a.customRequestTemplate)}return t},l=function(e){e.fields||(e.fields=[]);var t=i("query",e)||"GET"===e.verb,r=i("insert",e)||"POST"===e.verb,a=i("update",e)||"PATCH"===e.verb||"PUT"===e.verb,n=i("delete",e)||"DELETE"===e.verb;I.each(e.fields,function(e,t){t.accessible=!0,t.uiOnly||(t.createable&&!r&&(t.createable=!1),t.editable&&!a&&(t.editable=!1)),t.displaytype||(t.displaytype=L.constants.DISPLAY_TYPES.TEXT),!1!==t.filterable&&(t.filterable=!0)}),e.accessible=!0,e.createable=r,e.updateable=a,e.deleteable=n,e.queryable=e.filterable=t,e.objectName=e.serviceUrl||e.methods&&e.methods.length&&e.methods[0].endpoint},b=function(e,t){return L.snippet.get(t)({response:e})},g=function(r,a,e){var n=I.extend({},r);return I.each(e,function(e,t){F(r[t])&&(n[t]=a[t])}),n},v=function(e,t){return e.customRequestTemplate?A.mergeAsDataInContext(e.customRequestTemplate,t.context):{}},S=function(e){e||(e={});var t,r=e.component,a=r.state,n=e.propertiesViewer,o=e.onChange||function(){r.rebuildProps(n)},i=[],s=[{name:"Method",props:i}],d=e.type,l="delete"===d,p=a.closest("model").attr("id"),u=-1!==I.inArray(d,["update","insert"]),c=a.attr("sendchanges"),h=a.attr("successif"),f="true"===a.attr("batch"),m=!(!a.attr("verb")||"GET"===a.attr("verb")),y=!(!a.attr("type")||"update"!==a.attr("type")&&"delete"!==a.attr("type")),b=!(!a.attr("sendchanges")||"asjsoninbody"!==a.attr("sendchanges")&&"asnestedjsoninbody"!==a.attr("sendchanges")),g="true"===a.attr("useresponsesnippet"),v=!(!a.attr("sendchanges")||"usetemplaterequest"!==a.attr("sendchanges")),S="simple"===a.attr("paginationmethod"),R="simple"===a.attr("limitmethod"),T=[],P=d+"s",q={value:"custompayloadinbody",label:"As custom payload format in request body"},x={value:"usetemplaterequest",label:"As templated request body"};if(f?"update"===d?T.push({value:"asjsoninbody",label:"As JSON Object in request body"},{value:"asnestedjsoninbody",label:"As nested JSON Object in request body"},q):T.push({value:"asjsoninbody",label:"As JSON Array in request body"},{value:"asnestedjsoninbody",label:"As nested JSON Array in request body"},q):"query"===d||"delete"===d?(T.unshift({value:"",label:"--None--"}),"delete"===d&&T.push({value:"asjsoninbody",label:"As JSON in request body"}),T.push(q,x)):T.push({value:"asjsoninbody",label:"As JSON in request body"},{value:"asnestedjsoninbody",label:"As nested JSON in request body"},{value:"asformdatainbody",label:"As URL-Encoded Form data in request body"},{value:"inheaderperfield",label:"In request headers - one per changed field"},{value:"inqueryparamperfield",label:"In URL parameters - one per changed field"},q,x),i.push({id:"endpoint",type:"template",location:"attribute",displayAs:"textarea",modelName:f?null:p,label:"Data Source URL",helptext:"The relative URL to access on the Data Source. May contain merge syntax, e.g. /products/list , /product/{{Id}} ."}),i.push(D().getDataSourceAccessMethodProperty({onChange:o,type:e.type,state:a})),v&&m&&i.push({id:"customrequesttemplate",type:"template",location:"attribute",displayAs:"textarea",modelName:f?null:p,label:"Custom Request",helptext:'The custom request template. May contain merge syntax, e.g. products/{{id}} or <id="{{Id}}"> .'}),i.push(D().getResponseInterceptionProperty({component:r,propertiesViewer:n})),g&&i.push({id:"responsesnippet",type:"snippet",label:"Response Payload Snippet",helptext:"The snippet to run upon a successful request. The snippet receives the initial request payload as an argument. This snippet then must return a response, which Skuid will use as if it were the payload of the request."}),(u||l)&&i.push({id:"batch",type:"boolean",label:"URL expects batch "+P,helptext:"If true, then Skuid will send all "+P+" in a single batch request. Otherwise, a separate HTTP request will be made for each "+d+"d row",onChange:function(){a.removeAttr("insertresponse createdrecordidlocation pathtocontent").attr("sendchanges","asjsoninbody"),r.save(),o()}}),"query"===d&&(i.push(D().getPathToContentProperty({component:r})),i.push(D().getPayloadContentTypeProperty({onChange:function(e){a.attr("payloadcontenttype",e),r.save().refresh()}}))),m?(i.push({id:"sendchanges",label:"query"===d||"delete"===d?"Request body contents":"Send "+("update"===e.type?"updated":"new")+" field values...",type:"picklist",defaultValue:T[0].value,picklistEntries:T,onChange:o}),"custompayloadinbody"===c&&i.push({id:"payloadsnippet",type:"snippet",label:"Payload Generation Snippet",helptext:"The name of the Snippet to run. Must return a payload, which will be inserted into the request body. Will be handed an object containing the new/changed data (In non-query methods)."},{id:"contenttype",type:"string",label:"Payload Content Type",defaultValue:"application/json",helptext:"The content type of the payload returned by the Payload Generation Snippet, e.g. application/xml, text/plain, application/soap+xml"})):a.removeAttr("payloadsnippet"),(u||f&&l)&&"asnestedjsoninbody"===c&&(t={id:"pathtocontent",type:"string"},f?(t.helptext="Skuid will generate an Array of",l?(t.label="Location of Array of deleted row keys",t.helptext+="the primary keys of deleted rows "):"insert"===d?(t.label="Location of Array of new rows",t.helptext+="each new row's field values "):"update"===d&&(t.label="Location of Array of updated rows",t.helptext+="each changed row's field values"),t.helptext+='and place this within a wrapper object at a location you specify.For instance, if this property is set to "data", then the request body will be \' { "data": [...] } \'.'):(t.label="Location of nested changes",t.helptext='Skuid will nest row changes at this locationwithin the JSON request body. For instance, if this property is set to "data", then the request body will be \'{ "data": { "field":"value"  } }\'.'),i.push(t)),u&&E(c,"perfield")){var C="inheaderperfield"===c?"header":"parameter";i.push({id:"changemapping",label:"Field name to "+C+" name mapping",type:"picklist",defaultValue:"auto",picklistEntries:[{value:"auto",label:"Same names"},{value:"autoprefix",label:"Same names, with added prefix"}],onChange:o}),"autoprefix"===a.attr("changemapping")&&i.push({id:"changemappingprefix",type:"string",label:A.capitalizeFirst(C)+" name prefix"})}if((u||f&&l)&&(i.push({id:"successif",label:"Method succeeds if...",type:"picklist",defaultValue:"requestsucceeds",picklistEntries:[{value:"requestsucceeds",label:"Request succeeds"},{value:"responsefieldispresent",label:'"Success" Field in response body is present'},{value:"responsefieldistrue",label:'"Success" Field in response body is true'},{value:"responsefieldequals",label:'"Success" Field in response body equals a value'},{value:"responsebodyequals",label:"Response body equals a value"},{value:"responseheaderispresent",label:'"Success" Header is present in response'},{value:"responseheaderequals",label:'"Success" Header in response equals a value'}],onChange:o}),M(h,"responsefield")?i.push({id:"successfield",type:"string",label:"Success Field Name"}):M(h,"responseheader")&&i.push({id:"successfield",type:"string",label:"Success Header Name",helptext:"The name of a Header in the response which, if present, indicates that this request succeeded, e.g. X-Record-Created"}),E(h,"equals"))){var w=function(){switch(h){case"responsebodyequals":return"Success Response Body Value";case"responsefieldequals":return"Success Field Value";case"responseheaderequals":return"Success Header Value"}}();i.push({id:"successvalue",type:"string",label:w})}return"insert"!==d||f||(i.push({id:"insertresponse",label:"Response handling",type:"picklist",defaultValue:"recordinbody",picklistEntries:[{value:"recordinbody",label:"Created record will be returned in response body"},{value:"idinbodyfield",label:"Id of created record will be returned in field in response body"},{value:"idinheader",label:"Id of created record will be returned in response header"},{value:"none",label:"No information about created record will be returned"}],onChange:o}),"idinbodyfield"===a.attr("insertresponse")?i.push({id:"createdrecordidlocation",type:"string",label:"Name of Field containing created record's Id",helptext:"What is the name of / path to the Field in the expected response that will contain the created record's id? e.g. id, recordId"}):"idinheader"===a.attr("insertresponse")&&i.push({id:"createdrecordidlocation",type:"string",label:"Name of Header containing created record's Id",helptext:"What is the name of the Header expected in the response that will contain the created record's id? e.g. X-Record-Id, X-New-Record-Id"})),b&&y&&i.push(D().getAllModelFieldsProperty(p)),"query"===d&&(i.push(D().getLimitMethodProperty({component:r,propertiesViewer:n,onChange:function(e){a.attr("limitmethod",e),r.save().refresh().rebuildProps()}})),R?(i.push({id:"simplerecordslimitparameter",type:"string",label:"Limit Parameter",helptext:"The URL parameter to be appended to the REST request that determines the amount of records to be requested. Review the REST service's documentation for the appropriate value."}),i.push(D().getModelLimitProperty())):a.removeAttr("limit simplerecordslimitparameter"),i.push(D().getPaginationMethodProperty({component:r,propertiesViewer:n,onChange:function(e){a.attr("paginationmethod",e),r.save().refresh().rebuildProps()}})),S?i.push({id:"offsetparameter",type:"string",label:"Offset Parameter",helptext:'The URL parameter to be appended to the REST request that, based on the offset in record order, determines which "page" of records to be displayed. Review the REST service\'s documentation for the appropriate value.'}):a.removeAttr("offsetparameter")),s},p=function(e,t,r){var a=t.pathToContent||"0"===t.pathToContent?N(e,t.pathToContent):e,n=r.recordsLimit;if(a.length===1+(0|n))return a.pop(),r.paginationOffset?r.paginationOffset+=n:n},R=function(e){return void 0!==e.paginationMethod},T=function(e){return void 0!==e.offsetParameter},j=A.parseAsJSONIfString,P=a.makeLabelFromId,k=n.generateErrorMessage,_=n.makeRequest,s=n.getIdField,B=n.getRowId,V={runtime:{metadataSource:"local"},composer:{modelConditionLabel:"URL Merge Condition",modelConditionsLabel:"URL Merge Conditions",canFieldsBeSelected:function(e){var t,r=e.model,a=r.attr("type")===f,n=(r.attr("datasource")||r.attr("service"))&&(a?r.children("methods").children("method[verb][verb!=''][endpoint][endpoint!='']").length:r.attr("verb")&&r.attr("endpoint")),o="Select a valid Service URL Endpoint and access method";return"components"===e.mode?(t=r.children("fields").children().length,!(!n&&!t)||"Please either "+o+", or manually add and define expected fields to this Model."):!!n||"Please "+o+"."}},canAutoGenerateConditionsFromFields:!1,validConditionTypes:["fieldvalue","param","userinfo","blank","modelmerge"],canConditionsBeGrouped:!1,canFieldsBeIndividuallySearched:!1,hasGlobalSearchEntities:!0,supportsServerSideSort:!1},new L.dataSource.DataSourceType({buildEntityMetadataRequest:function(e){var t=e.model,r=new L.model.Model(t);return e.ignorePathToContent&&delete r.pathToContent,I.extend(r,{path:e.path||""}),r},coerceConflictModel:function(e,t){t.extensions&&(e.methods=t.extensions.rest.methods),e.type="readwrite"},skipMetadataWhenQueryingFields:function(e){if(e.attr("payloadsnippet")&&"custompayloadinbody"===e.attr("sendchanges"))return!0;var a=!1;return e.find("method[type='query']").each(function(e,t){var r=I(t);if(!r.attr("payloadsnippet")||"custompayloadinbody"!==r.attr("sendchanges")||"GET"===r.attr("verb"))return!1;a=!0}),!!a},getConditionSourceProperties:n.getConditionSourceProperties,getEntityMetadata:function(a){a||(a={});var t=I.Deferred(),e=a.entities,n=a.dataSource,r=[],o=[],i={};return I.each(e,function(t,e){n&&!e.dataSource&&(e.dataSource=n);var r=function(f,n){n||(n={});var m,a,o,e,i,s,t,r,y=I.Deferred(),d=w(f),l=f.dataSource;if(d&&(m=d.endpoint||d.serviceUrl,a=d.verb,o=d.dataType,e=d.pathToContent,s=d.payloadContentType,t="true"===d.useResponseSnippet,r="custompayloadinbody"===d.sendChanges),!m||!a||!l)return y.reject("Cannot retrieve metadata for Model without a valid Data Source, Service Url, and Request Method.").promise();if(d&&"query"!==d.type||r||t){if(f&&f.fields&&f.fields.length){var p={};return I.map(f.fields,function(e){var t,r=e.displaytype;t="BOOLEAN"===r||("DATE"===r||"DATETIME"===r?new Date:"DOUBLE"===r||"NUMBER"===r||"PERCENT"===r?2.2:"INTEGER"===r?2:"PHONE"===r?"(800) 222-3333":"EMAIL"===r?"j@g.co":"ARRAY"===r?[]:"OBJECT"===r?{}:"a"),p[e.id]=t}),y.resolve(p).promise()}return(r||t)&&y.resolve().promise(),y.reject('Unable to retrieve metadata for this Model. If a query method cannot be defined for this Model (i.e. if its purpose is purely for creating/modifying/deleting records, then please click "Add Field" to manually add the fields that you would like to use.').promise()}if(i=x(l.serviceUrl,m,a,e),C[i])return C[i];var b,u,c=A.extractFieldsFromTemplate(m,{ignoreFunctions:!0}),h={},g={},v={},S=n.performingSearch,R=function(e,r){var a=e.split("."),n=v;I.each(a,function(e,t){e===a.length-1?n[t]=r:(n[t]||(n[t]={}),n=n[t])})},T=function(e){var r=I.Deferred(),t=_(f,{url:e,method:a,dataType:o,type:"query"},{isSample:!0});return C[i]=y.promise(),t.done(function(e){var t=e.body;"XML"===s&&(t=A.XMLToJSON(A.parseAsXMLIfString(t))),r.resolve(j(t))}).fail(function(e){r.reject(e)}).always(function(){delete C[i]}),r.promise()},P=function(e,t){var r,i,s,a,n,d,o,l,p=A.generateUniqueId(),u=[],c={};I.each(e,function(e,t){var r={uiOnly:!0};r.id=t.key,r.label=e,r.displaytype="TEXT",r.createable=r.editable=r.accessible=!0,u.push(r),void 0!==t.data&&(c[r.id]=t.data)}),(i=new L.model.Model({id:p,accessible:!0,createable:!0,fields:u,doClone:!1,dataSourceName:"Ui-Only"})).initialize().register(),s=i.createRow(),A.size(c)&&i.updateRow(s,c),r=I.map(u,function(e){return new L.ui.Field(s,i,null,{fieldId:e.id,mode:"edit"})}),a=I('<div title="Please provide sample values for Merge Variables needed for this Model Data Source" class="nx-editor"/>'),n=new L.ui.Editor(a,{showSaveCancel:!1});var h=m;I.each(u,function(e,t){h=h.replace(t.label,"<b>"+t.label+"</b>")}),n.header.append(I('<div class="nx-editor-header-title">').html("<b>Model: </b>"+f.id+"<br/><b>Service URL:</b> "+h).css({color:"black","font-size":"1.2em","font-weight":"400","word-break":"break-all"})),a.append(L.ui.createFieldSet(r,{editor:n})),t&&t.error&&n.handleMessages([{severity:"ERROR",message:t.error}]),o=[{text:"Retrieve metadata",icons:{primary:"ui-icon-check"},click:function(){var o={};I.each(u,function(e,t){var r=t.label,a=t.id,n=i.getFieldValue(s,a,!0);R(r,n),o[r]=n}),b.updateSettings(o),I.blockUI({message:"Retrieving metadata from REST Data Source..."}),T(A.mergeAsText("global",m,{apiExtensions:v})).done(function(e){y.resolve(e),I.unblockUI(),d()}).fail(function(e){I.blockUI({message:e,timeout:5e3})})}},{text:"Cancel",icons:{primary:"ui-icon-close"},click:d=function(){y.reject("All parameters for Model URL not provided --- unable to retrieve metadata for Model"),a.dialog("destroy").remove(),i.unregister()}}],l=function(){I(this).click().find(":input").first().focus()},a.dialog({resizable:!0,modal:!0,width:"50%",open:l,close:function(){d()},buttons:o}),I.unblockUI()};return c&&c.length?(L.builder&&!S&&(b=D().createModelSettingsService(f.id)),u=b?b.getSettings():{},I.each(c,function(e,t){var r,a="var"+e;!0!==n.ignoreCache&&(r=u[t]),g[t]={key:a,data:r},void 0!==r?R(t,r):h[t]={key:"var"+e}}),A.size(h)&&!S?P(h):T(A.mergeAsText("global",m,{apiExtensions:v})).done(function(e){y.resolve(e)}).fail(function(e){P(g,{error:"Unable to retrieve metadata for Model: "+e+". Please check that sample parameters for the Model URL are valid, and then re-request metadata."})})):T(m).done(function(e){y.resolve(e)}).fail(function(e){y.reject('Error connecting to REST Data Source at URL "'+q(l.serviceUrl,m)+'": '+e)}),y.promise()}(e,{ignoreCache:a.ignoreCache,performingSearch:a.performingSearch});r.done(function(e){i[t]=e}),o.push(r)}),I.when.all(o).done(function(){I.each(e,function(e){r.push(i[e])}),t.resolve(r)}).fail(function(e){t.reject(e)}),t.promise()},getEntityMetadataCacheKey:function(e){var t=w(e);return x(e.dataSource.serviceUrl,t.endpoint||t.serviceUrl,t.verb,A.combineStrings(t.pathToContent,e.path,"."))},getEntityMetadataLoadingMessageFromBreadcrumb:function(){return"Loading sample body for REST Data Source..."},getMethodProperties:S,getModelProperties:function(o,i){var s,e,t=L.builder.core,d=o.state,r=!1,l=d.children("methods"),a=d.attr("type")===f,n=t.getUnsavedChangesWarningProperty({component:o}),p=t.getCoreModelBasicProperties({component:o,propViewer:i}),u=[];return l.length&&(s=l.children('[type="query"]').first()).length&&(r=!0),p.push({id:"type",type:"picklist",label:"Model Behavior",defaultValue:"",picklistEntries:[{value:"",label:"Read-Only"},{value:f,label:"Read/Write"}],onChange:function(e,t){var r,a,n;e!==f||t?e||t!==f||(l=d.children("methods")).length&&(s=l.children('[type="query"]').first()).length&&(r=s.attr("pathtocontent"),a=s.attr("verb"),n=s.attr("endpoint"),d.attr({pathtocontent:r,verb:a,endpoint:n}),l.remove(),o.save()):(r=d.attr("pathtocontent"),a=d.attr("verb"),n=d.attr("endpoint"),(l=d.children("methods")).length||(l=c("<methods/>").appendTo(d)),s=c("<method/>").attr({type:"query",verb:a,endpoint:n,pathtocontent:r}).appendTo(l),d.removeAttr("verb endpoint pathtocontent payloadsnippet paginationmethod limitmethod limit offsetparameter simplerecordslimitparameter"),o.save()),o.refresh().rebuildProps(i)}}),a||(e=S({component:o,propertiesViewer:i,type:"query"}))&&e.length&&(e[0].props?Array.prototype.push.apply(p,e[0].props):Array.prototype.push.apply(p,e)),Array.prototype.push.apply(p,t.getModelLabelProperties()),!a||r?p.push(t.getModelQueryOnPageLoadProperty({component:o,propViewer:i})):!r&&a&&"true"===d.attr("query")&&(d.attr("query","false"),o.save()),p.push(t.getAsyncLoadProperty({component:o}),t.getCreateDefaultRowProperty(),t.getModelIdFieldProperty(),t.getModelNameFieldProperty()),n&&u.push(n),[{name:"Basic",props:p},{name:"Advanced",props:u}]},getNameField:n.getNameField,getIdField:s,getRowName:n.getRowName,getRowId:B,getUploadMethods:function(){var e=function(n,o,e,t,r){var a=e.uploadMethod.dataSource,i=A.renameFileWhileKeepingExtension(n.name,e.fileNameOverride?A.mergeAsTextInContext(e.fileNameOverride,e):"");t({fileName:i}),A.readFileAsBase64(n).then(function(e){var t={FileName:i,Body:e,ContentType:n.type},r=o.options.xmlDef.children("beforeuploadactions");if(r.length){var a=I.Deferred();return L.actions.runActionsNode(r,o,{model:o.model,row:o.row,apiExtensions:{$File:{body:t},$Promise:a}}).then(function(){return a})}return t}).then(function(e){var t=o.options.xmlDef.attr("url");o.row&&o.model&&(e.ParentId=o.model.getRowId(o.row),t=A.mergeAsDataInContext(t,A.getContextToUse(o)));var r=a.createHTTPRequest({url:(a.serviceUrl||"")+t,method:"POST"});return r.headers.Accept=L.constants.MIME_TYPES.JSON,r.headers["Content-Type"]=L.constants.MIME_TYPES.JSON,I.extend(r,{body:e}),a.makeRequest(r)}).then(function(e){r({newFileId:e&&e.body&&e.body.id,newFieldValue:e&&e.body&&e.body.id,body:e&&e.body})}).catch(function(e){r({message:L.ajax.getErrorMessage(e)})})};return{uploadfile:{label:"Generic REST Upload",hasDescription:!1,upload:e,builderProps:[{id:"url",type:"text",label:"Upload URL"}]},uploadfilewithcontext:{label:"Generic Rest Upload (With Context)",hasDescription:!1,upload:e,builderProps:[{id:"url",type:"text",label:"Upload URL"}],needsRecordContext:!0,getFileIdField:function(e){return e},getFileNameField:function(e){return e},getSrc:function(e){var t=e.component,r=m(t,"options","xmlDef"),a=r&&r.attr("url");return a?(t.row&&t.model&&(a=A.mergeAsDataInContext(a,A.getContextToUse(t))),A.resolve((e.dataSource.serviceUrl||"")+a)):""},deleteFile:function(e){var t=e.component,r=e.dataSource,a=m(t,"options","xmlDef"),n=a&&a.attr("url");n&&t.row&&t.model&&(n=A.mergeAsDataInContext(n,A.getContextToUse(t)));var o=r.createHTTPRequest({url:(r.serviceUrl||"")+n,method:"DELETE"});return r.makeRequest(o)}}}},getReferenceFieldRelationshipName:function(e,t){var r=t&&t.getField(e);if(r)return r.rel},getReferenceHandler:function(){return{getOverrideSearchProperties:function(){return[{type:"helptext",html:"Specify a route to search for related records. Your URL must include a {{search}} merge as a placeholder for a string containing the user's entered search text."},{id:"searchroute",type:"string",placeholder:"e.g. /api/users?query={{search}}",label:"Search Route"}]},getOverrideBatchProperties:function(){return[{type:"helptext",html:"Specify a route to get the labels for related records in a single batch. The URL must include an {{ids}} merge as a placeholder for a comma-separated list of keys to load.<br/><br/>(This is not needed if the related records are from the same Data Source as this Model and if your Model's query method returns the related record's labels as well as ids.)"},{id:"batchlabelroute",type:"string",placeholder:"e.g. /api/users?ids={{ids}}",label:"Item Labels Route"}]},getOverrideBatchFieldChildrenFunction:function(){return function(){return null}},getMetadataHandler:function(e,t,r,a){var n=e.children("batchfields").first(),o=n&&n.attr("batchlabelroute"),i=e.attr("ogdisplaytype"),s=e.attr("keyfield");if(t.rel=e.attr("rel"),t.searchRoute=e.attr("searchroute"),t.keyField=s,t.originalDisplayType=i,n&&o){var d=L.dataSource.getDataSourceFromXML(e),l=new L.model.Model({dataSource:d}),p=n.children("batchfield");l.id="_ReferenceLabelModel_"+(new Date).getTime()+t.rel,p&&p.length?l.fields=I.map(p,function(e){return{id:I(e).attr("field")}}):l.fields=[{id:s}],l.doQuery=!0,l.doClone=!1,l.serviceUrl=o,l.verb="GET",l.initialize();var u=new L.model.Condition;u.name="__reference_batch",u.sourceParam="ids",l.addCondition(u),r.batchLabelModels||(r.batchLabelModels={}),r.batchLabelModels[a]=l}},getReferenceValue:function(e,t){var r,a=t.keyField;return a?e[a]:(r=s(),e[I.isArray(r)?r[0]:r])},getRowFromReferenceValue:function(e,t,r){var a=s(e),n=e.getRows([{field:r.keyField||(I.isArray(a)?a[0]:a),value:t}]);return n&&n.length?n[0]:{}},processReferenceLookupModel:function(e,t){e.serviceUrl=t.metadata.searchRoute,e.verb="GET",e.label=t.id,e.labelPlural=t.id;var r=new L.model.Condition;r.name="__default_searchbox",r.sourceParam="search",e.addCondition(r)},getBatchFieldsCategoryLabel:function(){return"Item Labels Route"}}},isRelationshipField:function(e){return A.contains(e,".")},initialize:l,load:function(e,d){var t=I.Deferred(),r=[];return I.each(e,function(e,h){var i=I.Deferred(),f=w(h),t={},s=void 0;if(r.push(i.promise()),!f||"query"!==f.type)return i.resolve({data:[],lastLoadTime:(new Date).getTime()}),!0;"GET"!==(s={url:f.endpoint||f.serviceUrl,method:f.verb,dataType:f.dataType,type:f.type}).method&&f.sendChanges&&"usetemplaterequest"===f.sendChanges?s.data=v(f,{}):f.payloadSnippet&&"GET"!==s.method&&"custompayloadinbody"===f.sendChanges&&(s=function(e,t,r,a){return e.data=L.snippet.get(r)({model:t}),e.dataType=a,e}(s,h,f.payloadSnippet,f.contentType)),t.coerceCreateHTTPRequest=function(e){var t="query"===f.type,r=t&&R(f),a=t&&h.recordsLimit&&!F(f.limitMethod);if(r||a){var n=e.url,o=n&&n.includes("?"),i=o?n.substring(n.indexOf("?")+1):"",s=o?n.substring(0,n.indexOf("?")):n,d={},l=f.offsetParameter;if(r){var p=h.paginationOffset;F(l)||F(p)||(d[l]=p)}if(a){var u=f.simpleRecordsLimitParameter,c=F(l)?h.recordsLimit:h.recordsLimit+1;F(u)||F(c)||(d[u]=c)}e.url=s+"?"+i+(o?"&":"")+A.param(d)}},_(h,s,t).done(function(e){var t=void 0,r=void 0,a={},n=w(h);if(t=j(e.body),R(n)&&T(n)){var o=p(t,n,h);o?(a.canRetrieveMoreRows=!0,h.paginationOffset=o):(a.canRetrieveMoreRows=!1,delete h.paginationOffset)}"true"===n.useResponseSnippet&&n.responseSnippet&&(t=b(e,n.responseSnippet)),"XML"===n.payloadContentType&&(t=A.XMLToJSON(A.parseAsXMLIfString(t))),t&&h.pathToContent?r=N(t,h.pathToContent):t&&(r=t),r&&!I.isArray(r)&&(r=[r]),d.performingSearch?i.resolve({request:{dataSource:h.dataSource},results:[{label:h.label,objectName:h.objectName,objectMapKey:h.objectMapKey,modelName:h.id,records:r}]}):(a.lastLoadTime=(new Date).getTime(),a.data=r,a.debug=h.debug,a.soql=a.objectName=s.url,a.conditions=h.conditions,a.conditionLogic=h.conditionLogic,a.fields=h.fields,a.orderByClause=h.orderByClause,a.recordsLimit=h.recordsLimit,i.resolve(a))}).fail(function(e){i.reject(e)})}),I.when.all(r).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()},makeRequest:_,name:"REST",populateBreadcrumbFromEntityMetadata:n.populateBreadcrumbFromEntityMetadata,processEntityMetadataRequest:function(e){var a,t=e.entity,r=e.result,n=t.path,o=[],i={fields:o,childRelationships:[],methods:t.methods,endpoint:t.serviceUrl},s=t.pathToContent;return s&&(r=N(r,s)),n&&(E(n,".")||E(n,":"))&&(n=n.substring(0,n.length-1)),a=n?N(r,n):r,I.isArray(a)&&a.length&&(a=a[0]),a&&I.each(Object.keys(a),function(e,t){var r=function(e,t){var r,a=d(t),n=A.escapeFieldName(e),o={id:n,label:P(e),isPolymorphic:!1,isNamePointing:!1,displaytype:a};if("ARRAY"===a){var i=null;t.length&&(i=d(t[0])),o.rel=n,o.ref=n,o.referenceTo=[{objectName:n,displaytype:i,label:e,relationshipName:n}]}else if("OBJECT"===a)o.rel=n,o.ref=n,o.referenceTo=[{objectName:n,label:e,relationshipName:n}];else if("DOUBLE"===a)if(r=""+t,t%1==0)o.precision=r.length,o.scale=0;else{var s=r.split(".");o.precision=s[0].length,o.scale=2===s.length?s[1].length:0}return o}(t,a[t]);o.push(r)}),l(i),i},properties:V,save:function(e){var t=I.Deferred(),p=[],x=[],C=[],w=[],M=[],E=void 0;return I.each(e.operations,function(e,P){var q=L.$M(P.id),o=[],r=y("insert",q),a=y("update",q),n=y("delete",q),i=function(e,t,r){var a,n={key:e,item:t};return r.isBatch||(a={url:r.endpoint,method:r.verb,context:{model:q,row:q.getRowById(e)}},n.httpRequest=a,n.request={type:r.type,originalRecordId:e,originalRecord:q.getRecordById(e).get(),request:a,method:r}),n},t=I.map(P.deletes,function(e,t){return i(t,e,n)}),s=I.map(P.updates,function(e,t){return i(t,e,a)}),d=I.map(P.inserts,function(e,t){return i(t,e,r)});[{entries:t,method:n,type:"delete"},{entries:s,method:a,type:"update"},{entries:d,method:r,type:"insert"}].forEach(function(e){var t=e.entries,r=e.method;if(t.length)if(r.isBatch){var a={type:e.type,originalRecordIds:I.map(t,function(e){return e.key}),request:{url:r.endpoint,method:r.verb,context:{model:q}},method:r},n={};I.each(t,function(e,t){n[t.key]=t.item}),function(e,t,r){var a=e.sendChanges||"asjsoninbody";"asjsoninbody"===a?t.data=r:"asnestedjsoninbody"===a?(t.data={},A.setObjectProperty(t.data,e.pathToContent,r)):"custompayloadinbody"===a&&(t.data=L.snippet.get(e.payloadSnippet)({changes:r,model:t.context.model}),t.dataType=e.contentType)}(r,a.request,n),o.push(a)}else t.forEach(function(e){!function(r,e,t){var a="autoprefix"===r.changeMapping,n={},o=r.sendChanges||"asjsoninbody",i=r.requestBodyFields;I.each(t,function(e,t){n[(a?r.changeMappingPrefix:"")+e]=t}),"asjsoninbody"===o?(e.data=n,"delete"!==r.type&&"update"!==r.type||i&&i.length&&(e.data=g(e.data,e.context.row,i))):"asnestedjsoninbody"===o?(e.data={},"delete"!==r.type&&"update"!==r.type||i&&i.length&&(n=g(n,e.context.row,i)),A.setObjectProperty(e.data,r.pathToContent,n)):"custompayloadinbody"===o?(e.data=L.snippet.get(r.payloadSnippet)({changes:n,model:e.context.model,row:e.context.row}),e.dataType=r.contentType):"asformdatainbody"===o?(e.dataType=h,e.data=A.param(n)):"inheaderperfield"===o?e.headers=n:"inqueryparamperfield"===o?e.url+=(u(e.url,"?")?"&":"?")+A.param(n):"usetemplaterequest"===o&&(e.data=v(r,e))}(r,e.httpRequest,e.item),o.push(e.request)})});var l=function(e){var t,a,r=e.request,n=r.type,o=r.method,i=e.response,s=i?i.body:null,d=i?i.headers:null,l=e.error,p=[],u={errors:p,messages:[],source:P.id},c=e.isSuccess,h=o.successIf,f=o.successField,m=o.successValue,y="insert"===n;if(s&&O(s)&&(s=j(s)),c&&("responsefieldispresent"===h?c=U(s,f):"responsefieldistrue"===h?c=!0===N(s,f,!0):"responsefieldequals"===h?c=N(s,f,!0)==m:"responseheaderispresent"===h?c=U(d,f,!0):"responseheaderequals"===h?c=N(d,f)==m:"responsebodyequals"===h&&(c=s===m)),(u.success=c)||(E=!0,l?p.push({message:l,severity:"ERROR"}):(t=k(i))&&p.push({message:t,severity:"ERROR"})),o.isBatch)a="delete"===n?x:y?C:w,I.each(r.originalRecordIds,function(e,t){var r={success:u.success,errors:[],messages:[],source:P.id};y?r.oldId=t:!y&&t&&(r.id=t),s&&I.isPlainObject(s[t])&&(r.record=s[t]),a.push(r)}),p.length&&Array.prototype.push.apply(M,p);else if(y){if(u.oldId=r.originalRecordId,c){var b,g=o.insertResponse||"recordinbody",v=o.createdRecordIdLocation,S={},R=r.originalRecord;I.extend(S,R),"recordinbody"===g?(I.extend(S,s),b=B(S,q)):"idinbodyfield"===g?b=N(s,v):"idinheader"===g&&(b=N(d,v)),F(b)||(u.id=b),u.record=S}C.push(u)}else if("update"===n){var T=o.updateResponse;u.id=r.originalRecordId,c&&"recordinbody"===T&&A.isObject(s)&&(u.record=I.extend({},R,s)),w.push(u)}else"delete"===n&&(u.id=r.originalRecordId,x.push(u))};I.each(o,function(e,r){var t=_(q,r.request);t.done(function(e){var t=m(r,"method","responseSnippet");e.body=j(e.body),t&&(e=b(e,t)),l({request:r,response:e,isSuccess:!0})}).fail(function(e){l({request:r,error:e,isSuccess:!1})}),p.push(t)})}),I.when.all(p).always(function(){t.resolve({deleteResults:x,globalErrors:M,insertResults:C,totalsuccess:!E,updateResults:w})}),t.promise()},setDefaultConditionState:n.setDefaultConditionState,processModelXMLExtensions:function(e,t){e.extensions={rest:{customRequestTemplate:t.attr("customrequesttemplate"),pathToContent:t.attr("pathtocontent"),methods:e.methods,serviceUrl:t.attr("serviceurl")||t.attr("endpoint"),verb:t.attr("verb"),contentType:t.attr("contenttype"),sendChanges:t.attr("sendchanges"),payloadSnippet:t.attr("payloadsnippet"),useResponseSnippet:t.attr("useresponsesnippet"),paginationMethod:t.attr("paginationmethod"),offsetParameter:t.attr("offsetparameter"),simpleRecordsLimitParameter:t.attr("simplerecordslimitparameter"),limitMethod:t.attr("limitmethod"),responseSnippet:t.attr("responsesnippet"),payloadContentType:t.attr("payloadcontenttype")}}},getImageSources:function(e){var t={};return e&&A.inPlatform([L.constants.NATIVE,L.constants.CORDOVA])&&e.name===L.platform.getDefaultDataSourceName()&&(t.resource={label:L.$L("File_Resource"),builderProps:function(e,t,r){var a=[],n=r.prefix||"",o=n+"resource",i=n+"path",s=n+"resourceContentType",d=!0,l={};return l[o]="{{{name}}}",l[s]="{{{content_type}}}",t.attr(s)&&(d=t.attr(s)===L.constants.MIME_TYPES.ZIP),a.push(L.platform.builder.getStaticResourceProperty({id:o,valueTemplates:l,helptext:"The name of the File where the Image is stored.",onChange:function(){t.attr(i)&&(t.removeAttr(i),e.save()),e.refresh().rebuildProps()}})),t.attr(o)&&d&&a.push(L.platform.builder.getNestedPathProperty({id:i,state:t,nameProperty:o,namespaceProperty:L.platform.getEntityFieldName("static_resource","namespace"),onChange:function(){e.refresh()}})),a},getSrc:function(e){var t=I.Deferred(),r=e.prefix,a=r?r+"resource":"resource",n=r?r+"path":"path",o=r?r+"namespace":"namespace",i=e.xmlDef.attr(a),s=e.xmlDef.attr(o),d=e.xmlDef.attr(n),l=e.context,p=e.mergeSettings;return d&&(d=A.mergeAsDataInContext(d,l,p)),i&&(i=A.mergeAsDataInContext(i,l,p)),i||d?t.resolve(L.platform.getSiteResourceUrl({name:i,namespace:s,path:d||null})):t.reject("No Resource Name or Resource Path Provided"),t.promise()}}),t},searchProperties:function(e){return{conditions:[{name:"param",sourceType:"param",sourceParam:"param",value:e.attr("param"),operator:"=",encloseValueInQuotes:!1,inactive:!1},{name:"fieldsParam",sourceType:"param",sourceParam:"fieldsParam",value:e.attr("fieldsParam"),operator:"=",encloseValueInQuotes:!1,inactive:!1}],properties:[{id:"param",label:"Search Parameter",type:"text"},{id:"fieldsParam",label:"Fields Parameter",type:"text"}]}},search:function(l,p,u){var c=this,e=I.map(l.returning,function(e,t){var r,a=!1,n=!1,o=p&&p[t],i=u[e.modelName],s=i.fields,d="";return I.each(s,function(e,t){var r="object"===(void 0===t?"undefined":G(t))?t.id:t;d+=r+","}),d=d.substring(0,d.length-1),r=-1===t.indexOf("?")?t+"?{{param}}={{search}}{{#fieldsParam}}&{{fieldsParam}}={{fields}}{{/fieldsParam}}":t+"&{{param}}={{search}}{{#fieldsParam}}&{{fieldsParam}}={{fields}}{{/fieldsParam}}",i.type=f,i.methods=[{serviceUrl:r,verb:"GET",type:"query",dataType:"application/json"}],I.each(i.conditions,function(e,t){"__global_search"===t.name?(a=!0,t.value!==l.query&&(t.value=l.query)):"__fields"===t.name&&(n=!0,t.value!==d&&(t.value=d))}),a||i.addCondition({name:"__global_search",sourceType:"param",sourceParam:"search",value:l.query,operator:"=",encloseValueInQuotes:!1,inactive:!1}),n||i.addCondition({name:"__fields",sourceType:"param",sourceParam:"fields",value:d,operator:"=",encloseValueInQuotes:!1,inactive:!1}),c.searchProperties&&o&&I.each(c.searchProperties(o).conditions,function(e,t){i.addCondition(t)}),i});return c.load(e,{dataSource:L.dataSource.getDataSource(l.dataSourceName),loadAllMetadata:!0,performingSearch:!0,ignoreCache:!0}).then(function(e){return e})}})}});