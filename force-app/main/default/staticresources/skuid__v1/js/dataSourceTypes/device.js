!function(a){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return a[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=a,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=357)}({357:function(e,t,a){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};var n,i,d,p=skuid.utils,f=skuid.dataSource.utils,o=skuid.constants,l=skuid.native,u=skuid.time,s=p.inPlatform(o.CORDOVA),c=o.DISPLAY_TYPES,m=c.STRING,y=c.INTEGER,v=c.DATETIME,b=c.DATE,g=c.BOOLEAN,h=c.TEXTAREA,D="extensions",N="metadata";new skuid.dataSource.DataSourceType({buildEntityMetadataRequest:function(e){var t=e.model;return new skuid.model.Model(t)},createActions:function(){return{openCalendar:{label:"Open Calendar",builderProps:[{id:"date",label:"Date",type:"string",metadata:{id:"date",label:"Date",displaytype:b}}],runtimeExecution:function(e){var a=u.resolveDateKeyword(e.attr("date"));return Array.isArray(a)&&(a=a[0]),p.isString(a)&&(a=new Date(a)),new Promise(function(e,t){return l.calendar.openCalendar(a,e,t)})}},createEvent:{label:"Create Event",builderProps:[{id:"title",label:"Title",type:"string"},{id:"location",label:"Location",type:"string"},{id:"notes",label:"Notes",type:"string"},{id:"startDateTime",label:"Start Date Time",type:"string",metadata:{id:"startDateTime",label:"Start Date Time",displaytype:v}},{id:"endDateTime",label:"End Date Time",type:"string",metadata:{id:"endDateTime",label:"End Date Time",displaytype:v}}],runtimeExecution:function(a,e,n){var i=u.resolveDateKeyword(a.attr("startDateTime")),r=u.resolveDateKeyword(a.attr("endDateTime"));return p.isUndefined(i)?i=new Date:Array.isArray(i)?i=new Date(i[0]):p.isString(i)&&(i=new Date(i)),p.isUndefined(r)?r=new Date:Array.isArray(r)?r=new Date(r[r.length-1]):p.isString(r)&&(r=new Date(r)),new Promise(function(e,t){return l.calendar.createEventInteractively(p.mergeAsDataInContext(a.attr("title"),n),p.mergeAsDataInContext(a.attr("location"),n),p.mergeAsDataInContext(a.attr("notes"),n),i,r,e,t)}).then(function(){return new Promise(function(e,t){return l.calendar.findEvent(p.mergeAsDataInContext(a.attr("title"),n),p.mergeAsDataInContext(a.attr("location"),n),p.mergeAsDataInContext(a.attr("notes"),n),i,r,e,t)})}).then(function(e){return{$NativeAction:{Event:e[0]}}})}},pickContact:{label:"Pick Contact",builderProps:[],runtimeExecution:function(){return new Promise(function(e,t){return l.contacts.pickContact(e,t)}).then(function(e){return{$NativeAction:{Contact:e}}})}}}},createNewModelWithMetadata:function(a,e){return r({},e,{fields:e.fields.reduce(function(e,t){return-1<a.fields.findIndex(function(e){return e.id===t.id})&&e.push(t),e},[]),objectName:a.objectName,extensions:a.extensions})},getActions:f.getActionsStatic,getEntityList:function(){var e=this.prop("metadata"),t=[];for(var a in e)t.push({label:a,value:a});return p.resolve(t)},getEntityMetadata:function(e){var s=this,c=e.dataSource;return p.resolve(e.entities.map(function(e){var t=s.getEntityMetadataCacheKey(e),a=s.prop(N),n=a&&a[t],i=function(e){return p.isFunction(s.getMethod(n,e))};if(c&&!e.dataSource&&(e.dataSource=c),!n)return[];var r=n.accessible=i("query"),d=n.createable=i("insert"),o=n.updateable=i("update"),l=n.deleteable=i("delete"),u=n.searchable=i("search");return n.readonly=(r||u)&&!d&&!o&&!l,n.objectName=t,n.fields=n.fields.map(function(e){return e.label||(e.label=f.makeLabelFromId(e.id)),e.editable||(e.editable=!1),e.creatable||(e.creatable=!1),e.accessible||(e.accessible=!0),e}),n}))},getEntityMetadataCacheKey:function(e){return p.isString(e)?e:e.objectName||p.getObjectProperty(e,D+".entityName")},getEntityMetadataLoadingMessageFromBreadcrumb:function(){return"Loading Data Source metadata..."},getIdField:function(e){return this.prop(N)[e.objectName].idField},getMethod:function(e,t){return this.getMethods(e)[t]||{}},getMethods:function(e){return p.getObjectProperty(e,D)||e.methods||{}},getModelProperties:function(a,e,n){var i=this,t=skuid.builder.core,r=a.state,d=t.getCoreModelBasicProperties({component:a,propViewer:e});return d.push({id:"entity",type:"entity",dataSourceTypeName:this.name,dataSourceName:r.attr("datasource"),label:"Model Entity",onChange:function(e,t){i.onSelectEntity(e,t,a,n),a.refresh()}},t.getModelQueryOnPageLoadProperty({component:a,propViewer:e})),[{name:"Basic",props:d}]},getNameField:function(e){return this.prop(N)[e.objectName].nameField},getRowName:function(e,t){return t.getFieldValue(e,this.getNameField(t),!0)},getRowId:function(e,t){return t.getFieldValue(e,this.getIdField(t),!0)},initialize:function(e){return e},load:function(e,t){var a=this,n=void 0,i=e[0];return s?i.dataSource.getEntityMetadata(r({},t,{entities:[i]})).then(function(e){return e=e._unwrap(),n=a.createNewModelWithMetadata(i,e),e.extensions.methods.query(i)}).then(function(e){return n.data=e||[],[n]}):p.resolve()},name:"Device",onSelectEntity:function(e,t,a,n){var i=e,r=n.getCachedEntityMetadata(i),d=p.getObjectProperty(r.getExtensions(),"defaultConditions"),o=a.state.children("conditions").empty();d&&0<d.length&&o.append(d.map(function(e){var t=p.makeXMLDoc('<condition value="" />');for(var a in e)t.attr(a,e[a]);return t.attr("field",e.sourceparam),t})),a.refresh()},processEntityMetadataRequest:function(e){var t=r({},e.result,{extensions:{}}),a=t.extensions,n=t.methods,i=t.defaultConditions;return delete t.methods,a.methods=n,i&&(delete t.defaultConditions,a.defaultConditions=i),t},processModelXMLExtensions:function(e,t){var a=t.attr("entity");e.extensions={entityName:a},e.objectName=a},properties:(n={},i=N,d={Calendar:{idField:"id",nameField:"name",label:"Calendar",labelPlural:"Calendars",fields:[{id:"id",createable:!0,editable:!1},{id:"name",createable:!0,editable:!1},{id:"type",createable:!0,editable:!1}],methods:{query:function(){return l.calendar?new Promise(function(t,a){return l.calendar.listCalendars(function(e){t(e)},function(e){a(e)})}):p.reject("This native app does not contain calendar features.")}}},Contact:{idField:"id",nameField:"displayName",fields:[{id:"id",displaytype:y},{id:"displayName",displaytype:m,createable:!0,editable:!0},{id:"name",displaytype:m,editable:!0},{id:"firstName",displaytype:m,createable:!0,editable:!0},{id:"middleName",displaytype:m,createable:!0,editable:!0},{id:"lastName",displaytype:m,createable:!0,editable:!0},{id:"fullName",displaytype:m}],methods:{query:function(){if(!l.contacts)return p.reject("This native app needs to be upgraded to use contact features.");var e=[];for(var t in l.contacts.fieldType)e.push(t);return new Promise(function(a,t){l.contacts.find(e,function(e){for(var t=0;t<e.length;t++)e[t].firstName=e[t].name.givenName,e[t].middleName=e[t].name.middleName,e[t].lastName=e[t].name.familyName,e[t].fullName=e[t].name.formatted;a(e)},function(e){t(e)})})},insert:function(e,i){return l.contacts?new Promise(function(e,t){var a=l.contacts.create();for(var n in i)a[n]=i[n];a.save(e,t)}):p.reject("This native app needs to be upgraded to use contact features.")},update:function(e,t,a){if(!l.contacts)return p.reject("This native app needs to be upgraded to use contact features.");var n=e.getRowById(t),i={};return n?(a.displayName&&(n.displayName=a.displayName),a.firstName&&(i.givenName=a.firstName),a.middleName&&(i.middleName=a.middleName),a.lastName&&(i.familyName=a.lastName),p.size(i)&&(a.name=i),new Promise(function(e,t){n.save(e,t)})):p.reject("Could not find contact.")},delete:function(e,t){if(!l.contacts)return p.reject("This native app needs to be upgraded to use contact features.");var a=e.getRowById(t.id);return a?new Promise(function(e,t){a.remove(e,t)}):p.reject("Could not find contact.")}}},ContactEmail:{idField:"id",nameField:"id",label:"Contact Email",labelPlural:"Contact Emails",fields:[{id:"id",displaytype:y},{id:"contact_id",displaytype:y},{id:"pref",displaytype:g},{id:"type",displaytype:m},{id:"value",displaytype:m}],methods:{query:function(e){if(!l.contacts)return p.reject("This native app needs to be upgraded to use contact features.");var n=e.conditions.filter(function(e){return"contact_id"===e.name})[0].value;if(!n)return p.resolve();var i=[];for(var t in l.contacts.fieldType)i.push(t);return new Promise(function(a,t){l.contacts.find(i,function(e){var t=e&&e.filter(function(e){return e.id===n});t&&t.length||a(),a(t[0].emails)},function(e){t(e)})})}},defaultConditions:[{sourcetype:"param",sourceparam:"contact_id",name:"contact_id",label:"Contact Id",state:"filterablerequired",type:"fieldvalue",required:!0,value:""}]},ContactNumber:{idField:"id",nameField:"id",label:"Contact Number",labelPlural:"Contact Numbers",fields:[{id:"id",displaytype:y},{id:"contact_id",displaytype:y},{id:"pref",displaytype:g},{id:"type",displaytype:m},{id:"value",displaytype:m}],methods:{query:function(e){if(!l.contacts)return p.reject("This native app needs to be upgraded to use contact features.");var n=e.conditions.filter(function(e){return"contact_id"===e.name})[0].value;if(!n)return p.resolve();var i=[];for(var t in l.contacts.fieldType)i.push(t);return new Promise(function(a,t){l.contacts.find(i,function(e){var t=e&&e.filter(function(e){return e.id===n});t&&t.length||a(),a(t[0].phoneNumbers)},function(e){t(e)})})}},defaultConditions:[{sourcetype:"param",sourceparam:"contact_id",name:"contact_id",label:"Contact Id",state:"filterablerequired",type:"fieldvalue",required:!0,value:""}]},DeviceInfo:{idField:"uuid",nameField:"uuid",label:"Device Info",labelPlural:"Device Info",fields:[{id:"uuid",displaytype:m,required:!0},{id:"manufacturer",displaytype:m,required:!0},{id:"model",displaytype:m,required:!0},{id:"platform",displaytype:m,required:!0},{id:"version",displaytype:m,required:!0}],methods:{query:function(){return[l.device]}}},Event:{idField:"id",nameField:"id",label:"Event",labelPlural:"Events",fields:[{id:"allDay",displaytype:g},{id:"endDate",displaytype:v},{id:"startDate",displaytype:v},{id:"location",displaytype:m},{id:"id",displaytype:y},{id:"title",displaytype:m},{id:"message",displaytype:h}],methods:{query:function(e){if(!l.calendar)return p.reject("This native app does not contain calendar features.");var a=skuid.$.Deferred(),t={},n=new Date;n.setFullYear(n.getFullYear()+1),e.conditions.forEach(function(e){return t[e.name]=e.value});var i=t.dtstart?new Date(t.dtstart):new Date,r=t.dtend?new Date(t.dtend):n;return l.calendar.findEvent("","","",i,r,function(e){var t=[];e.forEach(function(e){e.allDay=!!e.allDay,t.push(e)}),a.resolve(t)},function(e){a.reject(e)}),a.promise()}},defaultConditions:[{sourcetype:"param",sourceparam:"calendar_id",name:"calendar_id",label:"Calendar Id",state:"filterablerequired",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"startDate",name:"startDate",label:"Start Date",state:"filterablerequired",type:"fieldvalue",required:!0,value:""},{sourcetype:"param",sourceparam:"endDate",name:"endDate",label:"End Date",state:"filterablerequired",type:"fieldvalue",required:!0,value:""}]}},i in n?Object.defineProperty(n,i,{value:d,enumerable:!0,configurable:!0,writable:!0}):n[i]=d,n),save:function(e,t){var a=t.dataSource;return Promise.all(e.operations.map(function(d){var e=d.type,o=skuid.$M(d.id);return a.getEntityMetadata(r({},t,{entities:[e]})).then(function(e){var t=(e=e._unwrap()).extensions.methods,a=[];for(var n in d.deletes)t.delete&&a.push(t.delete(o,d.deletes[n]));for(var i in d.inserts)t.insert&&a.push(t.insert(o,d.inserts[i]));for(var r in d.updates)t.update&&a.push(t.update(o,r,d.updates[r]));return Promise.all(a)})}))}})}});