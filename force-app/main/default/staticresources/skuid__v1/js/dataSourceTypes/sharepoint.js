!function(r){var a={};function n(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=r,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=372)}({372:function(e,t,r){"use strict";var k,a,D,_,P,d,w,s,o,F,l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],a=!0,n=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(a=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(n)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};k=skuid,a="Sharepoint",D=k.$,_=k.utils,P=_.makeXMLDoc,d=_.mergeAsTextInContext,w=k.dataSource.utils,s=D.Deferred,o=function(e){return"SkuidSharepoint-"+e+"-Login-"},F=function(e){var t=D.Deferred(),r=e.dataSource,a=function(){var e=r.authentication;return"apex"===e.authMethod&&"Sharepoint_SharedLogin"===e.providerName},n=o(r.name);return!r.isAuthenticated()&&a()&&D.cookie(n+"FedAuth")&&D.cookie(n+"rtFa")&&D.cookie(n+"Digest")&&(r.authentication.success=!0),r.authenticate().done(function(){r.isAuthenticated()&&a()&&(e.headers||(e.headers={}),D.cookie.raw=!0,e.headers.Cookie="FedAuth="+D.cookie(n+"FedAuth")+"; rtFa="+D.cookie(n+"rtFa")+";",e.headers["X-RequestDigest"]=D.cookie(n+"Digest"),D.cookie.raw=!1),t.resolve(e)}).fail(function(e){!function(e){if(e){var t=o(e.name);D.removeCookie(t+"FedAuth"),D.removeCookie(t+"rtFa"),D.removeCookie(t+"Digest"),e.authentication.success=!1,e.removeStoredAuthData()}}(r),t.reject(e)}),t.promise()},k.dataSource.getType(a)||new k.dataSource.core.ODataDataSourceTypeBase({name:a,getKeyFields:function(e){var t,r={},a=e.key;return D.isArray(a)&&(a=a[0]),a&&a.propertyRef&&(t=a.propertyRef[0].name,"Edm.Boolean"===e.propertyMap[t].type&&(a.propertyRef[0].name="ID"),D.each(a.propertyRef,function(e,t){r[t.name]={id:t.name}})),r},getEntityContainerToList:function(){return"ListData"},supportsBatch:function(){return D.Deferred().resolve(!0).promise()},authenticateAndGetMetadata:function(e){var t=this;return F(e).then(function(){return t.getMetadata(e)})},isDefFilterable:function(e){return"Edm.String"===e.type&&"BaseName"!==e.name},coerceEntitySetList:function(e){e.push("SP.Files")},_getFileMetadata:function(e,u){if(!e)return{};var t=e.split(","),d={};return D.each(t,function(e,t){var r=t.split(":"),a=l(r,2),n=a[0],o=a[1];if(n&&o){var i=_.mergeAsDataInContext(o.trim(),u);void 0!==i&&(d[n.trim()]=i)}}),d},getUploadMethods:function(){var O=this;return{relative_server_url:{label:"Relative Server URL",upload:function(e,t,d,o,a,n){var i,u,s=encodeURIComponent(_.renameFileWhileKeepingExtension(e.name,d.fileNameOverride?_.mergeAsTextInContext(d.fileNameOverride,d):"")),l=d.uploadMethod.dataSource,c=l&&l.serviceUrl?l.serviceUrl:"",r={row:t.row,model:t.model},f=t.options.xmlDef.attr("foldername"),p=O._getFileMetadata(t.options.xmlDef.attr("fileMetadata"),r),m=f?w.mergeThenURLEncode(f,r,{createFields:!1}):encodeURIComponent("/Shared Documents"),h="/web/getfolderbyserverrelativeurl('"+m+"')/files/getbyurl('"+s+"')/",v=_.rfc4122v4GUID(),y=e.size,b=k.platform.getMaxProxyRequestPayload(),g=1;function S(t){if(t&&t.body){var e=void 0;if(_.isString(t.body))try{e=JSON.parse(t.body)}catch(e){return function(e){if(!e)return"Error";var t=e.body,r=P(t).children("m\\:code").first().text().split(",");return r[1]&&r[1].trim&&r[1].trim()}(t)}else e=t.body;if(_.grab(e,"error","message","value"))return e.error.message.value;if(e&&e.message)return e.message}return"Had an error"}function T(e,t){t||(t={});var r=(t=D.extend({overwrite:!1},t)).overwrite;o({fileName:s});var a=c+"/web/getfolderbyserverrelativeurl('"+m+"')/files/add(overwrite="+r+",url='"+s+"')";d.headers.Accept="application/json; odata=verbose";var n=l.createHTTPRequest({url:a,headers:d.headers,method:"POST",contentType:"application/octet-stream",body:e});return l.makeRequest(n)}function x(){n({loaded:g,total:i});var e=c+h+"startupload(uploadId=guid'"+v+"')",t=l.createHTTPRequest({url:e,headers:d.headers,method:"POST",contentType:"application/octet-stream",body:u[0]});return l.makeRequest(t).then(function(e){R(e)},function(e){a({message:S(e)})})}function R(e){var t=JSON.parse(e.body).d,r=t.StartUpload?parseInt(t.StartUpload):parseInt(t.ContinueUpload);n({loaded:++g,total:i}),F(d).then(function(){if(d.headers.Accept="application/json; odata=verbose",g===i)!function(e){var t=c+h+"finishupload(uploadId=guid'"+v+"',fileOffset="+e+")",r=l.createHTTPRequest({url:t,headers:d.headers,method:"POST",contentType:"application/octet-stream",body:u[g-1]});l.makeRequest(r).then(function(e){if(a(),_.size(p))return A(_.parseAsJSONIfString(e.body).d,p)},function(e){a({message:S(e)})})}(r);else{var e=c+h+"continueupload(uploadId=guid'"+v+"',fileOffset="+r+")",t=l.createHTTPRequest({url:e,headers:d.headers,method:"POST",contentType:"application/octet-stream",body:u[g-1]});l.makeRequest(t).then(R,function(e){a({message:S(e)})})}})}function A(e,u){return function(e){var t=e.ListItemAllFields.__deferred.uri,r=l.createHTTPRequest({url:t,headers:d.headers,method:"GET",contentType:"application/json;odata=verbose"});return l.makeRequest(r)}(e).then(function(e){var t=_.parseAsJSONIfString(e.body),r=t.d.__metadata.type,a=t.d.__metadata.uri,n=t.d.__metadata.etag,o=u;o.__metadata={type:r},d.headers={},d.headers.Accept="application/json; odata=verbose",d.headers["X-HTTP-Method"]="MERGE",d.headers["If-Match"]=n;var i=l.createHTTPRequest({url:a,headers:d.headers,method:"POST",contentType:"application/json;odata=verbose",body:JSON.stringify(o)});return l.makeRequest(i)})}-1!==s.indexOf("'")&&(s=s.split("'").join("''")),y&&(d.dataSource=l,d.headers=d.headers||{},d.headers["skuid-base64-body"]=!0,_.readFileAsBase64(e).then(function(e){u=e,1===(i=Math.ceil(y/b))?F(d).then(function(){return T(u,{overwrite:!0}).then(function(e){if(a(),_.size(p))return A(_.parseAsJSONIfString(e.body).d,p)},function(e){a({message:S(e)})})}):F(d).then(function(){u=function(e,t){for(var r=e.length,a=[],n=Math.ceil(r/t),o=0;o<t;o++)a[o]=e.slice(n*o,n*(o+1));return a}(u,i),T("42",{overwrite:!(d.headers.Accept="application/json; odata=verbose")}).then(x,function(e){var t=S(e);t.includes("already exists")?x():a({message:t})})})}))},hasDescription:!1,hasParent:!1,builderProps:[{id:"foldername",type:"text",label:"Relative folder URL",defaultValue:"/Shared Documents",helptext:'This is the relative server url for the folder you want this file to be uploaded to. Example: "/Shared Documents/SubFolder1/SubFolder2"'},{id:"fileMetadata",type:"template",label:"Update Metadata",helptext:'Each field/value pair must be comma delimited and seperated by a colon, example: "RecordID: heyNow, OpportunityID: youreARockstar"',displayAs:"input",location:"attribute"}]}}},getActions:w.getActionsStatic,createActions:function(u){return{"download-file":{builderProps:[{label:"File URL",id:"key",type:"template",location:"attribute",defaultValue:"{{Url}}"},{label:"Name of File",id:"name",type:"template",location:"attribute",defaultValue:"{{Name}}"}],runtimeExecution:function(e,t,r){r=r||{};var a=s(),n=w.mergeThenURLEncode(e.attr("key")||"{{Url}}",r),o=d(e.attr("name")||"{{Name}}",r),i=function(e,t){return-1!==e.indexOf("_api")&&(e=e.substring(0,e.indexOf("_api"))),_.combineUrls(e,"_layouts/download.aspx?SourceUrl=")+t}(u.serviceUrl,n);return o&&n?(w.downloadWithLink(o,i),a.resolve().promise()):a.reject().promise()},label:"Download File"}}}})}});