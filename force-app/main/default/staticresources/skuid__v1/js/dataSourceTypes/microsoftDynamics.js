!function(a){var i={};function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return a[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=a,n.c=i,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=363)}({0:function(e){e.exports={date:"1612394257000",id:"v1",major:12,minor:4,patch:20,build:0,number:"12.4.20.0",name:"Spark Update 3 (12.4.20.0)",path:"v1"}},363:function(e,t,a){"use strict";var i,n=a(0),m=(i=n)&&i.__esModule?i:{default:i};!function(M){var S=M.$,p=S.each,R=M.utils,n=M.dataSource.utils,r=M.data.v2.sessionStorage,l="Microsoft.Dynamics.CRM",o={None:!1,SystemRequired:!0,ApplicationRequired:!0,Recommended:!1},s="Microsoft.Dynamics.CRM.StatusAttributeMetadata",u="Microsoft.Dynamics.CRM.StateAttributeMetadata",D="statecode",I="statuscode",U={1:{endpoint:"WinOpportunity",objectParameterName:"OpportunityClose"},2:{endpoint:"LoseOpportunity",objectParameterName:"OpportunityClose"}};if(!M.dataSource.getType("MicrosoftDynamics")){var i=M.dataSource.core.ODataDataSourceTypeBase;new i({name:"MicrosoftDynamics",supportsToLowerForFilters:function(){return!1},getGenericErrorMessage:function(){return"Unknown error occured during Dynamics request"},preSaveHook:function(m,y,e,b){if(!(b&&("opportunities"===b.type||"Microsoft.Dynamics.CRM.opportunities"===b.type)&&!!R.size(b.updates)))return S.when();var g=M.model.getModel(b.id),h=y&&y.serviceUrl,t=g&&g.getField(D),a=t&&t.picklistMetadata,v=a&&a.stateDefaultMapping;return t&&v&&h?S.when.all(S.map(e,function(e){var t=e.data,a="PATCH"===e.method,i=t&&t[D],n=t&&t[I];if(a&&(1===i||2===i)){var r=e.__oldid,o=r&&g.getRecordById(r).row(),s=o&&g.getRowOriginals(o),u=U[i],d=u.endpoint,c=u.objectParameterName,l={},p=!0,f=S.when();return l[c]={"opportunityid@odata.bind":R.combineUrls(h,e.requestUri)},delete t[D],delete t[I],S.each(t,function(e){if(-1===e.indexOf("@odata")||"@odata.bind"===e)return p=!1}),p&&(t.__shouldRemove=!0),(R.isUndefined(n)||isNaN(n))&&(n=v[i]),l.Status=n,s&&s[D]+""!="0"&&(f=function(e,t,a,i){var n={statecode:0};return n[I]=a,n["@odata.type"]="#Microsoft.Dynamics.CRM.opportunity",E(t,{url:i,method:"PATCH",headers:O({"Content-ID":e}),body:JSON.stringify(n)})}(r,y,v[0],R.combineUrls(h,e.requestUri))),f.then(function(){return E(y,{url:R.combineUrls(h,d),method:"POST",headers:O(),body:JSON.stringify(l)})}).then(function(){m.updateResults.push({errors:[],id:r,messages:[],record:JSON.stringify({statecode:i,statuscode:n}),source:b.id,success:!0})}).catch(function(){m.updateResults.push({errors:[{message:"There was an error attempting to update the Opportunity Status"}],id:r,messages:[],record:{},source:b.id,success:!1})})}})):S.when()},coerceResponseItemData:function(e,t,a,i){t&&"204"===t.statusCode&&a&&S.each(a,function(e){if(!i||!i[e]){if("@odata.type"===e){var t=a[e];return delete a[e],void(a["@odata\\.type"]=t)}delete a[e]}})},coerceRequest:function(e,t){var a=t.model;if(a){var i=0|a.recordsLimit;if(0<i&&(e.headers.Prefer="odata.maxpagesize="+(1+i)),t.addOnly&&a.paginationURL){var n=a.paginationURL.split("$skiptoken="),r=n[n.length-1];e.parameters={$skiptoken:r}}}},isPolyMorphicField:function(e){return"owninguser@odata.bind"===e?"owninguser@odata.bind":"owningteam@odata.bind"===e?"team@odata.bind":void 0},coerceResponse:function(e,t){if(t&&e){var a=e.body&&e.body["@odata.nextLink"];a?(t.canRetrieveMoreRows=!0,t.paginationURL=a.substring(a.indexOf("$skiptoken"))):t.canRetrieveMoreRows=!1}},coerceSaveItemRequest:function(a,e){var i=this,n=["Edm.DateTimeOffset","Edm.DateTime"];a.headers["Content-ID"]=""+e.key;var r=e&&e.model&&e.model.fieldsMap;S.each(a.data,function(e,t){i.isPolyMorphicField(e,t)&&(delete a.data[e],a.data["ownerid@odata.bind"]=t),r&&r[e]&&-1!==n.indexOf(r[e].edmtype)&&(a.data[e]=M.time.parseDateTimeString(t).toISOString())})},supportsBatch:function(){return S.Deferred().resolve(!0).promise()},coerceAdditionalQueries:function(e){e.requestUri=e.requestUri.replace("guid'","").replace("')",")")},evaluateUserInfoConditionSourceType:function(e,t){if("RoleName"!==t&&"RoleId"!==t)return e.getUserInfoProperty(t);var a=e.getUserInfoProperty("Roles")||[];if("RoleId"===t)return a.join(";");var i=R.keyBy(function(e){return R.grab(e,"metadata","securityRoles")||[]}(e),"roleid")||{};return S.map(a,function(e){var t=i[e]&&i[e].name;return t&&[t,t.toLowerCase()]}).join(";")},getTopClause:function(){},getSkipClause:function(){},getEntitySetFromEntityTypeName:function(e,t){var a=this.getEntityType(e,t);return a.entitySetName?this.getEntitySet(a.entitySetName,t):i.prototype.getEntitySetFromEntityTypeName(e,t)},getDefaultFieldsForReferenceField:function(e,t,a){return[R.getFieldReference(e,t,a),e+"."+t.keyField]},produceErrorTextFromErrors:function(e){return"Dynamics Web API Query error: "+S.map(e,function(e){var t,a,i,n=R.grab(e,"response","body");return n?(t=n.message,a=n.statusCode,"Not Implemented"===(i=n.error)?"Attempted a query not supported by the Dynamics Web API ("+a+" - "+i+")":t+" ("+i+" - "+a+")"):R.isString(e)?e:R.grab(e,"response","error")||"Bad Request"}).join("; ")},withinADynamicsPage:function(){return"true"===R.deparam(window.location.search).inDynamics},getNameFieldURLForReferenceField:function(e,t,a){var i=e.model,n=e.row,r=e.metadata,o=e.options.fieldXML,s=o&&o.attr("redirecttype")||"datasourcedefault",u=M.dataSource.DataSourceType.prototype.getNameFieldURLForReferenceField;if("datasourcedefault"!==s)return u(e,t,a);var d,c,l=i.dataSource,p=l.metadata,f=l.dataSourceType,m=f.getEntitySet(i.objectName,p),y=m&&f.getEntityType(m.entityType,p),b=y&&y.nameField===e.id,g=i.getRowId(n),h=n&&n[e.id]&&n[e.id][r.keyField],v=r.ref&&this.getEntityType(r.ref,p),S=v&&v.name;return S?(d=h,c=S):b&&(d=g,c=y.name),d&&c?'<a href="'+(l.serviceUrl.substring(0,l.serviceUrl.indexOf("/api/")+1)+"main.aspx?etn="+R.encodeHTML(c)+"&id="+R.encodeHTML(d)+"&pagetype=entityrecord")+'" target="'+(this.withinADynamicsPage()?"top":"_blank")+'">'+a+"</a>":void 0},coerceEntitySetList:function(a){var i=this;d(a,function(e){return R.isString(e)}),S.each(a,function(e,t){t.value=i.trimDefaultNamespace(a[e].value)})},getKeyFields:function(a){var i={},e=a.key;return"systemuser"===a.name?i.systemuserid={id:"systemuserid",entityType:a}:"team"===a.name?i.teamid={id:"teamid",entityType:a}:(S.isArray(e)&&(e=e[0]),e&&e.propertyRef&&S.each(e.propertyRef,function(e,t){i[t.name]={id:t.name,entityType:a}})),i},populateExtraServersideCachedMetadata:function(t){return S.when.all([this.fetchEntityDetailsNotIncludedInMetadataBlob(t),this.fetchSecurityRoles(t)]).then(function(){return t.metadata}).catch(function(e){return S.each(e,function(e,t){t&&t.message&&-1!==t.message.indexOf("Roles")&&M.component.getByType("skuidpage")[0].addProblem(t.message)}),t.metadata})},fetchSecurityRoles:function(a){var e=a.serviceUrl;return E(a,{url:R.combineUrls(e,"roles?$select=name,roleid,_businessunitid_value"),method:"GET",headers:O()}).then(function(e){var t=R.grab(e,"body","value");t&&(S.each(t,function(e,t){if(t){var a=t._businessunitid_value;delete t["@odata.etag"],delete t._businessunitid_value,t.businessUnitId=a}}),a.metadata.securityRoles=t)}).catch(function(){throw new Error("Error Fetching Security Roles")})},fetchEntityDetailsNotIncludedInMetadataBlob:function(e){var i=this,n=e.metadata,t={dataSource:e,requestUri:R.combineUrls(e.serviceUrl,"EntityDefinitions?$select="+["MetadataId","DisplayCollectionName","EntitySetName","PrimaryIdAttribute","DisplayName","SchemaName","LogicalName","PrimaryNameAttribute"].join(","))};return i.makeODataRequest(e,t).then(function(e){var t=i.getSchema(n,l),a=e.value,d=t.entityTypeMap,c=t.entitySetMap;return S.each(a,function(e,t){var a=t.LogicalName,i=d[a],n=t.PrimaryNameAttribute,r=t.DisplayName,o=t.PrimaryIdAttribute,s=t.DisplayCollectionName;if(i){o&&i.key&&i.key[0]&&i.key[0].propertyRef[0]&&(i.key[0].propertyRef[0].name=o),i.nameField=n,i.MetadataId=t.MetadataId,i.entitySetName=t.EntitySetName;var u=c[i.entitySetName];u&&s&&s.UserLocalizedLabel&&(u.label=s.UserLocalizedLabel.Label),r&&r.UserLocalizedLabel&&(i.label=r.UserLocalizedLabel.Label),u&&"activitypointers"===u.name&&(u.label=u.label+" (Read-Only)")}}),n})},trimDefaultNamespace:function(e){return 0===e.indexOf(l)?e.substring(l.length+1):e},getEntityDefinitionEndpointForAttributes:function(e,t){return R.combineUrls(t.serviceUrl,"EntityDefinitions("+e.MetadataId+")/Attributes")},getSpecificPicklistEndpoint:function(e,t,a,i){var n=this.getEntityDefinitionEndpointForAttributes(e,t);return R.combineUrls(n+"("+a+")",i+"?$select=LogicalName&$expand=OptionSet($select=Options),GlobalOptionSet($select=Options)")},getPicklistMetadataForEntityProps:function(e,i,n){var r,o=this,s=o.getSchema(i.metadata),u=s.entitySetMap,d=s.entityTypeMap,c={},l=[];return p(e,function(e,t){var a=u[o.trimDefaultNamespace(t.objectName)];(r=a&&d[o.trimDefaultNamespace(a.entityType)])&&r.MetadataId&&(r.builtMaps||o._buildEntitySpecificMaps(r,s,n),p(t.fields,function(e,t){var a=r.propertyMap&&r.propertyMap[t.id];a&&f(a.metadataType)&&!a.picklistEntries&&(c[JSON.stringify({entityTypeName:r.name,propId:a.metadataId,type:a.metadataType})]=!0)}))}),p(c,function(e){e=JSON.parse(e);var t=d[e.entityTypeName],a=o.getSpecificPicklistEndpoint(t,i,e.propId,e.type);l.push(o.makeCacheableODataRequest(i,{requestUri:a}).then(function(e){return o.handleNewFieldMetadata([e],t)}))}),S.when.all(l)},parseOptions:function(e){return S.map(e,function(e){return{value:e.Value,label:R.getObjectProperty(e,"Label.UserLocalizedLabel.Label")||e.Value}})},extractPicklistMetadata:function(e,t){var a={};if(e===u){a.isState=!0;var i=a.stateDefaultMapping={};return S.each(t,function(e,t){R.isUndefined(t.Value)||R.isUndefined(t.DefaultStatus)||(i[t.Value]=t.DefaultStatus)}),a}if(e===s){a.isStatus=!0;var n=a.validStateMapping={};return S.each(t,function(e,t){R.isUndefined(t.Value)||R.isUndefined(t.State)||(n[t.State]=n[t.State]||{},n[t.State][t.Value]=!0)}),a}},coerceUpdateRows:function(l,e){S.each(e,function(e,t){if(!R.isUndefined(t[D])){var a=l.getField(D),i=a&&a.picklistMetadata;if(i&&i.isState){var n=l.getRecordById(e),r=l.getField(I),o=t[D]+"",s=t[I]&&t[I]+""||n&&n.get(I),u=i.stateDefaultMapping,d=function(e,t,a){return!!R.grab(e,"picklistMetadata","validStateMapping",t,a)}(r,o,s),c=u&&u[o];if(n&&!R.isUndefined(c)&&r&&R.grab(r,"picklistMetadata","isStatus")&&(c+="",!d)){if(!R.isUndefined(t[I])&&c===t[I])return;t[I]=c}}}})},getValidPicklistEntriesSync:function(e){var t,a,i=e.metadata,n=i.picklistEntries,r=e.row,o=i.picklistMetadata,s=r&&r.statecode;return o&&o.isStatus&&!R.isUndefined(s)?(a=o.validStateMapping,t=a[s]||{},S.map(n,function(e){if(t[e.value])return e})):n},getValidPicklistEntries:function(e){return R.resolve(this.getValidPicklistEntriesSync(e))},appendAttributesToProperty:function(e,t,a){var i=t.OptionSet||t.GlobalOptionSet,n=i&&i.Options,r=t.MetadataId,o=a&&a.AttributePrivileges,s=o&&o.filter(function(e){return e.AttributeId===r})[0];if(n)return e.picklistEntries=this.parseOptions(n),void(e.picklistMetadata=this.extractPicklistMetadata(e.metadataType,n));e.metadataId=r,e.defaultValue=t.DefaultFormValue,e.attributeType=t.AttributeType,e.metadataType=t["@odata.type"]&&t["@odata.type"].split("#").pop(),e.helptext=R.getObjectProperty(t,"Description.UserLocalizedLabel.Label")||"",e.label=R.getObjectProperty(t,"DisplayName.UserLocalizedLabel.Label")||e.name,e.format=t.Format,s?(e.accessible=0<s.CanRead,e.createable=0<s.CanCreate,e.editable=0<s.CanUpdate):(e.accessible=t.IsValidForRead,e.createable=t.IsValidForCreate,e.editable=t.IsValidForUpdate),e.isRequired=t.RequiredLevel&&t.RequiredLevel.Value},isDefAccessible:function(e){return!e.accessible||e.accessible},isDefEditable:function(e,t){return!1!==e.editable&&!1!==t.editable&&"Uniqueidentifier"!==e.attributeType&&!!e.metadataId},isDefFilterable:function(e,t){var a=t&&t.id;return(!a||-1===a.indexOf("."))&&("String"===e.attributeType||"Memo"===e.attributeType)},fieldIsFilterableWhenSearchingReferenceFieldOptions:function(e){return"Edm.String"===e.edmtype},isDefCreateable:function(e,t){return!!e.metadataId&&(("Uniqueidentifier"!==e.attributeType||"Edm.Guid"!==e.type)&&(!1!==e.createable&&!1!==t.createable))},isDefRequired:function(e,t){var a=o[e.isRequired]&&!1!==t.createable&&!1!==e.createable&&"Edm.Guid"!==e.type;if(!e.metadataId)return!1;if(e.picklistEntries&&!R.isUndefined(e.defaultValue)&&"SystemRequired"===e.isRequired)for(var i=0;i<e.picklistEntries.length;i++)if(e.picklistEntries[i].value===e.defaultValue)return!0;return a},getReferenceFieldRelatedData:function(e,t,a,i){var n,r,o,s,u,d,c,l=e.id,p=e.keyField,f=R.isString(t)?t:t[p];if(p&&S.isPlainObject(t)&&t[p]&&1<R.size(t))return t;var m=i.getRows();for(d=0;d<m.length;d++)if(m[d]!==a&&(s=m[d][l])&&s[p]===f)return s;for(r=i.dataSource&&i.dataSource.name,n=M.model.getModelsByDataSource(r),d=0;d<n.length;d++)for(m=(o=n[d]).getRows(),c=0;c<m.length;c++){if(u=m[c],o.getRowId(u)===f)return u;if((s=u[l])&&s[p]===f)return s}var y={};return y[p]=f,y},coerceRequestedFields:function(e){var t={productassociationid_productassociation:1,parentbundleid_opportunityproduct:1,ownerid:1};return d(e,function(e){return!!t[e.id]||!!e.isArray}),e},coerceFieldMetadata:function(e,t){t.helptext&&(e.inlineHelpText=t.helptext),t.label&&(e.label=t.label),t.metadataId?e.metadataId=t.metadataId:e.label=n.makeLabelFromId(e.id),t.picklistEntries?(e.displaytype="PICKLIST",e.picklistEntries=t.picklistEntries,e.picklistMetadata=t.picklistMetadata,!t.defaultValue&&0!==t.defaultValue||-1===t.defaultValue||(e.defaultValue=t.defaultValue)):null!==t.defaultValue&&void 0!==t.defaultValue&&(e.defaultValue=t.defaultValue),f(t.metadataType)&&(e.displaytype="PICKLIST")},handleNewFieldMetadata:function(e,i,n){if(e){i.hasExtraMetadata=!0;var r=this;p(e,function(e,t){var a=i.propertyMap[t.LogicalName]||i.navigationPropertyMap[t.LogicalName];a&&r.appendAttributesToProperty(a,t,n)})}},getDefaultNamespace:function(){return l},coerceConditionValue:function(e,t){var a=t.picklistEntries,i=a&&a.length;if(!i||("0"|e)===e)return e;for(var n=0;n<i;n++)if(a[n].label===e)return a[n].value+"";return e},getExtraEntityMetadata:function(n,r){var o=this,a=[],s=n.metadata,u=o.getSchema(s,l),d=u.entitySetMap,c=u.entityTypeMap,i={};return n._offlineStoreQueued||(n._offlineStoreQueued=!0,M.events.subscribeOnce("models.loaded").then(function(){n._offlineStoreQueued=!1,M.storage.getDb(m.default.id).getTable("dataSourceMetadata").add(n.name,{alreadyTransferable:!0,data:n.metadata})})),p(r,function(e,t){t.entitySetName=l+"."+t.objectName,i[t.objectName]=!0}),p(i,function(i){var t,e=d[o.trimDefaultNamespace(i)];e&&(t=c[o.trimDefaultNamespace(e.entityType)])&&(t.builtMaps||o._buildEntitySpecificMaps(t,u,s),t.MetadataId&&a.push((t.hasExtraMetadata?S.when():o.makeCacheableODataRequest(n,{requestUri:o.getEntityDefinitionEndpointForAttributes(t,n)})).then(function(e){o.handleNewFieldMetadata(e&&e.value,t,n.getStoredAuthData().userInfo);var a=[];return p(r,function(e,t){t.objectName===i&&a.push(t)}),o.getPicklistMetadataForEntityProps(a,n,s)})))}),S.when.all(a)},getCachedODataRequest:function(e,t){var a=n.convertRequestObjToKey(t);return r.getItemJSON(e.name+"."+e._metadataCacheVersion+"."+a)},setCachedODataRequest:function(e,t,a){var i=n.convertRequestObjToKey(t);return r.batchSetItem(e.name+"."+e._metadataCacheVersion+"."+i,JSON.stringify(a))},makeCacheableODataRequest:function(t,a,i){var n=this,e=n.getCachedODataRequest(t,a);return e?S.Deferred().resolve(e).promise():n.makeODataRequest(t,a).then(function(e){return i&&(e=i(e)),n.setCachedODataRequest(t,a,e),e})},getUserInfoProperties:function(e){var t=[{value:"UserId",label:"User Id",defaultValue:!0},{value:"OrganizationId",label:"Organization Id"},{value:"BusinessUnitId",label:"Business Unit Id"}];return(e=e||{}).renderCondition?(t.push({value:"RoleName",label:"Role Names"}),t.push({value:"RoleId",label:"Role Ids"})):t.push({value:"Roles",label:"Roles"}),t},getUserInfo:function(t){var a,i,n,r,o=this;return e(t).then(function(e){return a=e.UserId,i=e.BusinessUnitId,n=e.OrganizationId,o.getSystemUserRoles(t,a)}).then(function(e){return r=e,o.getAttributePrivileges(t,a)}).then(function(e){return{AttributePrivileges:e,UserId:a,Roles:r,BusinessUnitId:i,OrganizationId:n}}).catch(function(){return{}})},getSystemUserRoles:function(e,t){var a=e.serviceUrl;return E(e,{url:R.combineUrls(a,"systemuserrolescollection?$select=roleid&$filter=systemuserid eq "+t),method:"GET",headers:O()}).then(function(e){var t=R.grab(e,"body","value"),a=[];return t&&t.length&&S.each(t,function(e,t){t&&a.push(t.roleid)}),a}).catch(function(){return[]})},getAttributePrivileges:function(e,t){var a=e.serviceUrl;return E(e,{url:R.combineUrls(a,"systemusers("+t+")/Microsoft.Dynamics.CRM.RetrievePrincipalAttributePrivileges"),method:"GET",headers:O()}).then(function(e){return e&&e.body&&e.body.AttributePrivileges})},getActions:n.getActionsStatic,getFunctionMap:function(e){var i={},t=e.dataServices,n=t.enumTypeMap["mscrm.ConditionOperator"];return t.schema.forEach(function(e){var a=e.namespace;e.function&&e.function.forEach(function(t){-1===n.picklistEntries.findIndex(function(e){return e.name===t.name})&&(i[a+"."+t.name]=t)})}),i},getFunctionsList:function(e){var i=[],t=e.dataServices,n=t.enumTypeMap["mscrm.ConditionOperator"];return t.schema.forEach(function(e){var a=e.namespace;e.function&&e.function.forEach(function(t){-1===n.picklistEntries.findIndex(function(e){return e.name===t.name})&&(t.namespace=a,i.push(t))})}),i},properties:{composer:{supports:{childRelationships:!1},canFieldsBeSelected:function(e){return!!e.breadcrumb.endsobject||"Select an external object for this Model."}},canAutoGenerateConditionsFromFields:!0,canConditionsBeGrouped:!0,hasGlobalSearchEntities:!0,validConditionTypes:["blank","datasourceuserinfo","fieldvalue","modelmerge","multiple","param","userinfo"]}})}function f(e){return!!e&&("Microsoft.Dynamics.CRM.PicklistAttributeMetadata"===e||e===s||e===u)}function d(e,t){for(var a=e.length;a--;)t(e[a],a)&&e.splice(a,1)}function E(e,t){return e.makeRequest(e.createHTTPRequest(t))}function e(e){return function(e,t){var a=e.serviceUrl;return E(e,{url:R.combineUrls(a,t),method:"GET",headers:O()}).then(function(e){return e&&e.body})}(e,"WhoAmI")}function O(e){return S.extend({"Content-Type":"application/json; charset=utf-8",Accept:"application/json","OData-MaxVersion":"4.0","OData-Version":"4.0"},e||{})}}(skuid)}});