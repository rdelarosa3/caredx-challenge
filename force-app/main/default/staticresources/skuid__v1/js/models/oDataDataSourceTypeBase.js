!function(n){var a={};function r(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=n,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=55)}({0:function(e){e.exports={date:"1612394257000",id:"v1",major:12,minor:4,patch:20,build:0,number:"12.4.20.0",name:"Spark Update 3 (12.4.20.0)",path:"v1"}},55:function(e,t,n){"use strict";var a,R,C,E,x,m,l,s,j,r,D,p,u,i,o,c,f,y,M,d,h,g,O,P,v,b,F,S,T,N,I,_,A,k,L,w,q,B,U,V,H=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},K=n(0),G=(a=K)&&a.__esModule?a:{default:a};R=skuid,C=R.$,E=C.each,x=C.extend,m=R.dataSource,l=m.utils,s=m.libraries.skuid,j=".",r=m.core||(m.core={}),D=R.utils,p=D.isString,u=D.createMapForArray,i=D.makeXMLDoc,o=R.time,c=o.parseSFDateTime,f=o.parseDateTimeString,y=o.getSFDateTime,M=C.Deferred,d=R.constants.HTTP_VERBS,h=d.PATCH,g=d.MERGE,O=d.POST,P=d.DELETE,v="Collection(",b="_odatalib",F={"Edm.String":"STRING","Edm.Boolean":"BOOLEAN","Edm.Date":"DATE","Edm.DateTime":"DATETIME","Edm.DateTimeOffset":"DATETIME","Edm.Int16":"NUMBER","Edm.Int32":"NUMBER","Edm.Decimal":"NUMBER","Edm.Double":"NUMBER","Edm.Int64":"NUMBER","Edm.Guid":"STRING"},S="skuidSupportsBatch",T=["@odata.editLink","@odata.id","@odata.type"],N=["__metadata"],I=["COUNT","COUNT DISTINCT","SUM","AVG","MAX","MIN"],_=function(e){if(!e)return e;var t=" and".length,n=e.length-t,a=e.lastIndexOf(" and");return-1===a?e:a!==n?e:e.substring(0,n)},A=function(n,a,e){var t=e.major<4?N:T;E(t,function(e,t){a[t]&&(n[t]=a[t])})},k=function(e){var t,n=M(),a=q.prototype.getServiceVersion(e),r=a.major<4,i="odata"+(r?"3":"4"),o=r?"data.js":"odatav4.js";return e[b]?n.resolve():s[i]?(e[b]=s[i],n.resolve()):D.loadJS((t=o,R.platform.getResourceUrl({ns:"skuid",path:"js/lib/"+t}))).then(function(){e[b]=s[i]=function(e){var t;return e.major<4?{read:(t=R.lib.OData).read,request:t.request,batchHandler:t.batchHandler,metadataHandler:t.metadataHandler,defaultHttpClient:t.defaultHttpClient}:{read:(t=R.lib.odatajs.oData).read,request:t.request,batchHandler:t.batch.batchHandler,metadataHandler:t.metadata.metadataHandler,defaultHttpClient:t.net.defaultHttpClient}}(a),n.resolve()}),n.promise()},L=function(e,t){var n={};return n[e]=!0,C.extend(n,t)},w=["name"],B="metadata",U="batch",V="entitySet",(q=function(n){E(w,function(e,t){if(!n[t])throw"Missing Required Property Error: "+t}),x(this,n),n.extendedProperties&&(x(!0,this.properties,n.extendedProperties),delete this.extendedProperties),m.DataSourceType.prototype.constructor.call(this,this),delete this.getModelProperties}).prototype=new m.DataSourceType(!1),(q.constructor=q).prototype=x(!0,q.prototype,{RESOURCE_TYPES:{RESOURCE_METADATA:B,RESOURCE_BATCH:U,RESOURCE_ENTITY_SET:V},authenticateAndGetMetadata:function(e){var t=this;return e.dataSource.authenticate().then(function(){return t.getMetadata(e)})},populateSelect:function(e,t,n,a){var r,i;n.uiOnly||a.accessible&&(r=n.id.split(j),n.isComplexField&&(r=[n.complexInReference?n.referenceParentId:r[0]]),i=r.join("/"),!1!==n.query&&(t&&!t[i]&&(e[i]=!0),a.keyField&&(e[i+"/"+a.keyField]=!0),(a.nameField||n.nameField)&&(e[i+"/"+(a.nameField||n.nameField)]=!0)))},getFieldDef:function(e,t,n,a){var r,i=a.metadata;return e.complexFields?e:((r=this.tryToGetComplexDef(e,e.id,t,n,a))||(r=this.getPropertyDef(e.id,t,i,n,t),1<e.id.split(j).length&&(e.editable=!1,e.createable=!1,e.sortable=!1)),r)},isArrayField:function(e,t){var n=e.id,a=void 0;if(n&&-1!==n.indexOf(j)){var r=!(!(a=n.split(j)[0])||!t)&&t[a];if(r&&r.type&&-1!==r.type.indexOf(v))return!0}return!1},isDefAccessible:function(){return!0},isDefEditable:function(e,t,n){var a=!0;return n.major<4&&(a=!this.propertyHasExtension(e,"StoreGeneratedPattern")),t.isComplexField?a=!t.complexInReference&&n.major<4:!1===t.editable&&3<n.major&&(a=!1),a},isDefCreateable:function(e,t,n){return this.isDefEditable(e,t,n)||this.isDefRequired(e,t,n)},isDefRequired:function(e,t){return"false"===e.nullable&&!1!==t.editable},isDefFilterable:function(e,t,n,a){return!this.isArrayField(t,a)&&"Edm.String"===e.type},buildFieldMetadata:function(e,t,n,a,r,i){var o,s,u,c,d=this,l=i.metadata,p=d.getServiceVersion(i),f=t.navigationPropertyMap;return!0===e.uiOnly?e:(o=d.getFieldDef(e,t,n,i))?(u={id:e.id,accessible:d.isDefAccessible(o,e),createable:d.isDefCreateable(o,e,p),editable:d.isDefEditable(o,e,p),sortable:!0,label:e.id,displaytype:F[o.type]||o.type,edmtype:o.type,required:d.isDefRequired(o,e,p),filterable:d.isDefFilterable(o,e,p,f),minInputLength:1,groupable:!0},e.defer&&(u.defer=!0),e.idField&&(u.idField=!0),R.builder||(e.name&&(u.name=e.name),e.function&&(u.function=e.function)),d.isDefForComplexTypeField(o,l)&&d.populateFieldMetadataForComplexField(u,t),d.isDefForReferenceField(o)?d.populateFieldMetadataForReferenceField(u,o,n,r,l):d.isDefForComplexTypeField(o,l)?(s=!0,d.populateFieldMetadataForComplexField(u,t)):s||3<p.major&&(c=d.getEnumTypeFromDef(o,l))&&d.populateFieldMetadataForEnumField(u,c),d.coerceFieldMetadata(u,o),e.overrideMetadata&&C.extend(u,e),!1===e.query&&(u.query=!1),u):void 0},isDefForReferenceField:function(e){return!(!e.fromRole&&!e.isReferenceProp)},populateFieldMetadataForComplexField:function(e,t){var n=e.id,a=t.propertyMap[n].type;e.displaytype="OBJECT",e.rel=n,e.ref=a,e.referenceTo=[{objectName:a,label:a,relationshipName:n}]},populateFieldMetadataForEnumField:function(e,t){e.displaytype="PICKLIST",e.picklistEntries=t.picklistEntries,e.noneLabel=!e.required,e.deDupLabel=!0},populateFieldMetadataForReferenceField:function(e,t,n,a,r){var i,o,s,u,c,d=this,l=e.id,p=e.id.split(".").join("/");if(t.fromRole)i=d.getAssociation(t.relationship,r),o=d.getEndFromAssociation(i,t.toRole),e.rel=l,-1!==C.inArray(o.multiplicity,["0..1","1"])?(c=d.getEntityType(o.type,r),e.keyField=c.key&&c.key.propertyRef[0].name,c.nameField&&(e.nameField=c.nameField),e.displaytype="REFERENCE",e.ref=o.type,e.referenceTo=[{objectName:o.type,label:o.type,relationshipName:l,keyField:e.keyField}]):(n&&(n[p]=!0),e.displaytype="ARRAY",e.type="array",e.dataPath="results",e.ref=o.type,e.referenceTo=[{objectName:o.type}],e.relationshipName=t.name,e.childSObject=o.type,s=d.getRefConstraintsFromAssociation(i,t.toRole),e.field=s.length&&s[0].name);else if(t.isReferenceProp){var f=t.type;e.rel=l,-1!==t.type.indexOf(v)?(n&&(n[p]=!0),f=f.substring(v.length,f.length-1),e.displaytype="ARRAY",e.type="array",e.ref=f,e.referenceTo=[{objectName:f}],e.relationshipName=t.name,e.childSObject=f,e.createable=!1,e.editable=!1):(u=t.referentialConstraint,(c=d.getEntityType(f,r))&&c.nameField&&(e.nameField=c.nameField),u&&0<u.length?e.keyField=u[0].referencedProperty:e.keyField=c.key&&c.key[0].propertyRef[0].name,e.displaytype="REFERENCE",e.ref=t.type,e.referenceTo=[{objectName:t.type,label:t.type,relationshipName:l,keyField:e.keyField}],e.createable=!0,e.editable=!0),e.sortable=!1}},buildEntityMetadataRequest:function(e){var t=e.targetEntity;return!t&&e.model&&e.model.attr&&(t=e.model.attr("sobject")),{objectName:t}},buildResourceUri:function(e,t,n){if(!e)throw"Unable to build Resource URI";n||(n={});var a,r=D.combineUrls,i=e.serviceUrl,o=n.entitySet,s=n.keyPredicate,u=n.count;switch(t){case B:return r(i,"$metadata");case U:return r(i,"$batch");case V:return a=r(i,o),s&&(a+="("+s+")"),u&&(a+="/$count"),a;default:return i}},getAssociation:function(e,t){var n=this.processFullyQualifiedName(e);return this.getSchema(t,n.nameSpace).associationMap[n.name]},getEndFromAssociation:function(e,t){return e.end.filter(function(e){return e.role===t})[0]},getExtraEntityMetadata:function(e){return R.storage.getDb(G.default.id).getTable("dataSourceMetadata").add(e.name,{entities:!1,data:e.metadata}),e.metadata},getEntityMetadata:function(c){var d=this,e=(c=c||{}).entities,t=c.dataSource;return d.authenticateAndGetMetadata(c).then(function(){return d.getExtraEntityMetadata(t,e)}).then(function(){var o=[],s={},u=t.metadata;return C.each(e,function(e,t){var n,a,r,i=function(e,t){var n,a,r,i=p(e)?e:e.objectName;return i?(a=(n=i&&i.split(".")).slice(0,-1).join("."),(r=t.dataServices.aliasMap)&&(a=r[a]||a),a+"."+n[n.length-1]):i}(t,u);if(!i)throw"No object name provided.";n=d.getEntitySet(i,u),a=d.getEntityTypeFromEntitySet(n,i,u),r=d.getFieldsFromEntityType(a,i,u,c.dataSource,c),d.cacheFieldsOfEntity({dataSource:c.dataSource,objectName:i},r,u,s),i.startsWith(".")&&(i=i.replace(".","")),o.push({childRelationships:[],fields:r,label:i,labelPlural:i,objectName:i,readonly:!1})}),o})},getEntityMetadataCacheKey:function(e){return p(e)?e:e.objectName},getEntityMetadataLoadingMessageFromBreadcrumb:function(e){return"Loading metadata for external object "+e.endsobject+"..."},getEntitySet:function(e,t){var n=this.processFullyQualifiedName(e),a=this.getSchema(t,n.nameSpace).entitySetMap;if(a&&a[n.name])return a[n.name]},getFlatEntitySetList:function(e){var t=this.getEntitySetList(e);return C.map(t,function(e){return D.isString(e)?e:e.value})},getEntitySetList:function(e){var r=[],i=this.getEntityContainerToList();return C.each(e.dataServices.schemaMap,function(a,e){var t;if(i&&e.entityContainerMap){var n=e.entityContainerMap[i];t=n&&n.entitySetMap}else t=e.entitySetMap;t&&C.each(t,function(e,t){var n=a+j+e;t.label?r.push({label:t.label,value:n}):r.push(a+j+e)})}),this.coerceEntitySetList(r),r},coerceEntitySetList:function(){},getActionMap:function(e){var n={};return e.dataServices.schema.forEach(function(e){var t=e.namespace;e.action&&e.action.forEach(function(e){n[t+"."+e.name]=e})}),n},getActionsList:function(e){var n=[];return e.dataServices.schema.forEach(function(e){var t=e.namespace;e.action&&e.action.forEach(function(e){e.namespace=t,n.push(e)})}),n},getFunctionMap:function(e){var n={};return e.dataServices.schema.forEach(function(e){var t=e.namespace;e.function&&e.function.forEach(function(e){n[t+"."+e.name]=e})}),n},getFunctionsList:function(e){var n=[];return e.dataServices.schema.forEach(function(e){var t=e.namespace;e.function&&e.function.forEach(function(e){e.namespace=t,n.push(e)})}),n},getDefaultNamespace:function(){},getIdField:function(e,t){var n=void 0,a=void 0;n=D.isString(e)?(a=e,t.metadata):(a=e.objectName,e.dataSource.metadata);var r=this.getEntitySet(a,n),i=this.getEntityTypeFromEntitySet(r,a,n),o=this.getKeyFields(i,n);return Object.keys(o)[0]},getSchema:function(e,t){if(!t&&!(t=this.getDefaultNamespace()))return e.dataServices.schema[0];var n=e.dataServices.schemaMap;return n[t]||C.map(n,function(e){if(e.alias===t)return e})[0]},getEntityType:function(e,t){var n=this.processFullyQualifiedName(e),a=this.getSchema(t,n.nameSpace),r=a.entityTypeMap[n.name];return r?(this._buildEntitySpecificMaps(r,a,t),r):this._tryToGetComplexEntity(e,t)},getEntityTypeFromEntitySet:function(e,t,n){var a=e?e.entityType:t;return this.getEntityType(a,n)},getEntityTypeNameFromRefPropDef:function(e,t){var n;return e.relationship?(n=this.getAssociation(e.relationship,t),this.getEndFromAssociation(n,e.toRole).type):e.type?-1!==e.type.indexOf(v)?e.type.substring(v.length,e.type.length-1):e.type:void 0},getEnumType:function(e,t){var n=this.processFullyQualifiedName(e);return this.getSchema(t,n.nameSpace).enumTypeMap[n.name]},getErrorFromErrorBody:function(e,t){var n,a,r;if(e){if((n=D.parseAsJSONIfString(e))&&C.isPlainObject(n)&&(n.error?n=n.error:n["odata.error"]&&(n=n["odata.error"]),n&&(a=n.code,n.message?r=C.isPlainObject(n.message)&&n.message.value?n.message.value:n.message:(r=n,e.statusCode&&(a=e.statusCode)))),!n)try{a=(n=D.makeXMLDoc(e)).find("code").text(),r=n.find("message").text()}catch(e){}return{code:a,message:r}}if(t)return{message:r=t.status,code:a=t.statusCode}},getFieldDataForItem:function(e,t,n,a){var r,i,o=n.split(j);if(1!==o.length)return r=e[o[0]],o.shift(),r?this.getFieldDataForItem(r,t,o.join(j)):null;if(a&&t.name===o[0]&&-1<t.id.indexOf(j)){var s=t.id.split(j),u=!t.function,c=a.navigationPropertyMap[s[0]],d=c&&c.type.split(j)[c.type.split(j).length-1];u&&(n=d+"_"+s[1])}return"DATETIME"!==t.displaytype?"Edm.Decimal"===t.edmtype||"Edm.Double"===t.edmtype?parseFloat(e[n]):"Edm.Int64"===t.edmtype?parseInt(e[n],10):e[n]:(r=e[n])?(i=r instanceof Date?r:f(r),y(i)):null},_getComplexTypeMap:function(e){return e.dataServices&&e.dataServices.complexTypeMap},_tryToGetComplexEntity:function(e,t){var n=this._getComplexTypeMap(t);if(n&&e)return n[e]},_setComplexTypeMap:function(e){var o={};return C.each(e.dataServices.schemaMap,function(n,a){var e=a.complexType;e&&C.each(e,function(e,t){o[n+j+t.name]={typeInfo:t,namespace:n},a.alias&&(o[a.alias+j+t.name]=o[n+j+t.name])})}),E(o,function(e,t){t.typeInfo.property=function e(t,n){if(!t)return[];n=n||{};var a=t.typeInfo,r=a.baseType,i=a.hasExpandedBaseType;return a.property||(a.property=[]),!r||i||(a.isDerived=!0,-1===r.indexOf(j)&&(r=t.namespace+j+r),a.hasExpandedBaseType=!0,n[r]||(n=L(r,n),a.property=a.property.concat(e(o[r],n)))),a.property}(t)}),D.size(o)||(o=null),e.dataServices.complexTypeMap=o},_setEnumTypeMap:function(e){var r={};return C.each(e.dataServices.schemaMap,function(t,e){var n=e.enumType,a=e.alias;n&&C.each(n,function(e,n){C.each(n.member,function(e,t){n.member[e].label=t.name}),r[t+j+n.name]=r[a+j+n.name]={picklistEntries:n.member,namespace:t,name:n.name}})}),e.dataServices.enumTypeMap=r},isDefForComplexTypeField:function(e,t){var n=e.type;return this._tryToGetComplexEntity(n,t)},getEnumTypeFromDef:function(e,t){var n=e.type,a=t.dataServices.enumTypeMap;if(a)return a[n]},_setMapOfPropertiesOfEntityType:function(e,r,i){if(e.propertyMap)return e.propertyMap;i||(i={});var o=this,s={},t=o.getPropertiesOfEntity(e);return t?(C.each(t,function(e,t){var n;if(t&&(s[t.name]=t,(n=o._tryToGetComplexEntity(t.type,r))&&!i[t.type])){i=L(t.type,i);var a=n;s[t.name].complexFields=o._setMapOfPropertiesOfEntityType(a,r,i)}}),e.propertyMap=s):{}},_setMapOfNavigationPropertiesOfEntityType:function(e,c){return e.navigationPropertyMap||(e.navigationProperty&&e.navigationProperty.length?(E(e.navigationProperty,function(e,t){var n,a,r=t.type,i="",o=c.aliasMap,s=!!r&&0===r.indexOf(v),u="";t.isReferenceProp=!0,r&&(s?i=r.substring(v.length,r.length-1):r&&(i=r),1<(n=i.split(".")).length&&o&&o[a=n.slice(0,n.length-1)]&&(u=o[a]+"."+n[n.length-1],s&&(u=v+u+")"),t.type=u))}),e.navigationPropertyMap=D.keyBy(e.navigationProperty,"name")):e.navigationPropertyMap={}),e.navigationPropertyMap},tryToGetComplexDef:function(n,a,e,r,t,i){var o,s,u,c,d,l,p,f,m,y,h,g,v,b,E=this,S=t.metadata,F=E._getComplexTypeMap(S),M=E.getServiceVersion(t);if(F){if(E._buildEntitySpecificMaps(e,E.getSchema(S,e.__namespace),S),o=a.split(j),u=e.propertyMap,c=e.navigationPropertyMap,i=i||"",1<o.length&&(m=c[o[0]]),D.size(m))return b=o[0],y=E.getEntityTypeNameFromRefPropDef(m,S),h=E.getEntityType(y,S),g=a.substring(b.length+1),v=i?i+"/"+b:b,E.tryToGetComplexDef(n,g,h,r,t,v);if(1<o.length){if(l=o[o.length-2],2<o.length){var T=o.slice(0,o.length-1).join(".complexFields."),R=D.getObjectProperty(u,T);R&&(d=R.type)}2===o.length&&(d=u&&u[l]&&u[l].type),p=o[o.length-1],(f=!!d&&F[d])&&C.each(f.typeInfo.property,function(e,t){t.name===p&&(s=t,n.isComplexField=!0,(n.complexParent=f).typeInfo.isDerived&&(n.editable=!1),r&&i&&(n.complexInReference=!0,M.major<=3&&(n.referenceParentId=i+"/"+a.substring(0,a.length-t.name.length-1),r[i]=!0)))})}return s}},coerceRequestedFields:function(e){return e},getPropertiesOfEntity:function(e){return e.property&&e.property.length?e.property:e.typeInfo&&e.typeInfo.property?e.typeInfo.property:[]},getFieldsFromEntityType:function(n,e,t,a,r){r=r||{};var i,o=this,s=o.processFullyQualifiedName(e).nameSpace,u=o.getPropertiesOfEntity(n),c=r.requestedFields,d=r.selects,l=r.expands,p=o.getSchema(t,s);return o._buildEntitySpecificMaps(n,p,t),c?(i={},C.each(c,function(e,t){i[t.id]=t}),C.each(o.getKeyFields(n,t),function(e,t){i[t.id]||c.push(C.extend(t,{idField:!0}))})):(c=[],u&&C.each(u,function(){var e={id:this.name};c.push(C.extend({},this,e))}),n.navigationProperty&&C.each(n.navigationProperty,function(){var e=!1;this.type&&0===this.type.indexOf(v)&&(e=!0),c.push({id:this.name,isArray:e})})),c=o.coerceRequestedFields(c),C.map(c,function(e){var t=o.buildFieldMetadata(e,n,l,d,s,a);if(t)return d&&o.populateSelect(d,l,e,t),t})},supportsToLowerForFilters:function(){return!0},coerceFieldMetadata:function(){},getFilterStringFromCondition:function(t,e,n){n||(n={});var a,r,i,o,s,u,c=this,d=n.version||{major:1},l=n.fieldsMetadata||[],p=function(e){return c.getURLFormattedValue(e,a.edmtype,d,t)},f=d.major<4,m=t.field,y=function(e,t,n){return(e=e.split(j).join("/"))+" "+(t||"eq")+" "+(n=D.isUndefined(n)?i:n)},h=function(e,t,n){return e=e.split(j).join("/"),t+"("+(!0===n?i:e)+","+(!0===n?e:i)+")"},g=function(e,t,n){e=e.split(j).join("/");var a=i;return c.supportsToLowerForFilters()&&(e="tolower("+e+")",a=a.toLowerCase()),t+"("+(!0===n?a:e)+","+(!0===n?e:a)+")"},v=function(e){var t=[];return E(s,function(){this&&t.push("("+y(e,"eq",this)+")")}),"("+t.join(" or ")+")"},b={"=":function(e){return y(e,"eq")},"!=":function(e){return y(e,"ne")},gt:function(e){return y(e,"gt")},lt:function(e){return y(e,"lt")},gte:function(e){return y(e,"ge")},lte:function(e){return y(e,"le")},contains:f?function(e){return g(e,"substringof",!0)}:function(e){return g(e,"contains")},"does not contain":f?function(e){return g(e,"not substringof",!0)}:function(e){return g(e,"not contains")},"starts with":function(e){return h(e,"startswith")},"does not start with":function(e){return h(e,"not startswith")},"ends with":function(e){return h(e,"endswith")},"does not end with":function(e){return h(e,"not endswith")},in:function(e){return v(e)},"not in":function(e){return"not "+v(e)},">":function(e){return b.gt(e)},">=":function(e){return b.gte(e)},"<":function(e){return b.lt(e)},"<=":function(e){return b.lte(e)}};return t.inactive?"":"group"===t.type?c.getFilterStringFromConditions(t.subConditions,t.subConditionLogic,e,n):(a=c.getFieldMetadataFromConditionField(m,l,e))?(a.ref&&a.keyField&&(m=t.field+"."+a.keyField,a=c.getFieldMetadataFromConditionField(m,l,e)),r=c.coerceConditionValue(t.value,a),i=r&&p(r),o=t.values,s=o&&o.map&&o.map(p),(u=b[t.operator])?u(m):""):""},coerceConditionValue:function(e){return e},getFieldMetadataFromConditionField:function(e,t,n){var a,r={},i=e.split("."),o=n.dataSource,s=o&&o.metadata;if(E(t,function(e,t){r[t.id]=t}),r[e])return r[e];if((a=r[i[0]])&&a.ref&&!(i.length<2)){var u=a.ref,c=this.getEntityType(u,s),d=this.getFieldsFromEntityType(c,u,s,o);return i.shift(),this.getFieldMetadataFromConditionField(i.join("."),d,n)}},getFilterStringFromConditions:function(e,t,n,a){var r=this,i="",o=C.map(e,function(e){return r.getFilterStringFromCondition(e,n,a)||"!!"});return o.length&&(t||(t=C.map(e,function(e,t){if(!0!==e.inactive)return t+1+""}).join(" and ")),t&&(-1!==(i=(i=D.makeConditionLogicString(t,o,{customAndString:" and ",customOrString:" or "})).replace(/\(\)/g,"")).indexOf("!!")&&(i=i.replace(/(((AND)|(OR)) ?!!)|(!! ?((AND)|(OR)))|!!|\(!!\)/gi,"").trim()),i=_(i))),i},getItemForDML:function(e,t,n){var a,r,i=e.edmtype,o=D.adjustValueBasedOnQuotedness;return"Edm.Binary"===i?t=window.btoa(t):-1!==C.inArray(i,["Edm.Boolean","Edm.Byte","Edm.Double","Edm.Int16","Edm.Int32","Edm.SByte","Edm.Single"])?t=o(t,!1):-1!==C.inArray(i,["Edm.Decimal","Edm.Guid","Edm.Int64","Edm.String"])?n.major<4||"Edm.String"===i?t=!1===p(r=t)?""+r:r:"Edm.Int64"!==i&&"Edm.Decimal"!==i||(t=o(t,!1)):"Edm.DateTime"===i?(a=c(t),t=R.time.formatDate("yy-mm-ddT",a)+R.time.formatTime("HH:mm:ss.SSS",a)):"Edm.DateTimeOffset"===i&&(a=c(t),t=(t=R.time.formatDate("yy-mm-ddT",a)+R.time.formatTime("HH:mm:ss.SSS000Z",a)).slice(0,-2)+":"+t.slice(-2)),t},getODataLibrary:function(e){return e[b]},getURLFormattedValue:function(e,t,a){var n=R.time,r=a.major<4,i=function(e,t,n){return n&&a.major>n?t:e+"'"+t+"'"},o=function(e,t,n){return n&&a.major>n?t:t+e},s=function(e){if(D.isNumber(e))return parseFloat(e);throw'The value "'+e+'" could not be translated to a number.'},u=function(e){var t;if(D.isDate(e)?t=e:D.isNumber(e)?t=new Date(e):D.isString(e)&&((t=n.parseDateTimeString(e))||(t=n.resolveDateKeyword(e)),C.isArray(t)&&(t=t[0])),!t)throw'The value "'+e+'" could not be translated to a date.';return t};return null===e?"null":"Edm.Boolean"===t?e?"true":"false":"Edm.Byte"===t?s(e).toFixed(0):"Edm.DateTimeOffset"===t?i("datetimeoffset",u(e).toISOString(),3):"Edm.Decimal"===t?o("M",function(e){var t=D.userLocale.decimalsSeparator;if(-1===e.indexOf(t))return e;var n=new RegExp("\\"+t+"?0+$");return e.replace(n,"")}(s(e).toFixed(20)),3):"Edm.Double"===t?o("D",s(e).toString(),3):"Edm.Guid"===t?i("guid",e,3):"Edm.Int16"===t?s(e).toFixed(0):"Edm.Int32"===t?s(e).toFixed(0):"Edm.Int64"===t?o("L",s(e).toFixed(0),3):"Edm.Float"===t&&r||"Edm.Single"===t?o("F",s(e).toString(),3):"Edm.SByte"===t?s(e).toFixed(0):"Edm.DateTime"===t&&r?i("datetime",u(e).toISOString().slice(0,-1),3):"Edm.Date"!==t||r?"Edm.TimeOfDay"!==t||r?"'"+function(e){for(var t="",n=0;n<e.length;n++){var a=e[n];-1<";,/?:@&=+$#".indexOf(a)?t+=encodeURIComponent(a):t+=a}return t}(""+e).replace("'","''")+"'":u(e).toISOString().split("T")[1].slice(0,-1):u(e).toISOString().split("T")[0]},getIndividualKeyFormatted:function(e,t,n,a){return this.getURLFormattedValue(n[e],t.edmtype,a)},getKey:function(t,e,n,a){var r,i=e.key,o=this;return C.isArray(i)&&(i=i[0]),i?1<i.propertyRef.length?C.map(i.propertyRef,function(e){return e.name+"="+o.getIndividualKeyFormatted(e.name,a[e.name],t,n)}).join(","):(r=i.propertyRef[0].name,D.isUndefined(t[r])?void 0:o.getIndividualKeyFormatted(r,a[r],t,n)):""+(t.Id||t.ID||t.id)},getKeyFields:function(n){var a={},e=n.key;return C.isArray(e)&&(e=e[0]),e&&e.propertyRef&&C.each(e.propertyRef,function(e,t){a[t.name]={id:t.name,entityType:n}}),a},getKeyFieldsInOrderedList:function(t){var e=[],n=t.key;return C.isArray(n)&&(n=n[0]),n&&n.propertyRef&&(e=C.map(n.propertyRef,function(e){return{id:e.name,entityType:t,edmtype:t.propertyMap[e.name].type}})),e},getMetadata:function(e){var t=this;return k(e.dataSource).then(function(){return t.queryMetadata(e)})},getModelProperties:function(n,e,t){var a=this.getServiceVersion(t),r=R.builder.core,i=n.state,o=r.getUnsavedChangesWarningProperty({component:n}),s=r.getCoreModelBasicProperties({component:n,propViewer:e}),u=[];return s.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,dataSourceName:i.attr("datasource")||i.attr("service"),label:"External Object Name",showLabelInTextInput:!0,onChange:function(e){if(e&&(!i.attr("label")||!i.attr("labelplural"))){var t=e.split(j).pop();i.attr("label")||i.attr("label",t),i.attr("labelplural")||i.attr("labelplural",t+(D.endsWith(t,"s")?"":"s")),n.save()}}}),a&&4===a.major&&s.push(r.getModelTypeProperty({component:n})),Array.prototype.push.apply(s,r.getModelLabelProperties()),s.push(r.getModelQueryOnPageLoadProperty({component:n,propViewer:e}),r.getAsyncLoadProperty({component:n}),r.getModelLimitProperty(),r.getModelOrderByProperty(),r.getCreateDefaultRowProperty(),r.getModelNameFieldProperty()),o&&u.push(o),u.push(r.getDeferFieldRenderingProperty(!0)),u.push(r.getFieldsToDeferProperty(n)),[{name:"Basic",props:s},{name:"Advanced",props:u}]},getAggregateFieldProperties:function(t,n){var a=t.state,r=R.builder.core;return[{id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:!0,picklistEntries:I.map(function(e){return{label:e,value:e.replace(" ","")}}),onChange:function(e){e&&a.attr("name",r.getDefaultAliasName(a.attr("id"),e)),t.save().refresh().rebuildProps(n)}}]},getNameField:function(e,t){var n,a,r,i,o=t&&t.metadata;return o&&(n=this.getEntitySet(e,o),a=this.getEntityTypeFromEntitySet(n,e,o),i=Object.keys(this.getKeyFields(a)),a.nameField?r=a.nameField:i&&0<i.length&&(r=i[0])),r},getRowName:function(e,t,n){return t.getFieldValue(e,n.getNameField(t.objectName),!0)},getRowId:function(e,t,n){var a=t.fields.length&&t.fields.filter(function(e){return e.idField})[0];if(a)return e[a.id];var r=n.metadata,i=r&&this.getEntitySet(t.objectName,r),o=r&&this.getEntityTypeFromEntitySet(i,t.objectName,r),s=this.getServiceVersion(n);return this.getKey(e,o,s,t.fieldsMap)},getEntityContainerToList:function(){},getEntityList:function(t){var n=this,a=M();return n.authenticateAndGetMetadata(t).then(function(e){a.resolve(n.getEntitySetList(e,t))},function(e){if("string"==typeof e)a.reject(e);else{var t=e.response,n=t.error;a.reject(n,t)}}),a.promise()},getEntityLabel:function(e,t){var n=t.metadata&&this.getEntitySet(e,t.metadata);if(n)return n.label},getPropertyByName:function(e,t){var n,a;return e.propertyMap?((a=e.propertyMap[t])||(a=e.navigationPropertyMap&&e.navigationPropertyMap[t]),a&&(n=a)):n=this.getPropertiesOfEntity(e).concat(e.navigationProperty).filter(function(e){return!!e&&t===e.name})[0],n},getPropertyDef:function(e,t,n,a,r,i){var o=e.split(j),s=this.getPropertyByName(t,o[0]);if(1===o.length)return a&&r.navigationPropertyMap[o[0]]&&(a[o[0]]=!0),s;var u=this.getEntityTypeNameFromRefPropDef(s,n),c=this.getEntityType(u,n);return a&&r.navigationPropertyMap[o[0]]&&(a[(i&&i+"/"||"")+o.slice(0,o.length-1).join("/")]=!0),o.shift(),this.getPropertyDef(o.join(j),c,n,a,r,i)},getRefConstraintsFromAssociation:function(e,n){var a=[];return e.referentialConstraint&&C.each(e.referentialConstraint,function(e,t){t.role===n&&C.each(t.propertyRef,function(){a.push(this)})}),a},getRowForItem:function(a,r,e,t){var i=this,o={};return C.each(e,function(e,t){var n=t.name?t.name:t.id;-1!==t.id.indexOf(j)?D.setObjectProperty(o,n,i.getFieldDataForItem(a,t,n,r)):o[n]=i.getFieldDataForItem(a,t,n)}),A(o,a,t),o},getServiceVersion:function(e){if(e.metadata&&e.metadata.skuidVersion)return e.metadata.skuidVersion;var t=((e&&e.getConfigProperty("odata-version")||"1.0")+"").split(j),n=parseFloat(t[0]),a=parseFloat(t[1]),r=parseFloat(t[2]),i={major:isNaN(n)?0:n,minor:isNaN(a)?0:a,patch:isNaN(r)?0:r};return i.stringRep=[i.major,i.minor].join(j),i},getApplyClause:function(e){var t=e.fields.filter(function(e){return e.function}),n=e.groupByFields,a="aggregate("+t.map(function(e){var t=e.function.toLowerCase();return"count"===t?"$count as "+e.name:("avg"===t&&(t="average"),e.id+" with "+t+" as "+e.name)}).join(",")+")";return 0<!n.length?"$apply="+a:"$apply=groupby(("+n.map(function(e){return e.id.replace(/\./g,"/")}).join()+"), "+a+")"},getSelectClause:function(e){var t=Object.keys(e);if(t.length)return"$select="+t.join(",")},getExpandClause:function(e){var t=Object.keys(e);if(t.length)return"$expand="+t.join(",")},getOrderByClause:function(e){if(e.orderByClause)return"$orderby="+e.orderByClause.replace(/nulls first/gi,"").replace(/nulls last/gi,"").replace(/asc/gi,"asc").replace(/desc/gi,"desc")},getFilterClause:function(e,t,n,a){var r=this.getFilterStringFromConditions(e,t.conditionLogic,t,{version:n,fieldsMetadata:a});if(r)return"$filter="+r},getSkipClause:function(e){var t=e.offsetPageNumber,n=e.offsetPageSize;if(1<t&&0<n)return"$skip="+(t-1)*n},getTopClause:function(e){var t=e.offsetPageSize||e.recordsLimit;if(0===t||0<t)return"$top="+(parseInt(t,10)+1)},createQualifiedURL:function(e,t,n,a,r,i){var o,s,u=this,c=[],d=e.getDataSource(),l=D.combineUrls(d.serviceUrl,i.name),p=e.isAggregate||!1;if(d)return o=u.getServiceVersion(d),p&&4===o.major?(c.push(u.getFilterClause(t,e,o,n)),c.push(u.getApplyClause(e)),(c=c.filter(function(e){return!!e})).length&&(l+="?"+encodeURI(c.join("&")))):(s=3<o.major?function(e,a){E(e,function(e){delete a[e]});var o={};E(e,function(t){var n=o[t]=[];E(a,function(e){0===e.indexOf(t+"/")&&-1===e.substring((t+"/").length).indexOf("/")&&(delete a[e],n.push(e.substring((t+"/").length)))})}),function a(r){var i=o;E(i,function(e,t){if(r){if(0===e.indexOf(r.name+"/")){var n={name:e.substring((r.name+"/").length),list:t};r.list.push(n),delete i[e],a(n)}}else a({name:e,list:t})})}();var t={str:"$expand="};if(D.size(o)&&function i(o,e){var s=!0;E(e,function(e,t){var a=!1,r=!1;if(s||(o.str+=","),s=!1,o.str+=e,t.length){var n=[];E(t,function(e,t){C.isPlainObject(t)||n.push(t)}),n.length&&(o.str+="($select=",o.str+=n.join(","),a=!0),E(t,function(e,t){if(C.isPlainObject(t)){a||r?!r&&a&&(o.str+=";$expand=",r=!0):(o.str+="($expand=",r=!0);var n={};n[t.name]=t.list,i(o,n)}}),!r&&!a||s||(o.str+=")")}})}(t,o),D.size(e))return t.str}(a,r):u.getExpandClause(a),c.push(s),c.push(u.getSelectClause(r)),c.push(u.getOrderByClause(e)),c.push(u.getFilterClause(t,e,o,n)),c.push(u.getSkipClause(e)),c.push(u.getTopClause(e)),(c=c.filter(function(e){return!!e})).length&&(l+="?"+encodeURI(c.join("&")))),l},cacheEntityFieldMetadataForModel:function(e){var a=this,r=e.getDataSource(),i=r.metadata,t=function(e,o){var a=e.objectName,t=e.fields,s=e.getDataSource(),u=s.metadata,n=o.getEntitySet(a,u);a=n&&n.entityType||a;var c={};c[a]=!0,C.each(t,function(e,t){t.ref&&(c[t.ref]=!0)});var r=t.filter(function(e){return-1!==e.id.indexOf(".")});return C.each(r,function(e,t){var n=t.id.split("."),i=a;C.each(n,function(e,t){var n=o.getEntityType(i,u);if(!n)return!1;var a=o.getFieldsFromEntityType(n,i,u,s);if(!a||!a.length)return!1;var r=(a=D.keyBy(a,"id"))[t];return!!r&&!!r.ref&&(c[r.ref]=!0,void(i=r.ref))})}),c}(e,a);C.each(t,function(e){if(!r.getCachedEntityMetadata(e)){var t=a.getEntityType(e,i),n=a.getFieldsFromEntityType(t,e,i,r);r.cacheEntityMetadata(e,{objectName:e,label:e,labelPlural:e,fields:n})}})},cacheFieldsOfEntity:function(e,t,n,a,r){var i=e.objectName,o=e.label||i,s=e.labelPlural||i,u=e.dataSource,c=this.getEntitySet(i,n);if(i=c&&c.entityType||i,r=r||0,a=a||{},!(u.getCachedEntityMetadata(i)||(a[i]={objectName:i,label:o,labelPlural:s,fields:t},u.cacheEntityMetadata(i,{objectName:i,label:o,labelPlural:s,fields:t}),5<r)))for(var d=0;d<t.length;d++){var l=t[d];if(l.ref&&!a[l.ref]){i=l.ref;var p=this.getEntityType(i,n),f=this.getFieldsFromEntityType(p,i,n,u);this.cacheFieldsOfEntity({dataSource:u,objectName:i},f,n,a,r+1)}}},getConditionsOfODataModel:function(n){return C.map(n.conditions,function(e){var t=n.getConditionValueResult(e);return e.originalValue||(e.originalValue=t.value),e})},coerceModelMetadata:function(e,t){"true"===t.abstract&&(e.createable=!1,e.updateable=!1,e.deleteable=!1)},loadIndividualModel:function(n,e,t){var a,r,i,o,s,u,c,d,l=this,p=e.metadata,f=M(),m=n.objectName,y=n.label||m,h=n.labelPlural||m,g=n.orderByClause,v={},b={},E=n.offsetPageSize||n.recordsLimit;if(!m)return f.reject("No object name specified for Model: "+n.id).promise();C.each(n.fields,function(e,t){C.isArray(n.deferredFields)&&-1<C.inArray(t.id,n.deferredFields)&&(t.defer=!0,n.fieldsMap[t.id].defer=!0)}),r=l.getEntitySet(m,p),i=l.getEntityTypeFromEntitySet(r,m,p),u=l.getConditionsOfODataModel(n),o=l.getFieldsFromEntityType(i,m,p,n.dataSource,{requestedFields:n.fields,selects:v,expands:b,applies:{}}),s=l.getFieldsFromEntityType(i,m,p,n.dataSource),l.cacheEntityFieldMetadataForModel(n),n.deferFieldRendering&&C.each(o,function(e,t){t.defer&&delete v[t.id]});try{a=l.createQualifiedURL(n,u,s,b,v,r)}catch(e){if(D.isString(e)&&-1!==e.indexOf("could not be translated"))return D.reject(e);throw e}return d={label:y,labelPlural:h,accessible:!0,createable:!0,updateable:!0,deleteable:!0,fields:o,soql:a,conditions:u,recordsLimit:E,objectName:m,orderByClause:g},l.coerceModelMetadata(d,i),!1===n.doQuery?f.resolve(d):(c={requestUri:a,model:n},t&&C.extend(!0,c,t),l.fetchData(e,c,i,o,E).then(function(e){return C.extend(d,e),d}))},makeODataRequest:function(n,a){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=this,e=r.method||"read",t=r.handler||"",s="read"!==e||r.tupleResponse,u=r.excludeMetadata,c=o.getODataLibrary(n),d=M();return c[e](a,function(){d.resolve(s?arguments:arguments[0])},function(){var e=arguments[0],t=e.response?o.getErrorFromErrorBody(e.response.body,e.response):e;if(!i&&(401===t.code||403===t.code))return n.invalidateAuthentication(),n.authenticate().then(function(){return o.makeODataRequest(n,a,r,!0)}).then(function(){d.resolve(s?arguments:arguments[0])}).catch(function(){d.reject(s?arguments:arguments[0])});d.reject(s?arguments:e)},t?c[t]:void 0,n.httpClientOfDataSourceType,u?void 0:n.metadata),d.promise()},coerceRequest:function(){},fetchData:function(e,r,i,o,s){var u=this,c=u.getServiceVersion(e);return u.makeODataRequest(e,r).then(function(e){var t,n=!1,a=c.major<4?e.results:e.value;return t=a&&C.isArray(a)?C.map(a,function(e){return u.getRowForItem(e,i,o.filter(function(e){return!1!==e.query}),c,D.keyBy(o,"id"))}):!a&&r.singleRow?e:[],s&&t.length>s&&(n=!0,t.pop()),{data:t,canRetrieveMoreRows:n}}).catch(function(e){throw e.response&&(e.response.requestUri=r.requestUri),e})},makeAdditionalQueries:function(e,n){var a,t=this,r=e.dataSource,i=r.metadata,o=t.getServiceVersion(r),s=e.objectName,u=t.getEntitySet(s,i),c=t.getEntityTypeFromEntitySet(u,s,i),d=t.getFieldsFromEntityType(c,s,i,r,{requestedFields:e.fields,selects:(a={},C.each(e.deferredFields,function(e,t){a[t]=!0}),a)}),l={requestUri:o.major<4?n.__metadata.uri:n["@odata.id"],singleRow:!0};return t.coerceAdditionalQueries(l),t.fetchData(r,l,c,d).then(function(t){return e.fields.map(function(e){e.defer&&t.data[e.id]&&(n[e.id]=t.data[e.id])}),R.events.publish("odata.deferred.loaded",[n]),{row:n,model:e}})},coerceAdditionalQueries:function(){},getEntitySetFromEntityTypeName:function(a,r){var i=this,o=i.processFullyQualifiedName(a),e=i.getFlatEntitySetList(r).filter(function(e){var t=i.getEntitySet(e,r),n=i.processFullyQualifiedName(t.entityType);return t.entityType===a||t.entityType===o.name||n&&n.name===a})[0];return e&&i.getEntitySet(e,r)},load:function(e,t){var r=this,n=M(),i=t.dataSource,a=[];return r.authenticateAndGetMetadata(t,e).then(function(){return r.getExtraEntityMetadata(i,e)}).then(function(){E(e,function(e,t){var n=t.objectName;if(n){var a=r.getEntitySet(n,i.metadata);a||(a=r.getEntitySetFromEntityTypeName(n,i.metadata),t.objectName=a.name)}}),C.each(e,function(){var e=r.loadIndividualModel(this,i,t);a.push(e)}),C.when.all(a).then(function(e){n.resolve(e)},function(e){var t=r.produceErrorTextFromErrors(e);n.reject(t)})},function(e,t){n.reject(e,t)}),n.promise()},produceErrorTextFromErrors:function(e){var a=this,r="There was a problem with an OData Query: ";return C.each(e,function(e,t){var n=a.getErrorFromErrorBody(t.message?t:t.response&&t.response.body,t.response);n&&t.response?(r+=(n.code?n.code+" - ":"")+n.message,t.response.requestUri&&(r+=" - Request URL: "+t.response.requestUri)):p(t)&&(r+=t)}),r},processFullyQualifiedName:function(e){var t=e.split(j);return{name:t.pop(),nameSpace:t.join(j)}},supportsBatch:function(e){var t="true"===(e.getConfigProperty("supports-batch")||"false");return M().resolve(t).promise()},search:function(s,e,n){var t=this,u=C.map(s.returning,function(e){var t=n[e.modelName];return e.fields||(e.fields=[]),t.searchFields=e.fields,t}),a=M();return t.getEntityMetadata({dataSource:s.dataSource,entities:u}).then(function(e){return C.each(e,function(i,e){var t=u[i],o=1;C.each(t.searchFields,function(a,r){C.each(e.fields,function(e,t){if((r=D.isString(r)?r:r.id)===t.id){if(t.filterable){var n=!1;C.each(u[i].conditions,function(e,t){t.name==="__global_search_"+o&&(n=!0,u[i].conditions[e].value=s.query)}),n||u[i].addCondition({name:"__global_search_"+o,sourceType:"param",sourceParam:"search",value:s.query,field:r,operator:"contains",encloseValueInQuotes:!0,inactive:!1}),o++}u[i].fields[a]=t}})}),t.conditionLogic?t.conditionLogic=t.conditionLogic.replace("AND","OR"):t.conditionLogic=t.conditions.map(function(e,t){if(!0!==e.inactive)return t+1+""}).join(" OR ")}),t.load(u,{dataSource:R.dataSource.getDataSource(s.dataSourceName),loadAllMetadata:!0,performingSearch:!0,ignoreCache:!0}).then(function(e){return a.resolve({request:s,results:e.map(function(e){var t=s.returning[e.objectName];return{label:e.label,labelPlural:e.labelPlural,objectName:n[t.modelName].objectName,objectMapKey:t.objectMapKey,modelName:t.modelName,records:e.data}})}).promise()})})},properties:{composer:{supports:{childRelationships:!1},canFieldsBeSelected:function(e){return!!e.breadcrumb.endsobject||"Select an external object for this Model."}},canAutoGenerateConditionsFromFields:!0,validConditionTypes:["fieldvalue","multiple","param","userinfo","blank","modelmerge"],canConditionsBeGrouped:!0,hasGlobalSearchEntities:!0},propertyHasExtension:function(e,t){return!!e.extensions&&0<e.extensions.filter(function(e){return e.name===t}).length},createPropertyExtensionsMap:function(e){var n={};if(e.extensions)return C.each(e.extensions,function(e,t){if(!t.name||void 0===t.value)return!0;n[t.name]=t.value}),n},_expandBaseTypeForEntity:function(e,t,n,a){if(!e||!t)return[];var r,i,o,s,u,c,d=e.baseType,l=n.dataServices,p=e.hasExpandedBaseType,f=e.__namespace;return a=a||{},!d||p?{properties:e.property||[],navigationProperties:e.navigationProperty||[],key:e.key}:(-1!==d.indexOf(j)&&(r=(i=d.split(j)).slice(0,i.length-1).join(j),o=d.substring(r.length+1)),r?(r=l.aliasMap[r]||r,e.baseType=r+j+o,s=(c=this.getSchema(n,r))&&c.entityTypeMap[o]):(s=this.getSchema(n,f).entityTypeMap[d],r=f),s?a[r+j+s.name]?{properties:e.property||[],navigationProperties:e.navigationProperty||[],key:e.key}:(a=L(r+j+s.name,a),e.hasExpandedBaseType=!0,u=this._expandBaseTypeForEntity(s,this.getSchema(n,r),n,a),e.property=(e.property||[]).concat(u.properties),e.navigationProperty=(e.navigationProperty||[]).concat(u.navigationProperties),e.key=u.key||e.key,{properties:e.property,navigationProperties:e.navigationProperty,key:e.key}):{properties:e.property||[],navigationProperties:e.navigationProperty||[],key:e.key})},_buildEntitySpecificMaps:function(e,t,n){var a,r=n.dataServices;e.builtMaps||(a=this._expandBaseTypeForEntity(e,t,n),e.property=a.properties,a.navigationProperties&&a.navigationProperties.length&&(e.navigationProperty=a.navigationProperties),e.key=a.key,this._setMapOfPropertiesOfEntityType(e,n),this._setMapOfNavigationPropertiesOfEntityType(e,r),e.builtMaps=!0)},_buildMetadataMaps:function(e,t){var n,o=t.major<4,s=e.dataServices;u([s],"schema","schemaMap","namespace",{addKeyRelationships:!1}),u(s.schema,"entityType","entityTypeMap","name",{addKeyRelationships:!1}),u(s.schema,"action","actionMap","name",{addKeyRelationships:!1}),u(s.schema,"function","functionMap","name",{addKeyRelationships:!1}),n=s.schema,s.aliasMap={},this._setComplexTypeMap(e),this._setEnumTypeMap(e),o&&(u(n,"association","associationMap","name",{addKeyRelationships:!1}),u(n,"entityContainer","entityContainerMap","name",{addKeyRelationships:!1})),E(n,function(e,n){var t,a,r,i;n.alias&&(s.aliasMap[n.alias]=n.namespace),(a=o?n.entityContainer:(n.entityContainerMap={},(t=n.entityContainer)&&(n.entityContainerMap[t.name]=t)&&[t]))&&(u(a,"entitySet","entitySetMap","name",{addKeyRelationships:!1}),r=n.entitySetMap={},C.each(a,function(){C.extend(r,this.entitySetMap)}),o&&(u(a,"associationSet","associationSetMap","name",{addKeyRelationships:!1}),i=n.associationSetMap={},C.each(a,function(){C.extend(i,this.associationSetMap)}))),C.each(n.entityTypeMap,function(e,t){t.__namespace=n.namespace})})},getBatchSupport:function(e){return D.getObjectProperty(e,"metadata.skuidSupportsBatch")},attachHttpClientToDataSource:function(i,d){var l=this,p=l.getODataLibrary(i),f=l.getServiceVersion(i).major<4;i.httpClientOfDataSourceType={request:function(o,s,u){var e,t,n=o.dataSource||i,a=C.extend(o.headers,d.headers),c=l.getServiceVersion(n),r=l.getBatchSupport(i);return f&&!r&&(a.DataServiceVersion=c.stringRep,a.MaxDataServiceVersion=c.stringRep),t={body:o.body,url:o.requestUri,method:o.method,headers:a},r||(t.contentType="application/json;odata=verbose"),l.coerceRequest(t,o),e=n.createHTTPRequest(t),n.useProxy?(n.authentication&&n.authentication.success&&(e.isAuthenticated=!0),R.ajax.proxy(e).done(function(e){var t,n=e?e.headers:null;if(3===c.major&&(C.each(["Content-Type","content-type"],function(e){if(n[e])return t=n[e],!1}),t&&"application/json"===t.slice(0,16))){var a=t.split(";"),r=!1;C.each(a,function(){if("odata"===this.slice(0,5))return!(r=!0)}),r||(e.headers["Content-Type"]=t+";odata=minimalmetadata")}var i={requestUri:o.requestUri,statusCode:e.statusCode,statusText:e.status,headers:e.headers,body:e.body instanceof Document?D.getXML(e.body):e.body};"2"===l.getStatusCode(e)?(l.coerceResponse(i,o.model),s(i)):u(e.status,i)}).fail(function(e){u({response:e})})):(C.extend(o,{requestUri:e.url,body:e.body,headers:e.headers}),p.defaultHttpClient.request(o,function(e){l.coerceResponse(e,o.model),s(e)},function(e){u(e)}))}}},coerceResponse:function(){},trimMetadataForCache:function(e){var n=e.dataServices,t=["aliasMap","complexTypeMap","enumTypeMap","schemaMap"];E(t,function(e,t){delete n[t]}),t=["entityContainerMap","entitySetMap","entityTypeMap","functionMap","actionMap"],E(n.schema,function(e,n){E(t,function(e,t){delete n[t]}),E(n.entityType,function(e,t){delete t.navigationPropertyMap,delete t.propertyMap,delete t.builtMaps}),D.isObject(n.entityContainer)?delete n.entityContainer.entitySetMap:E(n.entityContainer,function(e,t){delete t.entitySetMap})})},queryMetadata:function(e){var t,o=this,s=M(),u=e.dataSource,n=e.minimalOnly,c=o.getServiceVersion(u),d=function(e){var t=M();return o.populateExtraServersideCachedMetadata?o.populateExtraServersideCachedMetadata(e).then(function(e){t.resolve(e)}):t.resolve(),t.promise()};function a(t,e,n){var a,r,i=t&&t.dataServices;if(a=(n=n||{}).minimalOnly,r=n.fromSource,t&&(t.skuidVersion=c),i)o._buildMetadataMaps(t,c),u.metadata=t,(r?d(u,a):M().resolve().promise()).then(function(){return o.supportsBatch(u).then(function(e){return t[S]=e,a&&(o.trimMetadataForCache(t),u.fetchingMetadata=!1),s.resolve(t)},function(){t[S]=!1,u.fetchingMetadata=!1,s.resolve(t)})});else{if(e)return"OK"===e.statusText?s.reject("Unable to parse metadata. Is your OData version correct?",e):s.reject(e.statusText+": "+e.body,e);s.reject("Attempted to pull from datasource cache, but failed")}}if(u.metadata)return s.resolve(u.metadata).promise();if(u.fetchingMetadata)return u._metadataFetch;function r(){return o.makeODataRequest(u,{requestUri:o.buildResourceUri(u,B)},{tupleResponse:!0,handler:"metadataHandler",excludeMetadata:!0}).then(function(e){var t=H(e,2);a(t[0],t[1],{minimalOnly:n,fromSource:!0})}).catch(function(e){var t=H(e,2),n=t[0],a=t[1];s.reject(n,a)})}return u.fetchingMetadata=!0,o.attachHttpClientToDataSource(u,e),!u._metadataCacheVersion||n?r():(u.getCacheProperties(["url","version"]).version!==u._metadataCacheVersion&&u.setPersistentCacheProperties({version:null}),((t=u).setPersistentCacheProperties({version:null}),C.get("/api/v1/datasource-metadata?datasource="+t.name+"&cache="+t._metadataCacheVersion).then(function(e){return t.setPersistentCacheProperties({version:t._metadataCacheVersion}),JSON.parse(e)})).then(a).catch(r)),u._metadataFetch=s.promise(),u._metadataFetch},coerceSaveItemRequest:function(){},coerceChanges:function(){return!1},getUpdateMethod:function(e){return this.getBatchSupport(e)?this.getServiceVersion(e).major<4?g:h:this.getServiceVersion(e).major<3?g:h},itemNeedsIfMatchHeader:function(e){return!(!e.__metadata||!e.__metadata.etag)},getItemChanges:function(r,e,t,i){var o=this,s={},u=o.getServiceVersion(i),c=u.major<4;return C.each(e,function(e,t){var n=r.getField(e);if("REFERENCE"===n.displaytype){var a=o.getEntitySetFromEntityTypeName(n.ref,i.metadata);c?s[e]={__metadata:{uri:t?a.name+"("+t[n.keyField]+")":null}}:s[e+"@odata.bind"]=t?a.name+"("+t[n.keyField]+")":null}else s[e]=o.getItemForDML(n,t,u)}),s},save:function(o,e){var v=this,r=M(),i=e.dataSource,b=this.getServiceVersion(i),E=b.major<4,t="application/json;"+(E?"odata=verbose":"odata.metadata=full"),S=v.getUpdateMethod(i),s=[],u=[];function F(){return{Accept:t,"Content-Type":t}}return v.authenticateAndGetMetadata(e).then(function(e){return o.fromOfflineStorage?(C.each(o.operations,function(e,t){if(!R.$M(t.id)){var n=new R.model.Model({id:t.id,dataSource:i,conditions:[],label:t.type,objectName:t.type,fields:C.map(t.returning,function(e){return{id:e}}),extensions:t.extensions}).initialize().register(),a=[];C.each(t.deletes,function(e){a.push(e)}),C.each(t.updates,function(e){a.push(e)}),a.length&&s.push(n),u.push(n)}}),s.length?R.model.load(s).then(function(){return e}):e):e}).then(function(g){var i=[];C.each(o.operations,function(e,a){var c=R.$M(a.id),d=c.getDataSource(),l=[],p=[],f=v.getEntitySet(a.type,g),u=v.getEntityTypeFromEntitySet(f,a.type,g),m={},y=0,t=M(),r={deleteResults:[],insertResults:[],updateResults:[],totalsuccess:!0};function h(e,t,n){return{operationType:e,dataSource:d,model:c,key:t,row:n,operation:a,entitySet:f,entityType:u,version:b}}i.push(t),v.coerceChanges(a,o,c),C.each(a.deletes,function(e,t){var n,a=F(),r=c.getRowById(e);v.itemNeedsIfMatchHeader(r)&&(a["If-Match"]="*"),E||(a["Content-ID"]=""+e),A(t,r,b),v.coerceSaveItemRequest(n={requestUri:f.name+"("+e+")",method:P,__oldid:e,headers:a},h("delete",e,t)),l.push(n)}),C.each(a.updates,function(e,t){var n,a=c.getRowById(e),r=v.getItemChanges(c,t,a,d),i=F();for(var o in v.itemNeedsIfMatchHeader(a)&&(i["If-Match"]="*"),E||(i["Content-ID"]=""+e),A(r,a,b),r)if(-1<o.indexOf("odata.bind")){var s=o.split("@")[0],u=t[s];c.getRowOriginals(e)&&null===u&&(v.coerceSaveItemRequest(n={requestUri:f.name+"("+e+")/"+s+"/$ref",method:P,headers:i},h("update",e,t)),g.skuidSupportsBatch?p.push(n):l.push(n),delete r[o])}v.coerceSaveItemRequest(n={requestUri:f.name+"("+e+")",method:S,data:r,__oldid:e,headers:i},h("update",e,t)),l.push(n)}),C.each(a.inserts,function(e,t){var n,a=c.getRowById(e),r=v.getItemChanges(c,t,a,d),i=F(),o=u.__namespace+j+u.name,s=m[e];s||(s=++y),E?r.__metadata={type:o}:r["@odata.type"]="#"+o,i["Content-ID"]=""+s,v.coerceSaveItemRequest(n={requestUri:f.name,method:O,data:r,__oldid:e,headers:i},h("insert",e,t)),l.push(n)});var n=C.when();v.preSaveHook&&(n=v.preSaveHook(r,d,l,a)),n.then(function(){var n=[];return C.each(l,function(e,t){t.data&&t.data.__shouldRemove&&n.push(e)}),C.each(n.reverse(),function(e,t){l.splice(t,1)}),l.length?g.skuidSupportsBatch?(l=[l],p.length&&p.forEach(function(e){return l.push(e)}),v.handleBatchRequest(r,d,l,a).then(function(e){t.resolve(e)})):v.handleConcurrentRequests(r,d,l,a).then(function(e){t.resolve(e)}):t.resolve(r)}).catch(function(e){t.reject(e)})}),C.when.all(i).then(function(e){var n={insertResults:[],updateResults:[],deleteResults:[],globalErrors:[],totalsuccess:!0};C.each(e,function(e,t){C.merge(n.insertResults,t.insertResults),C.merge(n.updateResults,t.updateResults),C.merge(n.deleteResults,t.deleteResults),!1===t.totalsuccess&&(n.totalsuccess=!1)});for(var t=0;t<u.length;t++)u[t].unregister();r.resolve(n)},function(e){for(var n=[],a=[],t=0;t<u.length;t++)u[t].unregister();C.each(e,function(e,t){p(t.message)&&n.push(t.message),t.response&&a.push(t.response)}),r.reject(n,a)})}),r.promise()},getStatusCode:function(e){return e.statusCode?(e.statusCode+"").substring(0,1):"4"},handleConcurrentRequests:function(i,n,o,s){var u=this,e=M(),c=[];return E(o,function(a,e){var r=M(),t=x({},e,{requestUri:D.combineUrls(n.serviceUrl,e.requestUri)});return c.push(r),u.makeODataRequest(n,t,{method:"request"}).then(function(e){var t=H(e,2)[1],n=u.getStatusCode(t);if("4"===n||"5"===n)return i.totalsuccess=!1,r.reject(t.statusCode+" - "+t.statusText+" - "+t.body,t);u.handleResponse(t,o[a],s,i),r.resolve()}).catch(function(e){var t=H(e,1)[0];u.handleResponse(t,o[a],s,i),r.reject(t)})}),C.settle(c).always(function(){e.resolve(x({globalErrors:[]},i))}),e.promise()},handleBatchRequest:function(a,e,r,i){var o=this,s=M();return o.makeODataRequest(e,{requestUri:o.buildResourceUri(e,U),method:O,data:{__batchRequests:r.map(function(e){return{__changeRequests:Array.isArray(e)?e:[e]}})}},{method:"request",handler:"batchHandler",excludeMetadata:!0}).then(function(e){var t=H(e,2)[1],n=o.getStatusCode(t);"4"===n||"5"===n?s.reject(t.statusCode+" - "+t.statusText+" - "+t.body,t):(C.each(t.data.__batchResponses,function(n,e){e.__changeResponses?C.each(e.__changeResponses,function(e,t){Array.isArray(r[n])?o.handleResponse(t,r[n][e],i,a,!0):o.handleResponse(t,r[n],i,a,!0)}):o.handleResponse(e,r[n],i,a,!0)}),s.resolve(x({globalErrors:[]},a)))}).catch(function(e){var t=H(e,2)[1];s.reject({message:o.getGenericErrorMessage(),response:t})}),s.promise()},getGenericErrorMessage:function(){return"Unknown error occured making OData request"},getKeyFieldsFromEntityId:function(e,t,n){var a=this,r=n.metadata,i=a.getServiceVersion(n),o=e.match(/[^()]+(?=\))+/g),s=a.getKeyFieldsInOrderedList(t,r),u={};return o?(o=o.pop().split(","),E(o,function(e,t){var n=t.indexOf("=");if(-1!==n){var a=t.substring(0,n),r=t.substring(n+1);u[a]=r}else u[s[e].id]=t}),E(s,function(e,t){var n=t.id;u[n]=a.getItemForDML(t,u[n],i)}),u):{}},coerceResponseItemData:function(){},handleResponse:function(e,t,n,a,r){var i,o=this,s=R.$M(n.id),u=s.dataSource,c=u.metadata,d=o.getEntitySet(n.type,c),l=o.getEntityTypeFromEntitySet(d,n.type,c),p=o.getServiceVersion(u),f=[],m=p.major<4,y=o.getUpdateMethod(u),h=e.data,g=m?h:h&&h.d||h,v=g?o.getRowForItem(g,l,s.fields,p,s.fieldsMap):null,b=v&&o.getKey(v,l,p,s.fieldsMap),E=o.getStatusCode(e),S={},F="";if(!b&&3<p.major&&e.headers&&(i=e.headers["OData-EntityId"])){var M=o.getKeyFieldsFromEntityId(i,l,u);if(t.data){var T=x({},t.data,M);v=o.getRowForItem(T,l,s.fields,p,s.fieldsMap),b=o.getRowId(v,s,u)}}e instanceof Error&&(E="2"),"4"!==E&&"5"!==E||(e.stack?"Unexpected end of JSON input"===e.message?F+="Service sent back an invalid JSON payload":F+=e.message:(F="There was a problem with an OData "+(r?"Batch ":"")+"Request: ",(S=o.getErrorFromErrorBody(e.response&&e.response.body,e.response))&&(F+=(S.code?S.code+" - ":"")+S.message)),f.push({fields:S.fields||[],message:F,rowId:t.__oldid,severity:"ERROR",status:"OData Error"})),o.coerceResponseItemData(t,e,v,M),t.method===y?a.updateResults.push({errors:f,id:t.__oldid,messages:[],record:v&&JSON.stringify(v),source:n.id,success:!f.length}):t.method===O?a.insertResults.push({errors:f,id:b,messages:[],oldId:t.__oldid,record:v&&JSON.stringify(v),source:n.id,success:!f.length}):t.method===P&&a.deleteResults.push({errors:f,id:t.__oldid,messages:[],source:n.id,success:!f.length}),f.length&&(a.totalsuccess=!1)},handleDefaultReferenceFieldValue:function(e,t,n,a){var r={},i={};a.keyField&&(i[a.keyField]=t.value,r[a.id]=i),n.updateRow(e,r)},getReferenceFieldRelationshipName:function(e){return e},getReferenceHandler:function(){var a=this;return{getBaseReferenceProps:function(e){return[{id:"targetobjects",type:"sobject",readonly:!1,label:"Entity Type",dataSourceName:m.getDataSourceFromXML(e.state).name}]},getOverrideBatchProperties:function(){return[{type:"helptext",html:"Specify fields that will be added as related data. Any fields that are used in search or display templates will need to be added here."}]},getOverrideBatchNoItemsFunction:function(){return function(){return C("<div>").text("(Loading key field only.)")}},coerceObjectName:function(e,t){var n=a.getEntitySetFromEntityTypeName(e,t.metadata);return n?n.name:e},getOverrideBatchFieldChildrenFunction:function(t){return function(){return[{id:"batchfield",indent:1,linkedComponent:t,addtooltip:"Add New Batch Load Field",labelFunction:function(e){return e.attr("field")||"[No Field Selected]"},defaultStateFunction:function(){return i("<batchfield/>")},propsFunction:function(e){return[{id:"field",type:"field",label:"Field",sobject:t.state.attr("targetobjects"),dataSourceName:t.state.attr("datasource"),onChange:function(){e.refresh().rebuildProps()}}]}}]}},getMetadataHandler:function(e,t,n,a,r){var i,o=e.children("batchfields").first().children("batchfield"),s=e.attr("keyfield")||"ID",u=e.attr("targetobjects"),c=e.attr("ogdisplaytype"),d=e.attr("rel")||a+"__r";if(t.keyField=s,t.originalDisplayType=c,u&&(i=u.split(","),t.isNamePointing=1<i.length,(r||c&&"REFERENCE"!==c)&&(t.relationshipName=t.rel=d),t.referenceTo=C.map(i,function(e){return{accessible:!0,objectName:e}}),t.ref=u),!r&&c&&"REFERENCE"!==c){var l=m.getDataSourceFromXML(e),p=new R.model.Model({dataSource:l});p.id="_ReferenceLabelModel_"+(new Date).getTime()+d,o&&o.length?p.fields=C.map(o,function(e){return{id:C(e).attr("field")}}):p.fields=[{id:s}],p.doQuery=!0,p.doClone=!1,p.objectName=u,p.initialize();var f=new R.model.Condition;f.name="__reference_batch",f.operator="in",f.field=s,f.encloseValueInQuotes=!1,p.addCondition(f),n.batchLabelModels||(n.batchLabelModels={}),n.batchLabelModels[a]=p}},getReferenceValue:function(e,t){return a.getReferenceValue(e,t)},getRowFromReferenceValue:function(e,t,n){var a=e.getRows([{field:n.keyField||"ID",value:t}]);return a&&a.length?a[0]:{}},processReferenceLookupModel:function(e,t,n){e.objectName=n}}},getReferenceValue:function(e,t){return e[t.keyField||"ID"]},onDataSourceChange:function(e){e.attr("deferfieldrendering",!0)},createActions:function(E){var S=this,a=function(e,a,r){var t="action"===e?S.getActionMap(r):S.getFunctionMap(r),n="action"===e?S.getActionsList(r):S.getFunctionsList(r),i=a.state,o=i.attr("name"),s=t[o],u=n.filter(function(e){return e.namespace+"."+e.name===o}),c=[];if(c.push({id:"name",label:("action"===e?"Action":"Function")+" name",type:"combobox",showLabelInTextInput:!0,onChange:function(){D.removeAllAttrsExcept(i,["datasource","type","actionname","name"]),a.refresh().rebuildProps()},entries:function(e){return function(e,n,a){return C.map(e,function(e,t){if((void 0===e.parameter||void 0===e.parameter.find(function(e){return-1<e.type.indexOf(v)?e:a.dataServices.complexTypeMap[e.type]?e:-1===e.type.indexOf("Edm")&&S.getEntityType(e.type,a)&&S.getEntityType(e.type,a).typeInfo?e:void 0}))&&-1<e.name.indexOf(n))return{label:l.makeLabelFromId(e.name),value:t}})}(t,e,r)}}),s&&s.isBound)if(1<u.length)c.push({id:"bound",label:"Bound Entity Set",type:"combobox",onChange:function(){return a.refresh().rebuildProps()},showLabelInTextInput:!0,entries:function(a){return u.map(function(e){var t=e.parameter[0].type,n=S.getEntitySetFromEntityTypeName(t,r);if(n&&-1<n.name.indexOf(a))return{value:e.namespace+j+n.name,label:n.label||n.name}})}},{id:"bound-id",label:"Bound ID",type:"text",value:""});else{var d=S.getEntitySetFromEntityTypeName(s.parameter[0].type,r);d&&c.push({id:"bound",label:"Bound Entity Set",type:"readonly",value:d.label||d.name},{id:"bound-id",label:"Bound ID",type:"text",value:""})}return s&&s.parameter&&s.parameter.map(function(e,t){if(!s.isBound||0!==t){var n=function(e,t,n){var a=e.type,r=e.name,i=r.toLowerCase();if(F[a])return[{id:i,type:"string",label:r,metadata:{id:r,label:r,displaytype:F[a],edmtype:a,minInputLength:1}}];if(n.dataServices.enumTypeMap[a])return[{id:i,type:"picklist",label:r,entries:n.dataServices.enumTypeMap[a].picklistEntries}];var o=S.getEntityType(a,n);if(o){if(o.abstract){var s=[],u=n.dataServices.schemaMap,c=o.__namespace;return u[c].entityType.forEach(function(e){if(e.baseType===c+j+o.name){var t=S.getEntitySetFromEntityTypeName(e.name,n);t&&s.push({value:c+j+t.name,label:t.label||t.name})}}),[1===s.length?{id:i,label:r+" Entity Set",type:"readonly",value:s[0].label}:{id:i,label:r+" Entity Set",type:"combobox",showLabelInTextInput:!0,onChange:function(){return t.refresh().rebuildProps()},entries:function(t){return s.filter(function(e){return-1<e.label.indexOf(t)})}},{id:i+"-id",label:r+" Id",type:"text",value:""}]}var d=S.getEntitySetFromEntityTypeName(o.name,n);if(d)return[{id:d.name,label:"Entity Set",type:"readonly",value:d.label||d.name},{id:d.name.toLowerCase()+"-id",label:"Entity Set ID",type:"text",value:""}]}}(e,a,r);n&&n.length&&c.push.apply(c,n)}}),c},i=function(u,c,e,d,l,p){var t="action"===u?S.getActionMap(p):S.getFunctionMap(p),n="action"===u?S.getActionsList(p):S.getFunctionsList(p),a=c.attr("name"),f=S.processFullyQualifiedName(a),m=t[a],r=n.filter(function(e){return e.namespace+"."+e.name===a}),y=m&&m.parameter,h=l.serviceUrl,g={},v="",i={};if(h.lastIndexOf("/")!==h.length-1&&(h+="/"),1<r.length&&c.attr("bound")&&r.forEach(function(e){var t=e.parameter[0].type,n=S.getEntitySetFromEntityTypeName(t,p);n&&e.namespace+j+n.name===c.attr("bound")&&(y=(m=e).parameter)}),m.isBound){var o=D.mergeAsTextInContext(c.attr("bound-id"),d),s=S.getEntityType(m.parameter[0].type,p),b=S.getEntitySetFromEntityTypeName(s.name,p);h+=b.name+"("+o+")/"+a+(1<m.parameter.length&&"action"!==u?"(":"")}return y&&y.map(function(e,t){if(!m.isBound||0!==t){var n=e.name,a=n.toLowerCase(),r=D.mergeAsTextInContext(c.attr(""+a),d);if(0===t?"action"===u?h+=f.name:"function"==u&&(h+=f.name+(m.parameter.length?"("+n+"=@"+a:""),1<y.length&&(h+=","),v+=")?"):"function"===u&&(h+=n+"=@"+a,y.length-1!==t&&(h+=","),m.isBound&&1===t?v+=")?":v+="&"),"STRING"===F[e.type])"function"===u?v+="@"+a+"='"+r+"'":g[n]=r;else if("NUMBER"===F[e.type])"function"===u?v+="@"+a+"="+r:g[n]=parseInt(r,10);else if("DATE"===F[e.type]||"DATETIME"===F[e.type])"function"===u?v+="@"+a+"="+r:g[n]=r;else if(S.getEntityType(e.type,p)){var i=void 0,o=void 0;if(o=S.getEntityType(e.type,p).abstract?(i=S.getEntitySet(c.attr(a),p),D.mergeAsTextInContext(c.attr(a+"-id"),d)):(i=S.getEntitySetFromEntityTypeName(e.type,p),D.mergeAsTextInContext(c.attr(i.name.toLowerCase()+"-id"),d)),"function"===u)v+="@"+a+'={"@odata.id":"'+i.name+"("+o+')"}';else{var s=C.extend({},d.row);d.model&&d.model.fields.forEach(function(e){if("REFERENCE"===e.displaytype){var t=S.getEntitySetFromEntityTypeName(e.ref,p);if(s[e.id]){var n=s[e.id][e.id];s[e.id+"@odata.bind"]=""+l.serviceUrl+t.name+"("+n+")",delete s[e.id]}}}),delete s.__skuid_record__,g[n]=s}}else"function"===u?v+="@"+a+"="+r:g[n]=r}}),y||(h+=m.name),"function"===u?i.requestUri=h+v:"action"===u&&(i.requestUri=h,i.data=g,i.method="POST"),S.makeODataRequest(E,i).then(function(e){return{$ODataAction:e}})};return S.authenticateAndGetMetadata({dataSource:E}).then(function(r){var e=S.getFunctionMap(r),t=S.getActionMap(r),n={};return D.size(e)&&(n.function={label:"Function",builderProps:function(e){return a("function",e,r)},runtimeExecution:function(e,t,n,a){return i("function",e,0,n,a,r)}}),D.size(t)&&(n.action={label:"Action",builderProps:function(e){return a("action",e,r)},runtimeExecution:function(e,t,n,a){return i("action",e,0,n,a,r)}}),n})}}),x(r,{ODataDataSourceTypeBase:q}),D.runningTests()&&(q.prototype=x(!0,q.prototype,{unitTestableMethods:{removeTrailingAndIfNecessary:_}}))}});