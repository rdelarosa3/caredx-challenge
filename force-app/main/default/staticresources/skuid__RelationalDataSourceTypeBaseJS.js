!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=345)}({345:function(e,t,n){"use strict";var r,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=n(7),l=(r=o)&&r.__esModule?r:{default:r};!function(e){var t=e.$,n=t.each,r=t.extend,o=e.constants,u=e.dataSource,c=o.DISPLAY_TYPES,d=u.core||(u.core={}),s=e.utils,f=s.isString,h=t.Deferred,p=["name"],g="x-sql-dialect";function y(e){var t=e.body;if(t)for(;f(t);)try{t=JSON.parse(t)}catch(e){break}return t}function v(e){if(e.proxyVersion){var t=e.proxyVersion.split(".");if(3==t.length){var n=t.map(function(e){return parseInt(e,10)}),r=a(n,3),i=r[0],o=r[1],l=r[2];if(i>=0&&o>=2&&l>=3)return e.name}}return e.id}var b={getEntityList:function(e,t){return{url:s.combineUrls(t.dataServiceUrl,"datasources/"+v(t)+"/entities"),method:"GET",contentType:"application/json",headers:{}}},getModelMetadata:function(e,t){return{url:s.combineUrls(t.dataServiceUrl,"datasources/"+v(t)+"/entities?name="+e.entity),method:"GET",contentType:"application/json",headers:{accept:"application/vnd.skuid-metadata"}}},load:function(e,t){return{url:s.combineUrls(t.dataServiceUrl,"datasources/"+v(t)+"/load"),method:"POST",contentType:"application/json",body:e}},save:function(e,t){return{url:s.combineUrls(t.dataServiceUrl,"datasources/"+v(t)+"/save"),method:"POST",contentType:"application/json",body:e}}};function m(n){for(var r,i={},a=n.getDataSourceType(),o=function(r){return function(i){if(n.proxyHost)return function(e,n,r){return l.default.getAPIToken().then(function(i){var a=b[e](n,r);return a.headers=t.extend({},{"x-skuid-options-schemas":!0,Authorization:"Bearer "+i.jwt},a.headers),a})}(r,i,n).then(function(r){return e.ajax.direct(n.createHTTPRequest(r)).then(y).catch(function(e){var n,r=y(e);return r&&t.isPlainObject(r)&&(n=r.message),!n&&e&&(n=0===e.statusCode?"Error with the connection, likely caused by a timeout talking to the data source.":e.status),n})});var o=h(),u=function(t,n,r,i){var a=r.useDataSourceObjects?r.dataServiceUrl:i.remoteEndpoint,o=n?"POST":"GET",l={method:o,url:s.combineUrls(a,t)};return"POST"===o&&(l.body=n,l.contentType="application/json"),l.headers={"x-skuid-data-source":r.name,"x-skuid-options-schemas":!0},i.sendSessionIdAsHeader&&(l.headers["x-skuid-session-id"]=e.utils.userInfo.sessionId),i[g]&&(l.headers[g]=i[g]),l}(r,i,n,a);return e.ajax.direct(n.createHTTPRequest(u)).then(function(e){o.resolve(y(e))},function(e){var n,r=y(e);r&&t.isPlainObject(r)&&(n=r.message),n||(n=e.status),o.reject(n)}),o.promise()}},u=0,c=["load","save","getModelMetadata","getEntityList"];u<c.length;u++)i[r=c[u]]=o(r);return n._remote=i,i}function T(e){var t=e._remote;return t||(t=new m(e)),t}function F(e,t,n){t||(t=n.getDataSource());var r=t.getCachedEntityMetadata(e),i=r&&r.get("nameFields");if(i&&i.length)return i[0]}function M(e){var n=e.idFields;return n&&t.isArray(n)&&1===n.length?n[0]:n}function S(e){var n,r,i,a;e.rel||(e.rel=e.id+"__rel"),e.relationshipName||(e.relationshipName=e.rel),!e.ref&&e.referenceTo&&(n=e.referenceTo)&&n.length&&(r=[],i=[],a={c:"createable",o:"objectName",l:"label",k:"keyPrefix",p:"labelPlural",s:"searchable"},t.each(n,function(e,n){n.o?(r.push(n.o),i.push(n.k),t.each(a,function(e,t){n[t]=n[e],delete n[e]}),n.accessible=!0):(r.push(n.objectName),n.accessible=!0)}),r.length&&(e.ref=r.join(",")),i.length&&(e.refprefix=i.join(",")))}function P(e){return s.grab(e,"referenceTo",0,"keyField")}function j(e){return e&&e.slice(0,-5)}function E(e){return e&&e+"__rel"}function C(e){!function(e){t.each(e,function(e,t){if(!t.fields||!t.fields.length)throw"Error with Model: "+t.id+" - Must have at least one valid field"})}(e),function(e){t.each(e,function(e,n){if(!n.conditions||!n.conditions.length)return delete n.conditions,void delete n.conditionLogic;var r=!1;t.each(n.conditions,function(e,t){t.inactive||(r=!0)}),r||(delete n.conditions,delete n.conditionLogic)})}(e)}function N(e){return s.isString(e)||e.objectName&&e.dataSource}function O(e){n(p,function(t,n){if(!e[n])throw"Missing Required Property Error: "+n}),r(this,e),e.extendedProperties&&(r(!0,this.properties,e.extendedProperties),delete this.extendedProperties),u.DataSourceType.prototype.constructor.call(this,this),delete this.getModelProperties}O.prototype=new u.DataSourceType(!1),O.constructor=O,O.prototype=r(!0,O.prototype,{save:function(e,t){var n=t.dataSource;return n.authenticate().then(function(){return T(n).save(e)})},load:function(e,n){var r=n.dataSource;return r.authenticate().then(function(){var i=!1,a=["conditionLogic","doQuery","groupByMethod","havingLogic","id","objectName","schemaName","orderByClause","offsetPageNumber","offsetPageSize","recordsLimit","type"],o={},l=t.map(e,function(e){var n={};for(var r in e)e.hasOwnProperty(r)&&t.inArray(r,a)>-1&&(s.isUndefined(e[r])||""===e[r]||(n[r]=e[r]));var l=e.fields.filter(function(e){return e.uiOnly});return l.length&&(o[e.id]=l),t.each(["fields","groupByFields"],function(r,i){var a,o=e[i];o&&o.length&&(a=n[i]=[],t.each(o,function(e,n){var r;if(n.uiOnly)return!0;"childRelationship"===n.type?(r={id:n.id,type:n.type,anchorField:n.anchorField,keyField:n.keyField,childObject:n.childObject},t.each(["recordsLimit","orderByClause","subConditionLogic"],function(e,t){n.hasOwnProperty(t)&&null!==n[t]&&void 0!==n[t]&&(r[t]=n[t])}),n.subConditions&&(r.subConditions=[],n.subConditions.length&&t.each(n.subConditions,function(e,t){var n={};for(var i in t)t.hasOwnProperty(i)&&null!==t[i]&&void 0!==t[i]&&(n[i]=t[i]);r.subConditions.push(n)})),n.subFields&&(r.subFields=[],n.subFields.length&&t.each(n.subFields,function(e,t){var i={id:t.id};void 0!==n.query&&null!==n.query&&(i.query=i.query),r.subFields.push(i)}))):(r={id:n.id},t.each(["name","function","query"],function(e,t){n.hasOwnProperty(t)&&null!==n[t]&&(r[t]=n[t])})),a.push(r)}))}),t.each(["conditions","havings"],function(r,i){var a,o=e[i];o&&o.length&&(a=n[i]=[],t.each(o,function(n,r){var i=t.extend({},r);for(var o in i)null===i[o]&&delete i[o];t.each(i.subConditions,function(t,n){var r=e.getField(n.field);["INTEGER","DOUBLE","CURRENCY"].indexOf(r.displaytype)>-1&&(n.operator="=")}),a.push(i)}))}),e.needsMetadataLoad&&(i=!0),n});C(l);var u=!n||n.loadAllMetadata||i;return T(r).load({operationModels:l,options:{excludeMetadata:!u}}).then(function(e){var n,i,a=h();if(t.isArray(e))a.resolve(e);else if(e&&e.models)(n=e.metadata)&&s.size(n)&&t.each(n,function(e,t){r.cacheEntityMetadata(e,t)}),Object.keys(o).length&&(e.models=(i=o,e.models.map(function(e){return e.fields&&i[e.id]&&(e.fields=e.fields.concat(i[e.id])),e}))),a.resolve(e.models);else{var l=void 0;f(e)?l=e:t.isPlainObject(e)&&(l=e.message?e.message:e.error),a.reject(l||"Invalid Response Format")}return a.promise()})})},getRowId:function(e,n){var r,i=M(n),a={},o=!1;return t.isArray(i)?(i.length<=0&&(o=!0),i.forEach(function(t){var r=n.getFieldValue(e,t,!0);s.isUndefined(r)||null===r?o=!0:a[t]=r})):(r=n.getFieldValue(e,i,!0),s.isUndefined(r)||null===r?o=!0:a[i]=r),o?s.generateUniqueId():JSON.stringify(a)},getChildIdFromRow:function(e,t,n){var r=e.getIdFieldForChildRelationship(n),i=t[r],a=null;if(r&&i){var o={};o[r]=i,a=s.encodeHTML(JSON.stringify(o))}return a},getReferenceHandler:function(){return{getReferenceValue:function(e,t){return e[P(t)]},processReferenceLookupModel:function(e,t,n){var r=P(t.metadata),i=F(n,null,e);e.objectName=n,e.fields||(e.fields=[]),e.fields.push({id:r}),i&&!e.getField(i)&&e.fields.push({id:i})},getRowFromReferenceValue:function(e,t,n){var r=P(n),i=e.getRows([{field:r,value:t}]);return i&&i.length?i[0]:{}}}},getRowName:function(e,t,n){return t.getFieldValue(e,F(t.objectName,n,t),!0)},getNameField:F,getIdField:M,getIdFieldForChildRelationship:function(e,t){return M(e.fieldsMap[t])},initialize:function(e){if(e.fields&&e.fields.length){var n=e.getDataSource&&e.getDataSource(),r=n&&n.getCachedEntityMetadata(e.objectName);r&&(t.each(e.fields,function(n,i){!function e(n,r,i,a){if(r){var o,l,u,d,s,f,h=r.split("."),p=a.getDataSource&&a.getDataSource();if("childRelationship"===n.type)(d=n.referenceTo&&n.referenceTo.length&&n.referenceTo[0])&&(s=p&&p.getCachedEntityMetadata(d.o),n.idFields=s.get("idFields"),(f=n.subFields)&&t.each(f,function(t,n){e(n,n.id,s,a)}));else if(1===h.length){if(o=i&&i.getField&&i.getField(r)){l=a.getOverrideableFieldMetadata(n);var g=n.id,y=n.name;t.extend(!0,n,o),g&&(n.id=g),y&&(n.name=y),l&&t.each(l,function(e,t){n[e]=t})}n&&n.displaytype===c.REFERENCE&&S(n)}else r=j(r=h.shift()),(o=i&&r&&i.getField&&i.getField(r))&&((u=o.referenceTo)&&1===u.length?i=p&&p.getCachedEntityMetadata(u[0].objectName||u[0].o):u&&u.length>1&&(i=p&&p.getCachedEntityMetadata("Name")),i&&e(n,h.join("."),i,a)),n.required=n.createable=n.editable=!1}}(i,i.id,r,e)}),t.each(r.get(["label","labelPlural"]),function(t,n){e.hasOwnProperty(t)||(e[t]=n)}),t.each(r.get(["accessible","createable","updateable","deleteable","idFields"]),function(t,n){e[t]=n}))}return(!e.idFields||e.idFields&&!e.idFields.length)&&(e.updateable=!1,e.deleteable=!1),e.data instanceof Array||(e.data=[e.data]),e},getEntityList:function(e){var n=e.dataSource;return n._entityListCache?h().resolve(n._entityListCache):n.authenticate().then(function(){return T(n).getEntityList()}).then(function(e){return n._entityListCache=e.map(function(e){return t.isPlainObject(e)?{label:e.label,value:e.name}:e}),n._entityListCache})},handleDefaultReferenceFieldValue:function(e,n,r,a,o){var l=a.rel,u=n.value,c=s.getNameField(a.ref,r.dataSource),d=n.nameFieldValue||!1;if(!d){var f=s.getFieldReference(n.field,a,r.dataSource);t.each(o,function(e,t){t===n||t.field!==f||t.inactive||!t.value||n.operator&&"="!==n.operator||(d=t.value)})}var h,p={};d&&("object"===(void 0===d?"undefined":i(d))?h=d:(h={})[c]=d,p[l]=h),p[n.field]=u,r.updateRow(e,p)},getReferenceFieldRelatedData:function(n,r,i,a,o){var l,u=n.id,c=E(u);if(void 0===o[c]){if(t.each(a.data,function(){if(this[u]&&this[u]===r&&a.getFieldValue(this,c))return l=a.getFieldValue(this,c,!0),!1}),!l){var d=a.dataSource&&a.dataSource.name,s=n.referenceTo,f=[],h=[];s&&s.length&&t.each(s,function(){f.push(this),h.push(this.objectName)}),t.each(e.model.getModelsByDataSource(d),function(){var e=this,n=[];if(e!==a&&-1!==h.indexOf(e.objectName))return t.each(this.fields,function(){var e=this;t.each(f,function(t,r){r.keyField===e.id&&n.push(e)})}),n.length&&t.each(e.getRows(),function(){var i=this;if(t.each(n,function(){if(e.getFieldValue(i,this.id,!0)===r)return l=i,!1}),l)return!1}),!l&&void 0})}return l}},buildEntityMetadataRequest:function(e){var t=e.targetEntity;return!t&&e.model&&e.model.attr&&(t=e.model.attr("sobject")),{objectName:t}},getEntityMetadataLoadingMessageFromBreadcrumb:function(e){return"Loading metadata for table "+e.endsobject+"..."},getEntityMetadataCacheKey:function(e){return e.objectName},getEntityMetadata:function(e){var n=e.entities,r=e.dataSource;return function(e){if(e){if(t.isArray(e)){var n=!0;return t.each(e,function(){if(!N(this))return n=!1,!1}),n}if(t.isPlainObject(e))return N(e);if(s.isString(e))return!0}return!1}(n)?r.authenticate().then(function(){var e=t.map(n,function(e){var n=f(e)?e:e.objectName,i={entity:n,loadChildRelationships:!0,loadPicklistValues:!1};return n?(e&&e.fields&&e.fields.length&&(i.fieldsToLoad=e.fields.join(",")),T(r).getModelMetadata(i).then(function(e){return t.isArray(e)&&(e=e[0]),e.fields&&e.fields.length&&t.each(e.fields,function(e,n){var i=t.map(n.referenceTo,function(e){return e.objectName}).filter(function(e){return!(e in r.getCachedEntityMetadata())}),a=t.map(n.childRelations,function(e){return e.childObject}).filter(function(e){return!(e in r.getCachedEntityMetadata())});i.concat(a).length>0&&r.getEntityMetadata({entities:i,dataSource:r,ignoreMetadataOverrides:!0}).then(function(e){r.cacheEntityMetadata(r.getEntityMetadataCacheKey(e),e)}),S(n)}),e})):h().reject("No Table Name provided")});return t.when.all(e).catch(function(e){return h().reject(e&&e.length?e.join(","):"")})}):h().reject("Invalid Model configuration. Metadata could not be retrieved.")},getModelProperties:function(t,n){var r=e.builder.core,i=t.state,a=r.getUnsavedChangesWarningProperty({component:t}),o=r.getCoreModelBasicProperties({component:t,propViewer:n}),l=[];return o.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,dataSourceName:i.attr("datasource"),label:"Entity Name",onChange:function(e){if(e&&(!i.attr("label")||!i.attr("labelplural"))){var n=s.capitalizeFirst(e.split(".").pop());i.attr("label")||i.attr("label",n),i.attr("labelplural")||i.attr("labelplural",n+(s.endsWith(n,"s")?"":"s")),t.save()}}}),o.push(r.getModelTypeProperty({component:t}),r.getModelQueryOnPageLoadProperty({component:t,propViewer:n}),r.getModelLimitProperty(),r.getModelOrderByProperty(),r.getCreateDefaultRowProperty(),r.getModelNameFieldProperty()),a&&l.push(a),Array.prototype.push.apply(l,r.getModelLabelProperties()),[{name:"Basic",props:o},{name:"Advanced",props:l}]},getAggregateFieldProperties:function(t,n){var r=t.state,i=e.builder.core;return[{id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:!0,picklistEntries:[{label:"COUNT",value:"COUNT"},{label:"COUNT DISTINCT",value:"COUNT_DISTINCT"},{label:"SUM",value:"SUM"},{label:"AVG",value:"AVG"},{label:"MAX",value:"MAX"},{label:"MIN",value:"MIN"}],onChange:function(e){e&&r.attr("name",i.getDefaultAliasName(r.attr("id"),e)),t.save().refresh().rebuildProps(n)}}]},getAggregateGroupingProperties:function(){return[]},getReferenceFieldNameFromRelationshipField:j,getReferenceFieldRelationshipName:E,joinFieldDisplayTypeFilter:function(e){if(e)return!0},properties:{composer:{supports:{childRelationships:!0},canFieldsBeSelected:function(e){return!!e.breadcrumb.endsobject||"Select an entity to use for this Model"}},batchableEntityRequests:!0,serverSideModelMerge:!0,canAutoGenerateConditionsFromFields:!0,canConditionsBeGrouped:!0,validConditionTypes:["blank","fieldvalue","join","modelmerge","multiple","param","userinfo"]},searchableDisplayTypes:{INTEGER:1,DOUBLE:1,CURRENCY:1,ID:1,STRING:1,TEXT:1,EMAIL:1,PICKLIST:1,MULTIPICKLIST:1,COMBOBOX:1,PHONE:1,URL:1,REFERENCE:1,TEXTAREA:1}}),r(d,{RelationalDataSourceTypeBase:O})}(skuid)},7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"refreshAPIToken",value:function(){var e=this;return skuid.platform.services.getToken().then(function(t){var n=t.token,r=e.extractJWTPayload(n).exp;return e.apiToken={expiration:r,jwt:n}})}},{key:"extractJWTPayload",value:function(e){var t=e.split(".");if(3!=t.length)throw new Error("JWT not formatted correctly");return JSON.parse(atob(t[1]))}},{key:"getAPIToken",value:function(){var e=this.apiToken;return e&&this.isValid(e)?skuid.utils.resolve(e):this.refreshAPIToken()}},{key:"isValid",value:function(e){var t=void 0;return(t=skuid.utils.isString(e)?this.extractJWTPayload(e).exp:e.expiration)&&t>Date.now()/1e3}}]),e}();t.default=new i}});