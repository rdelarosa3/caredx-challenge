!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=105)}({10:function(e,t,n){"use strict";!function(e){var t=e.themeBuilder={themeSettings:{}},n=e.$,r=t.utils={},i={render:function(e,t){less.render(e,{optimization:1},function(e,n){t(e,n)})},parseVars:function(e){var t,n,r,i,s=e.match(/@[\w\-_]+\s*:\s*[^;]*;/g),a={};for(t=0;t<s.length;t++)if((r=(n=s[t].split(":"))[0].match(/[^@].+/))&&(r=r[0],null!==(i=n[1].match(/[^ ].+[^;]/)))){var o=(i=i[0]).match(/@[\w\-_]+/g);if(o&&o.length>0)for(var u=0;u<o.length;u++)i=i.replace(o[u],a[o[u].replace("@","")]);a[r]=i}return a}};function s(e){return"static"===e.type?["static",e.name||"",e.namespace||"",e.path||""].join("--"):"external"===e.type?["external",e.url||e.path||""]:""}n.extend(r,{clone:function(e){return void 0===e?e:JSON.parse(JSON.stringify(e))},getCSSResourceIdentifier:s,isBaseThemeCSSResource:function(e){var r=t.themeConfigurations.base,i=r?r.cssResources:null,a=s(e),o=!1;return a&&i&&i.length&&n.each(i,function(e,t){if(s(t)===a)return o=!0,!1}),o},isBaseThemeFontDefinition:function(e,r){var i=t.themeConfigurations.base,s=i?i.webFonts:null,a=r.name,o=!1;return a&&s&&s[e]&&s[e].length&&n.each(s[e],function(e,t){if(t.name===a)return o=!0,!1}),o},lessRenderer:i,parallel:function(e,t){if(0!==e.length){var n=[],r=0,i=0,s=!1;for(var a in e)"remove"!=a&&i++;for(var o in e)"remove"!=o&&e[o](u(o))}else t.apply(this,{});function u(e){return function(){var a=e;r++;for(var o=0;o<arguments.length;o++)void 0===n[o]&&(n[o]=[]),n[o][a]=arguments[o];if(r==i&&!s)return s=!0,void t.apply(this,n)}}},parseCssSize:function(t,n){var r,i,s=void 0!==(n=n||{}).defaultUnit?n.defaultUnit:"px";return e.utils.isString(t)&&(i=(i=t.match(/px|rem|em|pt/))?i[0]:s,r=parseFloat(t),"pt"===i&&(i="px",r*=4/3)),{size:r,unit:i}},parseSkuidBorderLess:function(e){var t,n=e.split(/[, ]\s*/),i={};if(n.length<=3)t=r.parseCssSize(n[0]),i.all={},i.all.width=t.size,i.all.widthUnit=t.unit,i.all.style=n[1],i.all.color=n[2],i.top=r.clone(i.all),i.right=r.clone(i.all),i.bottom=r.clone(i.all),i.left=r.clone(i.all);else{for(var s=["top","right","bottom","left"],a=0,o=0;a<n.length&&o<s.length;)i[s[o]]={},"null"==n[a]||"none"==n[a]?(i[s[o]].width="1",i[s[o]].style="none",i[s[o]].color="black",a++):(t=r.parseCssSize(n[a]),i[s[o]].width=t.size,i[s[o]].widthUnit=t.unit,i[s[o]].style=n[a+1],i[s[o]].color=n[a+2],a+=3),o++;i.individuallySet=!0}return i},randomSeed:function(e){this.seed=e,this.random=function(){var e=1e4*Math.sin(this.seed++);return e-Math.floor(e)}},rgbToHex:function(e){return(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},subscribeMultipleEventsOnce:function(t,r){var i={};t.forEach(function(t){i[t]=!1;var s=e.events.subscribe(t,function(){var a=!0;e.events.unsubscribe(s),i[t]=!0,n.each(i,function(e){a=a&&i[e]}),a&&r()})})},toLessString:function(e){var t="";for(var n in e)t+="@"+n+":"+e[n]+";";return t},baseThemes:["SkuidThemeClassic","SkuidThemeBuilderDark","SkuidThemeBuilderLight","SkuidThemeBuilderLightInk","SkuidThemeInk","SkuidThemeModern","SkuidThemePaper","SkuidThemeMobileClassic","SkuidThemeCleanGreen","SkuidThemeCoolGrey","SkuidThemeDynamics","SkuidThemeGlacial","SkuidThemeIceAge","SkuidThemeInvestor","SkuidThemeLightningDesign","SkuidThemeMaterialBlue","SkuidThemeSlated","SkuidThemeMobileCoolGrey","SkuidThemeMobileIceAge","SkuidThemeMobileMaterialBlue","SkuidThemeMobileNorthernLights"]})}(skuid)},104:function(e,t,n){"use strict";!function(e){var t=e.$,n=e.snippet.registerSnippet,r=e.utils,i=r.resolve,s=r.inPlatform(e.constants.NATIVE);function a(e){return"Ink"===e.skuid__Type__c||"Ink"===e.type}n("skuid.loadJSZip",function(){return"undefined"!=typeof JSZip?i():s?r.loadJS(e.platform.getResourceUrl({name:"lib/jSZip.js",namespace:"skuid"})):r.loadJS(r.getStaticResourceUrl("JSZip","skuid"))}),n("skuid.settings.copyPrefsFromOrgDefault",function(n){var i=n.initiatorId,s=n.model,a=n.row,o=e.$M("stng__OrgPreferences"),u=o.getFirstRow(),l={};t.each(o.fields,function(){r.startsWith(this.id,"skuid__")&&"skuid__Use_Component_Packs__c"!==this.id&&(l[this.id]=o.getFieldValue(u,this.id,!0))}),s.updateRow(a,l,{initiatorId:i})}),n("skuid.theme.createThemeResource",function(){var t=arguments[0],n=e.$,i=t.row,o=t.model,u=a(i);s&&(i.skuid__Skuid_Version_Date__c=e.version.date);var l,c,h,f=i.BaseTheme;s?(l=i.name,c="Mobile"===i.type,h=i.resource_name):(l=i.Name,c="Mobile"==i.skuid__Type__c,h=i.skuid__Resource_Name__c);var d=!1;if(n.each(o.registeredLists,function(e,t){if(t.validateRequiredFields().length)return d=!0,!1}),d)return r.reject();var m=["skuid_theme.json","resources.json"];u||m.push("skuidtheme.css");var g="SkuidTheme"+i.BaseTheme,p=e.$.map(m,function(t){var n=e.platform.themeBuilder.getThemeResourceUrl({apiVersion:u?"v2":"v1",name:g,nestedPath:t,namespace:"skuid"});return e.$.ajax({url:n})});return e.$.when.all(p).then(function(t){var a=t[0][0],d=t[1][0],m=t[2]&&t[2][0],g={id:l,lessVars:{},tempVars:{},webFonts:a.webFonts,baseTheme:f,isMobile:c,themeSettings:{}},p=new JSZip;p.file("skuid_theme.json",JSON.stringify(g,void 0,"\t")),p.file("resources.json",JSON.stringify(d)),u||(p.file("skuidbuilderstheme.css",m),p.file("skuidtheme.css",m),p.file("skuidicons.css",m));var b={ContentType:"application/zip",Body:p.generate({type:"base64",compression:"DEFLATE"}),CacheControl:"Public"};return s?b.FileName=h:(b.Name=h,b.skuid__Resource_Namespace__c=i.skuid__Resource_Namespace__c),n.ajax({type:"POST",url:s?"/api/v1/uploadTheme":"/services/data/v32.0/sobjects/StaticResource",headers:{"Content-Type":"application/json",Authorization:"Bearer "+r.userInfo.sessionId},data:JSON.stringify(b),dataType:"json"}).then(function(t){if(!s)return e.sfdc.api.query("SELECT NamespacePrefix FROM StaticResource WHERE Id='"+t.id+"'").then(function(t){o.updateRow(i,{skuid__Skuid_Version_Date__c:e.version.date,skuid__Resource_Namespace__c:t.records[0].NamespacePrefix})});o.updateRow(i,{version_date:e.version.date,file_id:t.id})})})}),n("skuid.theme.exportTheme",function(){var t=arguments[0],n=e.$.Deferred(),i=t.row,o=t.model.getRecordForRow(i).get(),u=a(i);(s?["id","file_id","updated_at"]:["Id","LastModifiedById","LastModifiedBy","attributes"]).forEach(function(e){delete o[e]});var l,c,h,f=JSON.stringify(o);return s?(l=i.resource_name,h=e.platform.themeBuilder.getThemeResourceUrl({apiVersion:u?"v2":"v1",name:i.resource_name})):(l=i.skuid__Resource_Name__c,c=i.skuid__Resource_Namespace__c,h=r.getStaticResourceUrl(l,c,void 0,(new Date).getTime())),JSZipUtils.getBinaryContent(h,function(e,t){if(e)return n.reject();var i=new JSZip;i.load(t),i.file("objdef.json",f);var s=i.generate({type:"blob",compression:"DEFLATE"});r.saveAs(s,l.replace(/SKTHEME/g,"")+".sktheme"),n.resolve()}),n.promise()});var o=function(){var t=e.$,n=arguments[0].record,r=n.id||n.Id,i=e.$M("stng__Themes_Import"),s=JSZip(n.Body,{base64:!0});if(i.cancel(),s.files["objdef.json"]){var a,o,u,l,c=JSON.parse(s.files["objdef.json"].asText()),h=e.$M("stng__Themes_"+c.skuid__Type__c),f="SELECT Id FROM skuid__Theme__c WHERE Name='"+(c.Name||c.name)+"'";r?(u="SELECT Id,NamespacePrefix,Name FROM StaticResource WHERE Id='"+r+"'",l=e.sfdc.api.query(u).then(function(e){e&&e.records&&e.records[0]&&(o=e.records[0],l.resolve&&l.resolve())})):l=t.Deferred().resolve();var d=e.sfdc.api.query(f).then(function(e){return e.records&&e.records[0]?(a=e.records[0],e):t.Deferred().reject()});t.when(d,l).then(function(){i.conditions[0].value=a.Id,o?(c.skuid__Resource_Name__c=o.Name,c.skuid__Resource_Namespace__c=o.NamespacePrefix):(delete c.skuid__Resource_Name__c,delete c.skuid__Resource_Namespace__c),i.updateData(function(){var e=i.updateRow({Id:a.Id},c);i.save(),h.adoptRow(e)})}).catch(function(){var e=i.createRow({additionalConditions:[{field:"Name",value:c.Name||c.name},{field:"skuid__Resource_Name__c",value:o.Name},{field:"skuid__Type__c",value:c.skuid__Type__c},{field:"skuid__Active__c",value:c.skuid__Active__c},{field:"skuid__Skuid_Version_Date__c",value:c.skuid__Skuid_Version_Date__c},{field:"skuid__Resource_Namespace__c",value:o.NamespacePrefix}]});i.save({callback:function(n){if(n.messages&&n.messages.length){var r=t("#themeImportErrors").length?t("#themeImportErrors"):t('<div id="themeImportErrors" class="nx-error">');r.prependTo(t("#importUploadTitle")),r.empty(),t.each(n.messages,function(e,t){r.append("<div>"+t+"</div>")})}else h.adoptRow(e)}})})}else alert("The uploaded file is not a valid skuid theme")};s?(n("skuid.theme.importThemeDeprecated",o),n("skuid.theme.importTheme",function(t){var n=e.$,r=n.Deferred(),i=e.$M("stng__Themes_Import"),s=e.$M("stng__Themes_Import_File"),a=t.apiExtensions.$Result.body;i.cancel(),s.cancel();var o=!1;return e.$.ajax({url:"/themes/"+a.name+"/objdef.json",type:"GET",contentType:"application/json"}).fail(function(){return r.reject("The uploaded file is not a valid Skuid Theme. objdef.json not found.")}).then(function(t){if(!1===(o=function(t){var n=e.constants.NATIVE,r={};switch(t.skuid__Type__c?"SKUID":n){case"SKUID":r.name=t.Name,r.type=t.skuid__Type__c,r.active=t.skuid__Active__c;break;case n:r=t;break;default:r=!1}return r}(t)))return r.reject("The uploaded file is not a valid Skuid Theme.");var n=e.$M("stng__Themes_Existing");return n.setCondition(n.getConditionByName("ThemeName"),o.name),n.updateData()}).then(function(){var t=e.$M("stng__Themes_Existing"),n=e.$M("stng__Themes_"+o.type),r=t.getFirstRow(),i=n;return r?(i=t).updateRow(r,{file_id:a.id,resource_name:a.name}):i.updateRow(n.createRow(),{name:o.name,resource_name:a.name,version_date:e.version.date,file_id:a.id,type:o.type}),i.save()}).then(function(t){if(t.messages&&t.messages.length){var i=n("#themeImportErrors").length?n("#themeImportErrors"):n('&lt;div id="themeImportErrors" class="nx-error"&gt;');return i.prependTo(n("#importUploadTitle")),i.empty(),n.each(t.messages,function(e,t){i.append("&lt;div&gt;"+t+"&lt;/div&gt;;")}),e.$M("stng__Themes_Desktop").cancel(),r.reject()}r.resolve()}),r})):n("skuid.theme.importTheme",o),n("resourceNamer",function(){var e=!1,n=t(".popup-resource-name input");t(".popup-theme-name input").on("input",function(t){var r;e||(r=s?t.target.value?t.target.value.match(/^[\w _-]+$/).join(""):"":t.target.value.match(/[a-z]|[A-Z]|[0-9]/g).join("").replace(/SKTHEME/g,"")+"SKTHEME",n.val(r),n.trigger("input"))}),n.on("keypress",function(){e=!0})})}(skuid)},105:function(e,t,n){"use strict";n.r(t);n(10),n(9),n(104)},2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUrlParameter=t.buildResourcesJson=t.makeTones=t.buildResourcesObjectFromThemeData=t.getResourcesCommentString=void 0;var r,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n(5),a=(r=s)&&r.__esModule?r:{default:r};var o=["DO NOT EDIT, this is a generated file and all changes","will be overwritten. If you wish to change the resources","loaded, please do so in the skuid_theme.json"].join(" ");t.getResourcesCommentString=function(){return o};var u=t.buildResourcesObjectFromThemeData=function(e){var t,n,r,s,a,u,h,f={},d=[],m={},g=e.cssResources||[],p=e.themeSettings?JSON.parse(JSON.stringify(e.themeSettings.getAll?e.themeSettings.getAll():e.themeSettings)):void 0,b=e.webFonts||{};if(b.google&&b.google.length)for(m.google={families:[]},s=0;s<b.google.length;s++)(r=b.google[s]).url&&(n=c(r.url,"family")),m.google.families.push(n);if(p&&p.tokens&&p.tokens.fontFamily){var _=p.tokens.fontWeight||{},v=":"+Object.keys(_).map(function(e){return _[e].value}).join(","),S=p.tokens.fontFamily,k=[];Object.keys(S).forEach(function(e){"google"===S[e].value.type&&k.push(S[e].value);var t=S[e].value.primaryFamily;S[e].value.secondaryFamily&&(t+=", "+S[e].value.secondaryFamily),S[e].value=t}),m=i(m,{google:{families:k.map(function(e){return e.primaryFamily+=v}).filter(function(e){return e})}})}if(b.custom)for(m.custom={families:[],urls:[]},s=0;s<b.custom.length;s++)t=b.custom[s],m.custom.families.push(t.name),t.url&&m.custom.urls.push(t.url);if(b.typekit&&(m.typekit={id:b.typekit}),p&&p.webFonts&&p.webFonts.typekit&&(m.typekit={id:p.webFonts.typekit}),m.typekit||m.google||m.custom?f.fontConfig=m:f.fontConfig={},g&&g.length){for(s=0;s<g.length;s++){switch(u=null,(a=g[s]).type){case"external":u={type:"external",url:a.url||a.path};break;default:u={type:"static",name:a.name},["namespace","path"].forEach(function(e){a.hasOwnProperty(e)&&(u[e]=a[e])})}u&&d.push(u)}d.length&&(f.cssResources=d)}if(p){if(f.themeSettings=(h=p,JSON.parse(JSON.stringify(h))),p.palette){var y={};Object.keys(p.palette).forEach(function(e){var t=p.palette[e].value;y[e]={value:{color:t.color}},t.shades&&(y[e].value._shades=l(t.color,t.shades.map(function(e){return-e}).reverse())),t.tints&&(y[e].value._tints=l(t.color,t.tints))}),f.themeSettings.palette=y}p.tokens&&Object.keys(p.tokens).forEach(function(e){var t=p.tokens[e],n={};Object.keys(t).forEach(function(e){n[e]={value:t[e].value}}),f.themeSettings.tokens[e]=n})}return function(e){if(e&&e.hasOwnProperty){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}return 0}(f)&&(f.__comment=o),f},l=t.makeTones=function(e,t){var n=(0,a.default)(e),r=[],i=(0,a.default)("#000"),s=(0,a.default)("#fff");return t.forEach(function(e){e<0?r.push(a.default.mix(n,i,-e).toHexString()):r.push(a.default.mix(n,s,e).toHexString())}),r.map(function(e){return e.toUpperCase()})},c=(t.buildResourcesJson=function(e){return JSON.stringify(u(e),null,"\t")},t.getUrlParameter=function(e,t){var n,r=e.split("?");r.length>1&&(r=r[1]),n=r.split("&");for(var i=0;i<n.length;i++){var s=n[i].split("=");if(s[0]==t)return s[1]}})},5:function(e,t,n){var r;!function(i){var s=/^\s+/,a=/\s+$/,o=0,u=i.round,l=i.min,c=i.max,h=i.random;function f(e,t){if(e=e||"",t=t||{},e instanceof f)return e;if(!(this instanceof f))return new f(e,t);var n=function(e){var t={r:0,g:0,b:0},n=1,r=null,o=null,u=null,h=!1,f=!1;"string"==typeof e&&(e=function(e){e=e.replace(s,"").replace(a,"").toLowerCase();var t,n=!1;if(I[e])e=I[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=$.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=$.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=$.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=$.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=$.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=$.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=$.hex8.exec(e))return{r:D(t[1]),g:D(t[2]),b:D(t[3]),a:U(t[4]),format:n?"name":"hex8"};if(t=$.hex6.exec(e))return{r:D(t[1]),g:D(t[2]),b:D(t[3]),format:n?"name":"hex"};if(t=$.hex4.exec(e))return{r:D(t[1]+""+t[1]),g:D(t[2]+""+t[2]),b:D(t[3]+""+t[3]),a:U(t[4]+""+t[4]),format:n?"name":"hex8"};if(t=$.hex3.exec(e))return{r:D(t[1]+""+t[1]),g:D(t[2]+""+t[2]),b:D(t[3]+""+t[3]),format:n?"name":"hex"};return!1}(e));"object"==typeof e&&(V(e.r)&&V(e.g)&&V(e.b)?(d=e.r,m=e.g,g=e.b,t={r:255*E(d,255),g:255*E(m,255),b:255*E(g,255)},h=!0,f="%"===String(e.r).substr(-1)?"prgb":"rgb"):V(e.h)&&V(e.s)&&V(e.v)?(r=B(e.s),o=B(e.v),t=function(e,t,n){e=6*E(e,360),t=E(t,100),n=E(n,100);var r=i.floor(e),s=e-r,a=n*(1-t),o=n*(1-s*t),u=n*(1-(1-s)*t),l=r%6;return{r:255*[n,o,a,a,u,n][l],g:255*[u,n,n,o,a,a][l],b:255*[a,a,u,n,n,o][l]}}(e.h,r,o),h=!0,f="hsv"):V(e.h)&&V(e.s)&&V(e.l)&&(r=B(e.s),u=B(e.l),t=function(e,t,n){var r,i,s;function a(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(e=E(e,360),t=E(t,100),n=E(n,100),0===t)r=i=s=n;else{var o=n<.5?n*(1+t):n+t-n*t,u=2*n-o;r=a(u,o,e+1/3),i=a(u,o,e),s=a(u,o,e-1/3)}return{r:255*r,g:255*i,b:255*s}}(e.h,r,u),h=!0,f="hsl"),e.hasOwnProperty("a")&&(n=e.a));var d,m,g;return n=F(n),{ok:h,format:e.format||f,r:l(255,c(t.r,0)),g:l(255,c(t.g,0)),b:l(255,c(t.b,0)),a:n}}(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=u(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=u(this._r)),this._g<1&&(this._g=u(this._g)),this._b<1&&(this._b=u(this._b)),this._ok=n.ok,this._tc_id=o++}function d(e,t,n){e=E(e,255),t=E(t,255),n=E(n,255);var r,i,s=c(e,t,n),a=l(e,t,n),o=(s+a)/2;if(s==a)r=i=0;else{var u=s-a;switch(i=o>.5?u/(2-s-a):u/(s+a),s){case e:r=(t-n)/u+(t<n?6:0);break;case t:r=(n-e)/u+2;break;case n:r=(e-t)/u+4}r/=6}return{h:r,s:i,l:o}}function m(e,t,n){e=E(e,255),t=E(t,255),n=E(n,255);var r,i,s=c(e,t,n),a=l(e,t,n),o=s,u=s-a;if(i=0===s?0:u/s,s==a)r=0;else{switch(s){case e:r=(t-n)/u+(t<n?6:0);break;case t:r=(n-e)/u+2;break;case n:r=(e-t)/u+4}r/=6}return{h:r,s:i,v:o}}function g(e,t,n,r){var i=[O(u(e).toString(16)),O(u(t).toString(16)),O(u(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function p(e,t,n,r){return[O(L(r)),O(u(e).toString(16)),O(u(t).toString(16)),O(u(n).toString(16))].join("")}function b(e,t){t=0===t?0:t||10;var n=f(e).toHsl();return n.s-=t/100,n.s=M(n.s),f(n)}function _(e,t){t=0===t?0:t||10;var n=f(e).toHsl();return n.s+=t/100,n.s=M(n.s),f(n)}function v(e){return f(e).desaturate(100)}function S(e,t){t=0===t?0:t||10;var n=f(e).toHsl();return n.l+=t/100,n.l=M(n.l),f(n)}function k(e,t){t=0===t?0:t||10;var n=f(e).toRgb();return n.r=c(0,l(255,n.r-u(-t/100*255))),n.g=c(0,l(255,n.g-u(-t/100*255))),n.b=c(0,l(255,n.b-u(-t/100*255))),f(n)}function y(e,t){t=0===t?0:t||10;var n=f(e).toHsl();return n.l-=t/100,n.l=M(n.l),f(n)}function T(e,t){var n=f(e).toHsl(),r=(n.h+t)%360;return n.h=r<0?360+r:r,f(n)}function w(e){var t=f(e).toHsl();return t.h=(t.h+180)%360,f(t)}function R(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+120)%360,s:t.s,l:t.l}),f({h:(n+240)%360,s:t.s,l:t.l})]}function x(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+90)%360,s:t.s,l:t.l}),f({h:(n+180)%360,s:t.s,l:t.l}),f({h:(n+270)%360,s:t.s,l:t.l})]}function A(e){var t=f(e).toHsl(),n=t.h;return[f(e),f({h:(n+72)%360,s:t.s,l:t.l}),f({h:(n+216)%360,s:t.s,l:t.l})]}function C(e,t,n){t=t||6,n=n||30;var r=f(e).toHsl(),i=360/n,s=[f(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,s.push(f(r));return s}function N(e,t){t=t||6;for(var n=f(e).toHsv(),r=n.h,i=n.s,s=n.v,a=[],o=1/t;t--;)a.push(f({h:r,s:i,v:s})),s=(s+o)%1;return a}f.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,n,r=this.toRgb();return e=r.r/255,t=r.g/255,n=r.b/255,.2126*(e<=.03928?e/12.92:i.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:i.pow((t+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:i.pow((n+.055)/1.055,2.4))},setAlpha:function(e){return this._a=F(e),this._roundA=u(100*this._a)/100,this},toHsv:function(){var e=m(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=m(this._r,this._g,this._b),t=u(360*e.h),n=u(100*e.s),r=u(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=d(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=d(this._r,this._g,this._b),t=u(360*e.h),n=u(100*e.s),r=u(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return g(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,n,r,i){var s=[O(u(e).toString(16)),O(u(t).toString(16)),O(u(n).toString(16)),O(L(r))];if(i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1))return s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0);return s.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:u(this._r),g:u(this._g),b:u(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+u(this._r)+", "+u(this._g)+", "+u(this._b)+")":"rgba("+u(this._r)+", "+u(this._g)+", "+u(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:u(100*E(this._r,255))+"%",g:u(100*E(this._g,255))+"%",b:u(100*E(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+u(100*E(this._r,255))+"%, "+u(100*E(this._g,255))+"%, "+u(100*E(this._b,255))+"%)":"rgba("+u(100*E(this._r,255))+"%, "+u(100*E(this._g,255))+"%, "+u(100*E(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(j[g(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+p(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var i=f(e);n="#"+p(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0;return t||!r||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return f(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(S,arguments)},brighten:function(){return this._applyModification(k,arguments)},darken:function(){return this._applyModification(y,arguments)},desaturate:function(){return this._applyModification(b,arguments)},saturate:function(){return this._applyModification(_,arguments)},greyscale:function(){return this._applyModification(v,arguments)},spin:function(){return this._applyModification(T,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(C,arguments)},complement:function(){return this._applyCombination(w,arguments)},monochromatic:function(){return this._applyCombination(N,arguments)},splitcomplement:function(){return this._applyCombination(A,arguments)},triad:function(){return this._applyCombination(R,arguments)},tetrad:function(){return this._applyCombination(x,arguments)}},f.fromRatio=function(e,t){if("object"==typeof e){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]="a"===r?e[r]:B(e[r]));e=n}return f(e,t)},f.equals=function(e,t){return!(!e||!t)&&f(e).toRgbString()==f(t).toRgbString()},f.random=function(){return f.fromRatio({r:h(),g:h(),b:h()})},f.mix=function(e,t,n){n=0===n?0:n||50;var r=f(e).toRgb(),i=f(t).toRgb(),s=n/100;return f({r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a})},f.readability=function(e,t){var n=f(e),r=f(t);return(i.max(n.getLuminance(),r.getLuminance())+.05)/(i.min(n.getLuminance(),r.getLuminance())+.05)},f.isReadable=function(e,t,n){var r,i,s=f.readability(e,t);switch(i=!1,(r=function(e){var t,n;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==n&&"large"!==n&&(n="small");return{level:t,size:n}}(n)).level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7}return i},f.mostReadable=function(e,t,n){var r,i,s,a,o=null,u=0;i=(n=n||{}).includeFallbackColors,s=n.level,a=n.size;for(var l=0;l<t.length;l++)(r=f.readability(e,t[l]))>u&&(u=r,o=f(t[l]));return f.isReadable(e,o,{level:s,size:a})||!i?o:(n.includeFallbackColors=!1,f.mostReadable(e,["#fff","#000"],n))};var I=f.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},j=f.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(I);function F(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function E(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!=e.indexOf("%")}(e);return e=l(t,c(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),i.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function M(e){return l(1,c(0,e))}function D(e){return parseInt(e,16)}function O(e){return 1==e.length?"0"+e:""+e}function B(e){return e<=1&&(e=100*e+"%"),e}function L(e){return i.round(255*parseFloat(e)).toString(16)}function U(e){return D(e)/255}var P,H,J,$=(H="[\\s|\\(]+("+(P="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?",J="[\\s|\\(]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?",{CSS_UNIT:new RegExp(P),rgb:new RegExp("rgb"+H),rgba:new RegExp("rgba"+J),hsl:new RegExp("hsl"+H),hsla:new RegExp("hsla"+J),hsv:new RegExp("hsv"+H),hsva:new RegExp("hsva"+J),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function V(e){return!!$.CSS_UNIT.exec(e)}void 0!==e&&e.exports?e.exports=f:void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}(Math)},9:function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2);!function(e){e.themeBuilder||(e.themeBuilder={});var t=e.$,n=e.utils,s=e.events.publish,a=e.themeBuilder,o=n.resolve,u=e.themeSettings.ThemeSettings;function l(e){return void 0===e?e:JSON.parse(JSON.stringify(e))}function c(e){if(n.startsWith(e,"/resource/")){var t,r,i,s,a=e.substring(10).split("/");if(a.length>=1&&(isNaN(a[0])||a.shift(),a.length>=1))return 2===(s=a.shift().split("__")).length?(r=s[0],t=s[1]):t=s[0],a.length&&(i=a.join("/")),{type:"static",name:t,namespace:r,path:i}}return!1}function h(n,r,i){var s={},o=[[]],u=0,l=0;return(i=i||{}).whiteList&&n.filter(function(e){return-1===i.whiteList.indexOf(e.skuid__Resource_Name__c)}),n.forEach(function(e){u<10?o[o.length-1].push(e):(u=0,o.push([e])),u++}),function i(u){var c=[];return o[u=u||0].forEach(function(i){var o=r.filter(function(e){return e.Name===i.skuid__Resource_Name__c})[0];o&&c.push(e.platform.themeBuilder.getResource(o,"skuid_theme.json").then(function(t){return t=JSON.parse(t),s[t.baseTheme]?{themeData:t,baseThemeData:s[t.baseTheme].data,baseThemeLess:s[t.baseTheme].less}:e.platform.themeBuilder.getThemeData(o).then(function(e){return s[t.baseTheme]={data:e.baseThemeData,less:e.baseThemeLess},e})}).then(function(n){if(!n.themeData.baseTheme)return t.Deferred().reject("No theme configuration");var r=new a.ThemeConfiguration(t.extend(n.themeData,{resource:o,baseThemeData:n.baseThemeData,lessStr:n.baseThemeLess,model:e.model.Model.prototype.getRecordForRow(i).model(),row:i}));return(r=e.themeBuilder.migrateTheme(r)).loadAndProcessLess().then(function(){return r})}).then(function(e){return e.save({skipScreenshot:!0})}).then(function(){e.events.publish("skuid.themeBuilder.themeUpdated"),t.blockUI({fadeIn:0,message:l+" of "+n.length+' Themes updated <br/> Updated "'+i.Name+'"'})}).catch(function(n){e.events.publish("skuid.themeBuilder.themeUpdateFailed"),t.blockUI({fadeIn:0,message:'Error updating "'+i.Name+'"'+(n&&n.message?": "+n.message:"")})}).always(function(){l++}))}),t.when.all(c).then(function(){if(u<o.length-1)return i(u+1)}).promise()}().then(function(){t.blockUI({fadeIn:0,message:"Updated all themes",timeout:2e3})})}function f(n,r){r=r||{};var s,o,u={},l=n.cssResources,c=a.utils.clone;return(s=n.baseThemeUrl,o=t.Deferred(),JSZipUtils.getBinaryContent(s,function(e,t){e?o.reject(e):o.resolve(t)}),o.promise()).then(function(r){var i=new JSZip(r),s="",a=t.Deferred();return u.lessVars=c(n.lessVars),u.webFonts=c(n.webFonts),u.cssResources=c(l),u.typekitId=c(n.typekitId),u.iconsets=c(n.iconsets),u.baseTheme=c(n.baseTheme),u.isMobile=c(n.isMobile),u.themeSettings=c(n.themeSettings.getAll()),u.themeSettingsLocal=c(n.themeSettingsLocal.getAll()),u.timeStamp=(new Date).getTime(),n.migrations&&(u.migrations=c(n.migrations)),u.id=n.id||n.getThemeUrl().split("/").splice(-2)[0].split("skuid__SkuidTheme").join("").toLowerCase(),u.initialized=!0,n.inlineCss&&(u.hasInlineCss=!0,s+=n.inlineCss,i.file("inline.css",s)),n.baseThemeData.hasInlineCss?e.platform.themeBuilder.getResource({Name:"SkuidTheme"+n.baseTheme,NamespacePrefix:"skuid"},"inline.css").then(function(e){s+=" "+e,a.resolve(i,s)}).fail(a.reject):a.resolve(i,""),a.promise()}).then(function(e,t){var s;return e.file("skuid_theme.json",(s=u,JSON.stringify(s,void 0,"\t"))),e.file("skuidtheme.css",n.outputCSS+(t?" "+t:"")),e.file("resources.json",(0,i.buildResourcesJson)(n)),r.screenshotFunction&&!r.skipScreenshot?r.screenshotFunction(n).then(function(t){return t&&e.file("screenshot.png",t,{base64:!0}),e}):(n.screenshot&&e.file("screenshot.png",n.screenshot,{base64:!0}),e)}).then(function(e){return e.generate({type:"base64",compression:"DEFLATE"})}).catch(function(e){throw'Error generating zip: "'+e+'"'})}e.snippet.register("skuid.themebuilder.updateThemes",function(){t.blockUI({fadeIn:0,message:"Updating themes, please wait..."});var n=e.$M("stng__Themes_Mobile")?e.$M("stng__Themes_Mobile").getRows():[];return h(e.$M("stng__Themes_Desktop").getRows().concat(n),e.$M("stng__DesktopThemeResources").getRows().concat(e.$M("stng__MobileThemeResources").getRows()),{whiteList:a.utils.baseThemes}).then(function(){t("#updateAllThemesButton").hide(),t.blockUI({fadeIn:0,message:"Done updating themes!",timeout:2500})})});var d=function(){function n(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var i,o,c=this,h=r.baseThemeData&&new n(r.baseThemeData),f=r.baseTheme||"Modern";if(f=f.charAt(0).toUpperCase()+f.slice(1),h&&(i=h.cssResources,o=h.webFonts),c.baseTheme=l(r.baseTheme),c.baseThemeData=h,c.baseThemeUrl=l(r.baseThemeUrl),c.cssResources=l(r.cssResources)||[],c.iconsets=l(r.iconsets),c.id=l(r.id),c.initialized=l(r.initialized),c.isMobile=l(r.isMobile),c.lessVars=l(r.lessVars),c.migrations=l(r.migrations),c.outputCSS=l(r.outputCSS),c.resource=r.resource,c.themeResourceName=l(r.themeResourceName),c.themeResourceName=this.resource&&l(this.resource.resourceName||this.resource.resource_name),c.timeStamp=(new Date).getTime(),c.webFonts=l(r.webFonts)||{},c.lessStr=l(r.lessStr),c.model=r.model,c.row=r.row,c.subscriptions={},c.hasInlineCss=r.hasInlineCss,r.themeSettings instanceof u?c.themeSettings=new u(l(r.themeSettings.getAll())||{}):c.themeSettings=new u(l(r.themeSettings)||{}),r.themeSettingsLocal instanceof u?c.themeSettingsLocal=new u(l(r.themeSettingsLocal.getAll())||{}):c.themeSettingsLocal=new u(l(r.themeSettingsLocal)||{}),h&&h.lessVars&&(c.lessVars=t.extend(h.lessVars,c.lessVars||{})),c.lessVars&&(c.baseThemeUrl=e.platform.themeBuilder.getThemeResourceUrl({name:"SkuidTheme"+f,namespace:"skuid",modstamp:(new Date).getTime()})),!c.initialized&&h&&(o&&(c.webFonts=o),i)){var d={};c.cssResources.forEach(function(e){var t=a.utils.getCSSResourceIdentifier(e);d[t]=e}),i.forEach(function(e){var t=a.utils.getCSSResourceIdentifier(e);d[t]||c.cssResources.push(e)})}h&&h.themeSettings&&(c.themeSettings=m(h.themeSettings,c.themeSettingsLocal)),h&&h.hasInlineCss&&e.platform.themeBuilder.getResource({Name:c.baseTheme,NamespacePrefix:"skuid"},"inline.css").done(function(e){s("skuid.themeBuilder.baseInlineCssLoaded",[e])}),c.hasInlineCss&&c.resource&&e.platform.themeBuilder.getResource(c.resource,"inline.css").done(function(e){c.inlineCss=e,s("skuid.themeBuilder.inlineCssLoaded",[c])})}return r(n,[{key:"getThemeUrl",value:function(){return e.platform.getResourceUrl({name:this.resourceName,namespace:this.resource.resourceNamespace,modstamp:(new Date).getTime()})+"/"}},{key:"save",value:function(n){n=n||{};var r=this,i=r.model||a.model,u=a.utils.clone;if(!r.resource)throw"Cannot save, Theme Config has no resource";return s("skuid.themeBuilder.saveStatus",["Saving Theme..."]),r.themeSettingsLocal&&r.themeSettings.setAll(m(r.baseThemeData.themeSettings,r.themeSettingsLocal).getAll()),e.utils.delay(10).then(function(){return s("skuid.themeBuilder.saveStatus",["Compiling Theme to CSS..."]),n.noLess?o():t.when((c=r.lessStr,h=u(r.lessVars),f=t.Deferred(),a.utils.lessRenderer.render(c+a.utils.toLessString(h),function(e,t){e?f.reject(e):f.resolve(t.css)}),f.promise()).then(function(n){return s("skuid.themeBuilder.saveStatus",["Compressing Theme CSS file..."]),t.when(n,e.utils.delay(1))}).then(function(e){return new CleanCSS({compatibility:"ie8"}).minify(e).styles}),(l=r,l.hasInlineCss&&void 0===l.inlineCss?e.platform.themeBuilder.getResource({Name:"SkuidTheme"+l.baseTheme,NamespacePrefix:"skuid"},"inline.css").catch(o):o())).then(function(t,n){if(r.outputCSS=[t,n,r.inlineCss].filter(function(e){return!!e}).join(" "),i){var s=r.row||i.getFirstRow(),a=e.platform.getEntityFieldName("theme","version_date");i.updateRow(s,a,e.version.date)}});var l,c,h,f}).then(function(){return s("skuid.themeBuilder.saveStatus",["Generating Theme bundle..."]),f(r,n)}).then(function(t){return s("skuid.themeBuilder.saveStatus",["Saving Theme bundle to server..."]),e.platform.themeBuilder.saveTheme(r,t,r.resource)}).then(function(){if(i)return i.save()}).then(function(){return s("skuid.themeBuilder.saveStatus",["Saved",1500]),s("skuid.themeBuilder.saveSuccess",[]),r}).fail(function(e){s("skuid.themeBuilder.saveStatus",["Save failed",1500]),s("skuid.themeBuilder.saveFailure",[e]),console.error("There was a problem saving this Theme: "+r.id,e);var n="There was a problem saving this Theme: "+r.id;e&&("string"==typeof e?e+=": "+e:e.message&&(e+=": "+e.message)),t.blockUI({fadeIn:0,message:n,timeout:3e3})})}},{key:"loadAndProcessLess",value:function(){var n=this;function r(e){return'"'===(e=e.split('\\"').join('"').split("\\r\\n").join("\n").split("\\t").join("\t").split("\\n").join("\n").split("\\\\").join("\\"))[0]&&(e=e.substring(1,e.length-1)),n.lessStr=e,e}return n.lessStr?o(r(n.lessStr)):e.platform.themeBuilder.getResource({Name:"SkuidTheme"+(n.baseThemeData.baseTheme||{mobileclassic:"MobileClassic",modern:"Modern",paper:"Paper",classic:"Classic",ink:"Ink"}[n.baseThemeData.id]),NamespacePrefix:"skuid"},"skuidtheme.min.less").done(function(e){return r(e)}).fail(function(){t.blockUI({fadeIn:0,message:"There was an error"}),setTimeout(t.unblockUI,2e3)})}},{key:"removeSetting",value:function(e){this.themeSettingsLocal.unset(e),this.baseThemeData.themeSettings.get(e)?this.themeSettings.set(e,this.baseThemeData.themeSettings.get(e)):this.themeSettings.unset(e)}},{key:"updateSetting",value:function(n,r){var i=this,s=i.subscriptions,a={};t.each(s,function(t){a[t]=JSON.stringify(e.utils.getObjectProperty(i.themeSettings,t))}),i.themeSettingsLocal.set(n,r),i.themeSettings.set(n,r),t.map(s,function(e,t){return t}).filter(function(e){var t=(n||"").match(e),r=JSON.stringify(i.themeSettings.get(e));return a[e]!==r&&(t&&0==t.index)}).forEach(function(e){s[e].forEach(function(e){e()})})}},{key:"subscribeChange",value:function(e,t){var n=this.subscriptions;return n[e]||(n[e]=[]),n[e].push(t),{unsubscribe:function(){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}}},{key:"getSetting",value:function(e){return this.themeSettings.get(e)}}]),n}();function m(n,r){var i=t.extend(!0,{},n.getAll(),r.getAll()),s=e.utils.getObjectProperty(r,"palette");t.each(s,function(e,t){t.value.shades&&(i.palette[e].value.shades=t.value.shades),t.value.tints&&(i.palette[e].value.tints=t.value.tints)});var a=e.utils.getObjectProperty(r,"tokens.shadow");return t.each(a,function(e,t){i.tokens.shadow[e]=t}),new u(i)}n.loadJS(e.platform.getResourceUrl({name:"lib/jSZip.js",namespace:"skuid"})),a.updateThemes=h,a.updateAllThemes=function(){e.snippet.get("skuid.themebuilder.updateThemes")("",!0)},a.migrateTheme=function(e){var n=new d(e),r=n.migrations;return r||(r=n.migrations={}),r.millau||(function(e){var n=t.extend({},e),r=n.webFonts&&n.webFonts.custom,i=n.cssResources,s={};i||(i=n.cssResources=[]),i.forEach(function(e){var t=a.utils.getCSSResourceIdentifier(e);s[t]=e}),r&&r.length&&r.forEach(function(e){var t,n=e.localurl,r=e.url,o=c(n)||c(r);!o&&r&&(r.indexOf("http://")>-1||r.indexOf("https://")>-1)&&(o={type:"external",path:r}),o&&(t=a.utils.getCSSResourceIdentifier(o),s[t]||i.push(o),delete e.localurl,delete e.url)})}(n),r.millau=""+(new Date).getTime()),n},a.ThemeConfiguration=d}(skuid)}});