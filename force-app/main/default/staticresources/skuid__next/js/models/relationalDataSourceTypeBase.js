skuid.runtime.registerApi("v2","models/relationalDataSourceTypeBase",function(e){var t=function(e){var t={};function i(n){if(t[n]){return t[n].exports}var r=t[n]={i:n,l:false,exports:{}};e[n].call(r.exports,r,r.exports,i);r.l=true;return r.exports}i.m=e;i.c=t;i.d=function(e,t,n){if(!i.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:n})}};i.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};i.t=function(e,t){if(t&1)e=i(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var n=Object.create(null);i.r(n);Object.defineProperty(n,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n};i.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};i.d(t,"a",t);return t};i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};i.p="";return i(i.s=443)}({443:function(t,i){(function(e){const t=e.$,i=t.each,n=t.extend,r=e.constants,a=e.dataSource,o=r.DISPLAY_TYPES,l=o.REFERENCE,u=a.core||(a.core={}),d=e.utils,c=d.isString,s=d.makeXMLDoc,f=d.Deferred,h=["name"],p="_entityListCache",g={INTEGER:1,DOUBLE:1,CURRENCY:1,ID:1,STRING:1,TEXT:1,EMAIL:1,PICKLIST:1,MULTIPICKLIST:1,COMBOBOX:1,PHONE:1,URL:1,REFERENCE:1,TEXTAREA:1};function b(e){return typeof e==="undefined"||e===null}function y(e){let t=e.body;if(t){while(c(t)){try{t=JSON.parse(t)}catch(e){break}}}return t}function m(e){if(e.proxyVersion){const t=e.proxyVersion.split(".");if(t.length==3){const[i,n,r]=t.map(e=>parseInt(e,10));if(i>=0&&n>=2&&r>=3){return e.name}}}return e.id}let F={getEntityList:function e(t,i){return{url:d.combineUrls(i.dataServiceUrl,"datasources/"+m(i)+"/entities"),method:"GET",contentType:"application/json",headers:{}}},getModelMetadata:function e(t,i){return{url:d.combineUrls(i.dataServiceUrl,"datasources/"+m(i)+"/entities?name="+t.entity),method:"GET",contentType:"application/json",headers:{accept:"application/vnd.skuid-metadata"}}},load:function e(t,i){return{url:d.combineUrls(i.dataServiceUrl,"datasources/"+m(i)+"/load"),method:"POST",contentType:"application/json",body:t}},save:function e(t,i){return{url:d.combineUrls(i.dataServiceUrl,"datasources/"+m(i)+"/save"),method:"POST",contentType:"application/json",body:t}}};function S(i,n,a){return e.utils.Identity.getAPIToken().then(function(o){let l=F[i](n,a);l.headers=t.extend({},{"x-skuid-public-key-endpoint":e.platform.getPublicKeyEndpoint(),Authorization:"Bearer "+o.jwt},l.headers);if(d.inPlatform([r.VISUALFORCE,r.LIGHTNING])){l.headers["x-skuid-session-id"]=e.utils.userInfo.sessionId}return l})}function M(i){let n={},r=i.getDataSourceType(),a=function n(a){return function(n){return S(a,n,i,r).then(function(n){return e.ajax.direct(i.createHTTPRequest(n)).then(y).catch(function(e){let i=y(e),n;if(i&&t.isPlainObject(i)){n=i.message}if(!n&&e){if(e.statusCode===0){n="Error with the connection, likely caused by a timeout talking to the data source."}else{n=e.status}}return n})})}};let o=0,l=["load","save","getModelMetadata","getEntityList"],u;for(;o<l.length;o++){u=l[o];n[u]=a(u)}i._remote=n;return n}function N(e){let t=e._remote;if(!t)t=new M(e);return t}function j(e,t,i){const n=E(e,t,i);if(n&&n.length)return n[0]}function E(e,t,i){if(!t&&i){t=i.getDataSource()}const n=t.getCachedEntityMetadata(e);return n?n.get("nameFields"):[]}function v(e,t){if(c(e)&&t){const i=t.getCachedEntityMetadata(e);return i?i.get("idFields"):[]}else{return e.idFields}}function C(e,t){const i=v(e,t);if(i&&i.length)return i[0]}function P(e,t){return C(e.fieldsMap[t],e.dataSource)}function O(e,t,i){return t.getFieldValue(e,j(t.objectName,i,t),true)}function T(e,i){let n=C(i),r={},a,o=false;if(t.isArray(n)){if(n.length<=0)o=true;n.forEach(function(t){let n=i.getFieldValue(e,t,true);if(d.isUndefined(n)||n===null){o=true}else{r[t]=n}})}else{a=i.getFieldValue(e,n,true);if(d.isUndefined(a)||a===null){o=true}else{r[n]=a}}if(o)return d.generateUniqueId();else return JSON.stringify(r)}function R(e,t,i){let n=e.getIdFieldForChildRelationship(i),r=t[n],a=null,o;if(n&&r){o={};o[n]=r;a=d.encodeHTML(JSON.stringify(o))}return a}function L(e){if(e)return true}function I(e){const i=e.dataSource;if(i[p]){return f().resolve(i[p])}return i.authenticate().then(()=>N(i).getEntityList()).then(e=>{if(c(e)){throw Error(e)}if(Array.isArray(e)&&!e.length){throw Error("No Data Source Objects found for this Data Source. Go to the Data Source and click 'Import Data Source Objects'.")}return i[p]=e.map(e=>{return t.isPlainObject(e)?{label:e.label,value:e.name}:e})})}function D(e,i,n,r,a){let o=r.rel,l=i.value,u=d.getNameField(r.ref,n.dataSource),c=i.nameFieldValue||false;if(!c){let e=d.getFieldReference(i.field,r,n.dataSource);t.each(a,function(t,n){if(n!==i&&n.field===e&&!n.inactive&&n.value&&(!i.operator||i.operator==="=")){c=n.value}})}let s={};if(c){let e;if(typeof c==="object"){e=c}else{e={};e[u]=c}s[o]=e}s[i.field]=l;n.updateRow(e,s)}function _(i,n,r,a,o){let l,u=i.id,d=B(u);if(o[d]!==undefined){return}t.each(a.data,function(){if(this[u]&&this[u]===n&&a.getFieldValue(this,d)){l=a.getFieldValue(this,d,true);return false}});if(!l){let r=a.dataSource&&a.dataSource.name;let o=i.referenceTo,u=[],d=[];if(o&&o.length){t.each(o,function(){u.push(this);d.push(this.objectName)})}t.each(e.model.getModelsByDataSource(r),function(){let e=this,i=[];if(e===a||d.indexOf(e.objectName)===-1)return;t.each(this.fields,function(){let e=this;t.each(u,function(t,n){if(n.keyField===e.id)i.push(e)})});if(i.length){t.each(e.getRows(),function(){let r=this;t.each(i,function(){let t=this;if(e.getFieldValue(r,t.id,true)===n){l=r;return false}});if(l)return false})}if(l)return false})}return l}function w(e,t){const i=e.referenceTo;if(!e.rel){e.rel=e.id.split(".").pop()+"__rel"}if(!e.relationshipName){e.relationshipName=e.rel}if(!e.ref&&i&&i.length){i.forEach(e=>{if(!e.label&&t){let i=t.getCachedEntityMetadata(e.objectName);if(i){e.label=i.getLabel();e.labelPlural=i.getLabelPlural();e.createable=i.get("createable");e.searchable=i.get("searchable")}}e.accessible=true});e.ref=e.refprefix=i.map(e=>e.objectName).join(",")}}function A(e,i,n,r){if(!i)return;let a,l,u=i.split("."),d,c,s,f=r.getDataSource&&r.getDataSource();if(e.type==="childRelationship"){const i=n.getChildRelationship(e.id);if(i){c=f&&f.getCachedEntityMetadata(i.childObject);if(c){e.idFields=c.get("idFields");s=e.subFields;if(s){t.each(s,function(e,t){A(t,t.id,c,r)})}}}}else if(u.length===1){a=n&&n.getField&&n.getField(i);if(a){l=r.getOverrideableFieldMetadata(e);let i=e.id,n=e.name;t.extend(true,e,a);if(i)e.id=i;if(n)e.name=n;if(l){t.each(l,function(t,i){e[t]=i})}}if(e&&e.displaytype===o.REFERENCE){w(e,f)}}else{i=u.shift();i=U(i);a=n&&i&&n.getField&&n.getField(i);if(a){d=a.referenceTo;if(d&&d.length===1){n=f&&f.getCachedEntityMetadata(d[0].objectName||d[0].o)}else if(d&&d.length>1){n=f&&f.getCachedEntityMetadata("Name")}if(n){A(e,u.join("."),n,r)}}e.required=e.createable=e.editable=false}}function x(e,t){const i=d.grab(e,"referenceTo",0,"keyField");if(i||!t)return i;const n=t.getDataSource();const r=t.objectName;const a=n.getCachedEntityMetadata(r);const o=a&&a.get("idFields");if(o&&o.length){return o[0]}}function k(){return{getBaseReferenceProps:function t(i){return[{id:"targetobjects",type:"entity",label:"Entity Name",readonly:false,dataSourceName:e.dataSource.getDataSourceFromXML(i.get("xmlState")).name}]},getOverrideBatchProperties:function e(){return[{type:"helptext",html:"Specify fields that will be added as related data. Any fields that are used in search or display templates will need to be added here."}]},getOverrideBatchNoItemsFunction:function e(){return function(){return t("<div>").text("(Loading key field only.)")}},getOverrideBatchFieldChildrenFunction:function e(t){return function(){return[{id:"batchfield",indent:1,linkedComponent:t,addtooltip:"Add Field",labelFunction:function e(t){return t.attr("field")||"[No Field Selected]"},defaultStateFunction:function e(){return s("<batchfield/>")},propsFunction:function e(i){let n=[{id:"field",type:"field",label:"Field",sobject:t.get("xmlState").attr("targetobjects"),dataSourceName:t.get("xmlState").attr("datasource"),onChange:function e(){i.refresh().rebuildProps()}}];return n}}]}},getMetadataHandler:function i(n,r,a,o,u){let d=n.children("batchfields").first();let c=d.children("batchfield");let s=n.attr("keyfield")||C(a);let f=n.attr("targetobjects");let h;let p=n.attr("ogdisplaytype");let g=n.attr("rel")||o+"__r";if(!s||!f){return}r.keyField=s;r.originalDisplayType=p;if(f){h=f.split(",");r.isNamePointing=h.length>1;if(u||p&&p!==l){r.relationshipName=r.rel=g}r.referenceTo=t.map(h,function(e){return{accessible:true,objectName:e,keyField:s}});r.ref=f}if(!u&&p&&p!==l){let i=e.dataSource.getDataSourceFromXML(n);let r=new e.model.Model({dataSource:i});r.id="_ReferenceLabelModel_"+(new Date).getTime()+g;if(c&&c.length){r.fields=t.map(c,function(e){return{id:t(e).attr("field")}})}else{r.fields=[{id:s}]}r.doQuery=true;r.doClone=false;r.objectName=f;r.initialize();let l=new e.model.Condition;l.name="__reference_batch";l.field=s;l.operator="in";r.addCondition(l);if(!a.batchLabelModels)a.batchLabelModels={};a.batchLabelModels[o]=r}},getReferenceValue:function e(t,i,n){const r=x(i,n);return t[r]},processReferenceLookupModel:function e(t,i,n){const r=x(i,t);const a=E(n,null,t);t.objectName=n;let o=t.fields;if(!o){o=t.fields=[]}if(r&&!o.find(e=>e.id===r)){o.push({id:r})}if(a&&a.length){a.forEach(e=>!o.find(t=>t.id===e)&&o.push({id:e}))}},getRowFromReferenceValue:function e(t,i,n){const r=x(n,t);const a=t.getRows([{field:r,value:i}]);return a&&a.length?a[0]:{}}}}function U(e){return e&&e.slice(0,-5)}function B(e){return e&&e+"__rel"}function V(e){if(e.fields&&e.fields.length){let i=e.getDataSource&&e.getDataSource();let n=i&&i.getCachedEntityMetadata(e.objectName);if(n){t.each(e.fields,function(t,i){A(i,i.id,n,e)});t.each(n.get(["label","labelPlural"]),function(t,i){if(!e.hasOwnProperty(t)){e[t]=i}});t.each(n.get(["accessible","createable","updateable","deleteable","idFields"]),function(t,i){e[t]=i})}}if(!e.idFields||e.idFields&&!e.idFields.length){e.updateable=false;e.deleteable=false}if(!(e.data instanceof Array))e.data=[e.data];return e}function q(t,i){let n=this,r=e.builder.core,a=t.get("xmlState"),o=r.getUnsavedChangesWarningProperty({component:t}),l=r.getCoreModelBasicProperties({component:t,propViewer:i}),u=[];l.push({id:"sobject",type:"sobject",dataSourceTypeName:n.name,dataSourceName:a.attr("datasource"),label:"Entity Name",onChange:function e(i){if(!i){return}let n=false;let o;try{let e=a.closest("model");o=r.getDataSourceFromModel(e).getCachedEntityMetadata(i)}catch(e){o={get:function e(){}}}if(!a.attr("batchable")){a.attr("batchable",o.get("batchable"));n=true}let l=d.capitalizeFirst(i.split(".").pop());if(!a.attr("label")){let e=o.get("label")||l;a.attr("label",e);n=true}if(!a.attr("labelplural")){let e=o.get("labelPlural")||l+(d.endsWith(l,"s")?"":"s");a.attr("labelplural",e);n=true}if(n){t.save()}}});l.push(r.getModelTypeProperty({component:t}),r.getModelQueryOnPageLoadProperty({component:t,propViewer:i}),r.getAsyncLoadProperty({component:t}),r.getModelLimitProperty(),r.getModelOrderByProperty(),r.getCreateDefaultRowProperty(),r.getModelNameFieldProperty());if(o)u.push(o);Array.prototype.push.apply(u,r.getModelLabelProperties());u.push(r.getModelBatchProperty());return[{name:"Basic",props:l},{name:"Advanced",props:u}]}function G(t,i){const n=t.get("xmlState"),r=e.builder.core;return[{id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:true,picklistEntries:[{label:"COUNT",value:"COUNT"},{label:"COUNT DISTINCT",value:"COUNT_DISTINCT"},{label:"SUM",value:"SUM"},{label:"AVG",value:"AVG"},{label:"MAX",value:"MAX"},{label:"MIN",value:"MIN"}],onChange:function e(a){if(a){n.attr("name",r.getDefaultAliasName(n.attr("id"),a))}t.save().refresh().rebuildProps(i)}}]}function X(){return[]}function z(e,t){let i=t.dataSource;return i.authenticate().then(function(){return N(i).save(e).then(e=>{if(d.isString(e)){throw Error(e)}return e})})}function H(e){Q(e);Y(e)}function K(e,t){return t.map(function(t){if(t.fields&&e[t.id]){t.fields=t.fields.concat(e[t.id])}return t})}function Q(e){t.each(e,function(e,t){if(!t.fields||!t.fields.length){throw Error("Error with Model: "+t.id+" - Must have at least one valid field")}})}function Y(e){t.each(e,function(e,i){if(!i.conditions||!i.conditions.length){delete i.conditions;delete i.conditionLogic;return}let n=false;t.each(i.conditions,function(e,t){if(t.inactive){return}else{n=true}});if(!n){delete i.conditions;delete i.conditionLogic}})}function J(e,i){let n=i.dataSource;return n.authenticate().then(function(){let r=false;let a=["conditionLogic","doQuery","groupByMethod","havingLogic","id","objectName","schemaName","orderByClause","offsetPageNumber","offsetPageSize","recordsLimit","type"];let o={};let l=t.map(e,function(e){let i={};for(let n in e){if(e.hasOwnProperty(n)&&t.inArray(n,a)>-1){if(!d.isUndefined(e[n])&&e[n]!==""){i[n]=e[n]}}}let n=e.fields.filter(function(e){return e.uiOnly});if(n.length){o[e.id]=n}t.each(["fields","groupByFields"],function(n,r){let a=e[r],o;if(a&&a.length){o=i[r]=[];t.each(a,function(e,i){let n;if(i.uiOnly)return true;else if(i.type==="childRelationship"){n={id:i.id,type:i.type,anchorField:i.anchorField,keyField:i.keyField,childObject:i.childObject};t.each(["recordsLimit","orderByClause","subConditionLogic"],function(e,t){if(i.hasOwnProperty(t)&&i[t]!==null&&typeof i[t]!=="undefined"){n[t]=i[t]}});if(i.subConditions){n.subConditions=[];if(i.subConditions.length){t.each(i.subConditions,function(e,t){let i={};for(let e in t){if(t.hasOwnProperty(e)&&t[e]!==null&&typeof t[e]!=="undefined"){i[e]=t[e]}}n.subConditions.push(i)})}}if(i.subFields){n.subFields=[];if(i.subFields.length){t.each(i.subFields,function(e,t){let r={id:t.id};if(typeof i.query!=="undefined"&&i.query!==null){r.query=i.query}n.subFields.push(r)})}}}else{n={id:i.id};t.each(["name","function","query"],function(e,t){if(i.hasOwnProperty(t)&&i[t]!==null)n[t]=i[t]})}o.push(n)})}});t.each(["conditions","havings"],function(n,r){let a=e[r],o;if(a&&a.length){o=i[r]=[];t.each(a,function(i,n){let r=t.extend({},n);for(let e in r){if(r[e]===null)delete r[e]}t.each(r.subConditions,function(t,i){let n=e.getField(i.field);if(["INTEGER","DOUBLE","CURRENCY"].indexOf(n.displaytype)>-1){i.operator="="}});o.push(r)})}});if(e.needsMetadataLoad){r=true}return i}).filter(function(e){if(e.conditions&&e.conditions.length){for(let t=0,i=e.conditions.length;t<i;++t){let i=e.conditions[t];if(i.noValueBehavior==="noquery"&&b(i.value)&&b(i.values)){return false}}}return true});if(l.length<=0){return null}H(l);let u=!i||i.loadAllMetadata||r;return N(n).load({operationModels:l,options:{excludeMetadata:!u}}).then(function(e){let i=f(),r;if(t.isArray(e)){i.resolve(e)}else if(e&&e.models){r=e.metadata;if(r&&d.size(r)){t.each(r,function(e,t){n.cacheEntityMetadata(e,t).setIsFullMetadata()})}if(Object.keys(o).length){e.models=K(o,e.models)}i.resolve(e.models)}else{let n;if(c(e)){n=e}else if(t.isPlainObject(e)){n=e.message?e.message:e.error}i.reject(n||"Invalid Response Format")}return i.promise()})})}function W(e){if(e){if(t.isArray(e)){let i=true;t.each(e,function(){if(!$(this)){i=false;return false}});return i}else if(t.isPlainObject(e)){return $(e)}else if(d.isString(e))return true}return false}function $(e){return d.isString(e)||e.objectName&&e.dataSource}function Z(e){let i=e.entities,n=e.dataSource;return W(i)?n.authenticate().then(function(){let e=t.map(i,function(e){let i=c(e)?e:e.objectName,r={entity:i,loadChildRelationships:true,loadPicklistValues:false};if(!i){return f().reject("No Table Name provided")}if(e&&e.fields&&e.fields.length){r.fieldsToLoad=e.fields.join(",")}return N(n).getModelMetadata(r).then(function(e){if(!e||!e.length&&!t.isPlainObject(e)){throw Error("No metadata could be retrieved for this table. You probably need to import this table as a Data Source Object. Go to your Data Source, and click 'Import Data Source Objects', then select this table to import it.")}if(t.isArray(e)){e=e[0]}let i=e.fields;i&&i.length&&i.forEach(e=>{if(e.displaytype===l){w(e,n)}});return e})});return Promise.all(e).catch(function(e){return f().reject(e&&e.length?e.join(","):"")})}):f().reject("Invalid Model configuration. Metadata could not be retrieved.")}function ee(e){let t=e.targetEntity;if(!t&&e.model&&e.model.attr){t=e.model.attr("sobject")}return{objectName:t}}function te(e){return"Loading metadata for table "+e.endsobject+"..."}function ie(e){return e.objectName}function ne(e,i,n){const r=this;const{dataSource:a}=e;const o=t.map(e.returning,e=>{let t;for(let i in n){if(i.indexOf("search__".concat(a.name,"__").concat(e.objectName))>-1){t=n[i]}}t.doQuery=true;t.recordsLimit=6;t.conditions=[];if(!e.fields)e.fields=[];t.searchFields=e.fields;return t});return r.getEntityMetadata({dataSource:a,entities:o}).then(i=>{t.each(i,function(i,n){let r=o[i],a={sourceType:"fieldvalue",type:"group",operator:"=",inactive:false,encloseValueInQuotes:true,originalInactive:false,name:"__global_search",subConditions:[],value:e.query};t.each(r.searchFields,function(i,r){t.each(n.fields,function(t,i){r=d.isString(r)?r:r.id;if(r===i.id){if(i.filterable){a.subConditions.push({name:"__global_search_subcondition",type:"fieldvalue",field:i.id,inactive:false,operator:"contains",value:e.query})}}})});a.subConditionLogic="(";t.each(a.subConditions,e=>{if(a.subConditions.length-1===e){a.subConditionLogic+="".concat(e+1,")")}else{a.subConditionLogic+="".concat(e+1," OR ")}});r.addCondition(a)});return r.load(o,{dataSource:a,loadAllMetadata:true}).then(t=>{return{request:e,results:t.map(t=>{const i=t.id.split("__");const n=i[i.length-1].split("--")[0];const r=e.returning[n];return{label:t.label||r.objectName,labelPlural:t.labelPlural||r.objectName,objectName:r.objectName,objectMapKey:r.objectMapKey,modelName:r.modelName,records:t.data}})}})})}class re extends a.DataSourceType{constructor(e){i(h,function(t,i){if(!e[i])throw Error("Missing Required Property Error: "+i)});super(e);if(e.extendedProperties){n(true,this.properties,e.extendedProperties);delete this.extendedProperties}delete this.getModelProperties}}Object.assign(re.prototype,{buildEntityMetadataRequest:ee,getAggregateFieldProperties:G,getAggregateGroupingProperties:X,getChildIdFromRow:R,getEntityList:I,getEntityMetadata:Z,getEntityMetadataCacheKey:ie,getEntityMetadataLoadingMessageFromBreadcrumb:te,getIdField:C,getIdFields:v,getIdFieldForChildRelationship:P,getModelProperties:q,getNameField:j,getNameFields:E,getReferenceFieldNameFromRelationshipField:U,getReferenceFieldRelatedData:_,getReferenceFieldRelationshipName:B,getReferenceHandler:k,getRowId:T,getRowName:O,handleDefaultReferenceFieldValue:D,initialize:V,joinFieldDisplayTypeFilter:L,load:J,properties:{batchableEntityRequests:true,canAutoGenerateConditionsFromFields:true,canConditionsBeGrouped:true,composer:{supports:{childRelationships:true},canFieldsBeSelected:function e(t){if(t.breadcrumb.endsobject){return true}else{return"Select an entity to use for this Model"}}},hasGlobalSearchEntities:true,serverSideModelMerge:true,validConditionTypes:["blank","fieldvalue","join","modelmerge","multiple","param","userinfo"]},save:z,search:ne,searchableDisplayTypes:g});n(u,{RelationalDataSourceTypeBase:re})})(e)}});return t});