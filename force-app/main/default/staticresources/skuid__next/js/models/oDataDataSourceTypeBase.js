skuid.runtime.registerApi("v2","models/oDataDataSourceTypeBase",function(e){var t=function(e){var t={};function a(r){if(t[r]){return t[r].exports}var i=t[r]={i:r,l:false,exports:{}};e[r].call(i.exports,i,i.exports,a);i.l=true;return i.exports}a.m=e;a.c=t;a.d=function(e,t,r){if(!a.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};a.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};a.t=function(e,t){if(t&1)e=a(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var r=Object.create(null);a.r(r);Object.defineProperty(r,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var i in e)a.d(r,i,function(t){return e[t]}.bind(null,i));return r};a.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};a.d(t,"a",t);return t};a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};a.p="";return a(a.s=442)}({15:function(e){e.exports={date:"1612394257000",id:"v2",major:12,minor:4,patch:20,build:0,number:"12.4.20.0",name:"Spark Update 3 (12.4.20.0)",path:"next"}},442:function(t,a,r){"use strict";r.r(a);var i=r(15);var n=r.t(15,1);(function(e){let t=e.$,a=t.each,r=t.extend,n=e.dataSource,o=n.utils,s=n.libraries.skuid,l=".",u=n.core||(n.core={}),c=e.utils,d=e.time,{getSFDateTime:f,parseDateTimeString:p,parseSFDateTime:m}=d,{combineUrls:y,createMapForArray:g,Deferred:h,getObjectProperty:b,isNumber:E,isString:S,isUndefined:F,keyBy:M,loadJS:T,makeXMLDoc:v,mergeAsTextInContext:R,reject:C,resolve:x,settle:j,size:D}=c,O=e.constants,P=O.HTTP_VERBS,N=P.PATCH,I=P.MERGE,_=P.POST,A=P.DELETE,k="Collection(",L="_odatalib",q={"Edm.String":"STRING","Edm.Boolean":"BOOLEAN","Edm.Date":"DATE","Edm.DateTime":"DATETIME","Edm.DateTimeOffset":"DATETIME","Edm.Int16":"NUMBER","Edm.Int32":"NUMBER","Edm.Decimal":"NUMBER","Edm.Double":"NUMBER","Edm.Int64":"NUMBER","Edm.Guid":"STRING"},B="skuidSupportsBatch",w=["@odata.editLink","@odata.id","@odata.type"],U=["__metadata"],V=["COUNT","COUNT DISTINCT","SUM","AVG","MAX","MIN"],H=";,/?:@&=+$#",K=function e(t){let a="";for(let e=0;e<t.length;e++){const r=t[e];if(H.indexOf(r)>-1){a+=encodeURIComponent(r)}else{a+=r}}return a},G=function e(t){if(!t)return t;let a=" and",r=a.length,i=t.length,n=i-r,o=t.lastIndexOf(a);if(o===-1)return t;if(o!==n)return t;return t.substring(0,n)},$=function t(a){let r;if(a.major<4){r=e.lib.OData;return{read:r.read,request:r.request,batchHandler:r.batchHandler,metadataHandler:r.metadataHandler,defaultHttpClient:r.defaultHttpClient}}else{r=e.lib.odatajs.oData;return{read:r.read,request:r.request,batchHandler:r.batch.batchHandler,metadataHandler:r.metadata.metadataHandler,defaultHttpClient:r.net.defaultHttpClient}}},Q=function e(t,a){let r=S(t)?t:t.objectName,i,n,o;if(!r)return r;i=r&&r.split(".");n=i.slice(0,-1).join(".");o=a.dataServices.aliasMap;if(o){n=o[n]||n}return n+"."+i[i.length-1]},J=function e(t,r,i){let n=i.major<4?U:w;a(n,function(e,a){if(r[a])t[a]=r[a]})},z=function t(a){let r=h(),i=re.prototype.getServiceVersion(a),n=i.major,o=n<4,l="odata"+(o?"3":"4"),u=o?"data.js":"odatav4.js",c=function t(a){return e.platform.getResourceUrl({ns:"skuid",path:"js/lib/"+a})};if(a[L]){r.resolve()}else if(s[l]){a[L]=s[l];r.resolve()}else{T(c(u)).then(function(){a[L]=s[l]=$(i);r.resolve()})}return r.promise()},X=function e(a,r){let i={};i[a]=true;return t.extend(i,r)},Y=function e(r,i){a(r,function(e){delete i[e]});let n={};a(r,function(e){let t=n[e]=[];a(i,function(a){if(a.indexOf(e+"/")===0&&a.substring((e+"/").length).indexOf("/")===-1){delete i[a];t.push(a.substring((e+"/").length))}})});(function e(t){let r=n;a(r,function(a,i){if(!t){e({name:a,list:i})}else if(a.indexOf(t.name+"/")===0){let n={name:a.substring((t.name+"/").length),list:i};t.list.push(n);delete r[a];e(n)}})})();let o={str:"$expand="};if(D(n)){(function e(r,i){let n=true;a(i,function(i,o){let s=false,l=false;if(!n){r.str+=","}n=false;r.str+=i;if(o.length){let i=[];a(o,function(e,a){if(!t.isPlainObject(a)){i.push(a)}});if(i.length){r.str+="($select=";r.str+=i.join(",");s=true}a(o,function(a,i){if(t.isPlainObject(i)){if(!s&&!l){r.str+="($expand=";l=true}else if(!l&&s){r.str+=";$expand=";l=true}let t={};t[i.name]=i.list;e(r,t)}});if((l||s)&&!n){r.str+=")"}}})})(o,n)}if(D(r)){return o.str}},W=function e(a,r){let i=a.objectName,n=a.fields,o=a.getDataSource(),s=o.metadata,l=r.getEntitySet(i,s);i=l&&l.entityType||i;let u={};u[i]=true;t.each(n,function(e,t){if(t.ref)u[t.ref]=true});let c=n.filter(function(e){return e.id.indexOf(".")!==-1});t.each(c,function(e,a){let n=a.id.split(".");let l=i;t.each(n,function(e,t){let a=r.getEntityType(l,s);if(!a)return false;let i=r.getFieldsFromEntityType(a,l,s,o);if(!i||!i.length){return false}i=M(i,"id");let n=i[t];if(!n)return false;if(!n.ref){return false}u[n.ref]=true;l=n.ref})});return u},Z=["name"],ee="metadata",te="batch",ae="entitySet";class re extends n.DataSourceType{constructor(e){a(Z,function(t,a){if(!e[a])throw Error("Missing Required Property Error: "+a)});super(e);delete this.getModelProperties;if(e.extendedProperties){r(true,this.properties,e.extendedProperties);delete this.extendedProperties}}authenticateAndGetMetadata(e){let t=this;return e.dataSource.authenticate().then(function(){return t.getMetadata(e)})}populateSelect(e,t,a,r){let i,n;if(a.uiOnly)return;if(!r.accessible)return;i=a.id.split(l);if(a.isComplexField){i=[!a.complexInReference?i[0]:a.referenceParentId]}n=i.join("/");if(a.query!==false){if(t&&!t[n])e[n]=true;if(r.keyField)e[n+"/"+r.keyField]=true;if(r.nameField||a.nameField)e[n+"/"+(r.nameField||a.nameField)]=true}}getFieldDef(e,t,a,r){let i=this,n,o=r.metadata;if(e.complexFields){return e}n=i.tryToGetComplexDef(e,e.id,t,a,r);if(n)return n;n=i.getPropertyDef(e.id,t,o,a,t);if(e.id.split(l).length>1){e.editable=false;e.createable=false;e.sortable=false}return n}isArrayField(e,t){const a=e.id;let r;if(a&&a.indexOf(l)!==-1){r=a.split(l)[0];const e=r&&t?t[r]:false;if(e&&e.type){if(e.type.indexOf(k)!==-1){return true}}}return false}isDefAccessible(){return true}isDefEditable(e,t,a){let r=this,i=true;if(a.major<4){i=!r.propertyHasExtension(e,"StoreGeneratedPattern")}if(t.isComplexField){i=!t.complexInReference&&a.major<4}else if(t.editable===false&&a.major>3){i=false}return i}isDefCreateable(e,t,a){return this.isDefEditable(e,t,a)||this.isDefRequired(e,t,a)}isDefRequired(e,t){return e.nullable==="false"&&t.editable!==false}isDefFilterable(e,t,a,r){if(this.isArrayField(t,r))return false;return e.type==="Edm.String"}buildFieldMetadata(a,r,i,n,o,s){let l=this,u,c=s.metadata,d=l.getServiceVersion(s),f,p,m,y=r.navigationPropertyMap;if(a.uiOnly===true)return a;u=l.getFieldDef(a,r,i,s);if(!u)return;p={id:a.id,accessible:l.isDefAccessible(u,a),createable:l.isDefCreateable(u,a,d),editable:l.isDefEditable(u,a,d),sortable:true,label:a.id,displaytype:q[u.type]||u.type,edmtype:u.type,required:l.isDefRequired(u,a,d),filterable:l.isDefFilterable(u,a,d,y),minInputLength:1,groupable:true};if(a.defer)p.defer=true;if(a.idField)p.idField=true;if(!e.builder){if(a.name)p.name=a.name;if(a.function)p.function=a.function}if(l.isDefForComplexTypeField(u,c)){l.populateFieldMetadataForComplexField(p,r)}if(l.isDefForReferenceField(u)){l.populateFieldMetadataForReferenceField(p,u,i,o,c)}else if(l.isDefForComplexTypeField(u,c)){f=true;l.populateFieldMetadataForComplexField(p,r)}else if(!f){if(d.major>3){m=l.getEnumTypeFromDef(u,c);if(m){l.populateFieldMetadataForEnumField(p,m)}}}l.coerceFieldMetadata(p,u);if(a.overrideMetadata)t.extend(p,a);if(a.query===false)p.query=false;return p}isDefForReferenceField(e){return!!(e.fromRole||e.isReferenceProp)}populateFieldMetadataForComplexField(e,t){let a=e.id,r=t.propertyMap[a].type;e.displaytype="OBJECT";e.rel=a;e.ref=r;e.referenceTo=[{objectName:r,label:r,relationshipName:a}]}populateFieldMetadataForEnumField(e,t){e.displaytype="PICKLIST";e.picklistEntries=t.picklistEntries;e.noneLabel=!e.required;e.deDupLabel=true}populateFieldMetadataForReferenceField(e,a,r,i,n){let o=this,s,l,u,c=e.id,d=e.id.split(".").join("/"),f,p;if(a.fromRole){s=o.getAssociation(a.relationship,n);l=o.getEndFromAssociation(s,a.toRole);e.rel=c;if(t.inArray(l.multiplicity,["0..1","1"])!==-1){p=o.getEntityType(l.type,n);e.keyField=p.key&&p.key.propertyRef[0].name;if(p.nameField){e.nameField=p.nameField}e.displaytype="REFERENCE";e.ref=l.type;e.referenceTo=[{objectName:l.type,label:l.type,relationshipName:c,keyField:e.keyField}]}else{if(r)r[d]=true;e.displaytype="ARRAY";e.type="array";e.dataPath="results";e.ref=l.type;e.referenceTo=[{objectName:l.type}];e.relationshipName=a.name;e.childSObject=l.type;u=o.getRefConstraintsFromAssociation(s,a.toRole);e.field=u.length&&u[0].name}}else if(a.isReferenceProp){let t=a.type;e.rel=c;if(a.type.indexOf(k)!==-1){if(r)r[d]=true;t=t.substring(k.length,t.length-1);e.displaytype="ARRAY";e.type="array";e.ref=t;e.referenceTo=[{objectName:t}];e.relationshipName=a.name;e.childSObject=t;e.createable=false;e.editable=false}else{f=a.referentialConstraint;p=o.getEntityType(t,n);if(p&&p.nameField){e.nameField=p.nameField}if(f&&f.length>0){e.keyField=f[0].referencedProperty}else{e.keyField=p.key&&p.key[0].propertyRef[0].name}e.displaytype="REFERENCE";e.ref=a.type;e.referenceTo=[{objectName:a.type,label:a.type,relationshipName:c,keyField:e.keyField}];e.createable=true;e.editable=true}e.sortable=false}}buildEntityMetadataRequest(e){let t=e.targetEntity;if(!t&&e.model&&e.model.attr){t=e.model.attr("sobject")}return{objectName:t}}buildResourceUri(e,t,a={}){if(!e)throw Error("Unable to build Resource URI");let r=e.serviceUrl,i=a.entitySet,n=a.keyPredicate,o=a.count,s;switch(t){case ee:return y(r,"$metadata");case te:return y(r,"$batch");case ae:s=y(r,i);if(n)s+="("+n+")";if(o)s+="/$count";return s;default:return r}}getAssociation(e,t){let a=this.processFullyQualifiedName(e),r=this.getSchema(t,a.nameSpace);return r.associationMap[a.name]}getEndFromAssociation(e,t){return e.end.filter(function(e){return e.role===t})[0]}getExtraEntityMetadata(t){e.storage.getDb(i.id).getTable("dataSourceMetadata").add(t.name,{entities:false,data:t.metadata});return t.metadata}getEntityMetadata(e){e=e||{};let a=this,r=e.entities,i=e.dataSource;return a.authenticateAndGetMetadata(e).then(function(){return a.getExtraEntityMetadata(i,r)}).then(function(){let n=[],o={},s=i.metadata;t.each(r,function(t,r){let i=Q(r,s),l,u,c;if(i){l=a.getEntitySet(i,s);u=a.getEntityTypeFromEntitySet(l,i,s);c=a.getFieldsFromEntityType(u,i,s,e.dataSource,e);a.cacheFieldsOfEntity({dataSource:e.dataSource,objectName:i},c,s,o);if(i.startsWith("."))i=i.replace(".","");n.push({childRelationships:[],fields:c,label:i,labelPlural:i,objectName:i,readonly:false})}else{throw Error("No object name provided.")}});return n})}getEntityMetadataCacheKey(e){return S(e)?e:e.objectName}getEntityMetadataLoadingMessageFromBreadcrumb(e){return"Loading metadata for external object "+e.endsobject+"..."}getEntitySet(e,t){let a=this,r=a.processFullyQualifiedName(e),i=a.getSchema(t,r.nameSpace),n=i.entitySetMap;if(n&&n[r.name])return n[r.name]}getFlatEntitySetList(e){let a=this,r=a.getEntitySetList(e);return t.map(r,function(e){if(S(e))return e;return e.value})}getEntitySetList(e){let a=this,r=[],i=this.getEntityContainerToList();t.each(e.dataServices.schemaMap,function(e,a){let n;if(i&&a.entityContainerMap){let e=a.entityContainerMap[i];n=e&&e.entitySetMap}else{n=a.entitySetMap}if(n){t.each(n,function(t,a){let i=e+l+t;if(a.label){r.push({label:a.label,value:i})}else{r.push(e+l+t)}})}});a.coerceEntitySetList(r);return r}coerceEntitySetList(){}getActionMap(e){let t={},a=e.dataServices.schema;a.forEach(function(e){let a=e.namespace;e.action&&e.action.forEach(function(e){t["".concat(a,".").concat(e.name)]=e})});return t}getActionsList(e){let t=[],a=e.dataServices.schema;a.forEach(function(e){let a=e.namespace;e.action&&e.action.forEach(function(e){e.namespace=a;t.push(e)})});return t}getFunctionMap(e){let t={},a=e.dataServices.schema;a.forEach(function(e){let a=e.namespace;e.function&&e.function.forEach(function(e){t["".concat(a,".").concat(e.name)]=e})});return t}getFunctionsList(e){let t=[],a=e.dataServices.schema;a.forEach(function(e){let a=e.namespace;e.function&&e.function.forEach(function(e){e.namespace=a;t.push(e)})});return t}getDefaultNamespace(){}getIdField(e,t){const a=this;let r;let i;if(c.isString(e)){i=e;r=t.metadata}else{i=e.objectName;r=e.dataSource.metadata}const n=a.getEntitySet(i,r),o=a.getEntityTypeFromEntitySet(n,i,r),s=a.getKeyFields(o,r);return Object.keys(s)[0]}getSchema(e,a){let r=this;if(!a){a=r.getDefaultNamespace();if(!a)return e.dataServices.schema[0]}let i=e.dataServices.schemaMap;return i[a]||t.map(i,function(e){if(e.alias===a)return e})[0]}getEntityType(e,t){let a=this,r=a.processFullyQualifiedName(e),i=a.getSchema(t,r.nameSpace),n=i.entityTypeMap[r.name];if(!n)return a._tryToGetComplexEntity(e,t);a._buildEntitySpecificMaps(n,i,t);return n}getEntityTypeFromEntitySet(e,t,a){let r=this,i=e?e.entityType:t;return r.getEntityType(i,a)}getEntityTypeNameFromRefPropDef(e,t){let a=this,r,i;if(e.relationship){r=a.getAssociation(e.relationship,t),i=a.getEndFromAssociation(r,e.toRole);return i.type}else if(e.type){if(e.type.indexOf(k)!==-1){return e.type.substring(k.length,e.type.length-1)}return e.type}}getEnumType(e,t){let a=this,r=a.processFullyQualifiedName(e),i=a.getSchema(t,r.nameSpace);return i.enumTypeMap[r.name]}getErrorFromErrorBody(e,a){let r,i,n;if(e){r=c.parseAsJSONIfString(e);if(r&&t.isPlainObject(r)){if(r.error)r=r.error;else if(r["odata.error"])r=r["odata.error"];if(r){i=r.code;if(r.message){n=t.isPlainObject(r.message)&&r.message.value?r.message.value:r.message}else{n=r;if(e.statusCode)i=e.statusCode}}}if(!r){try{r=c.makeXMLDoc(e);i=r.find("code").text();n=r.find("message").text()}catch(e){}}return{code:i,message:n}}else if(a){n=a.status;i=a.statusCode;return{message:n,code:i}}}getFieldDataForItem(e,t,a,r){let i=this,n=a.split(l),o;if(n.length===1){if(r&&t.name===n[0]&&t.id.indexOf(l)>-1){let e=t.id.split(l),i=!t.function,n=r.navigationPropertyMap[e[0]],o=n&&n.type.split(l)[n.type.split(l).length-1];if(i)a="".concat(o,"_").concat(e[1])}if(t.displaytype==="DATETIME"){o=e[a];if(o){let e;if(o instanceof Date)e=o;else{e=p(o)}return f(e)}else{return null}}else if(t.edmtype==="Edm.Decimal"||t.edmtype==="Edm.Double"){return parseFloat(e[a])}else if(t.edmtype==="Edm.Int64"){return parseInt(e[a],10)}else{return e[a]}}else{o=e[n[0]];n.shift();if(o){return i.getFieldDataForItem(o,t,n.join(l))}else{return null}}}_getComplexTypeMap(e){return e.dataServices&&e.dataServices.complexTypeMap}_tryToGetComplexEntity(e,t){let a=this._getComplexTypeMap(t);if(!(a&&e))return;return a[e]}_setComplexTypeMap(e){let r={};t.each(e.dataServices.schemaMap,function(e,a){let i=a.complexType;if(!i)return;t.each(i,function(t,i){r[e+l+i.name]={typeInfo:i,namespace:e};if(a.alias)r[a.alias+l+i.name]=r[e+l+i.name]})});function i(e,t){if(!e)return[];t=t||{};let a=e.typeInfo,n=a.baseType,o=a.hasExpandedBaseType;if(!a.property)a.property=[];if(!n||o)return a.property;a.isDerived=true;if(n.indexOf(l)===-1)n=e.namespace+l+n;a.hasExpandedBaseType=true;if(t[n])return a.property;t=X(n,t);a.property=a.property.concat(i(r[n],t));return a.property}a(r,function(e,t){t.typeInfo.property=i(t)});if(!D(r))r=null;e.dataServices.complexTypeMap=r;return r}_setEnumTypeMap(e){let a={};t.each(e.dataServices.schemaMap,function(e,r){let i=r.enumType,n=r.alias;if(!i)return;t.each(i,function(r,i){t.each(i.member,function(e,t){i.member[e].label=t.name});a[e+l+i.name]=a[n+l+i.name]={picklistEntries:i.member,namespace:e,name:i.name}})});e.dataServices.enumTypeMap=a;return a}isDefForComplexTypeField(e,t){let a=e.type;return this._tryToGetComplexEntity(a,t)}getEnumTypeFromDef(e,t){let a=e.type,r=t.dataServices.enumTypeMap;if(!r)return;return r[a]}_setMapOfPropertiesOfEntityType(e,a,r){if(e.propertyMap)return e.propertyMap;if(!r)r={};let i=this,n={},o=i.getPropertiesOfEntity(e);if(!o)return{};t.each(o,function(e,t){let o;if(!t)return;n[t.name]=t;o=i._tryToGetComplexEntity(t.type,a);if(o&&!r[t.type]){r=X(t.type,r);let e=o;n[t.name].complexFields=i._setMapOfPropertiesOfEntityType(e,a,r)}});e.propertyMap=n;return n}_setMapOfNavigationPropertiesOfEntityType(e,t){if(e.navigationPropertyMap)return e.navigationPropertyMap;if(!e.navigationProperty||!e.navigationProperty.length){e.navigationPropertyMap={};return e.navigationPropertyMap}a(e.navigationProperty,function(e,a){let r=a.type,i="",n,o,s=t.aliasMap,l=r?r.indexOf(k)===0:false,u="";a.isReferenceProp=true;if(!r)return;if(l){i=r.substring(k.length,r.length-1)}else if(r){i=r}n=i.split(".");if(n.length>1&&s){o=n.slice(0,n.length-1);if(s[o]){u=s[o]+"."+n[n.length-1];if(l){u=k+u+")"}a.type=u}}});e.navigationPropertyMap=M(e.navigationProperty,"name");return e.navigationPropertyMap}tryToGetComplexDef(e,a,r,i,n,o){let s=this,u,c,d,f,p=n.metadata,m=s._getComplexTypeMap(p),y=s.getServiceVersion(n),g,h,E,S,F,M,T,v,R,C;if(!m)return;s._buildEntitySpecificMaps(r,s.getSchema(p,r.__namespace),p);u=a.split(l);d=r.propertyMap;f=r.navigationPropertyMap;o=o||"";if(u.length>1){F=f[u[0]]}if(D(F)){C=u[0];M=s.getEntityTypeNameFromRefPropDef(F,p);T=s.getEntityType(M,p);v=a.substring(C.length+1);R=o?o+"/"+C:C;return s.tryToGetComplexDef(e,v,T,i,n,R)}else if(u.length>1){h=u[u.length-2];if(u.length>2){let e=u.slice(0,u.length-1).join(".complexFields."),t=b(d,e);if(t){g=t.type}}if(u.length===2){g=d&&d[h]&&d[h].type}E=u[u.length-1];S=g?m[g]:false;if(S){t.each(S.typeInfo.property,function(t,r){if(r.name===E){c=r;e.isComplexField=true;e.complexParent=S;if(S.typeInfo.isDerived)e.editable=false;if(i&&o){e.complexInReference=true;if(y.major<=3){e.referenceParentId=o+"/"+a.substring(0,a.length-r.name.length-1);i[o]=true}}}})}}return c}coerceRequestedFields(e){return e}getPropertiesOfEntity(e){if(e.property&&e.property.length){return e.property}else if(e.typeInfo&&e.typeInfo.property){return e.typeInfo.property}return[]}getFieldsFromEntityType(e,a,r,i,n){n=n?n:{};let o=this,s=o.processFullyQualifiedName(a).nameSpace,l=o.getPropertiesOfEntity(e),u=n.requestedFields,c=n.selects,d=n.expands,f,p=o.getSchema(r,s);o._buildEntitySpecificMaps(e,p,r);if(!u){u=[];if(l){t.each(l,function(){let e={id:this.name};u.push(t.extend({},this,e))})}if(e.navigationProperty){t.each(e.navigationProperty,function(){let e=false;if(this.type&&this.type.indexOf(k)===0){e=true}u.push({id:this.name,isArray:e})})}}else{f={};t.each(u,function(e,t){f[t.id]=t});t.each(o.getKeyFields(e,r),function(e,a){if(!f[a.id])u.push(t.extend(a,{idField:true}))})}u=o.coerceRequestedFields(u);return t.map(u,function(t){let a=o.buildFieldMetadata(t,e,d,c,s,i);if(!a)return;if(c){o.populateSelect(c,d,t,a)}return a})}supportsToLowerForFilters(){return true}coerceFieldMetadata(){}getFilterStringFromCondition(e,t,r){r||(r={});let i=this,n=r.version||{major:1},o=r.fieldsMetadata||[],s,u=function t(a){return i.getURLFormattedValue(a,s.edmtype,n,e)},c,d,f,p,m=n.major<4,y,g=e.field,h=function e(t,a,r){t=t.split(l).join("/");r=F(r)?d:r;return t+" "+(a||"eq")+" "+r},b=function e(t,a,r){t=t.split(l).join("/");let i=d;return a+"("+(r===true?i:t)+","+(r===true?t:i)+")"},E=function e(t,a,r){t=t.split(l).join("/");let n=d;if(i.supportsToLowerForFilters()){t="tolower("+t+")";n=n.toLowerCase()}return a+"("+(r===true?n:t)+","+(r===true?t:n)+")"},S=function e(t){let r=[];a(p,function(){if(this){r.push("("+h(t,"eq",this)+")")}});return"("+r.join(" or ")+")"},M={"=":function e(t){return h(t,"eq")},"!=":function e(t){return h(t,"ne")},gt:function e(t){return h(t,"gt")},lt:function e(t){return h(t,"lt")},gte:function e(t){return h(t,"ge")},lte:function e(t){return h(t,"le")},contains:m?function(e){return E(e,"substringof",true)}:function(e){return E(e,"contains")},"does not contain":m?function(e){return E(e,"not substringof",true)}:function(e){return E(e,"not contains")},"starts with":function e(t){return b(t,"startswith")},"does not start with":function e(t){return b(t,"not startswith")},"ends with":function e(t){return b(t,"endswith")},"does not end with":function e(t){return b(t,"not endswith")},in:function e(t){return S(t)},"not in":function e(t){return"not "+S(t)},">":function e(t){return M.gt(t)},">=":function e(t){return M.gte(t)},"<":function e(t){return M.lt(t)},"<=":function e(t){return M.lte(t)}};if(e.inactive)return"";if(e.type==="group"){return i.getFilterStringFromConditions(e.subConditions,e.subConditionLogic,t,r)}s=i.getFieldMetadataFromConditionField(g,o,t);if(!s)return"";if(s.ref&&s.keyField){g=e.field+"."+s.keyField;s=i.getFieldMetadataFromConditionField(g,o,t)}c=i.coerceConditionValue(e.value,s);d=c&&u(c);f=e.values;p=f&&f.map&&f.map(u);y=M[e.operator];return y?y(g):""}coerceConditionValue(e){return e}getFieldMetadataFromConditionField(e,t,r){let i=this,n={},o=e.split("."),s,l=r.dataSource,u=l&&l.metadata;a(t,function(e,t){n[t.id]=t});if(n[e])return n[e];s=n[o[0]];if(!s||!s.ref||o.length<2)return;let c=s.ref,d=i.getEntityType(c,u),f=i.getFieldsFromEntityType(d,c,u,l);o.shift();return i.getFieldMetadataFromConditionField(o.join("."),f,r)}getFilterStringFromConditions(e,a,r,i){let n=this,o="";let s=t.map(e,function(e){let t=n.getFilterStringFromCondition(e,r,i);return t||"!!"});if(s.length){if(!a){a=t.map(e,function(e,t){if(e.inactive!==true)return t+1+""}).join(" and ")}if(a){o=c.makeConditionLogicString(a,s,{customAndString:" and ",customOrString:" or "});o=o.replace(/\(\)/g,"");if(o.indexOf("!!")!==-1)o=o.replace(/(((AND)|(OR)) ?!!)|(!! ?((AND)|(OR)))|!!|\(!!\)/gi,"").trim();o=G(o)}}return o}getItemForDML(a,r,i){let n=a.edmtype,o=c.adjustValueBasedOnQuotedness,s=function e(t){return S(t)===false?""+t:t},l;if(n==="Edm.Binary"){r=window.btoa(r)}else if(t.inArray(n,["Edm.Boolean","Edm.Byte","Edm.Double","Edm.Int16","Edm.Int32","Edm.SByte","Edm.Single"])!==-1){r=o(r,false)}else if(t.inArray(n,["Edm.Decimal","Edm.Guid","Edm.Int64","Edm.String"])!==-1){if(i.major<4||n==="Edm.String"){r=s(r)}else if(n==="Edm.Int64"||n==="Edm.Decimal"){r=o(r,false)}}else if(n==="Edm.DateTime"){l=m(r);r=e.time.formatDate("yy-mm-ddT",l)+e.time.formatTime("HH:mm:ss.SSS",l)}else if(n==="Edm.DateTimeOffset"){l=m(r);r=e.time.formatDate("yy-mm-ddT",l)+e.time.formatTime("HH:mm:ss.SSS000Z",l);r=r.slice(0,-2)+":"+r.slice(-2)}return r}getODataLibrary(e){return e[L]}getURLFormattedValue(a,r,i){let n=e.time,o=i.major<4,s=function e(t,a,r){if(r&&i.major>r)return a;return t+"'"+a+"'"},l=function e(t,a,r){if(r&&i.major>r)return a;return a+t},u=function e(t){if(E(t))return parseFloat(t);throw Error('The value "'+t+'" could not be translated to a number.')},d=function e(a){let r;if(c.isDate(a))r=a;else if(E(a))r=new Date(a);else if(S(a)){r=n.parseDateTimeString(a);if(!r)r=n.resolveDateKeyword(a);if(t.isArray(r))r=r[0]}if(!r)throw Error('The value "'+a+'" could not be translated to a date.');return r},f=function e(t){let a=c.userLocale.decimalsSeparator;if(t.indexOf(a)===-1)return t;let r=new RegExp("\\"+a+"?0+$");return t.replace(r,"")},p;if(a===null)p="null";else if(r==="Edm.Boolean")p=a?"true":"false";else if(r==="Edm.Byte")p=u(a).toFixed(0);else if(r==="Edm.DateTimeOffset")p=s("datetimeoffset",d(a).toISOString(),3);else if(r==="Edm.Decimal")p=l("M",f(u(a).toFixed(20)),3);else if(r==="Edm.Double")p=l("D",u(a).toString(),3);else if(r==="Edm.Guid")p=s("guid",a,3);else if(r==="Edm.Int16")p=u(a).toFixed(0);else if(r==="Edm.Int32")p=u(a).toFixed(0);else if(r==="Edm.Int64")p=l("L",u(a).toFixed(0),3);else if(r==="Edm.Float"&&o||r==="Edm.Single")p=l("F",u(a).toString(),3);else if(r==="Edm.SByte")p=u(a).toFixed(0);else if(r==="Edm.DateTime"&&o)p=s("datetime",d(a).toISOString().slice(0,-1),3);else if(r==="Edm.Date"&&!o)p=d(a).toISOString().split("T")[0];else if(r==="Edm.TimeOfDay"&&!o)p=d(a).toISOString().split("T")[1].slice(0,-1);else p="'"+K(""+a).replace("'","''")+"'";return p}getIndividualKeyFormatted(e,t,a,r){return this.getURLFormattedValue(a[e],t.edmtype,r)}getKey(e,a,r,i){let n=a.key,o=this,s;if(t.isArray(n))n=n[0];if(n){if(n.propertyRef.length>1){return t.map(n.propertyRef,function(t){return t.name+"="+o.getIndividualKeyFormatted(t.name,i[t.name],e,r)}).join(",")}else{s=n.propertyRef[0].name;if(!F(e[s])){return o.getIndividualKeyFormatted(s,i[s],e,r)}}}else{return""+(e.Id||e.ID||e.id)}}getKeyFields(e){let a={},r=e.key;if(t.isArray(r))r=r[0];if(r&&r.propertyRef){t.each(r.propertyRef,function(t,r){a[r.name]={id:r.name,entityType:e}})}return a}getKeyFieldsInOrderedList(e){let a=[],r=e.key;if(t.isArray(r))r=r[0];if(r&&r.propertyRef){a=t.map(r.propertyRef,function(t){return{id:t.name,entityType:e,edmtype:e.propertyMap[t.name].type}})}return a}getMetadata(e){let t=this;return z(e.dataSource).then(function(){return t.queryMetadata(e)})}getModelProperties(t,a,r){let i=this,n=i.getServiceVersion(r),o=e.builder.core,s=t.get("xmlState"),u=o.getUnsavedChangesWarningProperty({component:t}),d=o.getCoreModelBasicProperties({component:t,propViewer:a}),f=[];d.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,dataSourceName:s.attr("datasource")||s.attr("service"),label:"External Object Name",showLabelInTextInput:true,onChange(e){if(e&&(!s.attr("label")||!s.attr("labelplural"))){let a=e.split(l).pop();if(!s.attr("label"))s.attr("label",a);if(!s.attr("labelplural"))s.attr("labelplural",a+(c.endsWith(a,"s")?"":"s"));t.save()}}});if(n&&n.major===4){d.push(o.getModelTypeProperty({component:t}))}Array.prototype.push.apply(d,o.getModelLabelProperties());d.push(o.getModelQueryOnPageLoadProperty({component:t,propViewer:a}),o.getAsyncLoadProperty({component:t}),o.getModelLimitProperty(),o.getModelOrderByProperty(),o.getCreateDefaultRowProperty(),o.getModelNameFieldProperty());if(u)f.push(u);f.push(o.getDeferFieldRenderingProperty(true));f.push(o.getFieldsToDeferProperty(t));return[{name:"Basic",props:d},{name:"Advanced",props:f}]}getAggregateFieldProperties(t,a){const r=t.get("xmlState"),i=e.builder.core;return[{id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:true,picklistEntries:V.map(e=>({label:e,value:e.replace(" ","")})),onChange(e){if(e){r.attr("name",i.getDefaultAliasName(r.attr("id"),e))}t.save().refresh().rebuildProps(a)}}]}getNameField(e,t){let a=this,r=t&&t.metadata,i,n,o,s;if(r){i=a.getEntitySet(e,r);n=a.getEntityTypeFromEntitySet(i,e,r);s=Object.keys(a.getKeyFields(n));if(n.nameField)o=n.nameField;else if(s&&s.length>0){o=s[0]}}return o}getRowName(e,t,a){return t.getFieldValue(e,a.getNameField(t.objectName),true)}getRowId(e,t,a){let r=t.fields.length&&t.fields.filter(function(e){return e.idField})[0];if(r)return e[r.id];else{let r=a.metadata,i=r&&this.getEntitySet(t.objectName,r),n=r&&this.getEntityTypeFromEntitySet(i,t.objectName,r),o=this.getServiceVersion(a);return this.getKey(e,n,o,t.fieldsMap)}}getEntityContainerToList(){}getEntityList(e){let t=this,a=h();t.authenticateAndGetMetadata(e).then(function(r){a.resolve(t.getEntitySetList(r,e))},function(e){if(typeof e==="string")a.reject(e);else{let t=e.response,r=t.error;a.reject(r,t)}});return a.promise()}getEntityLabel(e,t){let a=t.metadata,r=a&&this.getEntitySet(e,t.metadata);if(r)return r.label}getPropertyByName(e,t){let a=this,r,i,n;if(e.propertyMap){n=e.propertyMap[t];if(!n)n=e.navigationPropertyMap&&e.navigationPropertyMap[t];if(n)i=n}else{r=a.getPropertiesOfEntity(e);i=r.concat(e.navigationProperty).filter(function(e){if(!e)return false;return t===e.name})[0]}return i}getPropertyDef(e,t,a,r,i,n){let o=this,s=e.split(l),u=o.getPropertyByName(t,s[0]);if(s.length===1){if(r&&i.navigationPropertyMap[s[0]]){r[s[0]]=true}return u}else{let e=o.getEntityTypeNameFromRefPropDef(u,a);let t=o.getEntityType(e,a);if(r){if(i.navigationPropertyMap[s[0]]){r[(n&&n+"/"||"")+s.slice(0,s.length-1).join("/")]=true}}s.shift();return o.getPropertyDef(s.join(l),t,a,r,i,n)}}getRefConstraintsFromAssociation(e,a){let r=[];if(e.referentialConstraint){t.each(e.referentialConstraint,function(e,i){if(i.role===a){t.each(i.propertyRef,function(){r.push(this)})}})}return r}getRowForItem(e,a,r,i){let n=this,o={};t.each(r,function(t,r){const i=r.name?r.name:r.id;if(r.id.indexOf(l)!==-1){c.setObjectProperty(o,i,n.getFieldDataForItem(e,r,i,a))}else{o[i]=n.getFieldDataForItem(e,r,i)}});J(o,e,i);return o}getServiceVersion(e){if(e.metadata&&e.metadata.skuidVersion)return e.metadata.skuidVersion;let t=e&&e.getConfigProperty("odata-version")||"1.0",a=(t+"").split(l),r=parseFloat(a[0]),i=parseFloat(a[1]),n=parseFloat(a[2]),o={major:isNaN(r)?0:r,minor:isNaN(i)?0:i,patch:isNaN(n)?0:n};o.stringRep=[o.major,o.minor].join(l);return o}getApplyClause(e){let t=e.fields.filter(e=>e.function),a=e.groupByFields,r="aggregate(".concat(t.map(e=>{let t=e.function.toLowerCase();if(t==="count"){return"$count as ".concat(e.name)}else if(t==="avg"){t="average"}return"".concat(e.id," with ").concat(t," as ").concat(e.name)}).join(","),")");if(!a.length>0)return"$apply=".concat(r);else{return"$apply=groupby((".concat(a.map(e=>{return e.id.replace(/\./g,"/")}).join(),"), ").concat(r,")")}}getSelectClause(e){let t=Object.keys(e);if(t.length)return"$select="+t.join(",")}getExpandClause(e){let t=Object.keys(e);if(t.length)return"$expand="+t.join(",")}getOrderByClause(e){if(e.orderByClause)return"$orderby="+e.orderByClause.replace(/nulls first/gi,"").replace(/nulls last/gi,"").replace(/asc/gi,"asc").replace(/desc/gi,"desc")}getFilterClause(e,t,a,r){let i=this,n=i.getFilterStringFromConditions(e,t.conditionLogic,t,{version:a,fieldsMetadata:r});if(n)return"$filter="+n}getSkipClause(e){let t=e.offsetPageNumber,a=e.offsetPageSize;if(t>1&&a>0){return"$skip="+(t-1)*a}}getTopClause(e){let t=e.offsetPageSize||e.recordsLimit;if(t===0||t>0)return"$top="+(parseInt(t,10)+1)}createQualifiedURL(e,t,a,r,i,n){let o=this,s=[],l=e.getDataSource(),u,c=y(l.serviceUrl,n.name),d,f=e.isAggregate||false;if(!l)return;u=o.getServiceVersion(l);if(f&&u.major===4){s.push(o.getFilterClause(t,e,u,a));s.push(o.getApplyClause(e));s=s.filter(e=>!!e);if(s.length)c+="?"+encodeURI(s.join("&"))}else{if(u.major>3){d=Y(r,i)}else{d=o.getExpandClause(r)}s.push(d);s.push(o.getSelectClause(i));s.push(o.getOrderByClause(e));s.push(o.getFilterClause(t,e,u,a));s.push(o.getSkipClause(e));s.push(o.getTopClause(e));s=s.filter(e=>!!e);if(s.length)c+="?"+encodeURI(s.join("&"))}return c}cacheEntityFieldMetadataForModel(e){let a=this,r=e.getDataSource(),i=r.metadata,n=W(e,a);t.each(n,function(e){if(r.getCachedEntityMetadata(e))return;let t=a.getEntityType(e,i);let n=a.getFieldsFromEntityType(t,e,i,r);r.cacheEntityMetadata(e,{objectName:e,label:e,labelPlural:e,fields:n})})}cacheFieldsOfEntity(e,t,a,r,i){let n=this,o=e.objectName,s=e.label||o,l=e.labelPlural||o,u=e.dataSource,c=n.getEntitySet(o,a);o=c&&c.entityType||o;i=i||0;r=r||{};if(u.getCachedEntityMetadata(o))return;r[o]={objectName:o,label:s,labelPlural:l,fields:t};u.cacheEntityMetadata(o,{objectName:o,label:s,labelPlural:l,fields:t});if(i>5)return;for(let e=0;e<t.length;e++){let s=t[e];if(!s.ref)continue;if(r[s.ref]){continue}o=s.ref;let l=n.getEntityType(o,a),c=n.getFieldsFromEntityType(l,o,a,u);n.cacheFieldsOfEntity({dataSource:u,objectName:o},c,a,r,i+1)}}getConditionsOfODataModel(e){return t.map(e.conditions,function(t){let a=e.getConditionValueResult(t);if(!t.originalValue)t.originalValue=a.value;return t})}coerceModelMetadata(e,t){if(t.abstract==="true"){e.createable=false;e.updateable=false;e.deleteable=false}}loadIndividualModel(e,a,r){let i=this,n=a.metadata,o=e.objectName,s=e.label||o,l=e.labelPlural||o,u=e.orderByClause,c={},d={},f={},p,m,y,g,h,b,E=e.offsetPageSize||e.recordsLimit,F,M;if(!o){return C("No object name specified for Model: "+e.id)}t.each(e.fields,function(a,r){if(t.isArray(e.deferredFields)&&t.inArray(r.id,e.deferredFields)>-1){r.defer=true;e.fieldsMap[r.id].defer=true}});m=i.getEntitySet(o,n);y=i.getEntityTypeFromEntitySet(m,o,n);b=i.getConditionsOfODataModel(e);g=i.getFieldsFromEntityType(y,o,n,e.dataSource,{requestedFields:e.fields,selects:c,expands:d,applies:f});h=i.getFieldsFromEntityType(y,o,n,e.dataSource);i.cacheEntityFieldMetadataForModel(e);if(e.deferFieldRendering){t.each(g,function(e,t){if(t.defer)delete c[t.id]})}try{p=i.createQualifiedURL(e,b,h,d,c,m)}catch(e){if(S(e)&&e.indexOf("could not be translated")!==-1){return C(e)}throw e}M={label:s,labelPlural:l,accessible:true,createable:true,updateable:true,deleteable:true,fields:g,soql:p,conditions:b,recordsLimit:E,objectName:o,orderByClause:u};i.coerceModelMetadata(M,y);if(e.doQuery===false){return x(M)}F={requestUri:p,model:e};if(r){t.extend(true,F,r)}return i.fetchData(a,F,y,g,E).then(function(e){t.extend(M,e);return M})}makeODataRequest(e,t,a={},r=false){let i=this,n=a.method||"read",o=a.handler||"",s=n!=="read"||a.tupleResponse,l=a.excludeMetadata,u=i.getODataLibrary(e),c=h();u[n](t,function(){c.resolve(s?arguments:arguments[0])},function(){const n=arguments[0];const o=n.response?i.getErrorFromErrorBody(n.response.body,n.response):n;if(!r&&(o.code===401||o.code===403)){e.invalidateAuthentication();return e.authenticate().then(()=>{return i.makeODataRequest(e,t,a,true)}).then(function(){c.resolve(s?arguments:arguments[0])}).catch(function(){c.reject(s?arguments:arguments[0])})}c.reject(s?arguments:n)},o?u[o]:undefined,e.httpClientOfDataSourceType,l?undefined:e.metadata);return c.promise()}coerceRequest(){}fetchData(e,a,r,i,n){let o=this,s=o.getServiceVersion(e);return o.makeODataRequest(e,a).then(function(e){let l,u=false,c=s.major<4?e.results:e.value;if(c&&t.isArray(c)){l=t.map(c,function(e){return o.getRowForItem(e,r,i.filter(function(e){return e.query!==false}),s,M(i,"id"))})}else if(!c&&a.singleRow){l=e}else{l=[]}if(n&&l.length>n){u=true;l.pop()}return{data:l,canRetrieveMoreRows:u}}).catch(e=>{if(e.response){e.response.requestUri=a.requestUri}throw e})}makeAdditionalQueries(a,r){let i=this,n=function e(){let r={};t.each(a.deferredFields,function(e,t){r[t]=true});return r},o=a.dataSource,s=o.metadata,l=i.getServiceVersion(o),u=a.objectName,c=i.getEntitySet(u,s),d=i.getEntityTypeFromEntitySet(c,u,s),f=i.getFieldsFromEntityType(d,u,s,o,{requestedFields:a.fields,selects:n()}),p={requestUri:l.major<4?r.__metadata.uri:r["@odata.id"],singleRow:true};i.coerceAdditionalQueries(p);return i.fetchData(o,p,d,f).then(function(t){a.fields.map(function(e){if(e.defer&&t.data[e.id])r[e.id]=t.data[e.id]});e.events.publish("odata.deferred.loaded",[r]);return{row:r,model:a}})}coerceAdditionalQueries(){}getEntitySetFromEntityTypeName(e,t){let a=this,r=a.processFullyQualifiedName(e),i=a.getFlatEntitySetList(t);let n=i.filter(function(i){let n=a.getEntitySet(i,t),o=a.processFullyQualifiedName(n.entityType);return n.entityType===e||n.entityType===r.name||o&&o.name===e})[0];return n&&a.getEntitySet(n,t)}load(e,r){const i=this,n=r.dataSource;return i.authenticateAndGetMetadata(r,e).then(()=>i.getExtraEntityMetadata(n,e)).then(function(){a(e,function(e,t){let a=t.objectName;if(!a)return;let r=i.getEntitySet(a,n.metadata);if(r)return;r=i.getEntitySetFromEntityTypeName(a,n.metadata);t.objectName=r.name});return Promise.all(t.map(e,e=>i.loadIndividualModel(e,n,r))).catch(e=>C(i.produceErrorTextFromErrors(e)))})}produceErrorTextFromErrors(e){let t="There was a problem with an OData Query: ";const a=e=>{let a=this.getErrorFromErrorBody(e.message?e:e.response&&e.response.body,e.response);if(a&&e.response){t+=(a.code?a.code+" - ":"")+a.message;if(e.response.requestUri){t+=" - Request URL: "+e.response.requestUri}}else if(S(e)){t+=e}};if(Array.isArray(e))e.forEach(a);else a(e);return t}processFullyQualifiedName(e){let t=e.split(l);return{name:t.pop(),nameSpace:t.join(l)}}supportsBatch(e){let t=(e.getConfigProperty("supports-batch")||"false")==="true";return c.resolve(t)}search(a,r,i){let n=this,o=t.map(a.returning,function(e){let t=i[e.modelName];if(!e.fields)e.fields=[];t.searchFields=e.fields;return t}),s=h();return n.getEntityMetadata({dataSource:a.dataSource,entities:o}).then(function(r){t.each(r,function(e,r){let i=o[e],n=1;t.each(i.searchFields,function(i,s){t.each(r.fields,function(r,l){s=S(s)?s:s.id;if(s===l.id){if(l.filterable){let r=false;t.each(o[e].conditions,function(t,i){if(i.name==="__global_search_"+n){r=true;o[e].conditions[t].value=a.query}});if(!r){o[e].addCondition({name:"__global_search_"+n,sourceType:"param",sourceParam:"search",value:a.query,field:s,operator:"contains",encloseValueInQuotes:true,inactive:false})}n++}o[e].fields[i]=l}})});if(!i.conditionLogic){i.conditionLogic=i.conditions.map(function(e,t){if(e.inactive!==true)return t+1+""}).join(" OR ")}else{i.conditionLogic=i.conditionLogic.replace("AND","OR")}});return n.load(o,{dataSource:e.dataSource.getDataSource(a.dataSourceName),loadAllMetadata:true,performingSearch:true,ignoreCache:true}).then(function(e){return s.resolve({request:a,results:e.map(function(e){const t=a.returning[e.objectName];return{label:e.label,labelPlural:e.labelPlural,objectName:i[t.modelName].objectName,objectMapKey:t.objectMapKey,modelName:t.modelName,records:e.data}})}).promise()})})}propertyHasExtension(e,t){if(!e.extensions)return false;return e.extensions.filter(function(e){return e.name===t}).length>0}createPropertyExtensionsMap(e){let a={};if(!e.extensions)return;t.each(e.extensions,function(e,t){if(!t.name||typeof t.value==="undefined"){return true}a[t.name]=t.value});return a}_expandBaseTypeForEntity(e,t,a,r){if(!e||!t)return[];let i=this,n=e.baseType,o=a.dataServices,s=e.hasExpandedBaseType,u=e.__namespace,c,d,f,p,m,y,g;r=r||{};if(!n||s){return{properties:e.property||[],navigationProperties:e.navigationProperty||[],key:e.key}}if(n.indexOf(l)!==-1){d=n.split(l);c=d.slice(0,d.length-1).join(l);f=n.substring(c.length+1)}if(c){y=o.aliasMap[c];c=y||c;e.baseType=c+l+f;g=i.getSchema(a,c);p=g&&g.entityTypeMap[f]}else{p=i.getSchema(a,u).entityTypeMap[n];c=u}if(!p){return{properties:e.property||[],navigationProperties:e.navigationProperty||[],key:e.key}}if(r[c+l+p.name]){return{properties:e.property||[],navigationProperties:e.navigationProperty||[],key:e.key}}r=X(c+l+p.name,r);e.hasExpandedBaseType=true;m=i._expandBaseTypeForEntity(p,i.getSchema(a,c),a,r);e.property=(e.property||[]).concat(m.properties);e.navigationProperty=(e.navigationProperty||[]).concat(m.navigationProperties);e.key=m.key||e.key;return{properties:e.property,navigationProperties:e.navigationProperty,key:e.key}}_buildEntitySpecificMaps(e,t,a){let r=this,i,n=a.dataServices;if(e.builtMaps)return;i=r._expandBaseTypeForEntity(e,t,a);e.property=i.properties;if(i.navigationProperties&&i.navigationProperties.length){e.navigationProperty=i.navigationProperties}e.key=i.key;r._setMapOfPropertiesOfEntityType(e,a);r._setMapOfNavigationPropertiesOfEntityType(e,n);e.builtMaps=true}_buildMetadataMaps(e,r){let i=this,n=r.major<4,o=e.dataServices,s;g([o],"schema","schemaMap","namespace",{addKeyRelationships:false});g(o.schema,"entityType","entityTypeMap","name",{addKeyRelationships:false});g(o.schema,"action","actionMap","name",{addKeyRelationships:false});g(o.schema,"function","functionMap","name",{addKeyRelationships:false});s=o.schema;o.aliasMap={};i._setComplexTypeMap(e);i._setEnumTypeMap(e);if(n){g(s,"association","associationMap","name",{addKeyRelationships:false});g(s,"entityContainer","entityContainerMap","name",{addKeyRelationships:false})}a(s,function(e,a){let r,i,s,l;if(a.alias){o.aliasMap[a.alias]=a.namespace}if(n){i=a.entityContainer}else{a.entityContainerMap={};i=(r=a.entityContainer)&&(a.entityContainerMap[r.name]=r)&&[r]}if(i){g(i,"entitySet","entitySetMap","name",{addKeyRelationships:false});s=a.entitySetMap={};t.each(i,function(){t.extend(s,this.entitySetMap)});if(n){g(i,"associationSet","associationSetMap","name",{addKeyRelationships:false});l=a.associationSetMap={};t.each(i,function(){t.extend(l,this.associationSetMap)})}}t.each(a.entityTypeMap,function(e,t){t.__namespace=a.namespace})})}getBatchSupport(e){return b(e,"metadata.skuidSupportsBatch")}attachHttpClientToDataSource(a,r){let i=this,n=i.getODataLibrary(a),o=i.getServiceVersion(a).major<4;a.httpClientOfDataSourceType={request(s,l,u){let d=s.dataSource||a,f=t.extend(s.headers,r.headers),p,m=i.getServiceVersion(d),y=i.getBatchSupport(a),g;if(o&&!y){f.DataServiceVersion=m.stringRep;f.MaxDataServiceVersion=m.stringRep}g={body:s.body,url:s.requestUri,method:s.method,headers:f};if(!y){g.contentType="application/json;odata=verbose"}i.coerceRequest(g,s);p=d.createHTTPRequest(g);if(!d.useProxy){t.extend(s,{requestUri:p.url,body:p.body,headers:p.headers});return n.defaultHttpClient.request(s,function(e){i.coerceResponse(e,s.model);l(e)},function(e){u(e)})}else{if(d.authentication&&d.authentication.success){p.isAuthenticated=true}return e.ajax.proxy(p).then(function(e){let a=e?e.headers:null;if(m.major===3){let r;t.each(["Content-Type","content-type"],function(e){if(a[e]){r=a[e];return false}});if(r&&r.slice(0,16)==="application/json"){let a=r.split(";");let i=false;t.each(a,function(){if(this.slice(0,5)==="odata"){i=true;return false}});if(!i){e.headers["Content-Type"]=r+";odata=minimalmetadata"}}}let r={requestUri:s.requestUri,statusCode:e.statusCode,statusText:e.status,headers:e.headers,body:e.body instanceof Document?c.getXML(e.body):e.body};if(i.getStatusCode(e)==="2"){i.coerceResponse(r,s.model);l(r)}else{u(e.status,r)}}).catch(function(e){u({response:e})})}}}}coerceResponse(){}trimMetadataForCache(e){let t=e.dataServices;let r=["aliasMap","complexTypeMap","enumTypeMap","schemaMap"];a(r,function(e,a){delete t[a]});r=["entityContainerMap","entitySetMap","entityTypeMap","functionMap","actionMap"];a(t.schema,function(e,t){a(r,function(e,a){delete t[a]});a(t["entityType"],function(e,t){delete t["navigationPropertyMap"];delete t["propertyMap"];delete t["builtMaps"]});if(c.isObject(t["entityContainer"])){delete t["entityContainer"].entitySetMap}else{a(t["entityContainer"],function(e,t){delete t.entitySetMap})}})}queryMetadata(e){let a=this,r=h(),i=e.dataSource,n=e.minimalOnly,o=a.getServiceVersion(i),s=function e(t){let r=h();if(a.populateExtraServersideCachedMetadata){a.populateExtraServersideCachedMetadata(t).then(function(e){r.resolve(e)})}else r.resolve();return r.promise()};function l(e,t,n){let l=e&&e.dataServices,u,c;n=n||{};u=n.minimalOnly;c=n.fromSource;if(e)e.skuidVersion=o;if(l){a._buildMetadataMaps(e,o);i.metadata=e;let t=c?s(i,u):x();t.then(function(){return a.supportsBatch(i).then(function(t){e[B]=t;if(!u)return r.resolve(e).promise();a.trimMetadataForCache(e);i.fetchingMetadata=false;return r.resolve(e).promise()},function(){e[B]=false;i.fetchingMetadata=false;r.resolve(e)})})}else{if(t){if(t.statusText==="OK"){return r.reject("Unable to parse metadata. Is your OData version correct?",t).promise()}return r.reject(t.statusText+": "+t.body,t).promise()}else{r.reject("Attempted to pull from datasource cache, but failed")}}}if(i.metadata){return x(i.metadata)}else if(i.fetchingMetadata){return i._metadataFetch}i.fetchingMetadata=true;a.attachHttpClientToDataSource(i,e);function u(){return a.makeODataRequest(i,{requestUri:a.buildResourceUri(i,ee)},{tupleResponse:true,handler:"metadataHandler",excludeMetadata:true}).then(([e,t])=>{l(e,t,{minimalOnly:n,fromSource:true})}).catch(([e,t])=>{r.reject(e,t)})}function c(e){e.setPersistentCacheProperties({version:null});return t.get("/api/v1/datasource-metadata?datasource=".concat(e.name,"&cache=").concat(e._metadataCacheVersion)).then(function(t){e.setPersistentCacheProperties({version:e._metadataCacheVersion});return JSON.parse(t)})}if(!i._metadataCacheVersion||n){u()}else{let e=i.getCacheProperties(["url","version"]);if(e.version!==i._metadataCacheVersion){i.setPersistentCacheProperties({version:null})}c(i).then(l).catch(u)}i._metadataFetch=r.promise();return i._metadataFetch}coerceSaveItemRequest(){}coerceChanges(){return false}getUpdateMethod(e){if(!this.getBatchSupport(e)){return this.getServiceVersion(e).major<3?I:N}return this.getServiceVersion(e).major<4?I:N}itemNeedsIfMatchHeader(e){return!!(e.__metadata&&e.__metadata.etag)}getItemChanges(e,a,r,i){let n=this,o={},s=n.getServiceVersion(i),l=s.major<4;t.each(a,function(t,a){let r=e.getField(t);if(r.displaytype==="REFERENCE"){let e=n.getEntitySetFromEntityTypeName(r.ref,i.metadata);if(l){o[t]={__metadata:{uri:a?e.name+"("+a[r.keyField]+")":null}}}else{o[t+"@odata.bind"]=a?e.name+"("+a[r.keyField]+")":null}}else{o[t]=n.getItemForDML(r,a,s)}});return o}save(a,r){let i=this,n=h(),o=r.dataSource,s=this.getServiceVersion(o),u=s.major<4,c="application/json;"+(u?"odata=verbose":"odata.metadata=full"),d=i.getUpdateMethod(o),f=[],p=[];function m(){return{Accept:c,"Content-Type":c}}i.authenticateAndGetMetadata(r).then(function(r){if(!a.fromOfflineStorage)return r;t.each(a.operations,function(a,r){let i=e.$M(r.id);if(!i){let a=new e.model.Model({id:r.id,dataSource:o,conditions:[],label:r.type,objectName:r.type,fields:t.map(r.returning,function(e){return{id:e}}),extensions:r.extensions}).initialize().register();let i=[];t.each(r.deletes,function(e){i.push(e)});t.each(r.updates,function(e){i.push(e)});if(i.length){f.push(a)}p.push(a)}});if(!f.length)return r;return e.model.load(f).then(function(){return r})}).then(function(r){let o=[];t.each(a.operations,function(n,c){let f=e.$M(c.id),p=f.getDataSource(),y=[],g=[],b=i.getEntitySet(c.type,r),E=i.getEntityTypeFromEntitySet(b,c.type,r),S={},F=0,M=h(),T=[],v=[],R=[],C={deleteResults:T,insertResults:v,updateResults:R,totalsuccess:true};o.push(M);function j(e,t,a){return{operationType:e,dataSource:p,model:f,key:t,row:a,operation:c,entitySet:b,entityType:E,version:s}}i.coerceChanges(c,a,f);t.each(c.deletes,function(e,t){let a=m(),r,n=f.getRowById(e);if(i.itemNeedsIfMatchHeader(n)){a["If-Match"]="*"}if(!u){a["Content-ID"]=""+e}J(t,n,s);i.coerceSaveItemRequest(r={requestUri:b.name+"("+e+")",method:A,__oldid:e,headers:a},j("delete",e,t));y.push(r)});t.each(c.updates,function(e,t){let a=f.getRowById(e),n=i.getItemChanges(f,t,a,p),o=m(),l;if(i.itemNeedsIfMatchHeader(a)){o["If-Match"]="*"}if(!u){o["Content-ID"]=""+e}J(n,a,s);for(let a in n){if(a.indexOf("odata.bind")>-1){let s=a.split("@")[0];let u=t[s];let c=f.getRowOriginals(e);if(c&&u===null){i.coerceSaveItemRequest(l={requestUri:"".concat(b.name,"(").concat(e,")/").concat(s,"/$ref"),method:A,headers:o},j("update",e,t));if(r.skuidSupportsBatch)g.push(l);else y.push(l);delete n[a]}}}i.coerceSaveItemRequest(l={requestUri:b.name+"("+e+")",method:d,data:n,__oldid:e,headers:o},j("update",e,t));y.push(l)});t.each(c.inserts,function(e,t){let a=f.getRowById(e),r=i.getItemChanges(f,t,a,p),n=m(),o=E.__namespace+l+E.name,s,c=S[e];if(!c){F++;S[F];c=F}if(u){r.__metadata={type:o}}else{r["@odata.type"]="#"+o}n["Content-ID"]=""+c;i.coerceSaveItemRequest(s={requestUri:b.name,method:_,data:r,__oldid:e,headers:n},j("insert",e,t));y.push(s)});let D=x();if(i.preSaveHook){D=i.preSaveHook(C,p,y,c)}D.then(function(){let e=[];t.each(y,function(t,a){if(a.data&&a.data.__shouldRemove){e.push(t)}});t.each(e.reverse(),function(e,t){y.splice(t,1)});if(!y.length)return M.resolve(C).promise();if(r.skuidSupportsBatch){y=[y];if(g.length){g.forEach(e=>y.push(e))}return i.handleBatchRequest(C,p,y,c).then(function(e){M.resolve(e)})}return i.handleConcurrentRequests(C,p,y,c).then(function(e){M.resolve(e)})}).catch(function(e){M.reject(e)})});Promise.all(o).then(function(e){let a={insertResults:[],updateResults:[],deleteResults:[],globalErrors:[],totalsuccess:true};t.each(e,function(e,r){t.merge(a.insertResults,r.insertResults);t.merge(a.updateResults,r.updateResults);t.merge(a.deleteResults,r.deleteResults);if(r.totalsuccess===false)a.totalsuccess=false});for(let e=0;e<p.length;e++){p[e].unregister()}n.resolve(a)},function(e){let a=[],r=[];for(let e=0;e<p.length;e++){p[e].unregister()}t.each(e,function(e,t){if(S(t.message))a.push(t.message);if(t.response)r.push(t.response)});n.reject(a,r)})});return n.promise()}getStatusCode(e){return e.statusCode?(e.statusCode+"").substring(0,1):"4"}handleConcurrentRequests(e,t,i,n){let o=this,s=[];a(i,function(a,l){let u=h(),c=r({},l,{requestUri:y(t.serviceUrl,l.requestUri)});s.push(u);return o.makeODataRequest(t,c,{method:"request"}).then(([,t])=>{let r=o.getStatusCode(t);if(r==="4"||r==="5"){e.totalsuccess=false;return u.reject(t.statusCode+" - "+t.statusText+" - "+t.body,t)}o.handleResponse(t,i[a],n,e);u.resolve()}).catch(([t])=>{o.handleResponse(t,i[a],n,e);u.reject(t)})});const l=()=>{return r({globalErrors:[]},e)};return j(s).then(l,l)}handleBatchRequest(e,a,i,n){let o=this,s=h();o.makeODataRequest(a,{requestUri:o.buildResourceUri(a,te),method:_,data:{__batchRequests:i.map(e=>({__changeRequests:Array.isArray(e)?e:[e]}))}},{method:"request",handler:"batchHandler",excludeMetadata:true}).then(([,a])=>{let l=o.getStatusCode(a);if(l==="4"||l==="5"){s.reject(a.statusCode+" - "+a.statusText+" - "+a.body,a)}else{t.each(a.data.__batchResponses,function(a,r){if(r.__changeResponses){t.each(r.__changeResponses,function(t,r){if(Array.isArray(i[a])){o.handleResponse(r,i[a][t],n,e,true)}else o.handleResponse(r,i[a],n,e,true)})}else{o.handleResponse(r,i[a],n,e,true)}});s.resolve(r({globalErrors:[]},e))}}).catch(([,e])=>{s.reject({message:o.getGenericErrorMessage(),response:e})});return s.promise()}getGenericErrorMessage(){return"Unknown error occured making OData request"}getKeyFieldsFromEntityId(e,t,r){let i=this,n=r.metadata,o=i.getServiceVersion(r),s=e.match(/[^()]+(?=\))+/g),l=i.getKeyFieldsInOrderedList(t,n),u={};if(!s)return{};s=s.pop().split(",");a(s,function(e,t){let a=t.indexOf("=");if(a!==-1){let e=t.substring(0,a);let r=t.substring(a+1);u[e]=r}else{u[l[e].id]=t}});a(l,function(e,t){let a=t.id;u[a]=i.getItemForDML(t,u[a],o)});return u}coerceResponseItemData(){}handleResponse(t,a,i,n,o){let s=this,l=e.$M(i.id),u=l.dataSource,c=u.metadata,d=s.getEntitySet(i.type,c),f=s.getEntityTypeFromEntitySet(d,i.type,c),p=s.getServiceVersion(u),m=[],y=p.major<4,g=s.getUpdateMethod(u),h=t.data,b=y?h:h&&h.d||h,E=b?s.getRowForItem(b,f,l.fields,p,l.fieldsMap):null,S=E&&s.getKey(E,f,p,l.fieldsMap),F=s.getStatusCode(t),M,T={},v="",R;if(!S&&p.major>3&&t.headers){M=t.headers["OData-EntityId"];if(M){R=s.getKeyFieldsFromEntityId(M,f,u);if(a.data){let e=r({},a.data,R);E=s.getRowForItem(e,f,l.fields,p,l.fieldsMap);S=s.getRowId(E,l,u)}}}if(t instanceof Error){F="2"}if(F==="4"||F==="5"){if(t.stack){if(t.message==="Unexpected end of JSON input"){v+="Service sent back an invalid JSON payload"}else v+=t.message}else{T=s.getErrorFromErrorBody(t.response&&t.response.body,a.response);v="There was a problem with an OData "+(o?"Batch ":"")+"Request: ";if(T){v+=(T.code?T.code+" - ":"")+T.message}}m.push({fields:T.fields||[],message:v,rowId:a.__oldid,severity:"ERROR",status:"OData Error"})}s.coerceResponseItemData(a,t,E,R);if(a.method===g){n.updateResults.push({errors:m,id:a.__oldid,messages:[],record:E&&JSON.stringify(E),source:i.id,success:!m.length})}else if(a.method===_){n.insertResults.push({errors:m,id:S,messages:[],oldId:a.__oldid,record:E&&JSON.stringify(E),source:i.id,success:!m.length})}else if(a.method===A){n.deleteResults.push({errors:m,id:a.__oldid,messages:[],source:i.id,success:!m.length})}if(m.length)n.totalsuccess=false}handleDefaultReferenceFieldValue(e,t,a,r){let i={},n={};if(r.keyField){n[r.keyField]=t.value;i[r.id]=n}a.updateRow(e,i)}getReferenceFieldRelationshipName(e){return e}getReferenceHandler(){let a=this;return{getBaseReferenceProps(e){return[{id:"targetobjects",type:"sobject",label:"Entity Type",readonly:false,dataSourceName:n.getDataSourceFromXML(e.get("xmlState")).name}]},getOverrideBatchProperties(){return[{type:"helptext",html:"Specify fields that will be added as related data. Any fields that are used in search or display templates will need to be added here."}]},getOverrideBatchNoItemsFunction(){return function(){return t("<div>").text("(Loading key field only.)")}},coerceObjectName(e,t){let r=a.getEntitySetFromEntityTypeName(e,t.metadata);return r?r.name:e},getOverrideBatchFieldChildrenFunction(e){return function(){return[{id:"batchfield",indent:1,linkedComponent:e,addtooltip:"Add Field",labelFunction(e){return e.attr("field")||"[No Field Selected]"},defaultStateFunction(){return v("<batchfield/>")},propsFunction(t){let a=[{id:"field",type:"field",label:"Field",sobject:e.get("xmlState").attr("targetobjects"),dataSourceName:e.get("xmlState").attr("datasource"),onChange(){t.refresh().rebuildProps()}}];return a}}]}},getMetadataHandler(a,r,i,o,s){let l=a.children("batchfields").first();let u=l.children("batchfield");let c=a.attr("keyfield")||"ID";let d=a.attr("targetobjects");let f;let p=a.attr("ogdisplaytype");let m=a.attr("rel")||o+"__r";r.keyField=c;r.originalDisplayType=p;if(d){f=d.split(",");r.isNamePointing=f.length>1;if(s||p&&p!=="REFERENCE"){r.relationshipName=r.rel=m}r.referenceTo=t.map(f,function(e){return{accessible:true,objectName:e}});r.ref=d}if(!s&&p&&p!=="REFERENCE"){let r=n.getDataSourceFromXML(a);let s=new e.model.Model({dataSource:r});s.id="_ReferenceLabelModel_"+(new Date).getTime()+m;if(u&&u.length){s.fields=t.map(u,function(e){return{id:t(e).attr("field")}})}else{s.fields=[{id:c}]}s.doQuery=true;s.doClone=false;s.objectName=d;s.initialize();let l=new e.model.Condition;l.name="__reference_batch";l.operator="in";l.field=c;l.encloseValueInQuotes=false;s.addCondition(l);if(!i.batchLabelModels)i.batchLabelModels={};i.batchLabelModels[o]=s}},getReferenceValue(e,t){return a.getReferenceValue(e,t)},getRowFromReferenceValue(e,t,a){let r=e.getRows([{field:a.keyField||"ID",value:t}]);return r&&r.length?r[0]:{}},processReferenceLookupModel(e,t,a){e.objectName=a}}}getReferenceValue(e,t){return e[t.keyField||"ID"]}onDataSourceChange(e){e.attr("deferfieldrendering",true)}createActions(e){const a=this,r=(e,r,i)=>t.map(e,(e,t)=>{const n=e.parameter!==undefined&&e.parameter.find(e=>{if(e.type.indexOf(k)>-1)return e;if(i.dataServices.complexTypeMap[e.type])return e;if(e.type.indexOf("Edm")===-1&&a.getEntityType(e.type,i)){const t=a.getEntityType(e.type,i);if(t.typeInfo)return e}})!==undefined;if(!n&&e.name.indexOf(r)>-1){return{label:o.makeLabelFromId(e.name),value:t}}}),i=(e,t,r)=>{const i=e.type,n=e.name,o=n.toLowerCase();if(q[i]){return[{id:o,type:"string",label:n,metadata:{id:n,label:n,displaytype:q[i],edmtype:i,minInputLength:1}}]}if(r.dataServices.enumTypeMap[i]){return[{id:o,type:"picklist",label:n,entries:r.dataServices.enumTypeMap[i].picklistEntries}]}const s=a.getEntityType(i,r);if(s){if(s.abstract){let e=[],i=r.dataServices.schemaMap,u=s.__namespace,c=i[u].entityType,d;c.forEach(t=>{if(t.baseType==="".concat(u).concat(l).concat(s.name)){const i=a.getEntitySetFromEntityTypeName(t.name,r);if(i){e.push({value:"".concat(u).concat(l).concat(i.name),label:i.label||i.name})}}});if(e.length===1){d={id:o,label:"".concat(n," Entity Set"),type:"readonly",value:e[0].label}}else{d={id:o,label:"".concat(n," Entity Set"),type:"combobox",showLabelInTextInput:true,onChange:()=>t.refresh().rebuildProps(),entries:t=>{return e.filter(e=>e.label.indexOf(t)>-1)}}}return[d,{id:"".concat(o,"-id"),label:"".concat(n," Id"),type:"text",value:""}]}else{const e=a.getEntitySetFromEntityTypeName(s.name,r);if(e){return[{id:e.name,label:"Entity Set",type:"readonly",value:e.label||e.name},{id:"".concat(e.name.toLowerCase(),"-id"),label:"Entity Set ID",type:"text",value:""}]}}}},n=(e,t,n)=>{let o=e==="action"?a.getActionMap(n):a.getFunctionMap(n),s=e==="action"?a.getActionsList(n):a.getFunctionsList(n),u=t.get("xmlState"),d=u.attr("name"),f=o[d],p=s.filter(e=>"".concat(e.namespace,".").concat(e.name)===d),m=[];m.push({id:"name",label:"".concat(e==="action"?"Action":"Function"," name"),type:"combobox",showLabelInTextInput:true,onChange:()=>{c.removeAllAttrsExcept(u,["datasource","type","actionname","name"]);t.refresh().rebuildProps()},entries:e=>r(o,e,n)});if(f&&f.isBound){if(p.length>1){m.push({id:"bound",label:"Bound Entity Set",type:"combobox",onChange:()=>t.refresh().rebuildProps(),showLabelInTextInput:true,entries:e=>p.map(t=>{let r=t.parameter[0].type,i=a.getEntitySetFromEntityTypeName(r,n);if(i&&i.name.indexOf(e)>-1){return{value:"".concat(t.namespace).concat(l).concat(i.name),label:i.label||i.name}}})},{id:"bound-id",label:"Bound ID",type:"text",value:""})}else{let e=a.getEntitySetFromEntityTypeName(f.parameter[0].type,n);if(e){m.push({id:"bound",label:"Bound Entity Set",type:"readonly",value:e.label||e.name},{id:"bound-id",label:"Bound ID",type:"text",value:""})}}}f&&f.parameter&&f.parameter.map((e,a)=>{if(f.isBound&&a===0)return;const r=i(e,t,n);if(r&&r.length)m.push.apply(m,r)});return m},s=(r,i,n,o,s,u)=>{let c=r==="action"?a.getActionMap(u):a.getFunctionMap(u),d=r==="action"?a.getActionsList(u):a.getFunctionsList(u),f=i.attr("name"),p=a.processFullyQualifiedName(f),m=c[f],y=d.filter(e=>"".concat(e.namespace,".").concat(e.name)===f),g=m&&m.parameter,h=s.serviceUrl,b={},E="",S={};if(h.lastIndexOf("/")!==h.length-1){h+="/"}if(y.length>1&&i.attr("bound")){y.forEach(e=>{let t=e.parameter[0].type,r=a.getEntitySetFromEntityTypeName(t,u);if(r&&"".concat(e.namespace).concat(l).concat(r.name)===i.attr("bound")){m=e;g=m.parameter}})}if(m.isBound){let e=R(i.attr("bound-id"),o);let t=a.getEntityType(m.parameter[0].type,u);let n=a.getEntitySetFromEntityTypeName(t.name,u);h+="".concat(n.name,"(").concat(e,")/").concat(f).concat(m.parameter.length>1&&r!=="action"?"(":"")}g&&g.map((e,n)=>{if(m.isBound&&n===0)return;let l=e.name,c=l.toLowerCase(),d=R(i.attr("".concat(c)),o);if(n===0){if(r==="action")h+=p.name;else if(r=="function"){h+="".concat(p.name).concat(m.parameter.length?"(".concat(l,"=@").concat(c):"");if(g.length>1)h+=",";E+=")?"}}else if(r==="function"){h+="".concat(l,"=@").concat(c);if(g.length-1!==n)h+=",";if(m.isBound&&n===1)E+=")?";else E+="&"}if(q[e.type]==="STRING"){if(r==="function"){E+="@".concat(c,"='").concat(d,"'")}else b[l]=d}else if(q[e.type]==="NUMBER"){if(r==="function")E+="@".concat(c,"=").concat(d);else b[l]=parseInt(d,10)}else if(q[e.type]==="DATE"||q[e.type]==="DATETIME"){if(r==="function")E+="@".concat(c,"=").concat(d);else b[l]=d}else if(a.getEntityType(e.type,u)){const n=a.getEntityType(e.type,u);let d;let f;if(n.abstract){d=a.getEntitySet(i.attr(c),u);f=R(i.attr("".concat(c,"-id")),o)}else{d=a.getEntitySetFromEntityTypeName(e.type,u);f=R(i.attr("".concat(d.name.toLowerCase(),"-id")),o)}if(r==="function"){E+="@".concat(c,'={"@odata.id":"').concat(d.name,"(").concat(f,')"}')}else{let e=t.extend({},o.row);o.model&&o.model.fields.forEach(t=>{if(t.displaytype==="REFERENCE"){let r=a.getEntitySetFromEntityTypeName(t.ref,u);if(e[t.id]){let a=e[t.id][t.id];e["".concat(t.id,"@odata.bind")]="".concat(s.serviceUrl).concat(r.name,"(").concat(a,")");delete e[t.id]}}});delete e.__skuid_record__;b[l]=e}}else{if(r==="function")E+="@".concat(c,"=").concat(d);else b[l]=d}});if(!g)h+=m.name;if(r==="function"){S["requestUri"]=h+E}else if(r==="action"){S["requestUri"]=h;S["data"]=b;S["method"]="POST"}return a.makeODataRequest(e,S).then(e=>({$ODataAction:e}))};return a.authenticateAndGetMetadata({dataSource:e}).then(e=>{let t=a.getFunctionMap(e),r=a.getActionMap(e),i={};if(D(t)){i["function"]={label:"Function",builderProps:t=>n("function",t,e),runtimeExecution:(t,a,r,i)=>s("function",t,a,r,i,e)}}if(D(r)){i["action"]={label:"Action",builderProps:t=>n("action",t,e),runtimeExecution:(t,a,r,i)=>s("action",t,a,r,i,e)}}return i})}}Object.assign(re.prototype,{RESOURCE_TYPES:{RESOURCE_METADATA:ee,RESOURCE_BATCH:te,RESOURCE_ENTITY_SET:ae},properties:{composer:{supports:{childRelationships:false},canFieldsBeSelected:function e(t){if(t.breadcrumb.endsobject){return true}else{return"Select an external object for this Model."}}},canAutoGenerateConditionsFromFields:true,validConditionTypes:["fieldvalue","multiple","param","userinfo","blank","modelmerge"],canConditionsBeGrouped:true,hasGlobalSearchEntities:true}});r(u,{ODataDataSourceTypeBase:re});if(c.runningTests()){re.prototype.unitTestableMethods={removeTrailingAndIfNecessary:G}}})(e)}});return t});