skuid.runtime.registerApi("v2","models/RESTDataSourceTypeBase",function(e){var t=function(e){var t={};function r(n){if(t[n]){return t[n].exports}var o=t[n]={i:n,l:false,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=true;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){if(!r.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:n})}};r.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};r.t=function(e,t){if(t&1)e=r(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s=440)}({440:function(t,r){(function(e){const t=e.$,r=t.extend,n=e.utils,o=n.Deferred,a=n.makeXMLDoc,i=n.parseAsJSONIfString,s=e.dataSource,d=s.utils,u=d.REST,l=s.core||(s.core={}),c=e.model,p=n.contains,f=n.getObjectProperty,h=n.hasObjectProperty,y="extensions",g="x-metadata",m="rest.methods",S="rest.entityName",b="x-entityname";class M extends s.DataSourceType{constructor(e){t.each(["name"],function(t,r){if(!e[r])throw Error("Missing Required Property Error: "+r)});super(e);this.properties=r(true,{},M.prototype.properties);if(e.extendedProperties){r(true,this.properties,e.extendedProperties);delete this.extendedProperties}delete this.getModelProperties}buildEntityMetadataRequest(e){let t=e.model;let r=new c.Model(t);if(e.ignorePathToContent){delete r.pathToContent}r.path=e.path||"";if(e.targetEntity&&e.targetEntity!==r.dataSource.name){r.objectName=e.targetEntity}return r}buildSaveRequests(r){let o=this,a=e.$M(r.id),i=[],s={insert:r.inserts,update:r.updates,delete:r.deletes};function d(r,o){let a=r.method,i=r.request,s=a.changeMapping==="autoprefix",d=(a.sendDataAs||"").toLowerCase(),u={};t.each(o,function(e,t){u[(s?a.changeMappingPrefix:"")+e]=t});if(a.contentType===e.constants.MIME_TYPES.FORM_URL_ENCODED){i.data=n.param(u)}else if(d==="headerperfield"){i.headers=u}else if(d==="queryparamperfield"){i.url+=(p(i.url,"?")?"&":"?")+n.param(u)}else{i.data=u}}function u(e,t,r){return{type:e,originalRecordId:r,originalRecord:a.getRecordById(r).get(),method:t,model:a,row:a.getRowById(r),request:{url:t.url,method:t.verb,contentType:t.contentType}}}t.each(s,function(e,r){let n=o.getMethod(a,e);r&&n&&t.each(r,function(t,r){let a=u(e,n,t);if(e!=="delete"){d(a,r)}o.coerceRequest(a);i.push(a)})});return i}coerceRequest(){}getEntityMetadata(e){return Promise.all(t.map(e.entities,t=>this.getModelMetadata(t,e)))}getModelMetadata(e,t){let r=this,o=e,a=t.dataSource;if(n.isString(o)){o={objectName:o}}if(a&&!o.dataSource)o.dataSource=a;let i=r.getEntityMetadataCacheKey(o);return r.queryEntityMetadata(o,t).then(function(e){if(!e){return[]}let t=e.extensions||(e.extensions={}),o=t.rest||(e.rest={}),a=e.accessible=!!n.size(r.getMethod(e,"query")),s=e.createable=!!n.size(r.getMethod(e,"insert")),d=e.updateable=!!n.size(r.getMethod(e,"update")),u=e.deleteable=!!n.size(r.getMethod(e,"delete")),l=e.searchable=!!n.size(r.getMethod(e,"search"));e.readonly=(a||l)&&!s&&!d&&!u;o.entityName=e.objectName=i;return e})}getEntityMetadataCacheKey(e){if(typeof e==="string")return e;return e.objectName||f(e,"extensions.rest.entityName")}shouldIgnoreCache(e={}){return e.ignoreCache||false}getEntityMetadataLoadingMessageFromBreadcrumb(){return"Loading Data Source metadata..."}getEntityList(){return n.resolve([])}searchableEntities(e={}){let r=o(),n=this,a=[];n.getEntityList(e).then(function(o){t.each(o,function(t,r){n.queryEntityMetadata(r.value,e).then(function(e){if(e.methods.search){a.push(r)}})});r.resolve(a)});return r.promise()}search(r,n,o){let a=this,i=[];t.each(r.returning,function(e,s){let d=false,u=n&&n[e],l=o[s.modelName];l.extensions.rest={entityName:e};t.each(l.conditions,function(e,t){if(t.name==="__global_search"){d=true;if(t.value!==r.query){t.value=r.query}}});if(!d){l.addCondition({name:"__global_search",sourceType:"param",sourceParam:"search",value:r.query,operator:"=",encloseValueInQuotes:false,inactive:false})}if(a.searchProperties&&u){t.each(a.searchProperties(u).conditions,function(e,t){l.addCondition(t)})}i.push(l)});return a.load(i,{dataSource:e.dataSource.getDataSource(r.dataSourceName),loadAllMetadata:true,performingSearch:true,ignoreCache:true}).then(function(e){return e})}getExtendedModelProperties(){return{basic:[],advanced:[],customTabs:[]}}getMethod(e,t){return this.getMethods(e)[t]||{}}getMethods(e){return f(e,y+"."+m)||e.methods||{}}getModelProperties(t,r,o){let a=this,i=e.builder.core,s=i.getUnsavedChangesWarningProperty({component:t}),d=t.get("xmlState"),u=d.attr(b),l=u!==undefined,c=i.getCoreModelBasicProperties({component:t,propViewer:r,isDataSourceLocked:l}),p=[],f=this.prop("composer.hasEntityOptions")!==false;if(f){c.push({id:b,label:"Model Entity",type:"entity",dataSourceName:o.name,readonly:d.attr(b)?true:false,showLabelInTextInput:true,onChange(e,r){if(a.onSelectEntity)a.onSelectEntity(e,r,t,o);t.save()}})}c.push(i.getModelQueryOnPageLoadProperty({component:t,propViewer:r}),i.getAsyncLoadProperty({component:t}),i.getCreateDefaultRowProperty());if(s)p.push(s);p.push(i.getDeferFieldRenderingProperty(true));let h=this.getExtendedModelProperties(u,d,t,o);let y=[];let g=Array.prototype.push;if(n.grab(h,"basic","length")){g.apply(c,h.basic)}y.push({name:"Basic",props:c});if(n.grab(h,"advanced","length")){g.apply(p,h.advanced)}y.push({name:"Advanced",props:p});if(n.grab(h,"customTabs","length")){g.apply(y,h.customTabs)}a.coerceModelPropertyTabs(y);return y}coerceModelPropertyTabs(){}handleSaveResult(e){let t=this,o=[],a=[],s=[],d=[],u=[],l;e.map(function(e){let d=e.operation,c=e.requestContext,p=c.type,y=c.method,g=y.receiveDataAs||"recordinbody",m=e.response,S=m?i(m.body):null,b=m?m.headers:null,M=e.error,E=[],R={errors:u,messages:E,source:d.id},v,x=e.isSuccess,P=y.successIf,q=y.successField,_=y.successValue,C,N;if(x){if(P==="responsefieldispresent"){x=h(S,q)}else if(P==="responsefieldistrue"){x=f(S,q,true)===true}else if(P==="responsefieldequals"){x=f(S,q,true)===_}else if(P==="responseheaderispresent"){x=h(b,q,true)}else if(P==="responseheaderequals"){x=f(b,q)===_}else if(P==="responsebodyequals"){x=S===_}else if(P==="responsebodyisempty"){x=n.isUndefined(S)||S===null}}R.success=x;if(!x){l=true;if(M){u.push({message:M,severity:"ERROR"})}else{v=t.generateErrorMessage(m);if(v){u.push({message:v,severity:"ERROR"})}}}if(p==="insert"){R.oldId=c.originalRecordId;if(x){C=y.createdRecordIdLocation;N={};r(N,c.originalRecord);if(g==="recordinbody"){r(N,S)}else if(g==="idinbodyfield"){R.id=f(S,C)}else if(g==="idinheader"){R.id=f(b,C)}R.record=N}t.coerceSaveResultObject(R,c);a.push(R)}else if(p==="update"){R.id=c.originalRecordId;if(g==="recordinbody")R.record=S;t.coerceSaveResultObject(R,c);s.push(R)}else if(p==="delete"){R.id=c.originalRecordId;o.push(R)}});return{deleteResults:o,globalErrors:d,insertResults:a,totalsuccess:!l,updateResults:s}}getPaginationToken(){}coerceSaveResultObject(){}initialize(e){if(e&&e.fields&&e.fields.length){let r=this,n=r.getEntityMetadataCacheKey(e),o=e.getDataSource&&e.getDataSource(),a=o&&o.getCachedEntityMetadata(n),i,s,d,u;if(!a){return}i=a&&a.getFieldsList&&a.getFieldsList()||[];s=e.fields;d=e.extensions||(e.extensions={});u=d.rest||(d.rest={});let l=t.map(s,function(e){return e.id});t.each(i,function(e,t){if(l.indexOf(t.id)>=0||t.omittable!==false)return;s.push({id:t.id})});t.each(s,function(e,t){r.updateFieldMetadata(t,t.id,a)});u.methods=a&&a.getExtensions&&a.getExtensions(m)}return e}load(e,r){let n=this,o=r.dataSource;r.ignoreCache=n.shouldIgnoreCache(r);return o.authenticate().then(function(){return Promise.all(t.map(e,function(e){if(e.doQuery===false){let a=t.extend({},r,{entities:[e]});return o.getEntityMetadata(a).then(function(t){return n.createNewModelWithMetadata(e,t,r)})}return n.loadSingleModel(e,r)}))})}getEntityFieldsMap(e){let t=this,r=t.prop(g),o=n.grab(r,e,"fields"),a=o&&n.keyBy(o,"id");return a}createNewModelWithMetadata(e,n){let o=n._unwrap(),a=o.fields.reduce(function(e,t){e[t.id]=t;return e},{});let i=r({},o,{fields:t.map(e.fields,function(e){if(e.uiOnly)return t.extend(true,{},e);else return t.extend(true,{},a[e.id],e)})});if(i.extensions&&e.extensions){i.objectName=i.extensions.entityname=e.extensions.entityname;if(i.extensions.rest&&e.extensions.rest){i.extensions.rest.entityName=e.extensions.rest.entityName;if(!i.objectName)i.objectName=i.extensions.rest.entityName}}return i}loadSingleModel(e,r){let n=this,o,a,i,s,d,u,l;let c=t.extend({},r,{entities:[e]});return e.dataSource.getEntityMetadata(c).then(function(t){d=t._unwrap();o=t.getExtensions(S),i=t.getExtensions(m),s=i&&(r.performingSearch?i.search:i.query),u={url:s.url,method:s.verb,contentType:s.contentType},l={type:r.performingSearch?"search":"query",method:s,model:e,request:u,addOnly:c.addOnly};a=n.createNewModelWithMetadata(e,t,r);if(!s){throw Error('No query method found for "'+o+'"')}return n.preLoadHook(l)}).then(function(){n.coerceRequest(l);if(l.addOnly&&e.paginationToken){n.applyPaginationToken(l.request,e.paginationToken)}return n.makeRequest(e,l)}).then(function(t){a.data=n.parseSuccessfulLoadResponse(t,s,a,e,d.fields);let r=n.getPaginationToken(t,s,a,e);if(r){a.canRetrieveMoreRows=true;e.paginationToken=r}else{a.canRetrieveMoreRows=false;delete e.paginationToken}return n.postLoadHook(a,l)}).then(function(){if(r.performingSearch){return{request:{dataSource:e.dataSource},results:[{label:e.label,objectName:e.objectName,objectMapKey:e.objectMapKey,modelName:e.id,records:a.data}]}}if(!e.deferFieldRendering&&l.method.additionalRequests){return Promise.all(a.data.map(function(t,r){return n.makeAdditionalQueries(e,t,s,a).then(function(e){a.data[r]=e.row})})).then(function(){return a})}return a})}applyPaginationToken(){}preLoadHook(){}postLoadHook(){}preSaveHook(){return d.deferrable()}postSaveHook(){}makeAdditionalQueries(t,r,n,a){let i=o(),s=this,d=n||t.extensions.rest.methods.query;if(a)t.fields=a.fields;if(d.additionalRequests){d.additionalRequests.map(function(n){let o={type:"query",method:n,model:t,request:{url:n.url,method:n.verb,contentType:n.contentType},row:r};s.coerceRequest(o);s.makeRequest(t,o).then(function(n){r.__additionalRequestMade=true;s.parseAdditionalQueries(n,t,r,o);e.events.publish("rest.deferred.loaded",[r]);i.resolve({row:r,model:t})})})}return i.promise()}parseAdditionalQueries(e,r,o,a){let i=n.parseAsJSONIfString(e.body);r.fields.forEach(function(e){if(e.defer&&t.inArray(e.id,a.method.fields)>-1){o[e.id]=f(i,e.path)}})}onSelectEntity(e,r,n,o){let i=e,s=o.getCachedEntityMetadata(i),d=s.getFieldsList().filter(function(e){return e.omittable===false}),u=f(s.getExtensions(),"rest.defaultConditions"),l=n.get("xmlState"),c=l.children("fields").empty(),p=l.children("conditions").empty();if(d&&d.length>0){c.append(d.map(function(e){return a('<field id="'+e.id+'" />')}))}if(u&&u.length>0){p.append(u.map(function(e){let r=a('<condition value="" />');t.each(e,function(e,n){if(e==="picklistEntries"){let e=a("<picklistentries/>");e.append(t.map(n,function(e){return a("<entry/>").attr(e)}));r.append(e)}else{r.attr(e,n)}});return r}))}if(this.prop("composer.rebuildPropsOnSelectEntity"))n.refresh().rebuildProps();else n.refresh()}processEntityMetadataRequest(e){let t=r(true,{extensions:{rest:{}}},e.result),n=t.extensions.rest,o=t.methods,a=t.defaultConditions;delete t.methods;n.methods=o;if(a){delete t.defaultConditions;n.defaultConditions=a}return t}processModelXMLExtensions(e,t){let r=t.attr(b);e.extensions.rest={entityName:r};e.objectName=r}queryEntityMetadata(){}save(e){let r=this,n=o();t.each(e.operations,function(e,o){const a=r.buildSaveRequests(o),i=[],s=[];t.each(a,function(e,t){let n;let a=r.preSaveHook(t).then(function(){return r.makeRequest(t.model,t)}).then(function(e){n=e;e.body=r.parseSuccessfulSaveResponse(e,t);return r.postSaveHook(e,t)}).then(function(){s.push({operation:o,requestContext:t,response:n,isSuccess:true})}).catch(function(e){s.push({operation:o,requestContext:t,error:e,isSuccess:false})});i.push(a)});const d=()=>{n.resolve(r.handleSaveResult(s))};Promise.all(i).then(d,d)});return n.promise()}updateFieldMetadata(e,t,n){if(e.overrideMetadata)return;t||(t=e.id);if(!t)return;let o=n&&n.getField&&n.getField(t),a,i;if(!o)return;a=e.id;i=e.name;r(true,e,o);if(a)e.id=a;if(i)e.name=i}}Object.assign(M.prototype,{_NEW_ID_PREFIX:"__skuid_new__",_FAKE_ID_PREFIX:"__skuid__",_DEFAULT_ID_FIELD:"id",properties:{composer:{canFieldsBeSelected:function e(t){let r=t.model,n=r.attr(b)||r.attr("sobject"),o=r.attr("datasource")||r.attr("service"),a=s.get(o),i=a&&a.getDataSourceType(),d=i.prop("composer.hasEntityOptions")!==false;if(d&&n){return true}else{return"Select an Entity for this Model"}},rebuildPropsOnSelectEntity:true},canAutoGenerateConditionsFromFields:false,canConditionsBeGrouped:false,showSearchFields:false,canFieldsBeIndividuallySearched:false,canServerSearch:false,onlySupportsClientSideFieldConditions:true,supportsServerSideSort:false},parseSuccessfulLoadResponse:d.parseSuccessfulLoadResponseWithSynonyms,parseSuccessfulSaveResponse:d.parseSuccessfulSaveResponseWithSynonyms,parseResponseBodyAsJSON:i,processErrorObject:u.processErrorObject,populateBreadcrumbFromEntityMetadata:u.populateBreadcrumbFromEntityMetadata,makeRequest:u.makeRequest,generateErrorMessage:u.generateErrorMessage,getConditionSourceProperties:u.getConditionSourceProperties,getIdField:u.getIdField,getNameField:u.getNameField,getRowId:u.getRowId,getRowName:u.getRowName,setDefaultConditionState:u.setDefaultConditionState});r(l,{RESTDataSourceTypeBase:M})})(e)}});return t});