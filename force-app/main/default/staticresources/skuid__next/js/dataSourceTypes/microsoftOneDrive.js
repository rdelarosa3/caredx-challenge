skuid.runtime.registerApi("v2","dataSourceTypes/microsoftOneDrive",function(e){var t=function(e){var t={};function n(r){if(t[r]){return t[r].exports}var i=t[r]={i:r,l:false,exports:{}};e[r].call(i.exports,i,i.exports,n);i.l=true;return i.exports}n.m=e;n.c=t;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(e,t){if(t&1)e=n(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var r=Object.create(null);n.r(r);Object.defineProperty(r,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=722)}({722:function(t,n){(function(e){const t=e.$,n=t.each,r=t.ajax,i=e.utils,a=i.Deferred,o=i.getObjectProperty,l=i.parseAsJSONIfString,s=e.dataSource,d=s.utils,c=e.constants,u=c.DATASOURCE,p=c.DISPLAY_TYPES,f=c.MIME_TYPES,m=c.HTTP_VERBS,y="MicrosoftOneDrive",h=f.JSON,b=p.DATETIME,v=p.NUMBER,T=p.OBJECT,g=p.STRING,x=p.IMAGE,S=m.GET,P=m.PATCH,O=m.DELETE,A="Parent Folder",R=u.SEARCH_CONDITION,C=function e(t,r){let a={};n(t,function(e,t){if(!t.inactive){a[t.sourceParam||t.name]=encodeURI(i.mergeAsTextInContext(t.value,r))}});return a},_=function e(t){let n=t.model,r=n.conditions,i=C(r,t),a=i[R],o="/_api/v2.0/drive/items/",l=i[A],s=i["extension"]||"",d,c;if(l){if(l.indexOf("/")===-1){c=o+l+"/children"}else{l=l.split(" ").join("%20");d=l.split("/");c="/_api/v2.0/drive/root:"+l;if(!s&&d[d.length-1].indexOf(".")===-1){c=c+":/children"}}}else c="/_api/v2.0/drive/root/children";if(a){if(!l||l.indexOf("/")!==-1){c="/_api/v2.0/drive/root/view.search?q="+a}else{c="/_api/v2.0/drive/items/"+l+"/view.search?q="+a}}t.request.url=c};if(s.getDataSourceType(y))return;new s.core.RESTDataSourceTypeBase({name:y,coerceRequest:function e(t){let n=t.type,r=t.request.data,i="/_api/v2.0/drive/items/";if(!t.request.url){if(n==="query"){_(t)}else if(n==="update"||n==="delete"){t.request.url=i+t.originalRecordId;if(n==="update"){let e=r.parentDirectory||"";t.request.data.parentReference={path:"/drive/root:"+e};delete t.request.data.parentDirectory}}}t.request.headers={Accept:h}},parseSuccessfulLoadResponse:function e(n,r,a,o){let l=this,s=l.parseResponseBodyAsJSON(n.body),d=r.pathToContent,c=o.conditions,u,p,f,m,y=[];t.each(c,function(e,t){if(t.name==="extension"){u=t.value}else if(t.name===A){p=t.value;if(p)f=p.split("/")}});if(p&&f[f.length-1].indexOf(".")!==-1){m=s}else m=d?i.getObjectProperty(s,d):s;if(t.isArray(m)){t.each(m,function(e,t){let n;if(u){let e=t.name.split(".");if(e){n=e.slice(-1)[0]}else n=""}if(u&&n.indexOf(u)===-1){delete m[e]}else{let e=t.parentReference.path,n=e?e.split(":")[1]:t.parentReference.id;t.createdByUserName=i.getObjectProperty(t,"createdBy.user.displayName");t.lastModifiedByUserName=i.getObjectProperty(t,"lastModifiedBy.user.displayName");t.parentDirectory=n;t.oneUp=n.substring(0,n.lastIndexOf("/"));t.downloadUrl=t["@content.downloadUrl"];y.push(t)}});m=y}else{let e=m.parentReference.path,t=e?e.split(":")[1]:m.parentReference.id;m.createdByUserName=i.getObjectProperty(m,"createdBy.user.displayName");m.lastModifiedByUserName=i.getObjectProperty(m,"lastModifiedBy.user.displayName");m.parentDirectory=t;m.oneUp=t.substring(0,t.lastIndexOf("/"));m.downloadUrl=m["@content.downloadUrl"];m=[m]}return m},getUploadMethods:function t(){function r(t,r,a,o,s,d){let c=encodeURIComponent(i.renameFileWhileKeepingExtension(t.name,i.mergeAsTextInContext(a.filename,a))),u=new FileReader,p=a.model,f=p.dataSource,m=p.conditions,y=f.serviceUrl,b=t.size,v=e.platform.getMaxProxyRequestPayload(),T=1,g,x,S,P;n(m,function(e,t){x=t.value||""});function O(e){if(e&&e.body){let t=e.body;if(t&&t.error&&t.error.message){return t.error.message}}return"Had an error"}function A(t,n){if(e.utils.inPlatform(e.constants.NATIVE))return t;else{if(n==="atob")return atob(t);else if(n==="btoa")return btoa(t)}}function R(){let e;o({fileName:a.filename||t.name});if(x&&x.indexOf("/")===-1){e=y+"/_api/v2.0/drive/items/"+x+":/"+c+":/upload.createSession"}else if(!x||x==="/"){e=y+"/_api/v2.0/drive/root:/"+c+":/createUploadSession"}else e=y+"/_api/v2.0/drive/root:"+x+"/"+c+":/upload.createSession";let n=f.createHTTPRequest({url:e,method:"POST",headers:{"Content-Length":0,Accept:h}});return f.makeRequest(n)}function C(){let e=A(P[0],"atob").length-1;d({loaded:T,total:S});return f.makeRequest(f.createHTTPRequest({url:g,headers:{"Content-Range":"bytes 0-"+e+"/"+b,"Content-Length":P[0].length,Accept:h},contentType:"application/octet-stream",method:"PUT",body:P[0]})).then(function(e){if(S===1){s()}else _(e)},function(e){s({message:O(e)})})}function _(e){T++;d({loaded:T,total:S});f.authenticate(a).then(function(){if(T===S)E(e);else{let t=l(e.body),n=t.nextExpectedRanges[0].split("-")[0],r=parseInt(n,10)+A(P[T-1],"atob").length-1;f.makeRequest(f.createHTTPRequest({url:g,headers:{"Content-Range":"bytes "+n+"-"+r+"/"+b,"Content-Length":P[T-1].length,Accept:h},contentType:"application/octet-stream",method:"PUT",body:P[T-1]})).then(function(e){_(e)},function(e){s({message:O(e)})})}})}function E(e){let t=l(e.body),n=t.nextExpectedRanges[0].split("-")[0],r=parseInt(n,10)+A(P[T-1],"atob").length-1;f.makeRequest(f.createHTTPRequest({url:g,headers:{"Content-Range":"bytes "+n+"-"+r+"/"+b,"Content-Length":P[T-1].length,Accept:h},contentType:"application/octet-stream",method:"PUT",body:P[T-1]})).then(function(e){if(e.statusCode===202)s({message:"Upload failed!"});else s()},function(e){s({message:O(e)})})}function U(e,t){let n=e.length,r=[],i=Math.ceil(n/t);for(let n=0;n<t;n++){r[n]=A(e.slice(i*n,i*(n+1)),"btoa")}return r}u.readAsBinaryString(t);u.onloadend=function(){P=u.result;S=Math.ceil(b/v);f.authenticate(a).then(function(){P=U(P,S);R().then(function(e){let t=l(e.body);g=t.uploadUrl;C()},function(e){s({message:O(e)})})})}}return{"Direct Upload":{label:"Direct Upload",canRunPostUploadSnippet:true,upload:r,needsModelInContext:true}}},parseAdditionalQueries:function e(n,r,i,a){let s=o(l(n.body),a.method.pathToContent);if(t.isArray(s))s=s[0];r.fields.forEach(function(e){if(e.defer&&t.inArray(e.id,a.method.fields)>-1){i[e.id]=o(s,e.path)}})},createActions:function t(o){return{"create-folder":{label:"Create new folder",builderProps:[{label:"Model with Parent Folder Condition",id:"model",type:"model",helptext:"Will take the value in this model's parent folder condition, and use it as the parent folder for the new folder",entryFilter:i.filterByDataSourceAndEntity(o.name,"File")},{label:"Folder Name",id:"foldername",type:"string"}],runtimeExecution:function t(o,l,s,d){let c=e.$M(i.mergeAsDataInContext(o.attr("model"))),u=c.dataSource,p=u.serviceUrl,f="",m,y=i.mergeAsTextInContext(o.attr("foldername"),s),h=a();n(c.conditions,function(e,t){if(t.sourceParam===A){f=i.mergeAsTextInContext(t.value,s)||f}});m={name:y,folder:{},"@name.conflictBehavior":"rename"};if(f&&f.indexOf("/")===-1){r({url:p+"/_api/v2.0/drive/items/"+f+"/children",headers:{Authorization:"Bearer "+d.authentication.responseBody.access_token,"Content-Type":"application/json"},method:"POST",dataType:"json",data:JSON.stringify(m),success:function e(){h.resolve()},error:function e(t){h.reject(t)}})}else{r({url:p+"/_api/v2.0/drive/root:"+f,headers:{Authorization:"Bearer "+d.authentication.responseBody.access_token},method:"GET",dataType:"json",success:function e(t){r({url:p+"/_api/v2.0/drive/items/"+t.id+"/children",headers:{Authorization:"Bearer "+d.authentication.responseBody.access_token,"Content-Type":"application/json"},method:"POST",dataType:"json",data:JSON.stringify(m),success:function e(){h.resolve()},error:function e(t){h.reject(t)}})},error:function e(t){h.reject(t)}})}return h.promise()}},copy:{label:"Copy a File",builderProps:[{label:"Model with Parent Folder Condition",id:"model",type:"model",helptext:"Will take the value in this model's parent folder condition, and use it as the parent folder for the new folder",entryFilter:i.filterByDataSourceAndEntity(o.name,"File")},{label:"File Name",id:"filename",type:"string"}],runtimeExecution:function t(o,l,s){let d=e.$M(i.mergeAsDataInContext(o.attr("model"))),c=s.row,u=c.parentReference.path,p=u?u.split(":")[1]:c.parentReference.id,f=d.dataSource,m=f.serviceUrl,y="",h,b,v=i.mergeAsTextInContext(o.attr("filename"),s),T=a();n(d.conditions,function(e,t){if(t.sourceParam===A){y=i.mergeAsTextInContext(t.value,s)||y}});b={parentReference:c.parentReference,name:v};if(!y){h=m+"/_api/v2.0/drive/root:/"+c.name+":/action.copy"}else if(y&&y.indexOf("/")===-1){h=m+"/_api/v2.0/drive/items/"+c.id+"/action.copy"}else{h=m+"/_api/v2.0/drive/root:"+p+"/"+c.name+":/action.copy"}r({url:h,headers:{Authorization:"Bearer "+f.authentication.responseBody.access_token,"Content-Type":"application/json",Prefer:"response-async"},method:"POST",dataType:"json",data:JSON.stringify(b),success:function e(){T.resolve()},error:function e(t){T.reject(t)}});return T.promise()}}}},getEntityList:d.getEntityListStatic,queryEntityMetadata:d.queryEntityMetadataStatic,getActions:d.getActionsStatic,extendedProperties:{composer:{unomittableFields:true,hasEntityOptions:true},hasDefaultSearch:true,canServerSearch:true,hasGlobalSearchEntities:true,"x-metadata":{__skuid_fieldDefaults:{File:{displaytype:g,editable:false,createable:false,accessible:true}},File:{idFields:["id"],nameField:"name",label:"File",labelPlural:"Files",fields:[{id:"id",inlineHelpText:"Identifier of the drive.","x-alwaysinclude":true},{id:"name",inlineHelpText:"Name of the drive.",editable:true},{id:"createdByUserName"},{id:"createdDateTime",displaytype:b},{id:"lastModifiedByUserName"},{id:"lastModifiedDateTime",displaytype:b},{id:"webUrl"},{id:"parentReference",displaytype:T,accessible:false},{id:"size",displaytype:v},{id:"parentDirectory",editable:true},{id:"oneUp",label:"Directory Up"},{id:"downloadUrl",label:"Download Link"},{id:"smallThumbnail",label:"Thumbnail (Small)",displaytype:x,defer:true,path:"small.url"},{id:"mediumThumbnail",label:"Thumbnail (Medium)",displaytype:x,defer:true,path:"medium.url"},{id:"largeThumbnail",label:"Thumbnail (Large)",displaytype:x,defer:true,path:"large.url"}],methods:{query:{url:"",verb:S,contentType:h,pathToContent:"value",additionalRequests:[{url:"/_api/v2.0/drive/items/{{id}}/thumbnails",verb:S,contentType:h,pathToContent:"value",fields:["smallThumbnail","mediumThumbnail","largeThumbnail"]}]},update:{url:"",verb:P,contentType:h,receiveDataAs:"recordinbody",successIf:"responsefieldispresent",successField:"name"},delete:{url:"",verb:O,contentType:h},search:{url:"/_api/v2.0/drive/root/view.search?q={{search}}",verb:S,contentType:h,pathToContent:"value"}},defaultConditions:[{sourcetype:"param",sourceparam:A,name:A,label:"Path to File/Folder",state:"filterableon",value:""},{sourcetype:"param",sourceparam:"extension",name:"extension",label:"File Extension",state:"filterableon",value:""}]}}}})})(e)}});return t});