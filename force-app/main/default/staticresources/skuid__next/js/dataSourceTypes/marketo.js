skuid.runtime.registerApi("v2","dataSourceTypes/marketo",function(e){var t=function(e){var t={};function a(r){if(t[r]){return t[r].exports}var i=t[r]={i:r,l:false,exports:{}};e[r].call(i.exports,i,i.exports,a);i.l=true;return i.exports}a.m=e;a.c=t;a.d=function(e,t,r){if(!a.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};a.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};a.t=function(e,t){if(t&1)e=a(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var r=Object.create(null);a.r(r);Object.defineProperty(r,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var i in e)a.d(r,i,function(t){return e[t]}.bind(null,i));return r};a.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};a.d(t,"a",t);return t};a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};a.p="";return a(a.s=719)}({719:function(t,a){(function(e){let t=e.$,a=e.utils,r=a.parseAsJSONIfString,i=e.constants,l=i.DISPLAY_TYPES,n=l.DATETIME,o=l.BOOLEAN,s=l.ID,d=l.STRING,u="Lead",p="Person",c="Campaign",y="Program",f="Folder",m="StaticList",b="Channel",T="ActivityType",g="Activity",h="Tag",v={},P=e.dataSource,I=P.utils,S=a.grab,E=I.REST,C="Marketo",k=i.MIME_TYPES.JSON,A=l.NUMBER,M={Person:1,Campaign:2,Program:3,Folder:4,StaticList:5,Channel:6,ActivityType:7,Activity:8,Tag:9},j="List",q="ProgramId",L="Id",x="filterValues",D="filterType",F="query",N="insert",O="delete",w="update",R=function t(a,r){try{return e.time.resolveDateKeyword(decodeURIComponent(r.dateTime))[0].toISOString()}catch(e){throw Error("Date must be of the format: LAST_N_WEEKS:10, for the model: "+a.id+" - Please reference the DataSource's documentation for more information on valid options.")}},V=function e(a,r){let i={sourcetype:"param",state:"filterablerequired",type:"fieldvalue",required:true,value:"",name:a};i.name=a;if(a===j){i.label="List Id"}else if(a===q){i.label="Program Id"}else if(a===L){i.label="Marketo GUID"}else{i.label=a}if(r){let e={};t.each(r.fields,function(t,a){e[a.id]=a});let a=[];let l={};t.each(r.searchableFields,function(r,i){t.each(i,function(t,r){if(l[r])return;l[r]=true;a.push({value:r,label:e[r].label})})});i.picklistEntries=a}i.sourceparam=i.name;return i},_=function e(t){t=t.toUpperCase();let a={SCORE:A,FLOAT:A};if(a[t])return a[t];return t},B=function e(t,i,l,n){if(n!==false&&v[i])return I.deferrable(v[i]);return t.authenticate().then(function(){if(i.indexOf("rest")===-1){i=a.combineUrls(a.combineUrls(t.serviceUrl||"","/rest/v1/"),i)}else{i=a.combineUrls(t.serviceUrl||"",i)}let e={url:i};if(l){n=false;e.method="POST";e.data=l;e.body=l;e.contentType=k}else{e.method="GET"}return t.makeRequest(t.createHTTPRequest(e))}).then(function(e){e=r(e);if(!(e&&e.body))throw Error("Failed to connect to Marketo");let t=r(e.body),a;if(!t.success){throw Error("Bad request made to Marketo")}if(t.result){a=t.result}else if(t.nextPageToken){a=t.nextPageToken}if(!a)throw Error("No result in response");if(n!==false){v[i]=a}return a})},H=function e(t){let a={Custom:"customobjects.json",Person:"leads/describe.json",Lead:"leads/describe.json"};return a[t]||"customobjects/"+t+"/describe.json"},U=function e(a){let r=a.idField;return{fields:t.map(a.fields,function(e){let t={displaytype:_(e.dataType),label:e.displayName,id:e.name,editable:e.updateable!==false,createable:e.createable!==false};if(e.name===r){t.editable=false;t.createable=false;t.omittable=false}return t}),idFields:[r],searchableFields:a.searchableFields}},G=function e(a){return{fields:t.map(a,function(e){if(!e.rest)return;let t={displaytype:_(e.dataType),label:e.displayName,id:e.rest.name,editable:e.rest.readOnly===false,createable:e.rest.readOnly===false,accessible:true};if(e.rest.name==="id"){t.omittable=false;t.editable=false;t.createable=false;t.displaytype=s}return t}),idFields:["id"]}},K=function e(a){let r=a.type,i=a.request,l=a.model,n=a.row,o=i.data,s={},d=I.getModelMergeConditions(l,a),u=i.url,p=d[j],c=d[q],y=d[L];if(r===F){if(c){u+="leads/programs/"+c+".json"}else if(p){u+="list/"+p+"/leads.json"}else if(y){u+="leads.json?filterType=id&filterValues="+decodeURIComponent(y)}else{throw Error("Must query persons using a non-empty condition value")}}else if(r===O){u+="leads/delete.json";s={input:[{id:n.id}]}}else{u+="leads.json";s={input:[t.extend({},o)]};if(r===w){s.input[0].id=n.id;s.lookupField="id";s.action="updateOnly"}else{s.action="createOrUpdate"}}if(s){i.data=s}i.url=u},z=function e(t){let a=t.model,r=t.request,i=r.url,l=t.type,n=I.getModelMergeConditions(a,t);if(l===F){if(n["campaignId"].length===0){r.url=i+"campaigns.json"}else{i+=t.method.url;r.url=i}}},J=function e(t){let a=t.model,r=t.request,i=r.url,l=t.type,n=I.getModelMergeConditions(a,t);if(l===F){if(n["tagType"].length===0&&n["tagValue"].length===0){r.url=i+"programs.json"}else if(n["tagType"].length===0||n["tagValue"].length===0){throw Error("Model "+a.label+' had an error: both tagType and tagValue conditions must be present to query Program by Tag. Without either, query will default to "all" Programs')}else{i+=t.method.url;r.url=i}}if(l===N){i+=t.method.url;r.url=i;let e=r.data.value,a=r.data.channel,l=r.data.description,n=r.data.folderType,o=r.data.name,s=r.data.type,d={id:e,type:n};r.data="name="+o+"&"+"folder="+JSON.stringify(d)+"&"+"type="+s+"&"+"channel="+a;if(l)r.data=r.data.concat("&description="+l);r.contentType="application/x-www-form-urlencoded"}if(l===w){i+=t.method.url;r.url=i}},W=function e(t){let a=t.model,r=t.request,i=r.url,l=t.type,n=I.getModelMergeConditions(a,t);if(l===F){if(!n["maxDepth"]){i+="folders.json";r.url=i}else{i+=t.method.url;r.url=i}}},Y=function e(t){let a=t.request,r=a.url,i=t.type;if(i===F){r+=t.method.url}a.url=r},Z=function e(t){let a=t.model,r=t.request,i=r.url,l=t.type,n=I.getModelMergeConditions(a,t);if(l===F){if(!n["channelName"]){i+="channels.json";r.url=i}else{i+=t.method.url;r.url=i}}},$=function e(t){let a=t.request,r=a.url,i=t.type;if(i===F){r+=t.method.url}a.url=r},Q=function e(t){let a=t.model,r=t.request,i=r.url,l=t.type,n=I.getModelMergeConditions(a,t),o=n["personIds"],s=n["activityTypeIds"],d=a.tokenVal;if(l===F&&a.paginationToken){i=i.concat(t.method.url)}else{i=i.concat(t.method.url,"leadIds=",o,"&activityTypeIds=",s,"&nextPageToken=",d)}r.url=i},X=function e(t){let a=t.request,r=a.url,i=t.type;if(i===F){r+=t.method.url}a.url=r},ee=function e(a,i){let l=a.type,n=a.request,o=a.model,s=I.getModelMergeConditions(o,a),d=n.url,u=s[D],p=s[x];d+="customobjects/"+i+".json";if(l===F){if(!(u&&p))throw Error("Must have a valid filterType and filterValue condition set");p=r(p);if(t.isArray(p))p=p.join(",");d+="?"+D+"="+u+"&"+x+"="+p}n.url=d},te=function e(t){let a={};switch(t){case c:a.idFields=["id"];a.label=t;a.labelPlural="Campaigns";a.fields=[{id:"id",label:"Campaign ID",displaytype:L},{id:"name"},{id:"type"},{id:"programName"},{id:"programId",displaytype:L},{id:"workspaceName"},{id:"createdAt",displaytype:n},{id:"updatedAt",displaytype:n},{id:"active",displaytype:o}];a.methods={query:{url:"campaigns/{{campaignId}}.json",verb:i.HTTP_VERBS.GET,contentType:k,pathToContent:"result"}};a.defaultConditions=[{sourcetype:"param",sourceparam:"campaignId",name:"campaignId",label:"Campaign ID",state:"filterableon",type:"fieldvalue",required:true,value:""}];break;case y:a.idFields=["id"];a.label=t;a.labelPlural="Programs";a.fields=[{id:"id",label:"Program ID",displaytype:L},{id:"name",createable:true,editable:true},{id:"description",createable:true,editable:true},{id:"createdAt",displaytype:n},{id:"updatedAt",displaytype:n},{id:"url"},{id:"type",createable:true},{id:"channel",createable:true},{id:"sfdcId",label:"SFDC ID",displaytype:L},{id:"sfdcName",label:"SFDC Name"},{id:"status"},{id:"workspace"},{id:"folderType",synonym:"folder.type",label:"Folder Type",createable:true},{id:"value",synonym:"folder.value",label:"Folder Id",createable:true,displaytype:L},{id:"folderName",synonym:"folder.folderName",label:"Folder Name",createable:true}];a.methods={query:{url:"program/byTag.json?tagType={{tagType}}&tagValue={{tagValue}}",verb:i.HTTP_VERBS.GET,contentType:k,pathToContent:"result"},update:{url:"program/{{id}}.json",verb:i.HTTP_VERBS.POST,contentType:"application/x-www-form-urlencoded"},insert:{url:"programs.json",verb:i.HTTP_VERBS.POST,contentType:k}};a.defaultConditions=[{sourcetype:"param",sourceparam:"tagType",name:"tagType",label:"Tag Type",state:"filterableon",type:"fieldvalue",required:true,value:""},{sourcetype:"param",sourceparam:"tagValue",name:"tagValue",label:"Tag Value",state:"filterableon",type:"fieldvalue",required:true,value:""},{sourcetype:"param",sourceparam:"id",name:"id",label:"Program Id",state:"filterableon",type:"fieldvalue",required:true,value:""}];break;case f:a.idFields=["id"];a.label=t;a.labelPlural="Folders";a.fields=[{id:"accessZoneId",displaytype:L},{id:"createdAt",displaytype:n},{id:"description"},{id:"metaFolderId",label:"Folder Id (Meta)",synonym:"folderId.id",displaytype:L},{id:"metaFolderType",label:"Folder Type (Meta)",synonym:"folderId.type"},{id:"folderType"},{id:"id",label:"Folder Id",displaytype:L},{id:"isArchive",displaytype:o},{id:"isSystem",displaytype:o},{id:"name"},{id:"parentId",synonym:"parent.id",label:"Parent Id",displaytype:L},{id:"parentType",synonym:"parent.type",label:"Parent Type"},{id:"updatedAt",displaytype:n},{id:"url"},{id:"workspace"}];a.methods={query:{url:"folders.json?maxDepth={{maxDepth}}",verb:i.HTTP_VERBS.GET,contentType:k,pathToContent:"result"}};a.defaultConditions=[{sourcetype:"param",sourceparam:"maxDepth",name:"maxDepth",label:"Max Folder Depth",state:"filterableon",type:"fieldvalue",required:false}];break;case m:a.idFields=["id"];a.label=t;a.labelPlural="Lists";a.fields=[{id:"id",label:"List ID",displaytype:L},{id:"name"},{id:"description"},{id:"programName"},{id:"workspaceName"},{id:"createdAt",displaytype:n},{id:"updatedAt",displaytype:n}],a.methods={query:{url:"lists.json",verb:i.HTTP_VERBS.GET,contentType:k,pathToContent:"result"}};a.defaultConditions=null;break;case b:a.idFields=["id"];a.label=t;a.labelPlural="Channels";a.fields=[{id:"applicableProgramType"},{id:"createdAt",displaytype:n},{id:"id",label:"Channel ID"},{id:"name"},{id:"updatedAt",displaytype:n}],a.methods={query:{url:"channel/byName.json?Name={{channelName}}",verb:i.HTTP_VERBS.GET,contentType:k,pathToContent:"result"}};a.defaultConditions=[{sourcetype:"param",sourceparam:"channelName",name:"channelName",label:"Channel Name",state:"filterableon",type:"fieldvalue",required:false}];break;case T:a.idFields=["id"];a.label=t;a.labelPlural="Activity Types";a.fields=[{id:"id",label:"Activity Type ID"},{id:"name"},{id:"apiName"},{id:"description"},{id:"primaryAttributeName",synonym:"primaryAttribute.name"},{id:"primaryAttributeDatatype",synonym:"primaryAttribute.dataType"}],a.methods={query:{url:"activities/types.json",verb:i.HTTP_VERBS.GET,contentType:k,pathToContent:"result"}};a.defaultConditions=null;break;case g:a.idFields=["id"];a.label=t;a.labelPlural="Activities";a.fields=[{id:"id",label:"Activity ID",displaytype:L},{id:"activityDate",displaytype:n},{id:"activityTypeId",displaytype:L},{id:"campaignId",displaytype:L},{id:"leadId",label:"personId",displaytype:L},{id:"marketoGUID",displaytype:L},{id:"primaryAttributeValueId",displaytype:L},{id:"primaryAttributeValue"}];a.methods={query:{url:"activities.json?",verb:i.HTTP_VERBS.GET,contentType:k,pathToContent:"result"}};a.defaultConditions=[{sourcetype:"param",sourceparam:"personIds",name:"personIds",label:"Person ID",state:"filterableon",type:"fieldvalue",required:true,value:""},{sourcetype:"param",sourceparam:"activityTypeIds",name:"activityTypeIds",label:"Activity Type ID",state:"filterableon",type:"fieldvalue",required:true,value:""},{sourcetype:"param",sourceparam:"dateTime",name:"dateTime",label:"Date Time",state:"filterableon",type:"fieldvalue",required:true,value:"LAST_N_WEEKS:10"}];break;case h:a.idFields=["id"];a.label=t;a.labelPlural="Tags";a.fields=[{id:"applicableProgramTypes"},{id:"required",displaytype:o},{id:"tagType"}],a.methods={query:{url:"tagTypes.json",verb:i.HTTP_VERBS.GET,contentType:k,pathToContent:"result"}};a.defaultConditions=null;break;default:a=null;return a}a.fields.forEach(function(e){if(!e.label)e.label=I.makeLabelFromId(e.id);if(!e.displaytype)e.displaytype=d;if(!e.editable)e.editable=false;if(!e.creatable)e.creatable=false;if(!e.accessible)e.accessible=true});return a},ae=function e(t){t.model.dbType="Asset";t.request.url="/rest/asset/v1/"},re=function e(t){t.model.dbType="Lead";t.request.url="/rest/v1/"};if(P.getDataSourceType(C))return;new P.core.RESTDataSourceTypeBase({name:C,coerceRequest:function e(a){let r=this,i=a.model,l=i.fields,n=a.type,o=a.request,s=r.getEntityMetadataCacheKey(i);switch(s){case u:re(a);K(a);break;case p:re(a);K(a);break;case c:re(a);z(a);break;case m:re(a);Y(a);break;case T:re(a);$(a);break;case g:re(a);Q(a);break;case y:ae(a);J(a);break;case f:ae(a);W(a);break;case b:ae(a);Z(a);break;case h:ae(a);X(a);break;default:ee(a,s)}if(n===F){if(o.url.indexOf("?")===-1){o.url+="?"}else{o.url+="&"}o.url+="fields="+t.map(l,function(e){if(e.id&&!e.uiOnly)return e.id}).join(",");if(!i.recordsLimit)i.recordsLimit=150;if(a.model.dbType==="Lead"){if(i.recordsLimit&&(i.recordsLimit|0)+""===i.recordsLimit+""){if(a.model.objectName==="Activity")o.url+="&batchSize="+(i.recordsLimit|0);else o.url+="&batchSize="+((i.recordsLimit|0)+1)}}else if(a.model.dbType==="Asset"){if(i.recordsLimit&&(i.recordsLimit|0)+""===i.recordsLimit+""){o.url+="&maxReturn="+((i.recordsLimit|0)+1)}}}},createActions:function e(){return{"add-lead-to-static-list":{label:"Add a Person to a Static List",builderProps:[{label:"Person ID",id:"personId",type:"string"},{label:"List ID",id:"listId",type:"string"}],runtimeExecution:function e(t,r,i,l){let n=a.mergeAsTextInContext(t.attr("personId"),i),o=a.mergeAsTextInContext(t.attr("listId"),i),s=l.serviceUrl+"rest/v1/",d=s+"lists/"+o+"/leads.json",u={input:[{id:n}]},p=l.createHTTPRequest({url:d,method:"POST",headers:{"Content-Type":"application/json"},body:u});return l.makeRequest(p)}},"remove-lead-from-static-list":{label:"Remove a Person from Static List",builderProps:[{label:"Person ID",id:"personId",type:"string"},{label:"List ID",id:"listId",type:"string"}],runtimeExecution:function e(t,r,i,l){let n=a.mergeAsTextInContext(t.attr("personId"),i),o=a.mergeAsTextInContext(t.attr("listId"),i),s=l.serviceUrl+"rest/v1/",d=s+"lists/"+o+"/leads.json",u={input:[{id:n}]},p=l.createHTTPRequest({url:d,method:"DELETE",headers:{"Content-Type":"application/json"},body:u});return l.makeRequest(p)}}}},applyPaginationToken:function e(t,a){if(a.dbType==="Lead"){t.url+="&nextPageToken="+a.value}else if(a.dbType==="Asset"){t.url+="&offset="+a.value}},postSaveHook:function e(t,a){let i=this,l=a.model,n=I.getModelMergeConditions(l,a),o=n[j],s=i.getEntityMetadataCacheKey(l),d=a.type===N,c=r(t.body),y=c.id,f,m;if(!(s===p&&o&&d&&y||s===u&&o&&d&&y))return;f=y;m="lists/"+o+"/leads.json";return B(l.dataSource,m,{input:[{id:f}]},false,"POST")},getPaginationToken:function e(t,a,i,l){let n=r(t&&t.body),o={};if(l.dbType==="Lead"&&i.objectName!="Activity"){if(n&&n.success&&n.nextPageToken&&n.result&&n.result.length===(l.recordsLimit|0)+1){o={dbType:l.dbType,value:n.nextPageToken};n.result.pop();return o}}else if(l.dbType==="Asset"){if(n.result&&n.result.length===(l.recordsLimit|0)+1){o={dbType:l.dbType,value:l.offset-1};n.result.pop();return o}}},parseSuccessfulLoadResponse:function e(t,i,l,n){let o=r(t.body),s=i.pathToContent,d=s?a.getObjectProperty(o,s):o;d=r(d);if(n.dbType==="Asset"){if(d){n.offset?n.offset+=d.length:n.offset=d.length}}if(o&&o.errors&&o.errors.length){throw Error("Model "+n.label+' had an error: "'+o.errors[0].message+'"')}I.safeEach(d,function(e,t){I.applySynonym(t,l)});return d},parseSuccessfulSaveResponse:function e(t,a){if(t.body.errors&&t.body.errors[0]){throw Error("Model "+a.model.label+' had an error: "'+t.body.errors[0].message+'"')}let i=r(t.body);if(i.success){let e=i.result[0];if(e.status==="skipped"){let t=e.reasons[0];throw Error("code: "+t.code+", "+t.message)}return{id:i.result[0].id}}},getEntityList:function e(a){let r=a.dataSource;let i=t.map(M,function(e,t){return{value:t,label:t}});return B(r,H("Custom")).then(function(e){i=i.concat(t.map(e,function(e){return{value:e.name,label:e.name}}));return i})},preLoadHook:function e(a){let r=this,i=a.model,l=r.getEntityMetadataCacheKey(i),n,o,s,d,c;if(l===p||l===u){n=I.getModelMergeConditions(i,a);o=n[j];s=n[q];d=o||s;if(!d)return;if((d|0)+""===d+""){return}let e=o?j:q,r=(o?"lists.json?name=":"/rest/asset/v1/program/byName.json?name=")+d;return B(i.dataSource,r).then(function(a){if(!a.length)throw Error("Bad list condition passed for model: "+i.id);t.each(i.conditions,function(t,r){if(r.sourceParam===e){r.value=a[0].id+"";return false}})})}else if(l===g&&!i.paginationToken){d=I.getModelMergeConditions(i,a);c=R(i,d);let e="activities/pagingtoken.json?sinceDatetime="+c;return B(i.dataSource,e).then(function(e){i.tokenVal=e;if(!e.length)throw Error("Bad list condition passed for model: "+i.id)})}},getExtendedModelProperties:function t(a,r,i){let l=e.builder.core,n={basic:[],advanced:[],customTabs:[]};if(a!==p&&a!==u){return n}n.basic.push({id:"fetchby",type:"picklist",label:"Fetch Persons By",picklistEntries:[{label:"Static List",value:j},{label:"Program",value:q},{label:"Id",value:L}],defaultValue:j,helptext:"Persons can be fetched by Id, Static List, or Program",onChange:function e(t){E.replaceConditions([V(t)],r);i.save().refresh().rebuildProps()}},l.getModelLimitProperty());return n},queryEntityMetadata:function e(r,i){let l=this.getEntityMetadataCacheKey(r);if(!l)return a.reject("No Entity was selected for this Model.");let n=te(l);if(n){return I.deferrable(n)}return B(i.dataSource,H(l)).then(function(e){let a;if(l===p||l===u){a=G(e)}else if(M[l]){a=U(e)}else if(e.length){a=U(e[0])}else{throw Error("Marketo did not recognize the entity: "+l)}let r={query:{url:"",verb:"GET",contentType:k,pathToContent:"result"}};if(l===p||l===u){r.insert={url:"",verb:"POST",contentType:k};r.update={url:"",verb:"POST",contentType:k};r["delete"]={url:"",verb:"POST",successIf:"requestsucceeds"}}let i=t.extend({label:l,labelPlural:l,methods:r},a);if(l===p||l===u){i.defaultConditions=[V(j)]}else if(S(a,"searchableFields","length")){i.defaultConditions=[V(x),V(D,a)]}return i})},getActions:I.getActionsStatic,extendedProperties:{composer:{unomittableFields:true,hasEntityOptions:true,rebuildPropsOnSelectEntity:true}}})})(e)}});return t});