skuid.runtime.registerApi("v2","dataSourceTypes/amazonDynamoDB",function(e){var t=function(e){var t={};function n(i){if(t[i]){return t[i].exports}var r=t[i]={i:i,l:false,exports:{}};e[i].call(r.exports,r,r.exports,n);r.l=true;return r.exports}n.m=e;n.c=t;n.d=function(e,t,i){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:i})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(e,t){if(t&1)e=n(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var i=Object.create(null);n.r(i);Object.defineProperty(i,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=705)}({705:function(t,n){(function(e){let t=e.$,n=t.map,i=t.each,r=e.utils,a=r.parseAsJSONIfString,o=t.isPlainObject,u=e.dataSource,l=u.utils,s=e.constants,f=s.DISPLAY_TYPES,d=s.HTTP_VERBS,c=r.grab,p="AmazonDynamoDB",y="application/json",m=f.ARRAY,b=f.BOOLEAN,h=f.DOUBLE,g=f.NUMBER,x=d.POST,S=s.DATASOURCE.SEARCH_CONDITION,N={S:"TEXT",N:h,BOOL:b,B:"TEXT",NS:m,SS:m,L:m,M:"OBJECT",NULL:b},E={},T=r.setObjectProperty,I=r.getObjectProperty;E[g]="N";E[h]="N";E[b]="BOOL";E["TEXT"]="S";E[m]="L";E["OBJECT"]="M";let O={S:true,N:true,B:true};function P(t,n,i,o){let u={method:t},l;if(i)u.body=i;if(o){l=n.getCacheProperty(JSON.stringify(u));if(l){return r.resolve(a(l))}}return e.ajax.direct({url:"/core/data/aws",type:"POST",body:u,contentType:"application/json",headers:{"x-skuid-data-source-name":n.name}}).then(function(e){if(o){n.setPersistentCacheProperty(JSON.stringify(u),e.body)}return a(e.body)},function(e){let t=e.status;try{let n=JSON.parse(e.body);if(n&&n.message){t+=": "+n.message}}catch(e){}throw t})}function A(){let e=0;return function(){return e++}}function M(e){return e&&(e.dynamotype||E[e.displaytype])||"S"}function j(e,t){let r=n(t.fieldsMap,function(e){if(e.key)return e.id}),a="";i(r.sort(),function(t,n){a+=JSON.stringify({v:e[n]})});return a}if(u.getDataSourceType(p))return;function v(e,t,n,a,o,u){let l=true,s,f=a.FilterExpression||"",d=a.ExpressionAttributeValues,c=a.ExpressionAttributeNames,p=B(t);i(t.fieldsMap,function(t){let n=p[t];let i=":arg"+o();let y={},m=M(n);if(m!=="S")return;let b=r.getUnescapedParts(t);if(b.length>1)return;if(!u&&n.key){return}y[m]=e;d[i]=y;let h=R(t,c,o,a);if(f.length&&l){f="("+f+")"+" AND (";s=true}else if(!l){f+=" OR "}l=false;f+="contains ("+h+", "+i+")"});if(s)f+=")";a.FilterExpression=f}function F(e,n){let a={};i(e,function(e,i){if(i.inactive)return;let o;if(i.value&&i.type!=="multiple"){o=r.mergeAsTextInContext(i.value,n)}else if(i.values&&i.values.length){o=t.map(i.values,function(e){return r.mergeAsTextInContext(e,n)})}if(o){if(a.hasOwnProperty(i.field)){if(r.isObject(a[i.field])&&a[i.field].hasMultipleOfSameField){a[i.field].values.push(o)}else{a[i.field]={hasMultipleOfSameField:true,values:[a[i.field],o]}}}else a[i.field||i.name]=o}});return a}function C(e,n){let i=e.length;if(!n){return t.map(e,function(e){return e.expression}).join(" AND ")}for(;i>0;i--){n=n.replace(e[i-1].order," "+e[i-1].expression+" ")}return n}let D={"=":"=","!=":"<>",gt:">",lt:"<",gte:">=",lte:"<="};function k(e,t,n,i){if(i){if(n==="!="){return"attribute_exists("+e+")"}return"attribute_not_exists("+e+")"}n=n||"=";if(D[n]){return e+" "+D[n]+" "+t}if(n==="contains"){return"contains ("+e+", "+t+")"}if(n==="does not contain"){return"NOT (contains ("+e+", "+t+") ) "}if(n==="starts with"){return"begins_with ("+e+", "+t+")"}if(n==="does not start with"){return"NOT (begins_with ("+e+", "+t+") ) "}if(n==="in"){return e+" IN ("+t.join(", ")+")"}if(n==="not in"){return"NOT ("+e+" IN ("+t.join(", ")+") ) "}}function L(){let e={};let n={};let i={};let r=[];return{addSubName:function t(r,a,o,u){i[o]=1;if(e[a])return e[a];if(u){return r}n[r]=a;e[a]=r;return r},getMap:function e(){return n},getFinalMap:function e(){t.each(r,function(e,t){delete n[t]});return n},getInverseMap:function t(){return e},candidateForRemoval:function e(t){r.push(t)},getFieldsAccountedFor:function e(){return i}}}function w(e,t){let n=false;if(!t&&e){throw Error("Model's specified index does not contain a field key in use.")}if(e){t.forEach(function(t){if(t===e){n=true}})}else{n=true}return n}function _(t,n,a,o){let u=true,l=t&&t.conditions||[],s=a.FilterExpression||"",f=a.KeyConditionExpression||"",d=a.ExpressionAttributeValues,c=a.ExpressionAttributeNames,p=t.conditionLogic||"",y=[],m=B(t),b=e.model.getCustomPropertyValue(t,"indexby");i(l,function(e,l){let s=l.field,p=n[s],h=!!t.fieldsMap[s],g=h&&m[s],x=l.operator,S=l.type==="blank",N=l.type==="multiple";if(r.isObject(n[s])&&n[s].hasMultipleOfSameField){p=n[s].values.shift()}if(l.inactive||p===undefined||!g)return;let E,T=[],I={},P=M(g);if(!S){if(!N){E=":arg"+o();I={};I[P]=O[P]?p+"":p;d[E]=I}else{i(p,function(e,t){let n=":arg"+o();I={};I[P]=O[P]?t+"":t;d[n]=I;T.push(n)})}}let A=R(s,c,o,a,true);if(g.key&&w(b,g.indexesFound)){u=false;if(f.length)f+=" AND ";f+=k(A,E,x)}else{y.push({order:e+1,expression:k(A,E||T,x,S)})}});if(y.length){s=C(y,p)}a.FilterExpression=s;a.KeyConditionExpression=f;if(b){a.IndexName=b}return u}function B(e){let t=e.objectName;let n=e.dataSource;let i=c(n,"entityMetadataCache",t);if(i){return i.getFieldsMap()}return{}}function q(e,n){let i=e.model,r=i&&i.conditions,a=A(),o=true,u=F(r,e),l=n.ExpressionAttributeNames;if(!t.isEmptyObject(u)){o=_(i,u,n,a)}let s=u[S];if(s){v(s,i,u,n,a,o)}let f=l.getFieldsAccountedFor();t.each(i.fields,function(e,t){if(!f[t.id]){R(t.id,l,a,n)}});if(i.recordsLimit|0){n.Limit=i.recordsLimit|0}return{method:o?"scan":"query",body:n}}function K(e,t,n){let a="";i(r.getUnescapedParts(e),function(i,r){let o="#subName"+n();if(a)a+=".";o=t.addSubName(o,r,e);a+=o});return a}function R(e,t,n,a,o){let u="";i(r.getUnescapedParts(e),function(i,r){let a="#subName"+n();if(u)u+=".";a=t.addSubName(a,r,e,!o);u+=a});U(a,u,e,t);return u}function U(e,n,i,a){let o=e.ProjectionExpression;let u=n;let l=r.getUnescapedParts(i)[0];if(n.indexOf(".")!==-1){u=n.split(".")[0]}a.addSubName(u,l,i);if(!o){e.ProjectionExpression=u}else{let n=t.map(o.split(","),function(e){return e.trim()});if(n.indexOf(u)===-1){e.ProjectionExpression+=", "+u}}}function V(e,t){if(!e)return;let n=function e(n,i,a){let o=false;if(!r.isObject(i))o=true;a=a||[];let u=[].concat(a);t(n,i,u,o);l.safeEach(i,function(t,i){u=[].concat(a);u.push(n);e(t,i,u)})};l.safeEach(e,n)}function J(e,t,n){if(!r.isObject(e))return;let i=e;for(let e=0;e<t.length;e++){let r=t[e];let a=e===t.length-1;if(i&&i[r]&&!a){i=i[r]}else if(!a){i[r]={};i=i[r]}else{i[r]=n;return}}}function H(e,t,n){if(I(e,t)){return}T(e,t,n)}function z(e,t,n){let r={};t=t||{};i(e,function(e,i){G(r,e,i,"",t,n)});return r}function G(e,t,n,a,u,l){let s=r.escapeFieldName(t);if(a)a+=".";a+=s;let f=Object.keys(n)[0];if(u&&u[a]&&!u[a].dynamotype){u[a].dynamotype=f}if(!o(n[f])){if(l){return H(e,a,f)}if(f==="N"){return T(e,a,parseFloat(n[f]))}return T(e,a,n[f])}if(l){return H(e,a,"M")}i(n[f],function(t,n){G(e,t,n,a,u,l)})}function X(e,n,i,r,a){let o=r.UpdateExpression;let u=Object.keys(n);let l=t.map(e,function(e,t){let o=u.filter(function(e){return e.indexOf(t+".")===0});return W(t,o,n,e,i,r,a)}).filter(function(e){return!!e}).join(", ");return o+l}function Y(e){if(e.originalItemPayload){e.originalItemPayloadDigest={};t.each(e.originalItemPayload,function(t,n){let i=z(n);e.originalItemPayloadDigest[j(i,e)]=i});delete e.originalItemPayload}else if(!e.originalItemPayloadDigest){e.originalItemPayloadDigest={}}}function Q(e,t){Y(e);let n=e.originalItemPayloadDigest||{};let i=j(t,e);return n[i]}function W(e,n,i,a,o,u,l){if(!n.length)return;let s="";let f={};let d={};let c=u.ExpressionAttributeValues;d[e]=a;t.each(n,function(e,n){let a=ee(n,i,o);let c=[];let p=n.split(".");let y="";t.each(p,function(e,t){let n=e===p.length-1,i,o;c.push(t);if(a[e]&&!n){return}else if(!a[e]&&!n){y=c.join(".");o=r.getObjectProperty(d,y);$(y,o,u,f,l);return false}else if(n){y=c.join(".");i=r.getObjectProperty(d,y);s=s?s+", ":"SET ";s+=c.join(".")+" = "+i;return}})});if(r.size(f)){if(s){s+=", "}s+=t.map(f,function(e,t){let n=":arg"+l();c[n]=e;return"SET "+t+" = "+n}).join(", ")}return s}function $(e,n,i,r){if(r[e])return;let a={};let o=i.ExpressionAttributeValues;let u=i.ExpressionAttributeNames;let l=u.getMap();r[e]=a;let s=[];let f=[];V(n,function(e,t,n,i){let r=n.length?n.join("."):"";f.push(e);if(i){s.push(t);if(r)r+=".";r+=e;J(a,Z(l,r),o[t])}});t.each(f,function(e,t){u.candidateForRemoval(t)});t.each(s,function(e,t){delete o[t]})}function Z(e,n){let i=n.split(".");return t.map(i,function(t){return["M",e[t]]})}function ee(e,t,n){let i=t[e],a=r.getUnescapedParts(i),o="",u=[];a.pop();for(let e in a){if(o)o+=".";o+=a[e];if(!r.isUndefined(r.getObjectProperty(n,o))){u.push(a[e])}}return u}function te(e,n){if(!e)return;t.each(e,function(e,i){let r=i.fieldId;let a=r.split(".");let o=a.splice(-1);let u=i.changes;let l=t.map(a,function(e){return[e,"M"]}).concat([o]).join(".");T(n,l,u)})}function ne(e,t,n,i){let r=[];V(t,function(t,n,a,o){if(!o)return;let u=[e].concat(a).concat(t);let l=u.join(".");let s=i.fieldsMap[l];let f=M(s);let d={};d[f]=O[f]?n+"":n;let c={fieldId:l,changes:d};r.push(c)});te(r,n)}function ie(e,t){let n=true;e.filter(function(e){if((e.id===t).length!=0){n=false}});return n}function re(e,t){let n=[];e.KeySchema.forEach(function(e){n.push(e.AttributeName)});n.forEach(function(n){t[n]?t[n].push(e.IndexName):t[n]=[e.IndexName]})}function ae(e,t){let n=t.Table.KeySchema,i=t.Table.GlobalSecondaryIndexes,a=t.Table.LocalSecondaryIndexes,o=[],u={};if(i){i.forEach(function(e){o.push(e.IndexName);re(e,u);n=n.concat(e.KeySchema)})}if(a){a.forEach(function(e){o.push(e.IndexName);re(e,u);n=n.concat(e.KeySchema)})}n=r.keyBy(n,"AttributeName");return{secondaryIndexNames:o,secondaryIndexNameToFieldMap:u,keySchema:n}}function oe(e){let t=[];if(e){e.forEach(function(e){t.push({label:e,value:e})});return t}}function ue(e,t){for(let n in e){e[n].indexesFound=[];if(t[e[n].id]){e[n].indexesFound=t[e[n].id]}}}new u.core.RESTDataSourceTypeBase({name:p,updateFieldMetadata:()=>{},coerceRequest:function e(n){let a=n.type,o=n.model,u=o?o.getDataSource().name:null,s=n.request,f=n.row,d=this.getEntityMetadataCacheKey(o),c=a==="delete",p=a==="query",y=a==="insert",m=a==="update",b={},h=L(),g={},x="",S={TableName:d,ExpressionAttributeNames:h,ExpressionAttributeValues:g},N=A();if(p){s.data=q(n,S)}if(y){i(s.data,function(e,t){if(r.isObject(t)){return ne(e,t,b,o)}let n=o.fieldsMap[e];if(n){let i={};let r=M(n);t=O[r]?t+"":t;i[n.dynamotype||"S"]=t;b[e]=i}});S.Item=b;n.ItemJustAdded=b;s.data={method:"putItem",body:S}}if(m||c){i(o.fields,function(e,t){if(t.key){let e={};let n=t.dynamotype||"S";let i=f[t.id];i=O[n]?i+"":i;e[n]=i;b[t.id]=e}});S.Key=b}if(m){let e=r.getModelFieldIdChanges(s.data);let t={};let n={};i(e,function(e,i){let r=":arg"+N();let a=o.fieldsMap[e];if(a){let o=K(e,h,N,S),u={},l=a.dynamotype||E[a.displaytype]||"S";u[l]=O[l]?i+"":i;g[r]=u;if(o.split(".").length>1){T(t,o,r);n[o]=e}else{x=x?x+", ":"SET ";x+=o+" = "+r}}});S.UpdateExpression=x;S.ReturnValues="ALL_NEW";if(Object.keys(t).length){S.UpdateExpression=X(t,n,Q(o,f),S,N)}s.data={method:"updateItem",body:S}}if(c){s.data={method:"deleteItem",body:S}}S.ExpressionAttributeNames=S.ExpressionAttributeNames.getFinalMap();if(s.data.body){s.data.body=l.trimEmptyParameters(s.data.body)}t.extend(s,{headers:{"x-skuid-data-source-name":u},method:"POST",url:"/core/data/aws"})},getConditionSourceProperties:function t(n,i){let r=e.builder.core;if(i.renderMode==="propsonly"){return r.getConditionParameterProperties(n,{url:i.url})}else{return[]}},getExtendedModelProperties:function t(n,i,r,a){let o=e.builder.core.createDSTSpecificProp,u=a.getCachedEntityMetadata(n),l=c(u,"_m","secondaryIndexNames")?oe(u._m.secondaryIndexNames):null,s=[{label:"Primary Index",value:""}];if(l){s=s.concat(l);return{basic:[o({id:"indexby",type:"picklist",label:"Query by Index",picklistEntries:s,defaultValue:"",helptext:"If querying by a secondary index, please specify the IndexName you are querying against."},a.dataSourceType,r)]}}},getRowId:j,getPaginationToken:function e(t){let n=a(t.body);return n.LastEvaluatedKey},applyPaginationToken:function e(t,n){if(!c(t,"data","body"))return;t.data.body.ExclusiveStartKey=n},parseSuccessfulLoadResponse:function e(n,i,o,u){let l=this,s=a(n.body),f=i.pathToContent,d=f?r.getObjectProperty(s,f):s;o.originalItemPayload=d;l.getKeyFieldsFromMetadata(u,o);return t.isArray(d)?d.map(function(e){return z(e,u.fieldsMap)}):[]},postSaveHook:function e(t,n){let i=t.body;let r=n.model;let a;let o;Y(r);let u=r.originalItemPayloadDigest||{};if(n.type==="update"){a=z(i.Attributes,r.fieldsMap);o=j(a,r);u[o]=a}else if(n.type==="insert"){a=z(n.ItemJustAdded,r.fieldsMap);o=j(a,r);u[o]=a;delete n.ItemJustAdded}else if(n.type==="delete"){delete u[n.originalRecordId]}},getKeyFieldsFromMetadata:function e(n,r){if(!r.fields||!n.fields)return;i(r.fields,function(e,r){if(!r.key)return;i(n.fields,function(e,n){if(r.id!==n.id)return;t.extend(n,r);return-1})})},getEntityList:function e(t){return P("listTables",t.dataSource).then(function(e){return n(e.TableNames,function(e){return{value:e,label:e}})})},setDefaultConditionState:function e(t){t.sourceType="fieldvalue";t.type="fieldvalue";t.operator="=";t.encloseValueInQuotes=true},queryEntityMetadata:function e(n,a){const o=this.getEntityMetadataCacheKey(n);if(!o)return r.reject("No Entity was selected for this Model.");let u,l;return Promise.all([P("describeTable",a.dataSource,{TableName:o},true).then(function(e){u=e}),P("scan",a.dataSource,{TableName:o,Limit:25},true).then(function(e){l=e})]).then(function(){let e=u.Table.AttributeDefinitions,a=[],s={},f=ae(n,u),d=f.keySchema,p=f.secondaryIndexNames,m=f.secondaryIndexNameToFieldMap;if(c(n,"fields","length")){i(n.fields,function(e,t){s[t.id]=t;a.push(t)})}i(e,function(e,n){let i=n.AttributeName,r=d[i],o=s[i];if(!o){o={id:n.AttributeName,label:n.AttributeName,displaytype:N[n.AttributeType],dynamotype:n.AttributeType,createable:true,editable:false,filterable:true,groupable:false,omittable:false,key:r&&r.KeyType,required:true};a.push(o)}else{t.extend(o,{omittable:false,dynamotype:n.AttributeType,createable:true,editable:false,key:r&&r.KeyType,required:true});if(!o.label){o.label=n.AttributeName}if(!o.displaytype){o.displaytype=N[n.AttributeType]}}o.accessible=true});let b=t.map(l.Items,function(e){return z(e,{},true)});let h={};t.each(b,function(e,n){t.each(n,function(e,t){if(!h[e])h[e]=t})});t.each(h,function(e,n){if(d[e])return;let i=s[e];let o=N[n];if(i){let e={dynamotype:n,displaytype:o,createable:true,editable:true,required:false};t.each(e,function(e,t){if(r.isUndefined(i[e])){i[e]=t}})}else{if(ie(a,e)){a.push({id:e,displaytype:o,createable:true,editable:true,filterable:true,required:false,label:e,dynamotype:n})}}});ue(a,m);return{secondaryIndexNames:p,secondaryIndexNameToFieldMap:m,label:o,labelPlural:o,fields:a,methods:{query:{url:"",verb:x,contentType:y,pathToContent:"Items"},insert:{url:"",verb:x,contentType:y,receiveDataAs:"recordinbody",successIf:"requestsucceeds",successField:"ok",successValue:"true"},update:{url:"",verb:x,contentType:y,receiveDataAs:"recordinbody",successIf:"requestsucceeds"},delete:{url:"",verb:x,contentType:y,successIf:"requestsucceeds"}}}})},shouldIgnoreCache:function e(){return false},extendedProperties:{onlySupportsClientSideFieldConditions:false,composer:{unomittableFields:true,hasEntityOptions:true,modelConditionLabel:"Condition",modelConditionsLabel:"Conditions",canFieldsBeSelected:function e(){return true},validConditionOperators:function t(n,i){let r=n.find("field"+"#"+i.attr("field"));let a=n.attr("x-entityname");let o=e.dataSource.getDataSource(n.attr("datasource"));let u=["","=","!=","gt","lt","gte","lte","in","not in","starts with","contains","does not contain","does not start with"];if(!o||!r.length||!a){return u}let l=o.entityMetadataCache[a];if(!l)return u;let s=l.getField(i.attr("field"));if(!s||!s.key)return u;if(s.key==="HASH")return["="];return["=","gt","lt","gte","lte","starts with"]}},runtime:{metadataSource:"hybrid"},canConditionsBeGrouped:false,canAutoGenerateConditionsFromFields:true,initializeConditionLogic:false,hasDefaultSearch:true,canServerSearch:true}})})(e)}});return t});