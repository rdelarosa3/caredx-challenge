skuid.runtime.registerApi("v2","dataSourceTypes/salesforce",function(e){var t=function(e){var t={};function n(r){if(t[r]){return t[r].exports}var i=t[r]={i:r,l:false,exports:{}};e[r].call(i.exports,i,i.exports,n);i.l=true;return i.exports}n.m=e;n.c=t;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(e,t){if(t&1)e=n(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var r=Object.create(null);n.r(r);Object.defineProperty(r,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=726)}({726:function(t,n){(function(e){const t=e.constants,n=t.DISPLAY_TYPES,r=t.LIGHTNING,i=n.REFERENCE,a=t.SALESFORCE,o=t.VISUALFORCE,l=n.BOOLEAN,s=n.INTEGER,c=n.DATE,u=n.DATETIME,d="x-salesforce-save-api-version",f=2,p="Could not upload file",m="compressedRecordTypeMetadata",h="picklistToIndexMapMetadata",g="_decompressedRecordTypeMetadata",b="_failedToGetRecordTypeMetadata",y="_recordTypeIdsAlreadyFetching",S="Approve",v="Reject",C="Removed",N=e.$,I=e.utils,T=e.dataSource,A=T.utils,R=A.splitAndTrimStringsToArray,F=A.validateEmailAddresses,w=A.partitionRecipients,j=e.sfdc,k=j.api.version,E={},P={Case:"CaseNumber",ContentDocument:"Title",ContentVersion:"Title",CustomPermission:"MasterLabel",Event:"Subject",FeedItem:"Title",Idea:"Title",PartnerNetworkConnection:"ConnectionName",Solution:"SolutionName",Task:"Subject",WorkOrder:"WorkOrderNumber"},M={CampaignMember:1,AccountContactRole:1,OpportunityContactRole:1,ContractContactRole:1,CaseContactRole:1,CaseComment:1,CaseSolution:1,OpportunityLineItem:1},_="RecordType",O=_+"Id",x={},{Deferred:L,encodeHTML:U,getInvokable:D,inPlatform:V,isString:B,makeXMLDoc:q,mergeAsTextInContext:H,resolve:W,startsWith:z,toArray:Y}=e.utils;N.each([n.BUTTONGROUP,n.COMBOBOX,n.MULTIBUTTONGROUP,n.MULTIPICKLIST,n.PICKLIST],(e,t)=>{x[t]=true});let $=1;let G;function J(e,t,n){let r,i;if(!n._metadataCacheVersion||n._metadataCacheVersion===0){for(r=0;r<t.length;r++){if(!t[r].hasMetadataLoaded())return false}return true}for(r=0;r<e.length;r++){let a=e[r],o=t[r],l={},s=n.entityMetadataCache[a.objectName];if(o.hasMetadataLoaded()){continue}if(!a.hasOwnProperty("accessible")){return false}if(!a.fields){continue}if(!s||!s._m||!s._m.fields){return false}else{let e=s._m.fields;N.each(e,function(t,n){if(n.rel&&n.referenceTo){l[n.rel]={fieldFrom:n.id,entityAssociated:n.referenceTo[0].o?n.referenceTo[0].o:n.referenceTo[0].objectname}}l[n.id]=e[t]});for(i=0;i<a.fields.length;i++){let e=a.fields[i];if(e.id.indexOf(".")!==-1){let t=fe(e.id),r=s&&t&&s.getField&&s.getField(t);if(r){let e=r.referenceTo;if(e&&e.length===1){s=n&&n.getCachedEntityMetadata(e[0].objectName||e[0].o)}else if(e&&e.length>1){s=n&&n.getCachedEntityMetadata("Name")}if(!s){return false}}}else if(!l[e.id]){return false}}}o.setMetadataHasLoaded()}return true}function K(e){return e===c||e===u}function Q(e){if(!e)return true;if(V([o,r])){if(typeof e==="string")return e===a;else if(typeof e==="object")return e.name===a}return false}function X(e){return Q(e.getDataSource())}function Z(){return window.sforce&&sforce.one?sforce.one:false}function ee(){return e.platform.isInConsoleEnvironment&&e.platform.isInConsoleEnvironment()}function te(){return e.platform.getConsoleNavigationMethods&&e.platform.getConsoleNavigationMethods()}function ne(e,t){if(I.getWindowLocation().href.indexOf("/lightning/")>-1){return"/lightning/r/".concat(t,"/").concat(e,"/view")}else{return"#/sObject/".concat(e,"/view")}}function re(e){return function(t){if(t.metaKey)return;t.preventDefault();e()}}function ie(e){return re(function(){window.$A.get("e.force:navigateToSObject").setParams({recordId:e}).fire()})}function ae(e){return re(function(){sforce.one.navigateToSObject(e)})}function oe(e,t,n){const r=te();return re(function(){r&&r.openConsoleTabForField(e,t,n)})}function le(){return V(r)&&!!window.$A}function se(e,t){let{model:n,id:r,row:i}=e.getState(),a=n.getField(r),o=a.controllingField,l=o&&n.getField(o),s=a.picklistEntries,c=function e(t,n){let r=new sforce.Base64Binary(""),i=r.decode(n),a=i.charCodeAt(t>>3);return(a&128>>t%8)!==0},u,d,f,p=[];if(!o||!l)return t||s;d=n.getFieldValue(i,o,true);if(t&&t.length){u={};N.each(t,function(){u[this.value]=1})}if(l.displaytype==="BOOLEAN"){f=d?1:0}else{N.each(l.picklistEntries,function(e,t){if(t.value===d){f=e}})}if((f||f===0)&&s){N.each(s,function(e,t){if(c(f,t.validFor)&&(!u||t.value in u)){p.push(t)}})}return p}function ce(e){let{model:t,row:n,id:r,picklistOptions:i}=e.getState(),a=t.objectName,o=t.getField(r),l=o.id.toLowerCase()==="recordtypeid",s=o.picklistEntries||[],c=[],u=t.getFieldValue(n,O,true);if(o.uiOnly||o.overrideMetadata&&s.length&&o.customPicklistEntriesProvided){return A.deferrable(s)}if(l){return A.deferrable(Ct(e))}if(u&&!c.includes(u)){c.push(u)}if(c.length){return St(a,r,c,t).then(function(t){if(!t){t=i||o.picklistEntries}return se(e,t)})}return A.deferrable(se(e))}function ue(e){while(B(e)){try{e=JSON.parse(e)}catch(e){break}}return e}function de(e,t,r,a){if(!t)return;let o,l,d=t.split("."),f,p,m,h,g=a.getDataSource&&a.getDataSource();if(e.type==="childRelationship"){p=e.referenceTo&&e.referenceTo.length&&e.referenceTo[0];if(p){m=g&&g.getCachedEntityMetadata(p.o);h=e.subFields;if(h){N.each(h,function(e,t){de(t,t.id,m,a)})}}}else if(d.length===1){o=r&&r.getField&&r.getField(t);if(o){l=a.getOverrideableFieldMetadata(e);let t=e.id,n=e.name;N.extend(true,e,o);if(t)e.id=t;if(n)e.name=n;if(l){N.each(l,function(t,n){e[t]=n})}}if(e&&e["function"]){let t=e["function"];if(t){t=t.toUpperCase();const r=g&&g.getDisplayTypeForFieldFunction(t,e);if(t.lastIndexOf("COUNT",0)===0){e.displaytype=n.INTEGER}else if(K(e.displaytype)&&r===s){e.displaytype=n.STRING}else if(e.displaytype===u&&r===c){e.displaytype=c}e.required=e.createable=e.editable=false}}if(e&&e.displaytype===i){let t,n,r,i;if(!e.relationshipName){e.relationshipName=e.rel}if(!e.ref&&e.referenceTo){t=e.referenceTo;if(t&&t.length){n=[];r=[];i={c:"createable",o:"objectName",l:"label",k:"keyPrefix",p:"labelPlural",s:"searchable"};N.each(t,function(e,t){if(t.o){n.push(t.o);r.push(t.k);N.each(i,function(e,n){t[n]=t[e];delete t[e]});t.accessible=true}});if(n.length)e.ref=n.join(",");if(r.length)e.refprefix=r.join(",")}}}}else{t=d.shift();t=fe(t);o=r&&t&&r.getField&&r.getField(t);if(o){f=o.referenceTo;if(f&&f.length===1){r=g&&g.getCachedEntityMetadata(f[0].objectName||f[0].o)}else if(f&&f.length>1){r=g&&g.getCachedEntityMetadata("Name")}if(r){de(e,d.join("."),r,a)}}e.required=e.createable=e.editable=false}}function fe(e){let t=e.split(".")[0];if(I.endsWith(t,"__r")||I.endsWith(t,"__pr")){return t.substring(0,t.length-1)+"c"}else{return t+"Id"}}function pe(e){if(I.endsWith(e,"__c")||I.endsWith(e,"__pc")){return e.substring(0,e.length-1)+"r"}else{return e.substring(0,e.length-2)}}function me(e){return I.contains(e,".")}function he(t){if(t.metadataCacheVersion){t._metadataCacheVersion=t.metadataCacheVersion;delete t.metadataCacheVersion}if(t.name===a&&V(r)){t.serviceUrl="https://".concat(e.settings.site("host"))}}function ge(e){if(e&&e.fields&&e.fields.length){let t=e.getDataSource&&e.getDataSource();let n=t&&t.getCachedEntityMetadata(e.objectName);N.each(e.fields,function(t,r){de(r,r.id,n,e)})}return e}function be(e){if(!e)return"";let t=e.statusCode,n=e.body,r=t&&e.status?t+" "+e.status+": ":"";n=ue(n);if(n instanceof Array&&n.length===1){r+=n[0].message}else if(n&&n.message){r+=n.message}else if(e.error){r+=e.error}return r}function ye(n){let r=I.combineUrls(n.serviceUrl,"/services/apexrest/skuid/api/v1/"),i=function i(o,l="models"){return function(i){let s=L(),c=i&&!B(i)?JSON.stringify(i):i||null,u,d=0,f,p;if(n.name===a){p=[];if(c){p.push(c)}p.push(function(t,r){let i;if(r.status){if(B(t)){try{t=JSON.parse(t)}catch(e){}}s.resolve(t)}else{i=r.message;if(e.platform.isPlatformSessionError(i,n)){e.platform.attemptLogin(d).then(function(){d++;e.remote()[o].apply(window,p)}).catch(function(){s.reject(i)})}else{s.reject(i)}}},{escape:false});e.remote()[o].apply(window,p)}else{let e=r+l;u=c?"POST":"GET";f={method:u,url:e,headers:{"x-skuid-rest-service-method":o,"X-SKUID-REST-SERVICE-METHOD":o}};if(u==="POST"){f.body=c;f.contentType="application/json"}n.makeRequest(n.createHTTPRequest(f)).then(function(e){let n=e.body,r=e.statusCode;if(e.error){s.reject(e.error)}else if(n){n=ue(n);if(N.inArray(r,[200,201,204])<0){s.reject(be(e))}else{if(n&&n.error&&I.size(n)===1){if(n.error==="Invalid Skuid Model API request method: null"&&V(t.NATIVE)){s.reject("The version of Skuid installed in the target Salesforce org "+"is not compatible with Skuid Platform. "+"Please install the latest version of Skuid into this Salesforce org.")}else{s.reject(n.error)}}else{s.resolve(n)}}}},function(e){s.reject(be(e))})}return s.promise()}};const o={};[{name:"load",pathName:"models"},{name:"save",pathName:"models"},{name:"getModelMetadata",pathName:"models"},{name:"getEntityList",pathName:"models"},{name:"doSearch",pathName:"models"},{name:"checkMetadataApiAccess",pathName:"models"},{name:"approvalsProcessWorkItem",pathName:"approvals"},{name:"approvalsUnlockRecord",pathName:"approvals"},{name:"sendEmail",pathName:"models"}].forEach(e=>{o[e.name]=i(e.name,e.pathName)});n._sfdcRemote=o;return o}function Se(e){let t=e._sfdcRemote;if(!t)t=new ye(e);return t}function ve(){return e.utils.userInfo}function Ce(e){let t=e.fields,n=e.file,r=e.payloadField,i=e.url,o="formboundary"+Math.random().toString(36).substr(2,10),l=e.filename||n.name,s=e.dataSource,c={},u;u=new Blob(["--boundary_"+o+"\n"+'Content-Disposition: form-data; name="entity_content";'+"\n"+"Content-Type: application/json"+"\n\n"+JSON.stringify(t)+"\n\n"+"--boundary_"+o+"\n"+"Content-Type: "+n.type+"\n"+'Content-Disposition: form-data; name="'+r+'"; filename="'+l+'"\n\n',n,"\n"+"--boundary_"+o+"--"],{type:'multipart/form-data; boundary="boundary_'+o+'"'});let d=s.createHTTPRequest({url:i,headers:c,method:"POST"});d.headers.Accept="application/json";if(s.name===a){d.headers.Authorization="Bearer "+ve().sessionId}N.extend(d,{body:u,cache:false,contentType:s.useProxy?'multipart/form-data; boundary="boundary_'+o+'"':false,processData:false});if(I._ie){d.contentType='multipart/form-data; boundary="boundary_'+o+'"'}return s.makeRequest(d)}function Ne(e){let t=e.path,n=e.basePath||"";if(e.dataSource&&e.dataSource.name===a){n=""}e.accessToken=e.accessToken||ve().sessionId;e.url=I.getSafeRelativeUrl(n+"/services/data"+t);return Ce(e)}function Ie(e,t,n,r){let i=[],a={errors:i},o=true,l;function s(t,n){let r=e[t];if(!r||r.length!==n){o=false}else{for(l=0;l<n;l++){if(!r[l].success){if(r[l].errors&&r[l].errors.length){Array.prototype.push.apply(i,r[l].errors)}o=false}}}}t&&s("insertResults",t);n&&s("updateResults",n);r&&s("deleteResults",r);a.success=!i.length&&o;return a}function Te(e,t,n,r,i){let a=n.uploadMethod.dataSource;I.readFileAsBase64(e).then(function(o){let l=[],s={},c={},u={},d=t.model,f=t.row,p=t.options.xmlDef,m=t.ownerIdField||p&&p.attr("owneridfield")||"",h=f&&d?d.getRowId(f):null,g=f&&m&&f[m]?f[m]:"",b,y,S,v,C;s.id="imageAttachmentUpload";s.type="Attachment";c.id="imageImageInsert";c.type="skuid__Image__c";u.id="updateObject";u.type=d.objectName;y=n.description?H(n.description,{row:f,model:d},{createFields:false}):"";v=n.filename?H(n.filename,{row:f,model:d},{createFields:false}):e.name;S=t.fieldValue;b=t.fileId;if(n.storeAs==="field"){if(b&&S){c.id="imageImageUpdate";c.updates={};c.updates[S]={Name:v};s.deletes={};s.deletes[b]={Id:b};s.inserts={1:{ParentId:S,Body:o,Name:v,ContentType:e.type,Description:y}};l.push(s,c);C="AttachmentUpdate"}else if(S){c.id="imageImageUpdate";c.updates={};c.updates[S]={Name:v};s.inserts={1:{ParentId:S,Body:o,Name:v,ContentType:e.type,Description:y}};l.push(s,c);C="CreateAttachmentToImage"}else{c.inserts={1:{}};s.inserts={2:{ParentId:"1",Body:o,Name:v,ContentType:e.type,Description:y}};u.updates={};u.updates[h]={};u.updates[h][t.fieldName]="1";l.push(c,s,u);C="CreateFileAndAttachment"}}else if(n.storeAs==="record"){s.inserts={1:{ParentId:h,Body:o,Name:v,ContentType:e.type,Description:y}};if(g){s.inserts["1"].OwnerId=g}l.push(s);C="CreateAttachment"}r({fileName:v});Se(a).save(JSON.stringify({operations:l,rollbackOnAnyError:true})).then(function(e){let n,r,a,o,l=e.insertResults,s=t.fieldValue,c;if(C==="AttachmentUpdate"){c=Ie(e,1,1,1);if(c.success){n=l[0].id;r=s}else{o="Failure Updating Attachment";a=c.errors}}else if(C==="CreateAttachmentToImage"){c=Ie(e,1,1,0);if(c.success){n=l[0].id;r=s}else{o="Failure Creating Attachment";a=c.errors}}else if(C==="CreateAttachment"){c=Ie(e,1,0,0);if(c.success){n=l[0].id}else{o="Failure Creating Attachment";a=c.errors}}else if(C==="CreateFileAndAttachment"){c=Ie(e,2,1,0);if(c.success){n=l[1].id;r=l[0].id}else{o="Failure Creating File and Attachment";a=c.errors}}if(o&&a&&a.length){o+=": "+N.map(a,function(e){return e.message}).join(", ")}i({newFileId:n,newFieldValue:r,newFileName:v,message:o})},function(e){i({message:e&&e.error})})},function(e){i(e)})}function Ae(e){let t=L(),n=e.paramString||"",r=e.dataSource,i=e.fileField,o=e.context,l,s,c,u,d;if(o){let{model:e,row:t}=o;if(o.id){c=o.id}else if(t){if(i){u=e.getField(i);if(u&&u.displaytype==="REFERENCE"){s=i.substr(0,i.length-1);c=I.getObjectProperty(t,s+"r.skuid__AttachmentId__c")}else{c=I.getObjectProperty(t,i)}}else if(e){l=e.objectName;if(l==="skuid__Image__c"){c=t.skuid__AttachmentId__c}else if(l==="Attachment"){c=e.getRowId(t)}}}}if(c){if(r.name===a){t.resolve(I.getUrlFromAttachmentId(c+n))}else{d=r.serviceUrl+"/services/data/v"+k+"/sobjects/Attachment/"+c+"/body";r.authenticate().then(function(){return r.makeRequest(r.createHTTPRequest({url:d,accept:"application/octet-stream"}))}).then(function(e){t.resolve("data:;base64,"+e.body)},function(e){t.reject(e)})}}else{t.reject("No Attachment Id")}return t.promise()}function Re(t,n){if(B(t)){return n({message:p+": "+t})}n({message:e.ajax.getErrorMessage(t,p)})}function Fe(t,n,i,o,l,s){let c=i.uploadMethod.dataSource,{model:u,row:d}=n,f={model:u,row:d},p={createFields:false},m=n.options.xmlDef,h=n.ownerIdField||m&&m.attr("owneridfield")||"",g=d&&h&&d[h]?d[h]:"",b=i.description?H(i.description,f,p):"",y=i.filename?H(i.filename,f,p):t.name,S=i.feedtext?H(i.feedtext,f,p):"",v=i.errMessageInLightning;function C(){const t=e.page?e.page.community:null;return t?t.id:null}function T(e){Re(e,l)}function A(e){const n={Origin:e,PathOnClient:y,Description:b};const r=C();if(u){if(u.objectName==="ContentDocument"){n.ContentDocumentId=u.getRowId(d)}else if(i.storeAs==="contentdocumentwithrecord"){n.FirstPublishLocationId=u.getRowId(d)}}if(r)n.NetworkId=r;return Ne({path:"/v"+k+"/sobjects/ContentVersion",basePath:c&&c.serviceUrl,fields:n,payloadField:"VersionData",file:t,filename:y,dataSource:c})}function R(){let e="35.0",r=C();return Ne({path:"/v"+e+(r?"/connect/communities/"+r:"")+"/chatter/feed-elements",basePath:c&&c.serviceUrl,fields:{body:{messageSegments:[{type:"Text",text:S}]},capabilities:{content:{description:b,title:y}},feedElementType:"FeedItem",subjectId:n.model.getRowId(n.row)},payloadField:"feedElementFileUpload",file:t,filename:y,dataSource:c})}o({fileName:y});if(V(r)){l({message:v||"This file storage location is not supported in Lightning"});return false}if(i.storeAs==="record"){let e={ParentId:n.model.getRowId(n.row),Name:y,ContentType:t.type,Description:b};if(g){e.OwnerId=g}Ne({path:"/v"+k+"/sobjects/Attachment",basePath:c&&c.serviceUrl,fields:e,payloadField:"Body",file:t,filename:y,dataSource:c}).then(function(e){let t=e&&I.parseAsJSONIfString(e.response||e.body),n=t.id;l({newFileId:n,newFileName:y})},T,function(e){s(e)})}else if(i.storeAs==="field"){let e="/v"+k+"/sobjects/Attachment",r=n.fieldValue,i=false,a,o;let u=function e(){let t=L();if(r){t.resolve(r)}else{let e=[],r={id:"imageImageInsert",inserts:{1:{}},type:"skuid__Image__c"},i={id:"updateObject",updates:{},type:n.model.objectName},a=n.model.getRowId(n.row);i.updates[a]={};i.updates[a][n.fieldName]="1";e.push(r,i);Se(c).save(JSON.stringify({operations:e,rollbackOnAnyError:true})).then(function(e){let n,r="";if(e.globalErrors&&e.globalErrors.length){r+=e.globalErrors.join(", ")}else{if(e.insertResults&&e.insertResults.length===1&&e.updateResults&&e.updateResults.length===1){if(e.insertResults[0].success&&e.updateResults[0].success){n=e.insertResults[0].id}else{N.each(e.insertResults[0].errors,function(){r+=this.message});N.each(e.updateResults[0].errors,function(){r+=this.message})}}else{r+="Error Uploading File"}}if(n){t.resolve(n)}else{t.reject(r)}},function(e){t.reject(e&&e.error)})}return t.promise()};u().then(function(r){let a=n.fileId;o=r;if(a&&r){i=true;e+="/"+a+"?_HttpMethod=PATCH"}let l={Name:y,ContentType:t.type,Description:b};if(!a&&r){l.ParentId=r}return Ne({path:e,basePath:c&&c.serviceUrl,fields:l,payloadField:"Body",file:t,filename:y,dataSource:c})}).then(function(e){let t=n.fileId,r=e&&(e.response||e.body);if(t){a=t}else{if(r){r=I.parseAsJSONIfString(r);a=r.id}}if(i){let e=[],t={id:"updateObject",updates:{},type:"skuid__Image__c"};t.updates[o]={Name:y};e.push(t);return Se(c).save(JSON.stringify({operations:e,rollbackOnAnyError:true}))}return W()}).then(()=>{l({newFileId:a,newFileName:y,newFieldValue:o})},T,function(e){s(e)})}else if(i.storeAs==="chatterfeed"){R().then(function(){l();if(window.chatter&&c.name===a){let e=chatter.getFeed();let t=e.getConfig();e.refresh({feedType:t.feedType,isFullRefresh:true,params:t})}},T,function(e){s(e)})}else if(i.storeAs==="chatterfiles"){A("H").then(function(){l()},T,function(e){s(e)})}else if(i.storeAs==="contentdocument"||i.storeAs==="contentdocumentwithrecord"){A("C").then(function(){l()},T,function(e){s(e)})}}function we(t,n,r,i,o){let l=r.filename||t.name,s=r.uploadMethod.dataSource,c=s&&s.serviceUrl?s.serviceUrl:"";let u=function e(t){Re(t,o)};i({fileName:l});I.readFileAsBase64(t).then(function(t){let n=l.split("."),r="",i,d,f;if(n.length>1)r=n.pop().toUpperCase();l=n.join("")+r;i=l.match(/[a-z]|[A-Z]|[0-9]/g);l=i?i.join(""):"unnamedResource";if(/[0-9]/.test(l.charAt(0)))l="SR"+l;d=s.createHTTPRequest({url:c+"/services/data/v"+k+"/sobjects/StaticResource",headers:{"Content-Type":"application/json"},method:"POST"});d.headers.Accept="application/json";if(s.name===a){d.headers.Authorization="Bearer "+ve().sessionId}f={Name:l,ContentType:"application/"+r,Body:t,CacheControl:"Public"};N.extend(d,{body:JSON.stringify(f),contentType:"application/json"});s.makeRequest(d).then(function(e){let t=e.body,n=t.id||t.Id;if(typeof n!=="undefined")f.Id=n;o({record:N.extend(f,e)})},function(t){let n="SELECT Id FROM StaticResource WHERE Name='"+l+"'";if(s.name!==a){u(t);return}e.sfdc.api.query(n).then(function(n){if(n.records&&n.records[0]){let t=window.confirm('Static Resource "'+l+'" already exists, do you want to overwrite it?');if(t){f.Id=n.records[0].Id;let t=new e.sfdc.api.SObject("StaticResource",f);return t.update()}}return I.reject(t)}).then(function(){o({record:f})},function(e){u(e)})})})}function je(e){return e&&e in P?P[e]:e in M||e&&I.endsWith(e,"__x")?Pe():"Name"}function ke(e,t){return t.getFieldValue(e,je(t.objectName),true)}function Ee(e,t){return t.getFieldValue(e,Pe(),true)}function Pe(){return"Id"}function Me(){return"Id"}function _e(e,t){return t.keyPrefix}function Oe(e){return e.substring(0,3)}function xe(e){return{operations:e.operations.map(function(e){let t={updates:e.returning.map(function(e){return{id:e}}),changes:{},id:e.id,type:e.type};e.inserts&&N.each(e.inserts,function(e,n){t.changes[e]=n});e.updates&&N.each(e.updates,function(e,n){t.changes[e]=n});e.deletes&&N.each(e.deletes,function(e){t.changes[e]={__deleted:true}});return t}),rollbackOnAnyError:e.rollbackOnAnyError}}function Le(e){const t=e.fields;if(e.objectName==="OpportunityLineItem"&&e.type!=="aggregate"){for(let e=0;e<t.length;e++){if(t[e].id==="UnitPrice")return t}t.push({id:"UnitPrice"})}return t}function Ue(t,r){let i={Case:["UseActiveAssignmentRule","SendAutoResponseEmails","SendUserNotificationEmails","AllowExternalEmails"],CaseComment:["AllowExternalEmails"],Event:["SendUserNotificationEmails","AllowExternalEmails"],Lead:["UseActiveAssignmentRule","SendAutoResponseEmails","SendUserNotificationEmails","AssignmentRuleId"],Task:["SendUserNotificationEmails"],User:["SendUserNotificationEmails"]};if(!t||!t.operations)return;if(!r)r=f;t.operations.forEach(function(t){let r=i[t.type],a=e.$M(t.id);["inserts","updates","changes"].forEach(function(e){if(t[e]){N.each(t[e],function(t,i){N.each(i,function(r,o){if(I.endsWith(r,"__r")||I.endsWith(r,"__pr")){delete i[r]}if(a){let l=a?a.getField(r):null,s=N.isArray(o),c=N.isPlainObject(o),u,d,f;if(e==="changes"){f=a.getRecordById(t);u=f?f.isNew():false;d=f?!f.isNew()&&!f.isMoribund():false}else{u=e==="inserts";d=e==="updates"}if(l){if(u&&!l.createable||d&&!l.editable){delete i[r];return true}if(c&&l.displaytype===n.OBJECT||s&&l.displaytype===n.ARRAY){i[r]=JSON.stringify(o);return true}}if(s||c){delete i[r]}}});if(a&&r){let e=a.changes[t];N.each(r,function(t,n){if(e.hasOwnProperty(n)){i[n]=e[n]}})}})}})});if(r<2){return xe(t)}else{return t}}function De(e,t,n){return Be(e,t,n).then(function(e){if(!I.size(e)){throw new Error}return e}).catch(function(){return Ve(e,t,n).catch(function(t){e[b]=true;throw t})})}function Ve(e,t,n){let r="/sobjects/"+t+"/describe/layouts/"+n;return He(r,e,"GET",function(){}).then(function(e){return st(e)})}function Be(e,t,n){if(t==="Task"||t==="Event"){return I.reject()}let r="/ui-api/object-info/"+t+"/picklist-values/"+n;return He(r,e,"GET",function(){}).then(function(e){return lt(e)})}function qe(e,t){let n=t.dataSource;let r=n.getCacheProperty(d);if(!r){r=f;n.setPersistentCacheProperty(d,r)}return n.authenticate().then(function(){return Se(n).save(Ue(e,r)).then(function(e){return e},function(t){if(t&&t.indexOf("Invalid Skuid Save request - could not deserialize JSON into valid Save Request")>-1){let t=r>=2?1:2;return Se(n).save(Ue(e,t)).then(function(e){n.setPersistentCacheProperty(d,t);return e})}else{return t}})})}function He(t,n,r,i){r=r||"GET";let a={type:r,url:t,cache:r==="GET",dataSource:n,error:i};return e.sfdc.api.makeRequest(a)}let We=function t(n,r){if(r&&r.addProblem){r.addProblem(n)}else{(e.component.getByType("skuid__page")[0]||e.component.getByType("skuidpage")[0]).addProblem(n)}};let ze=function t(r,i,a){a=a||{};let o=function e(t){let n;if(t&&t.length){n=t[0].outputValues;return n&&n.output&&n.output.attributes?n.output:n}else{return null}};let l=function e(t,n,r){const i=r.message||r.body;return"Error running "+t+" action"+(n?" "+n:"")+(r?(r.statusCode?": "+r.statusCode:"")+(i?': "'+i+'"':""):"")};return function(t,s,c){let u=t.attr("sfdcactionname")||i,d=t.attr("sobject")||"global",f=L(),p={},m=true,h,g=N.extend({},a,{sobject:d,actionName:u});t.children("inputs").children().each(function(){let e=D(N(this),"attr"),t=e("name"),r=e("value"),i=e("displaytype"),a=e("sendarray"),o=I.getContextToUse(s,c);if(!t){f.reject({$CurrentAction:{error:'Invalid parameter name for Salesforce Action "'+u+'"'}});m=false;return false}else{r=I.mergeAsDataInContext(r,o);if(i.toUpperCase()===n.BOOLEAN){if(r==="true")r=true;else r=false}if(a==="true")p[t]=[r];else p[t]=r}});if(!m){return f.promise()}let b={inputs:[p]};let y=Ye(i,g);e.sfdc.api.makeRequest({type:"POST",url:y,dataSource:r,data:b,crossDomain:true,success:function e(t){h=o(t);f.resolve({$PreviousAction:{result:h}})},error:function t(n){let a;let c=I.parseAsJSONIfString(n.responseJSON);if(typeof c==="string"){c=n}let d=typeof c==="object"&&!(c instanceof Array)?true:false;if(c&&c.length||d){let t=d?c:c[0];if(t.errors&&t.errors.length||d){let n=d?t:t.errors[0];if(i==="apex"&&n.statusCode==="INVALID_INPUT"){a=l(i,u,n)+". Attempting to run action one more time without the invalid input parameter.";We(a,s);He(y,r,"GET").then(function(t){let n={};t=I.parseAsJSONIfString(t);if(t.inputs&&t.inputs.length){N.each(t.inputs,function(e,t){for(let e in p){if(e===t.name){n[e]=p[e]}}})}let c={inputs:[n]};e.sfdc.api.makeRequest({type:"POST",url:y,dataSource:r,data:c,crossDomain:true,success:function e(t){h=o(t);f.resolve({$PreviousAction:{result:h}})},error:function e(t){let n=I.parseAsJSONIfString(t.responseJSON);let r=n[0];let o;if(r.errors&&r.errors.length){o=r.errors[0]}a=l(i,u,o);We(a,s);let c=o.message||"Error running custom Apex action "+u;f.reject({$CurrentAction:{error:c}})}})},function(){f.reject({$CurrentAction:{error:"Error getting updated inputs for custom Apex action"}})})}else{if(u&&u!==i){a=l(i,u,n)}else{a=l(i,null,n)}We(a,s);f.reject({$CurrentAction:{error:n.message||n.body}})}}else{a="Error running "+i+" action";We(a,s);f.reject({$CurrentAction:{error:"Unknown error with custom Apex action"}})}}}});return f.promise()}};let Ye=function e(t,n){n=n||{};let r=n.needSObject,i=n.isStandard,a=n.sobject,o=n.actionName;if(i&&!o)o=t;o=o||"";if(i){return"/actions/standard/"+o}else{if(r){return"/actions/custom/"+t+"/"+a+"/"+o}else{return"/actions/custom/"+t+"/"+o}}};let $e=function e(t,n,r,i){let a=i.children("inputs"),o;if(a.length)o=a.children();if(o&&o.length){let e=false;N.each(o,function(t,r){let i=n.filter(function(e){return e.name===N(r).attr("name")});if(i.length===0){r.remove();e=true}});if(e){r.save()}}N.each(n,function(e,n){let o=n.name,l=(n.type||"TEXT").toLowerCase(),s=n.maxOccurs&&n.maxOccurs>1;if(l==="sobject"&&n.sobjectType){l="TEXT"}let c={isStateless:true,label:n.label,id:n.label,required:n.required,type:l.toLowerCase(),helptext:n.description,valueFunction:function e(){let t=a?a.children('[name="'+o+'"]'):false;return t.length?t.attr("value"):null},onChange:function e(t){let n=a?a.children('[name="'+o+'"]'):false;if(t||t===false||t===0){if(!n||!n.length){n=q("<input/>").attr({name:o,displaytype:l});if(!a||a&&!a.length){a=q("<inputs/>").appendTo(i)}n.appendTo(a)}if(s&&!n.attr("sendarray"))n.attr("sendarray",true);n.attr("value",t)}else{n.length&&n.remove()}r.save()}};if(l==="picklist"||l==="combobox"){c.picklistEntries=n.picklistValues}t.push(c)})};let Ge=function t(n,r,i,a,o={}){let l=i&&i.component,s=i&&i.propViewer,c=o.needSObject,u=o.isStandard;let d=function t(){let i=[],o="sfdcactionname",d=D(r,"attr"),f=c&&(d("sobject")||"global"),p=A.makeLabelFromId(a),m=d(o),h=Ye(a,{needSObject:c,isStandard:u,sobject:f}),g=(m||u)&&Ye(a,{needSObject:c,isStandard:u,sobject:f,actionName:m});let b=function e(t){return function(){I.removeAllAttrsExcept(r,["actionname","datasource","type"].concat(t));l.save().rebuildProps(s)}};if(c){i.push({id:"sobject",label:"SObject",type:"combobox",defaultValue:"Global",source:function e(){return He("/actions/custom/"+a,n).then(function(e){return N.map(e,function(e,t){return{label:t,value:t}})})},onChange:b(["sobject"])})}if(!u){i.push({id:o,label:p+" action",type:"combobox",source:function e(){return He(h,n).then(function(e){return N.map(e.actions,function(e){return{label:e.label,value:e.name}})})},onChange:b([o,"sobject"])})}if(g){let t=()=>e.sfdc.api.getCachedResult({dataSource:n,type:"GET",url:g});let a=t();let o;if(!a&&g){o=He(g,n).then(()=>{return t()}).catch(t=>{e.page.addProblem(t.message);return i})}else{o=I.resolve(a)}return o.then(e=>{$e(i,e.inputs,l,r);return i})}else{return i}};return{builderProps:d,runtimeExecution:ze(n,a,o),label:o.label||A.makeLabelFromId(a),name:a}};const Je=function t(n,r,i={}){let o,l=false;if(e.builder){o=i.getContextModelName&&i.getContextModelName();const t=o&&e.builder.core.getModelFromModelName(o);if(t&&t.attr("datasource")===a)l=true}return{builderProps:[{id:"model",type:"model",label:"Model",noneOption:l&&o?{label:"-- Model in Context --",value:""}:undefined,entryFilter:e=>{if(l&&o===e.attr("id")){return false}return e.attr("datasource")===a}}],name:"share",label:"Share",runtimeExecution(t,n,r){let i,a;if(t.attr("model")){i=e.$M(t.attr("model"));a=i.getFirstRow()}else{i=r.model;a=r.row}if(!i||!a)throw Error("A model and a row are required but one is missing.");const o={"001":"Acc","003":"Con","006":"Opp","00Q":"Lead",500:"Case",701:"Campaign"},l=i.keyPrefix in o?o[i.keyPrefix]:"CustomObject";I.redirect({url:"/p/share/".concat(l,"SharingDetail?parentId=").concat(i.getRowId(a))})}}};const Ke=function t(n,r,i={}){let o,l=false;if(e.builder){o=i.getContextModelName&&i.getContextModelName();const t=o&&e.builder.core.getModelFromModelName(o);if(t&&t.attr("datasource")===a)l=true}return{builderProps:[{id:"model",type:"model",label:"Model",noneOption:l&&o?{label:"-- Model in Context --",value:""}:undefined,entryFilter:e=>{if(l&&o===e.attr("id")){return false}return e.attr("datasource")===a}}],name:"clone",label:"Clone",runtimeExecution(t,n,r){let i,a;if(t.attr("model")){i=e.$M(t.attr("model"));a=i.getFirstRow()}else{i=r.model;a=r.row}if(!i||!a)throw Error("A model and a row are required but one is missing.");I.redirect({url:"/".concat(i.getRowId(a),"/e?clone=1")})}}};const Qe=function t(n,r,i){const o=j.weblink,l=i.component,s=i.objectName,c=i.weblinks||[],u={id:"weblinkname",type:"picklist",label:"Custom Button / Link Name",defaultValue:"",picklistEntries:c.map(e=>{let t=e.NamespacePrefix,n=e.MasterLabel,r=e.Name;return{label:I.decodeHTML("".concat(n).concat(t?" (".concat(t,")"):"")),value:t?"".concat(t,"__").concat(r):r}}),onChange(e){if(e){const t=e.split("__");let n,r;if(t.length===2){n=t[0];r=t[1]}else{r=t[0]}o.get({objectName:s,weblinkName:r,namespacePrefix:n,callback(){l.save().refresh().rebuildProps()}})}else{l.save().refresh().rebuildProps()}}};let d,f=false;if(e.builder){d=i.getContextModelName&&i.getContextModelName();const t=d&&e.builder.core.getModelFromModelName(d);if(t&&t.attr("datasource")===a)f=true;if(r.attr("weblinkname")&&u.picklistEntries.findIndex(e=>e.value===r.attr("weblinkname"))===-1){r.attr("weblinkname","")}}return{builderProps:[{id:"model",type:"model",label:"Model",noneOption:f&&d?{label:"-- Model in Context --",value:""}:undefined,entryFilter:e=>{if(f&&d===e.attr("id")){return false}return e.attr("datasource")===a},onChange(){l.save().refresh().rebuildProps()}},u],name:"sfdcweblink",label:"SFDC Web Link",runtimeExecution(t,n,r){let i,a;if(t.attr("model")){i=e.$M(t.attr("model"));a=i.getFirstRow()}else{i=r.model;a=r.row}if(!i||!a)throw Error("A model and a row are required but one is missing.");const l=i.objectName;let s=t.attr("weblinkname"),c;if(!s||!l)return;const u=s.split("__");if(u.length===2){c=u[0];s=u[1]}else{s=u[0]}o.get({weblinkName:s,objectName:l,namespacePrefix:c,callback(e){if(!e)return;const t=e.LinkType==="javascript";I.redirect({row:a,model:i,url:"/servlet/servlet.Integration?".concat(I.param({lid:e.Id,eid:i.getRowId(a),ic:1,retURL:window.location})),window:e.OpenType==="newWindow"||!t&&I.startsWith(e.Url,"http://",true)?"blank":"parent"})}})}}};let Xe=function t(){return{builderProps:[{id:"modelId",label:"Model",type:"model"},{id:"batchSize",label:"Batch Size",type:"number"},{id:"stepmessage",label:"Step Message",type:"template"},{id:"finishMessage",label:"Finish Message",type:"template"},{id:"cancelChanges",label:"Cancel Model Changes",type:"boolean",defaultValue:false}],name:"loadAllRemainingRecords",label:"Load All Remaining Records",runtimeExecution:function t(n,r,i){let a={};let{modelId:o,batchSize:l,cancelChanges:s}=n.attr();let c=e.$M(o),u=n.find("stepMessage").text(),d=n.find("finishMessage").text();if(l)l=parseInt(l,10);if(!c){return I.reject('The model "'.concat(o,'" could not be resolved.'))}if(c.hasChanged&&s==="true"){c.cancel()}a.message="Loading all remaining records for ".concat(o);let f=r&&r.getParentPage({root:true}),p=c.data.length;if(!f)f=e.component.getByType("skuid__page")[0];if(!f._getCPI)f=r.getParentPage();const m=f._cpi;m.blockUI(a);return c.loadAllRemainingRecords({isAction:true,dataSourceLimit:e=>{if(e.offsetPageSize*e.offsetPageNumber>1e4)return false;if(l&&e.offsetPageSize*e.offsetPageNumber>2e3)return false;return true},stepCallback:(t,n)=>{m.unblockUI();if(u){a.message=I.mergeInContext(u,Object.assign({},i,{$CurrentAction:{nextStartRecord:t,nextFinishRecord:n}}),{createFields:true,registerFields:false,nl2br:true}).text()}else{a.message=e.label.merge(e.$L("Retrieving_records_a_to_b"),t,n)}m.blockUI(a)},finishCallback:t=>{m.unblockUI();if(d){a.message=I.mergeInContext(d,Object.assign({},i,{$CurrentAction:{totalRecords:t-p}}),{createFields:true,registerFields:false,nl2br:true}).text()}else{a.message=e.label.merge(e.$L("All_a_Rows_Loaded_For_b"),t,c.id)}a.timeout=e.utils.runningTests()?1:1500;m.blockUI(a)},batchSize:l},i).then(e=>{return e||I.reject("An error occurred when retrieving records")}).catch(e=>{m.unblockUI();return I.reject({$PreviousAction:{error:e}})})}}};let Ze=function e(t){return function(e,n,r,i){let a=e.attr("workitemid"),o=e.attr("comments"),l=e.attr("nextapproverid"),s=I.getContextToUse(n,r);let c={actionType:t,workItemId:I.mergeAsDataInContext(a,s),comments:I.mergeAsDataInContext(o,s)};if(t!==C&&l){c.nextApproverId=I.mergeAsDataInContext(l,s)}return i.authenticate().then(()=>Se(i).approvalsProcessWorkItem(JSON.stringify(c))).catch(e=>{We(e,n);return I.reject({$CurrentAction:{error:e}})})}};let et=function e(t,n,r,i){let a=I.getContextToUse(n,r),o=I.mergeAsDataInContext(t.attr("recordid"),a);if(!o){let e="You must provide a valid record Id.";We(e,n);return I.reject({$CurrentAction:{error:e}})}return i.authenticate().then(()=>Se(i).approvalsUnlockRecord(o)).catch(e=>{We(e,n);return I.reject({$CurrentAction:{error:e}})})};let tt=function e(){let t=[{label:"Work Item Id",id:"workitemid",type:"template",location:"attribute",displayAs:"input",helptext:"The Id of the Salesforce ProcessInstanceWorkItem on which the action is being performed."},{label:"Comments",id:"comments",type:"template",location:"attribute",displayAs:"input",helptext:"(Optional) Adds comments to the approval history for this action."}];return[{name:"approvals-approve",label:"Approve",builderProps:t.concat([{label:"Next Approver Id",id:"nextapproverid",type:"template",location:"attribute",displayAs:"input",helptext:"(Optional) The user Id of the next approver. This property only applies if the next approval step allows users to manually choose a next approver."}]),runtimeExecution:Ze(S)},{name:"approvals-reject",label:"Reject",builderProps:t,runtimeExecution:Ze(v)},{name:"approvals-recall",label:"Recall",builderProps:t,runtimeExecution:Ze(C)},{name:"approvals-unlock",label:"Unlock Record",builderProps:[{label:"Record Id",id:"recordid",type:"template",location:"attribute",displayAs:"input",helptext:"Id of the record to unlock."}],runtimeExecution:et}]};let nt=function e(){return{builderProps:[{id:"to",label:"To",type:"template",displayAs:"input",location:"attribute"},{id:"cc",label:"Cc",type:"template",displayAs:"input",location:"attribute"},{id:"bcc",label:"Bcc",type:"template",displayAs:"input",location:"attribute"},{id:"prettySender",label:"Email Display Name",helptext:"The name that will be displayed beside the email address of the sender. Typically the first and last name of the sender or the name of an organization.",type:"template",displayAs:"input",location:"attribute"},{id:"replyTo",label:"Reply To",helptext:"The address used when a recipient replies to an email.",type:"template",displayAs:"input",location:"attribute"},{id:"subject",label:"Subject",type:"template",location:"attribute"},{id:"body",label:"Plain Text Body",type:"template",location:"attribute"},{id:"htmlBody",label:"HTML Body",type:"template",location:"attribute"}],runtimeExecution:rt,label:"Send HTML Email",name:"send-html-email"}};let rt=function t(n,r,i,a){const o=function e(t){return I.mergeAsDataInContext(n.attr(t),i)},l=10;const s=o("to"),c=o("cc"),u=o("bcc"),d=o("prettySender"),f=o("subject"),p=o("body"),m=o("htmlBody"),h=o("replyTo");const g=R(s),b=R(c),y=R(u);if(!F(g,y,b)){return}else{let t=[];if(!g.length)t.push("Email must have recipients");if(!f.length)t.push("Email subject cannot be empty");if(!h.length)t.push("Reply To cannot be empty");if(!p.length)t.push("Email body cannot be empty");if(t.length){e.component.getByType("skuid__page")[0].addProblem(t.join("\n"));return}const n=w(g,b,y,l);const r={partitionedDestinations:n,prettySender:d,replyTo:h,subject:f,body:p,htmlBody:m};return Se(a).sendEmail(JSON.stringify(r))}};let it=function e(t,n){return I.parseAsJSONIfString(t.getCacheProperty(n,"sessionStorage"))||{}},at=function e(t){let n={};N.each(t,function(e,t){n[t]=e});return n},ot={getMapOfPicklistValuesToEntries:function e(t){if(!t)return{};let n=t.metadata&&t.metadata.picklistEntries||t.picklistEntries;let r={};N.each(n,function(e,t){r[t.value]=t});return r},getCurrentlyCachedFieldsMap:function e(t,n){let r=t.getCachedEntityMetadata(n);if(!r)return{};return r.getFieldsMap()},getRecordTypeMetadata:function e(t,n,r){let i=this,a=t[g];if(!a){a=t[g]={}}if(a[r]){return a[r]}let o=it(t,m+"."+r);if(!I.size(o)||o.length!==3)return;let l=o[0],s={modstamp:o[1],__uid:o[2]};if(mt(s,t))return;let c=at(it(t,h+".picklist")),u=at(it(t,h+".value")),d=i.getCurrentlyCachedFieldsMap(t,n),f=I.isUndefined,p=a[r]={};N.each(l,function(e,t){let n=c[t[0]],r=i.getMapOfPicklistValuesToEntries(d[n]),a=t[2];if(f(n)||!d[n])return;p[n]=N.map(t[1],function(e){let t=u[e];if(f(t))return;if(r&&(!r[t]||!r[t].active)){return}return{value:t,label:r[t]&&r[t].label||t,defaultValue:e===a}})});return p},storeRecordTypeMetadata:function e(t,n,r){let i=r;bt(i);let a=it(t,h),o=a.value||{},l=a.picklist||{},s=Object.keys(o).length,c=Object.keys(l).length,u=[],d=I.isUndefined,f=[u,i.modstamp,i.__uid];N.each(i.metadata,function(e,t){let n=[],r=[],i=l[e];u.push(r);if(d(i)){i=l[e]=c;c++}r.push(i,n);N.each(t,function(e,t){let i=I.decodeHTML(t.value),a=o[i];if(d(a)){a=o[i]=s;s++}n.push(a);if(t.defaultValue){r.push(a)}})});this.safeUpdateCache(t,h,"picklist",l);this.safeUpdateCache(t,h,"value",o);this.safeUpdateCache(t,m,i.id,f)},persistCache:function e(t){t.persistBatchCache("sessionStorage")},safeUpdateCache:function e(t,n,r,i){let a=t.getCacheProperty(n,"sessionStorage")||{};a[r]=i;t.batchCacheProperty(n,a,"sessionStorage")},clear:function e(t){delete t[g];t.clearPropertiesCache()}};function lt(e){let t=e.picklistFieldValues;let n={};N.each(t,function(e,t){let r=I.grab(t,"defaultValue","value");n[e]=N.map(t.values,function(e){return{value:e.value,label:e.label,defaultValue:r&&r===e.value}})});return n}function st(e){let t={};e.detailLayoutSections&&e.detailLayoutSections.forEach(function(e){e.layoutRows&&e.layoutRows.forEach(function(e){e.layoutItems&&e.layoutItems.forEach(function(e){e.layoutComponents&&e.layoutComponents.forEach(function(e){let n=I.grab(e,"details","type");if(n&&(n.indexOf("picklist")>-1||n==="combobox")){t[e.details.name]=e.details.picklistValues}})})})});return t}function ct(e,t,n){if(!I.isApiEnabled()||n[b]||!t||!t.length)return W();return Promise.all(N.map(t,function(t){let r=ot.getRecordTypeMetadata(n,e,t);if(r){return{metadata:r,id:t}}let i=e+t;let a=n[y]=n[y]||{};let o=a[i];if(o){return o}return a[i]=De(n,e,t).then(function(r){let o={metadata:r,id:t};ot.storeRecordTypeMetadata(n,e,o);delete a[i];return{metadata:ot.getRecordTypeMetadata(n,e,t),id:t}}).catch(e=>{delete a[i];throw e})})).then(function(e){ot.persistCache(n);let t={};N.each(e,function(e,n){t[n.id]=n.metadata});return t}).catch(()=>{return})}function ut(e){let t=!I.runningTests()?E[e]:null;if(!t){t=I.sessionStorage(e);if(t){t=JSON.parse(t);E[e]=t;return t}else{return null}}else{return t}}function dt(e,t){E[e]=t;if(t&&!t.__isFailure){I.sessionStorage(e,JSON.stringify(t))}}function ft(t){if(I.isApiEnabled()){let n="skuid_describeLayout_"+t,r=ut(n),i=false;if(r){if(mt(r))i=true;if(!r.modstamp||r.modstamp<e.page.modstamp)i=true}else i=true;if(i){try{r=sforce.connection.describeLayout(t);bt(r);dt(n,r)}catch(e){r=null}}return r}else return false}function pt(e){if(!e)return;let t=e.authentication,n=t?t.responseBody:false;if(!n){n=t.responseBody=e.getStoredAuthData()}if(n)return n.access_token}function mt(t,n){let r=t.__uid,i=r===gt()||r===pt(n),a=!t.modstamp||e.page.modstamp&&t.modstamp<e.page.modstamp,o=n&&n._metadataCacheVersion&&n._metadataCacheVersion>t.modstamp;return!i||a||o}function ht(e){let t=0,n,r,i;if(e.length===0)return t;for(n=0,r=e.length;n<r;n++){i=e.charCodeAt(n);t=(t<<5)-t+i;t|=0}return t}function gt(){if(!G)G=ht(ve().sessionId);return G}function bt(t,n){if(!t)return false;let r=(new Date).getTime();if(r<e.page.modstamp){r=e.page.modstamp}t.modstamp=r;t.__uid=gt()||I.grab(n,"authentication","responseBody","access_token")}function yt(t){if(I.isApiEnabled()){let n="skuid_describeSObject_"+t,r=ut(n),i=false;if(r){if(mt(r))i=true;if(!r.modstamp||r.modstamp<e.page.modstamp)i=true}else{i=true}if(i){try{r=sforce.connection.describeSObject(t);bt(r);dt(n,r)}catch(e){r=null}}return r}else{return false}}function St(t,n,r,i){let o=i&&i.dataSource||e.dataSource.get(a);return ct(t,r,o).then(function(e){if(!e)return;let t={};let i=[];N.each(r,function(r,a){let o=e[a]&&e[a][n];if(!o)return;N.each(o,function(e,n){if(!t[n.value]){i.push(n);t[n.value]=true}})});return i})}function vt(t,n,r,i){const a=t instanceof e.component.Component,{model:o,id:l,field:s}=a?t.getState():t,c=ot.getRecordTypeMetadata(i,r,n),u=s||o.getField(l);let d;if(!c)return;d=c[l];if(!d)return u?u.picklistEntries:t.get("picklistOptions");return Y(d)}function Ct(e){const{model:t,row:n,id:r,field:i}=e.getState(),a=t.getField(r),o=t.getDataSource(),l=t.objectName,s=n&&(n[O]||n[_]&&n[_].Id);let c;if(a.id.includes("RecordTypeId")){if(!Rt(t)){return[]}const e={};const n=[];t.recordTypeInfos.forEach(r=>{const i=r.recordTypeId;if(r.isAvailable&&(t.recordTypeInfos.length===1||!r.isMaster)){if(!e[i]){n.push({label:r.name,value:i});e[i]=1}}});return n}if(!Ft(i)){c=vt(e,s,l,o)||a.picklistEntries}else{c=a.picklistEntries}return se(e,c)}function Nt(t,n){let r={},i=[];N.each(t,function(t,n){if(n.data&&n.data.length)return;let i=e.$M(n.id);if((!i||!i.createRowIfNoneFound)&&!n.createRowIfNoneFound)return;let a=It(n);if(!a)return;if(!r[n.objectName])r[n.objectName]={};r[n.objectName][a]=true});i=N.map(r,function(e,t){let r=N.map(e,function(e,t){return t});return ct(t,r,n)});return Promise.all(i)}function It(e){let t=Tt(e);if(!t)At(e);t=Tt(e);return t&&t.recordTypeId}function Tt(e){if(!e._defaultRecordType)At(e);return e._defaultRecordType}function At(e,t){let n,r,i=[];if(!t){t=N.map(e.conditions,function(e){if(!e.inactive)return e})}let a=Rt(e);if(a){N.each(e.recordTypeInfos,function(){if(this.isDefaultRecordTypeMapping&&!this.isMaster){n=this.recordTypeId;return false}})}e.createable&&t&&N.each(t,function(e,t){if(!t.inactive&&t.field&&t.field===O&&t.value&&t.value!="null"&&t.value.length>=15){n=t.value;i.unshift(e)}});if(n){let t=n.substring(0,15);N.each(e.recordTypeInfos,function(){if(this.recordTypeId.substring(0,15)===t){r=this;n=this.recordTypeId;return false}})}e._defaultRecordType=r;if(i.length){N.each(i,function(){t.splice(this,1)})}return r}function Rt(e){return e.recordTypeInfos&&e.recordTypeInfos.length>1}function Ft(e){const t=e&&e.picklistEntries;return!!(e.overrideMetadata&&t&&t.length&&e.customPicklistEntriesProvided)}function wt(e){return!!x[e.displaytype]}function jt(e,t){const n=e.metadata||e;return Rt(t)&&wt(n)&&!Ft(e)&&!n.uiOnly}function kt(e){if(e.dataSource.name!==a)return I.resolve();const t='<?xml version="1.0" encoding="utf-8"?>\n<env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n\t<env:Header>\n\t\t<urn:SessionHeader xmlns:urn="http://soap.sforce.com/2006/04/metadata">\n\t\t\t<urn:sessionId>'.concat(sforce.connection.sessionId,"</urn:sessionId>\n\t\t</urn:SessionHeader>\n\t</env:Header>\n\t<env:Body>").concat(e.body,"</env:Body>\n</env:Envelope>");return N.ajax({type:"POST",url:"/services/Soap/m/40.0",beforeSend:function e(t){t.setRequestHeader("SOAPAction",'""');t.setRequestHeader("Content-Type","text/xml")},data:t}).then(function(e,t,n){let r="",i=q(n.responseText),a=i.find("errors"),o=i.find("result"),l={};if(a.length){N.each(a,function(){r+=N(this).children("message").text()+"\n"})}if(r)return I.reject(r);else{N.each(o.children(),function(e,t){t=N(t);l[t.prop("tagName")]=t.text()});return l}}).catch(function(e,t,n){return I.reject(n.status)})}function Et({dataSource:e,description:t,name:n,url:r}){if(e.name!==a)return I.resolve();if(!n)n=r.substring(r.indexOf("://")+3).replace(/[\W]+/g,"");const i=n.length>40?n.substring(0,40):n;const o='<createMetadata>\n\t<metadata xsi:type="RemoteSiteSetting">\n\t\t<fullName>'.concat(i,"</fullName>\n\t\t<description>").concat(t,"</description>\n\t\t<disableProtocolSecurity>false</disableProtocolSecurity>\n\t\t<isActive>true</isActive>\n\t\t<url>").concat(r,"</url>\n\t</metadata>\n</createMetadata>");return kt({body:o,dataSource:e})}function Pt(e){return Se(e).checkMetadataApiAccess()}new e.dataSource.DataSourceType({name:a,prefillMetadataForObject:function e(t){ge(t.data)},getNameField:je,getIdField:Pe,getIdFieldForChildRelationship:Me,getKeyPrefix:_e,getValueKeyPrefix:Oe,getRowId:Ee,getRowName:ke,getValidPicklistEntries:ce,getValidPicklistEntriesSync:Ct,save:qe,makeMetadataApiRequest:kt,checkMetadataApiAccess:Pt,addRemoteSiteSetting:Et,onSelectEntity:function e(t,n,r,i){let a=t,o=i.getCachedEntityMetadata(a),l=o.getField(O),s=r.get("xmlState"),c=s.children("fields").empty();if(l){c.append(q('<field id="'.concat(O,'"/>')),q('<field id="'.concat(_,'.Name"/>')));if(!i.getCachedEntityMetadata(_)){i.getEntityMetadata({entities:[_]})}}},load:async function e(t,n){const r=n.dataSource;await r.authenticate();const i=["conditionLogic","doQuery","forView","groupByMethod","havingLogic","id","objectName","orderByClause","offsetPageNumber","offsetPageSize","offsetSize","queryAllRows","recordsLimit","type"];const a=N.map(t,function(e){const t={};for(const n in e){if(e.hasOwnProperty(n)&&N.inArray(n,i)>-1){t[n]=e[n]}}N.each(["fields","groupByFields"],function(n,r){const i=e[r];let a;if(i&&i.length){a=t[r]=[];N.each(i,function(e,t){let n;if(t.uiOnly)n=t;else if(t.type==="childRelationship"){n={id:t.id,type:t.type};N.each(["recordsLimit","orderByClause","subConditionLogic"],function(e,r){if(t.hasOwnProperty(r)&&t[r]!==null&&typeof t[r]!=="undefined"){n[r]=t[r]}});if(t.subConditions){n.subConditions=[];if(t.subConditions.length){N.each(t.subConditions,function(e,t){const r={};for(const e in t){if(t.hasOwnProperty(e)&&t[e]!==null&&typeof t[e]!=="undefined"){r[e]=t[e]}}n.subConditions.push(r)})}}if(t.subFields){n.subFields=[];if(t.subFields.length){N.each(t.subFields,function(e,r){const i={id:r.id};if(typeof t.query!=="undefined"&&t.query!==null){i.query=t.query}n.subFields.push(i)})}}}else{n={id:t.id};N.each(["name","function","query","convertToUserTimezone"],function(e,r){if(t.hasOwnProperty(r)&&t[r]!==null)n[r]=t[r]})}a.push(n)})}});N.each(["conditions","havings"],function(n,r){const i=e[r];let a;if(i&&i.length){a=t[r]=[];N.each(i,function(e,t){const n=N.extend({},t);for(const e in n){if(n[e]===null)delete n[e]}if(!n.processOnClient){a.push(n)}});if(!a.length){a=t[r]=null}}});if(t.objectName==="OpportunityLineItem"&&e.type!=="aggregate"){t.fields=Le(t)}if(!e._originalConditionLogic){t.conditionLogic=e.getConditionLogic(null,t.conditions)}return t});const o=J(a,t,r);let l;if(o){l={operationModels:a,options:{excludeMetadata:o}}}else{l=a}const s=await Se(r).load(l);let c;if(N.isArray(s)){c=s}else if(s&&s.models){const e=s.metadata;if(e&&I.size(e)){N.each(e,function(e,t){r.cacheEntityMetadata(e,t)})}c=s.models}else{throw Error("Invalid Response Format")}await Nt(c,r);return c},getUserInfo:function t(n){let i=n.authentication,l=i&&i.responseBody,s;if(n.name===a&&I.inPlatform([o,r])){return W(ve())}if(l)s=l.id;if(!l||!s)return W();s=s.replace("https://","");s=s.substring(s.indexOf("/"));return e.ajax.proxy(n.createHTTPRequest({url:I.combineUrls(n.serviceUrl,s),method:"GET",contentType:"application/json"})).then(function(e){let t=I.parseAsJSONIfString(e.body);return{email:t.email,firstName:t.first_name,lastName:t.last_name,name:t.display_name,userId:t.user_id,userName:t.username}})},getUserInfoProperties:function e(){return[{label:"First Name",value:"firstname"},{label:"Last Name",value:"lastname"},{label:"Email",value:"email"},{label:"Full Name",value:"name"},{label:"User Id",value:"userid",defaultValue:true},{label:"User Name",value:"username"}]},searchProperties:function e(){return{properties:[{id:"allowRawSosl",label:"Allow SOSL operators",helptext:"When enabled, SOSL operators are passed into the query unescaped. These operators then retain their SOSL search functionality instead of being used as literal search terms. Enabling this on one return object enforces it on all other Salesforce return object queries made by this component.",type:"boolean"}]}},getActions(t){const n=Ye("",{isStandard:true}),i=I.mergeArrays;return He(n,t).then(t=>{return function(n,l,s={}){let c;const u=(t&&t.actions||[]).filter(e=>{if(e.name=="submit"){c=Ge(n,l,s,e.name,{isStandard:true,label:e.label});return false}else return true}).map(e=>Ge(n,l,s,e.name,{isStandard:true,label:e.label}));const d=[{label:"Standard",value:"-",disabled:true}];i(d,u);d.push({label:"",value:"-",disabled:true},{label:"Custom",value:"-",disabled:true},Ge(n,l,s,"apex"),Ge(n,l,s,"flow"),Ge(n,l,s,"emailAlert",{needSObject:true}),Ge(n,l,s,"quickAction",{needSObject:true}),Xe(n,l,s),nt(n,l,s));if(n.name===a&&I.inPlatform([o,r])){const t=j.weblink;let r,i;if(e.builder){const a=l&&l.attr("model")||s.getContextModelName&&s.getContextModelName();r=a&&e.builder.core.getSObjectNameFromModelName(a);d.push(Je(n,l,s),Ke(n,l,s));i=r?t.getAllForObject(r):[];if(r&&!i.length){if(!t.haveQueriedForObject(r)){t.get({objectName:r,callback(){s.component.refresh().rebuildProps()}})}}else if(r){d.push(Qe(n,l,Object.assign(s,{sobjectName:r,weblinks:i})))}}else{const e=s.component,t=e.get("context");d.push(Je(n,l,s),Ke(n,l,s));if(t&&t.model){d.push(Qe(n,l,Object.assign(s,{objectName:t.model.objectName})))}}}d.push({label:"",value:"-",disabled:true},{label:"Approvals",value:"-",disabled:true});if(c)d.push(c);i(d,tt(n,l,s));return d}})},getEntityList:function e(t){let n=I.sObjectList,r=t.dataSource;if(r.name===a&&n){return I.resolve(n)}else{return r.authenticate().then(function(){return Se(r).getEntityList()})}},handleDefaultReferenceFieldValue:function t(n,r,i,o,l){let s=o.rel,c=r.value,u=I.getNameField(o.ref),d=r.nameFieldValue||false;if(!d&&o.ref===_){N.each(i.recordTypeInfos,function(){if(this.recordTypeId===c){d=this.name;return false}})}if(!d){if(r.model){let t=e.$M(r.model),n=t.getDataSourceType().name===a;if(t&&t.data.length){N.each(t.data,function(e,r){if(c===t.getRowId(r)||n&&c===r.Id15){let e=t.getRecordForRow(r);if(e){d=e.get()}else{d=r}return false}})}}if(!d){let e=I.getFieldReference(r.field,o);N.each(l,function(t,n){if(n!==r&&n.field===e&&!n.inactive&&n.value&&(!r.operator||r.operator==="=")){d=n.value}})}}let f={};if(d){let e;if(typeof d==="object"){e=d}else{e={};e[u]=d}f[s]=e}f[r.field]=c;i.updateRow(n,f)},coerceCreateRow:function e(t,n,r){let i=n,a=t.row(),o,l,s={};a.Id=t.id();At(n,r);o=It(n);l=Tt(n);let c=I.grab(n,"fieldsMap",O);if(c){if(c.overrideMetadata&&!I.isUndefined(c.defaultValue)){return}}if(o){s[O]=o;if(l){s[_]={Name:l.name}}i.updateRow(a,s,{preventSetActive:true})}},coerceUpdateRows:function e(t,n,r){if(r.preventTrackChanges)return;if(t.objectName==="Opportunity"){N.each(n,function(e,n){let r="StageName",i="Probability",a="ForecastCategoryName",o="ForecastCategory",l=t.changes[e],s=l&&l[r],c=n[r],u=t.getField(r),d=u&&u.fieldMappings;if(c&&d){let e=t.getField(i),r=t.getField(a),u=t.getField(o);if(!s){if(!l){N.each(d,function(t,l){if(l.MasterLabel===c){if(e)n[i]=l.DefaultProbability;if(r)n[a]=l[a];if(u)n[o]=l[a]}})}else{N.each(d,function(t,s){if(s.MasterLabel===c){if(e&&!l[i])n[i]=s.DefaultProbability;if(r&&!l[a])n[a]=s[a];if(u&&!l[o])n[o]=s[a]}})}}else{let t=false,f=false,p=false;N.each(d,function(e,n){if(n.MasterLabel===s){if(i in l&&l[i]!==n.DefaultProbability)t=true;if(a in l&&l[a]!==n[a])f=true;if(o in l&&l[o]!==n[a])p=true}});if(!t||!f||!p){N.each(d,function(l,s){if(s.MasterLabel===c){if(e&&!t)n[i]=s.DefaultProbability;if(r&&!f)n[a]=s[a];if(u&&!p)n[o]=s[a]}})}}}})}else if(t.objectName==="OpportunityLineItem"&&t.type!=="aggregate"){const e="Quantity",i="UnitPrice",a="TotalPrice";let o=false;N.each(n,function(n,r){let l=t.changes[n],[s,c,u]=[false,false,false];if(e in r||l&&e in l){s=true}if(i in r||l&&i in l){c=true}if(a in r||l&&a in l){u=true}if(s&&!c&&!u){const e=t.getRowById(n),a=t.getFieldValue(e,i,true);r.UnitPrice=a;o=true}});if(o)r.alwaysAddChanges=true}},coerceMassUpdate:function e(t){if(t.objectName!=="Opportunity")return;let n=t.getField("StageName");if(n){N.each(["ForecastCategory","ForecastCategoryName","Probability"],function(e,n){let r=t.getField(n);if(r){r.needsEditor=true}})}},coerceDefaultValue:function e(t,n){let r,i=t.displaytype,a,o=It(n),s;if(jt(t,n)){s=vt({field:t,model:n,id:t.id},o,n.objectName,n.getDataSource());if(s&&s.length){N.each(s,function(e,t){if(t.defaultValue&&t.defaultValue!=="false"){r=t.value;return false}});if(r&&r!==0&&r!="null"){if(i===l)r=r===true||r==="true";a=r}}}return a},determineIfCreateRowNeedsMetadata:function e(t){let n=t.fields;for(let e=0;e<n.length;e++){if(jt(n[e],t))return true}},loadDefaultValueMetadata:function e(t,n){let r=this;if(jt(t,n)){let e=It(n);return r.getMetadataForRecordTypes(n.objectName,[e],n.dataSource)}return I.resolve()},getReferenceFieldNameFromRelationshipField:fe,getReferenceFieldRelationshipName:pe,isRelationshipField:me,getReferenceFieldRelatedData:function t(n,r,i,a,o){let l,s=n.id,c=pe(s);if(o[c]!==undefined){return}N.each(a.data,function(){if(this[s]&&(this[s]===r||this[s].length&&this[s].length>=15&&this[s].substr(0,15)===r)&&a.getFieldValue(this,c)){l=a.getFieldValue(this,c,true);return false}});let u,d,f;if(!l){u=n.referenceTo;d=[];f=[];if(u&&u.length){N.each(u,function(){d.push(this.keyPrefix);f.push(this.objectName)})}if(d.length>1){if(r.length>=15){d=[r.substring(0,3)]}}N.each(d,function(t,n){N.each(e.model.getModelsByKeyPrefix(n)||[],function(){let e=this;e.data&&e.data.forEach(function(t){if(e.getRowId(t)===r||t.Id15&&t.Id15===r){let n=e.getRecordForRow(t);if(n){l=n.get()}else{l=t}return false}});if(l)return false})})}if(!l){let t=a.dataSource&&a.dataSource.name;N.each(e.model.getModelsByDataSource(t),function(){let e=this,t=[];if(e===a)return;N.each(this.fields,function(){let e=this,n=e.referenceTo;if(n&&n.length){N.each(f,function(r,i){N.each(n,function(){if(i===this.objectName)t.push(e)})})}});if(t.length){N.each(e.getRows(),function(){let n=this;N.each(t,function(){let t=this;if(e.getFieldValue(n,t.id,true)===r){l=e.getFieldValue(n,t.rel,true);return false}});if(l)return false})}if(l)return false})}return l},search:function e(t){const{dataSource:n,returning:r}=t;delete t.dataSource;if(r&&Array.isArray(r)){t.returning=r.reduce((e,t)=>{if(t.objectName){e[t.objectName]=t}return e},{})}return Se(n).doSearch(t).then(function(e){if(e.results){e.results.forEach(function(e){const t=e.objectName,n=r[t];if(n){e.objectMapKey=n.objectMapKey;e.modelName=n.modelName}})}t.dataSource=n;e.request=t;return e})},buildEntityMetadataRequest:function e(t){let n=t.targetEntity;if(!n&&t.model&&t.model.attr){n=t.model.attr("sobject")}return{objectName:n}},clientSideCacheIsEnabled:function e(t){if(t._metadataCacheVersion&&t._metadataCacheVersion!=0&&t._metadataCacheVersion!=null)return true;else{return false}},dataSourceProvidesLanguageDetails:function e(){return ve().language},getEntityMetadataLoadingMessageFromBreadcrumb:function e(t){return"Loading metadata for object "+t.endsobject+"..."},getEntityMetadataCacheKey:function e(t){return t.objectName},getEntityMetadata:function e(t){let n=L(),r=t.entities,i=t.dataSource,a=t.loadPicklistValues,o=t.ignoreMetadataOverrides?"true":"false";if(r){i.authenticate().then(function(){const e=[];N.each(r,function(t,n){let r=L(),l=B(n)?n:n.objectName,s={sObjectName:l,loadChildRelationships:"true",loadPicklistValues:a?"true":"false",ignoreMetadataOverrides:o};e.push(r.promise());if(!l){r.reject("Error: no Salesforce Object Name was specified for Model.");return true}if(n&&n.fields&&n.fields.length){s.fieldsToLoad=n.fields.join(",");if(N.isPlainObject(n.fields[0])){s.fieldsToLoad=n.fields.map(function(e){return e.id}).join(",")}}Se(i).getModelMetadata(s).then(function(e){if(e){if(e instanceof Array&&e.length){r.resolve(N.map(e,function(e){ge(e);return e}))}else{ge(e);r.resolve(e)}}else{r.resolve(e)}},function(e){r.reject("There was an error retrieving metadata for object: "+l+": "+e)})});Promise.all(e).then(function(e){n.resolve(e)},function(e){if(e){n.reject(Array.isArray(e)?e.join(","):e)}else{n.reject("")}})},function(e){n.reject("Unable to authenticate to Salesforce. Metadata could not be retrieved. "+e)})}else{n.reject("No SObject provided.")}return n.promise()},getGroupingMethodsPicklistEntries:function e(){return[{value:"simple",label:"Simple"},{value:"rollup",label:"Rollup"}]},getImageSources:function n(r){let i={label:"Attachment",needsRecordContext:true,needsFieldContext:true,relatedObjectName:"skuid__Image__c",automaticFieldMappings:{Attachment:true,skuid__Image__c:true},getSrc:Ae};let o={attachment:i};if(r&&r.name===a){o.staticresource={label:"Static Resource",builderProps:function n(r,i,a){let o=a.additionalOnRefresh,l=a.additionalOnRebuildAndRefresh,s=a.prefix||"",c=[],u=s+"resource",d=s+"resourceNamespace",f=s+"resourceContentType",p=s+"path",m="{{#NamespacePrefix}}{{{NamespacePrefix}}}__{{/NamespacePrefix}}{{{Name}}}",h="{{{NamespacePrefix}}}",g="{{{ContentType}}}",b={},y=true;b[u]=m;b[d]=h;b[f]=g;if(i.attr(f)){y=i.attr(f)===t.MIME_TYPES.ZIP}c.push(e.platform.builder.getStaticResourceProperty({id:u,valueTemplates:b,onChange:function e(){if(i.attr(p)){i.removeAttr(p);r.save()}r.refresh().rebuildProps();l&&l()}}));if(i.attr(u)&&y){c.push(e.platform.builder.getNestedPathProperty({id:p,state:i,nameProperty:u,namespaceProperty:d,onChange:function e(){r.refresh();o&&o()}}))}return c},getSrc:function e(t){let n=L(),r,i,a=t.prefix||"",o=a?a+"resource":"resource",l=a?a+"path":"path",s=t.definition?t.definition[o]:t.xmlDef?t.xmlDef.attr(o):"",c=t.definition?t.definition[l]:t.xmlDef?t.xmlDef.attr(l):"",u=t.context,d=t.mergeSettings;if(c){c=I.mergeAsTextInContext(c,u,d)}if(s){s=I.mergeAsTextInContext(s,u,d);if(s){i=s.split("__");if(i.length===2){r=i[0];s=i[1]}}}if(s){n.resolve(I.getStaticResourceUrl(s,r,c))}else{n.reject("No Resource Provided")}return n.promise()}}}return o},getMetadataCacheVersion:function e(){return $},getReferenceHandler:function t(){return{getBaseReferenceProps:function t(n){return[{id:"targetobjects",type:"sobject",label:"SObject Type",readonly:false,dataSourceName:e.dataSource.getDataSourceFromXML(n.get("xmlState")).name}]},getOverrideBatchProperties:function e(){return[{type:"helptext",html:"Specify fields that will be added as related data. Any fields that are used in search or display templates will need to be added here."}]},getOverrideBatchNoItemsFunction:function e(){return function(){return N("<div>").text("(Loading key field only.)")}},getOverrideBatchFieldChildrenFunction:function e(t){return function(){return[{id:"batchfield",indent:1,linkedComponent:t,addtooltip:"Add Field",labelFunction:function e(t){return t.attr("field")||"[No Field Selected]"},defaultStateFunction:function e(){return q("<batchfield/>")},propsFunction:function e(n){let r=[{id:"field",type:"field",label:"Field",sobject:t.get("xmlState").attr("targetobjects"),dataSourceName:t.get("xmlState").attr("datasource"),onChange:function e(){n.refresh().rebuildProps()}}];return r}}]}},getMetadataHandler:function t(n,r,a,o,l){let s=n.children("batchfields").first();let c=s.children("batchfield");let u=n.attr("keyfield")||Pe();let d=n.attr("targetobjects");let f;let p=n.attr("ogdisplaytype");let m=n.attr("rel")||o+"__r";r.keyField=u;r.originalDisplayType=p;if(d){f=d.split(",");r.isNamePointing=f.length>1;if(l||p&&p!==i){r.relationshipName=r.rel=m}r.referenceTo=N.map(f,function(e){return{accessible:true,objectName:e}});r.ref=d}if(!l&&p&&p!==i){let t=e.dataSource.getDataSourceFromXML(n);let r=new e.model.Model({dataSource:t});r.id="_ReferenceLabelModel_"+(new Date).getTime()+m;if(c&&c.length){r.fields=N.map(c,function(e){return{id:N(e).attr("field")}})}else{r.fields=[{id:u}]}r.doQuery=true;r.doClone=false;r.objectName=d;r.initialize();let i=new e.model.Condition;i.name="__reference_batch";i.operator="in";r.addCondition(i);if(!a.batchLabelModels)a.batchLabelModels={};a.batchLabelModels[o]=r}},getReferenceValue:function e(t,n){return t[n.keyField||Pe()]},getRowFromReferenceValue:function e(t,n,r){let i=t.getRows([{field:r.keyField||Pe(),value:n}]);return i&&i.length?i[0]:{}},processReferenceLookupModel:function e(t,n,r,i){t.objectName=r;if(n.id==="OwnerId"&&r==="Group"){t.addCondition({field:"Type",value:"Queue",inactive:false})}if(r.toLowerCase()==="recordtype"){t.rTypeFor=i&&i.objectName;t.addCondition({field:"SObjectType",value:t.rTypeFor,inactive:false,type:"fieldvalue"})}}}},getUploadMethods:function t(n){const i=65e4,l={id:"autoRefreshModels",type:"boolean",label:"Auto-refresh related models on successful upload",defaultValue:true,helptext:"If true, then upon successful file upload, Skuid will automatically attempt to find related models that are displaying file data, and Skuid will cancel changes in these models and then re-query them."},s={id:"useLightningUploaderIfAvailable",type:"boolean",label:"Use Lightning's File Upload Component",platform:[o,r],defaultValue:false,helptext:"When checked, and user is in Lightning runtime, Salesforce's File Upload component is substituted for Skuid's File Upload component to bypass file size limitations. See documentation for details."},c=n&&n.name===e.platform.getDefaultDataSourceName()||false;function u(e,t,n,r,a,o){e.size<i?Te(e,t,n,r,a,o):Fe(e,t,Object.assign(n,{errMessageInLightning:"Cannot upload large files in Lightning"}),r,a,o)}function d(e){const t=e.component;const n=I.getContextToUse(t);const r=t.fieldName;const{model:i,row:a}=n;const o=i.objectName,l=i.getRowId(a),s=this.dataSource,c=n.model.getFieldValue(a,r,true);const u={id:"objdelete",updates:{},type:o};const d={id:"imagedelete",deletes:{},type:"skuid__Image__c"};u.updates[l]={};u.updates[l][r]="";d.deletes[c]={};return Se(s).save(JSON.stringify({operations:[u,d]}))}function f(t,n,r,i,o){let l=t.model.getRowId(t.row),s=n.attr("id"),c=this;if(c.dataSource.name===a){return(e.page.runningOnForceSite?e.page.currentSiteUrl:"/")+"apex/UploadImage?id="+l+(r?"&objfield="+r:"")+"&elid="+s+(i?"&desc="+i:"")+(o?"&filename="+o:"")}else{return""}}function p(){return this.dataSource.name===a}const m={record:{label:"In Attachment to Record",relatedObjectName:"Attachment",needsRecordContext:true,forceStoreAsFileName:true,upload:u,getSrc:Ae,deleteFile:d,supportsIframeUpload:p,getIframeSrc:f,builderProps:[{id:"owneridfield",helptext:"If left blank, owner of record will be creator of attachment",type:"field",addFieldToModel:true,label:"Custom Owner Id Field",modelprop:"model"}]},chatterfeed:{label:"In Chatter Feed Item",relatedObjectName:"ContentVersion",needsRecordContext:true,upload:Fe,builderProps:[{id:"feedtext",type:"text",label:"Feed Text"}]},field:{label:"In Field on Record",needsRecordContext:true,needsFieldContext:true,upload:u,getSrc:Ae,deleteFile:d,supportsIframeUpload:p,getIframeSrc:f,getFileIdField:e=>e.substr(0,e.length-1)+"r.skuid__AttachmentId__c",getFileNameField:e=>e.substr(0,e.length-1)+"r.Name"},chatterfiles:{label:"In Chatter Files",relatedObjectName:"ContentVersion",upload:Fe},contentdocument:{label:"In Content Document",relatedObjectName:"ContentVersion",upload:Fe,supportsLightningUploader:c},contentdocumentwithrecord:{label:"In Content Document (with Record Context)",relatedObjectName:"ContentVersion",needsRecordContext:true,upload:Fe,supportsLightningUploader:c},staticresource:{label:"In Static Resource",canRunPostUploadSnippet:true,upload:we,hideInBuilder:true}};N.each(m,function(e,t){let n=t.builderProps;if(t.relatedObjectName){if(!n){n=t.builderProps=[]}n.push(l)}if(t.supportsLightningUploader===true){if(!n){n=t.builderProps=[]}n.push(s)}});return m},getDefaultFieldsForReferenceField:function e(t,n,r){let i,a=n.referenceTo[0].objectName,o=[];if(n.referenceTo.length<2){i=I.getFieldReference(t,n,r)}else{i=I.getFieldRelationshipName(t,n)+".Name"}o.push(i);if(a==="skuid__Image__c"){o.push(I.getFieldRelationshipName(t,n)+".skuid__AttachmentId__c")}return o},getNameFieldURLForReferenceField:function t(n,r,i){let a=n.options.fieldXML,o=a&&a.attr("redirecttype")||"datasourcedefault",l=e.dataSource.DataSourceType.prototype.getNameFieldURLForReferenceField,s,c;if(o!=="datasourcedefault"){return l(n,r,i)}if(!X(n.model)||!r||!r.length)return;c='<a href="';s=r.substring(0,3);if(le()){let e;let t=n.metadata;if(t.referenceTo&&t.referenceTo.length){if(t.overrideMetadata){e=t.referenceTo[0]}else{e=t.referenceTo.find(e=>e.keyPrefix===s)}}if(!e||!e.objectName){return c+'"/>'}c+=ne(r,e.objectName)}else if(Z()){c+=I.getSafeRelativeUrl("/"+r)}else if(ee()){c+=I.getSafeRelativeUrl("/"+r)}else{c+=I.getSafeRelativeUrl("/"+r)}c+='" tabindex="-1">'+i+"</a>";return c},getLinkInfoForReferenceField:function t(n,r){const i=n.redirectType||"datasourcedefault",a=n.model,o=n.row,l=a.getRowId(o),s=a.getField(n.fieldId),c=le(),u=Z(),d=ee(),f=e.dataSource.DataSourceType.prototype.getLinkInfoForReferenceField,p={};if(i!=="datasourcedefault"){return f(n,r)}if(!X(n.model)||!r||!r.length)return;let m=r.substring(0,3);if(c){let e;if(s.referenceTo&&s.referenceTo.length){if(s.overrideMetadata){e=s.referenceTo[0]}else{e=s.referenceTo.find(e=>e.keyPrefix===m)}}p.onClick=ie(r);if(!e||!e.objectName){return p}p.refLink=ne(r,e.objectName)}else if(u){p.refLink=I.getSafeRelativeUrl("/"+r);p.onClick=ae(r)}else if(d){p.refLink=I.getSafeRelativeUrl("/"+r);p.onClick=oe(s.id,a.id,l)}else{p.refLink=I.getSafeRelativeUrl("/"+r)}return p},getNameFieldURLForTextField:function e(t,n,r){let i=t.metadata,a=t.model,o=r,l=t.row,s=a.getRowId(l),c=i&&i.displaytype==="URL",u=le(),d=Z(),f=ee(),p=n,m=["FirstName","LastName","Company"],h,g,b;if(!t.options.noLink&&!a.isSingleRow()&&X(a)&&I.userInfo.isAuthenticated&&(i&&i.nameField||m.includes(t.id))&&!a.isNewRow(l)&&t.id.indexOf(".")===-1){p=o;o='<a href="';if(u){o+=ne(s,a.objectName)}else if(d){o+=I.getSafeRelativeUrl("/"+s)}else if(f){o+=I.getSafeRelativeUrl("/"+s)}else{o+=I.getSafeRelativeUrl("/"+s)}return o+'">'+U(p)+"</a>"}else if(c){h=o&&z(o,"/");b=U(p);g=U(o);return'<a href="'.concat(b,'"').concat(h?"":' target="blank"',">").concat(g,"</a>")}},getLinkInfoForTextField:function t(n={},r){const i=n.model,a=i.getField(n.fieldId),o=n.redirectType||"datasourcedefault",l=n.row,s=l?i.getRowId(l):null,c=a&&a.displaytype==="URL",u=le(),d=Z(),f=ee(),p=te(),m=e.dataSource.DataSourceType.prototype.getLinkInfoForReferenceField,h=["FirstName","LastName","Company"];let g={},b,y;if(o!=="datasourcedefault"){return m(n,r)}if(!n.noLink&&!i.isSingleRow()&&X(i)&&I.userInfo.isAuthenticated&&(a&&a.nameField||h.includes(a.id))&&!i.isNewRow(l)&&a.id.indexOf(".")===-1){if(u){g.refLink=ne(s,i.objectName);g.onClick=ie(s)}else if(d){g.refLink=I.getSafeRelativeUrl("/"+s);g.onClick=ae(s)}else if(f){g.refLink=I.getSafeRelativeUrl("/"+s);g.onClick=re(function(){p&&p.openConsoleTabForNameField(s,i.id)})}else{g.refLink=I.getSafeRelativeUrl("/"+s)}return g}else if(c){y=r&&z(r,"/");b=U(r);if(y){if(u){g.refLink=b;g.onClick=re(function(){window.$A.get("e.force:navigateToURL").setParams({url:r}).fire()})}else if(d){g.refLink=b;g.onClick=re(function(){sforce.one.navigateToURL(r)})}else if(f){g.refLink=b;g.onClick=re(function(){p&&p.openConsoleTabForUrl(r,b)})}else{g.refLink=b}return g}return{refLink:b,target:"blank"}}},coerceStartingPageSize:function e(t){if(t.recordsLimit>2e3){t.offsetPageSize=2e3}else{t.offsetPageSize=t.recordsLimit||100}},getModelProperties:function t(n,r,i){let o=this,l=e.builder.core,s=n.get("xmlState"),c=function e(){let t=s.attr("datasource")||s.attr("service")||a;return t===a},u=l.getUnsavedChangesWarningProperty({component:n}),d=l.getCoreModelBasicProperties({component:n,propViewer:r}),f=[];d.push({id:"sobject",type:"sobject",dataSourceTypeName:this.name,dataSourceName:s.attr("datasource")||s.attr("service"),label:"Salesforce Object Name",onChange:function e(t,r){o.onSelectEntity(t,r,n,i);n.save()}},l.getModelTypeProperty({component:n}),l.getModelQueryOnPageLoadProperty({component:n,propViewer:r}),l.getAsyncLoadProperty({component:n}));if(c()&&s.attr("type")!=="aggregate"){f.push({id:"doclone",type:"picklist",label:"Clone data returned by Model query",helptext:"Should all data returned by querying this Model be 'cloned', meaning that data in the Model will be marked as 'New' so that when the Model is saved, new records will be created, rather than updates made to existing records?",picklistEntries:[{label:"Yes, always",value:"yes"},{label:"Yes, if 'clone' and 'id' parameters are present in URL",value:""},{label:"No",value:"no"}],defaultValue:""})}f.push({id:"queryallrows",type:"boolean",label:"Query Deleted / Archived records",helptext:'For developers: adds the SOQL "ALL ROWS" clause to your query. If true, then deleted records and/or archived Tasks will be included in your Model\'s query --- by default, they are not.'},{id:"forview",type:"boolean",label:'Update Salesforce "Recently Viewed" info',helptext:"For developers: adds the SOQL \"FOR VIEW\" clause to your query. Use this if you want this Model to feed into Salesforce's tracking of Recently Viewed Items. When this Model's query is run, the LastViewedDate for all records in this Model will be updated, and new records will be added to the RecentlyViewed object. "});if(c()){f.push({defaultValue:false,id:"nativeuiautosync",type:"boolean",label:"Auto-sync with other Lightning Components",helptext:"If enabled, then when this Skuid Page is used in Lightning Experience or Salesforce1, Skuid will automatically update this Model's data when other Lightning Components are refreshed, and Skuid will automatically notify other components whenever this Model is saved."})}d.push(l.getModelLimitProperty(),l.getModelOrderByProperty(),l.getCreateDefaultRowProperty());if(u)f.push(u);Array.prototype.push.apply(f,l.getModelLabelProperties());return[{name:"Basic",props:d},{name:"Advanced",props:f}]},getAggregateFieldProperties:function t(n,r){const i=n.get("xmlState"),a=e.builder.core;return[{id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:true,picklistEntries:[{label:"COUNT",value:"COUNT"},{label:"COUNT DISTINCT",value:"COUNT_DISTINCT"},{label:"SUM",value:"SUM"},{label:"AVG",value:"AVG"},{label:"MAX",value:"MAX"},{label:"MIN",value:"MIN"}],onChange:function e(t){if(t){i.attr("name",a.getDefaultAliasName(i.attr("id"),t))}n.save().refresh().rebuildProps(r)}}]},getValidFieldFunctionsForField:function e(t,n={}){const r=t.displaytype;const i=[];const a=n.alwaysAddBlank;if(r&&K(r)){const e=r===u;const t=!e||a;if(t)i.push({label:"--None--",value:"",abbrev:"",defaultValue:true});i.push({label:"CALENDAR_MONTH",value:"CALENDAR_MONTH",abbrev:"cm",dt:s},{label:"CALENDAR_QUARTER",value:"CALENDAR_QUARTER",abbrev:"cq",dt:s},{label:"CALENDAR_YEAR",value:"CALENDAR_YEAR",abbrev:"cy",defaultValue:!t,dt:s},{label:"DAY_IN_MONTH",value:"DAY_IN_MONTH",abbrev:"dm",dt:s},{label:"DAY_IN_WEEK",value:"DAY_IN_WEEK",abbrev:"dw",dt:s},{label:"DAY_IN_YEAR",value:"DAY_IN_YEAR",abbrev:"dy",dt:s});if(e)i.push({label:"DAY_ONLY",value:"DAY_ONLY",abbrev:"do",dt:c});i.push({label:"FISCAL_MONTH",value:"FISCAL_MONTH",abbrev:"fm",dt:s},{label:"FISCAL_QUARTER",value:"FISCAL_QUARTER",abbrev:"fq",dt:s},{label:"FISCAL_YEAR",value:"FISCAL_YEAR",abbrev:"fy",dt:s},{label:"HOUR_IN_DAY",value:"HOUR_IN_DAY",abbrev:"hd",dt:s},{label:"WEEK_IN_MONTH",value:"WEEK_IN_MONTH",abbrev:"wm",dt:s},{label:"WEEK_IN_YEAR",value:"WEEK_IN_YEAR",abbrev:"wy",dt:s})}return i},getFieldFunctionProperty:function t(n,r,i,a={}){const o="DISTANCE",l=n.get("xmlState");if(a.isCondition&&e.builder.core.isDistanceQueryable(i.displaytype)){let e=false,t=function t(n,r,i){if(i||l.attr(n)!==r){l.attr(n,r);e=true}};t("fieldfunction",o);if(!l.attr("units"))t("units","mi",true);if(!l.attr("value"))t("value","5",true);t("enclosevalueinquotes","false");if(N.inArray(l.attr("operator"),["lt","gt"])===-1)t("operator","lt",true);if(e){n.save();if(a.handleChange)a.handleChange();if(a.handleRefresh)a.handleRefresh();return false}return{id:"fieldfunction",defaultValue:o,type:"picklist",picklistEntries:[{value:o,label:o}],required:true,readonly:true,label:"Field Function"}}const s=Object.assign({alwaysAddBlank:a.isCondition},a);return e.dataSource.DataSourceType.prototype.getFieldFunctionProperty.apply(this,[n,r,i,s])},getAggregateGroupingProperties:function e(t,n,r){const i=this,a=[];if(r){const e=i.getFieldFunctionProperty(t,n,r);if(e){a.push(e)}const o=r.displaytype===u;if(o){a.push({id:"convertToUserTimezone",type:"boolean",label:"Convert to User Timezone",helptext:"Converts date/time values to the running user's time zone before grouping results. The default behavior is to group results based on UTC values.",defaultValue:false})}}return a},processModelXMLExtensions:function e(t,n){t.extensions={salesforce:{forView:n.attr("forview")==="true",nativeUiAutoSync:n.attr("nativeuiautosync")==="true",objectName:n.attr("sobject"),type:n.attr("type"),queryAllRows:n.attr("queryallrows")==="true"}}},isDataSourceNativeSalesforce:Q,getMetadataForRecordTypes:ct,getPicklistEntriesValidForRecordTypes:St,getAPIDescribeSObject:yt,getAPIDescribeLayout:ft,defaultControllingFields(){return[O]},initialize:ge,initializeDataSource:he,properties:{composer:{supports:{childRelationships:true},canFieldsBeSelected:function e(t){if(t.breadcrumb.endsobject){return true}else{return"Select an SObject for this Model"}}},canAutoGenerateConditionsFromFields:true,validConditionTypes:["fieldvalue","multiple","modelmerge","blank","param","userinfo","datasourceuserinfo","join"],canConditionsBeGrouped:true,hasGlobalSearchEntities:true,batchableEntityRequests:true,serverSideModelMerge:true,offline:{createConditionsForConflicts:function t(n){return[new e.model.Condition({encloseValueInParens:true,encloseValueInQuotes:true,field:"Id",inactive:false,operator:"in",state:"filterableon",type:"multiple",values:N.map(n.updates,function(e,t){return t})})]}}},_recordTypeCacheStorage:ot,_setMetadataCacheVersion:function e(t){$=t}})})(e)}});return t});