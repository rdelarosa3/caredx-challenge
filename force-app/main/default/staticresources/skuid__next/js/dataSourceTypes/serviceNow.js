skuid.runtime.registerApi("v2","dataSourceTypes/serviceNow",function(e){var t=function(e){var t={};function i(r){if(t[r]){return t[r].exports}var a=t[r]={i:r,l:false,exports:{}};e[r].call(a.exports,a,a.exports,i);a.l=true;return a.exports}i.m=e;i.c=t;i.d=function(e,t,r){if(!i.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};i.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};i.t=function(e,t){if(t&1)e=i(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var r=Object.create(null);i.r(r);Object.defineProperty(r,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r};i.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};i.d(t,"a",t);return t};i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};i.p="";return i(i.s=728)}({728:function(t,i){(function(e){let t=e.$,i=e.utils,r=e.dataSource,a=i.parseAsJSONIfString,l=r.utils,s=e.constants,n=s.DISPLAY_TYPES,d=s.HTTP_VERBS,o="ServiceNow",u=n.STRING,y=n.BOOLEAN,c=n.DATETIME,p=n.NUMBER,f=n.ID,m=s.MIME_TYPES.JSON,b=d.GET,T=d.POST,_=d.DELETE,g="query",h={},C=150,I="_sk_table",S=i.grab,v="&sysparm_offset=",E="?sysparm_limit=",k="ITEMSINCART",q={CATALOGS:"Catalogs",CATALOG:"Catalog",CATEGORIES:"Categories",CATEGORY:"Category",ITEMS:"Items",ITEM:"Item",CART:"Cart",ITEMSINCART:"Items In Cart"},A=function e(t){let i=t.model,r=t.request,a=r.url,s=t.type,n=l.getModelMergeConditions(i,t),d=n.sysId;if(s===g){if(d){a=a.concat("/",d)}else{a=D(a);i=x(i)}r.url=a}},P=function e(t){let i=t.request,r=i.url,a=t.type;if(a===g){r=D(r);i.url=r}},O=function e(t){let i=t.model,r=t.request,a=r.url,l=t.type;if(l===g){a=D(a);x(i);r.url=a}},w=function e(t){let i=t.model,r=t.request,a=r.url,l=t.type;if(l===g){a=D(a);x(i);r.url=a}},R=function e(t){let i=t.model,r=t.request,a=r.url,l=t.type;if(l===g){a=D(a);x(i);r.url=a}},M=function e(t,r,l,s){if(s!==false&&h[r])return i.resolve(h[r]);return t.authenticate().then(function(){r=i.combineUrls(t.serviceUrl||"",r);let e={url:r};if(l){s=false;e.method="POST";e.data=l;e.body=l;e.contentType=m}else{e.method="GET"}return t.makeRequest(t.createHTTPRequest(e))}).then(function(e){e=a(e);if(!(e&&e.body))throw Error("Failed to connect to ServiceNow");let t=a(e.body),i;if(!t.result){throw Error("Bad request made to ServiceNow")}if(t.result){i=t.result}else if(t.nextPageToken){i=t.nextPageToken}if(!i)throw Error("No result in response");if(s!==false){h[r]=i}return i})},F=function e(t){let i=[];t.forEach(function(e){let t={};t.label=e.label+" (Table)";t.value=e.name+I;e=t;i.push(e)});return i},L=function e(i){let r={};t.each(i,function(e){r[e]={displayType:{type:undefined,certainty:0,emptyValCount:0}}});return r},j=function e(i){let r=L(i[0]),a=0,l=.5;i.map(function(e){a++;t.each(e,function(e,t){let i=/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})/;if(typeof t==="object"){delete r[e]}else if(typeof t==="string"){if(t.match(i)){if(r[e].displayType.type===c||r[e].displayType.type===undefined){r[e].displayType.certainty++;if(r[e].displayType.type===undefined){r[e].displayType.type=c}return}r[e].displayType.certainty=1}else if(t.toLowerCase()==="true"||t.toLowerCase()==="false"){if(r[e].displayType.type===y||r[e].displayType.type===undefined){r[e].displayType.certainty++;if(r[e].displayType.type===undefined){r[e].displayType.type=y}return}r[e].displayType.certainty=1}else if(e.toLowerCase()==="sys_id"){if(r[e].displayType.type===f||r[e].displayType.type===undefined){r[e].displayType.certainty++;if(r[e].displayType.type===undefined){r[e].displayType.type=f}return}r[e].displayType.certainty=1}else if(t===""){if(r[e]){r[e].displayType.emptyValCount++;return}}else{if(r[e].displayType.type===u||r[e].displayType.type===undefined){r[e].displayType.certainty++;if(r[e].displayType.type===undefined){r[e].displayType.type=u}return}r[e].displayType.certainty=1}}})});t.each(r,function(e){if(r[e].displayType.type==="OBJECT"){delete r[e]}if(r[e].displayType.type===undefined){r[e].displayType.type=u}if(r[e].displayType.emptyValCount>a*l)r[e].displayType.type=u;if(r[e].displayType.emptyValCount+r[e].displayType.certainty<a)r[e].displayType.type=u});return r},G=function e(t){if(t.indexOf(I)!==-1){let e=t.split(I);e.pop();e.join("");return e}return false},N=function e(t){let i={};switch(t){case"CATALOG":i.idFields=["sys_id"];i.nameField="title";i.label="Service Catalogs";i.labelPlural="Catalogs";i.fields=[{id:"title"},{id:"sys_id",displaytype:f},{id:"has_categories",displaytype:y},{id:"has_items",displaytype:y},{id:"description"},{id:"desktop_image"}];i.methods={query:{url:"/sn_sc/servicecatalog/catalogs/{{sysId}}",verb:b,contentType:m,pathToContent:"result"}};i.defaultConditions=[{sourcetype:"param",sourceparam:"sysId",name:"SysId",label:"SysId",state:"filterableon",type:"fieldvalue",required:false,value:""}];break;case"CATALOGS":i.idFields=["sys_id"];i.nameField="title";i.label="Service Catalogs";i.labelPlural="Catalogs";i.fields=[{id:"title"},{id:"sys_id",displaytype:f},{id:"has_categories",displaytype:y},{id:"has_items",displaytype:y},{id:"description"},{id:"desktop_image"}];i.methods={query:{url:"/sn_sc/servicecatalog/catalogs",verb:b,contentType:m,pathToContent:"result"}};i.defaultConditions=null;break;case"CATEGORIES":i.idFields=["sys_id"];i.nameField="title";i.label="Categories By Catalog";i.labelPlural="Categories";i.fields=[{id:"title"},{id:"description"},{id:"full_description"},{id:"icon"},{id:"header_icon"},{id:"homepage_image"},{id:"sys_id",displaytype:f}];i.methods={query:{url:"/sn_sc/servicecatalog/catalogs/{{sysId}}/categories",verb:b,contentType:m,pathToContent:"result"}},i.defaultConditions=[{sourcetype:"param",sourceparam:"sysId",name:"SysId",label:"SysId",state:"filterableon",type:"fieldvalue",required:true,value:""}];break;case"CATEGORY":i.idFields=["sys_id"];i.nameField="title";i.label="Category By SysID";i.labelPlural="Categories";i.fields=[{id:"title"},{id:"description"},{id:"full_description"},{id:"icon"},{id:"header_icon"},{id:"homepage_image"},{id:"sys_id",displaytype:f}];i.methods={query:{url:"/sn_sc/servicecatalog/categories/{{sysId}}",verb:b,contentType:m,pathToContent:"result"}};i.defaultConditions=[{sourcetype:"param",sourceparam:"sysId",name:"SysId",label:"SysId",state:"filterableon",type:"fieldvalue",required:true,value:""}];break;case"ITEMS":i.idFields=["sys_id"];i.nameField="name";i.label="Items List";i.labelPlural="Items";i.fields=[{id:"sys_id"},{id:"short_description"},{id:"name"},{id:"icon"},{id:"description"},{id:"show_price",displaytype:y},{id:"type"},{id:"category_sysID",synonym:"category.sys_id",displaytype:f},{id:"category_title",synonym:"category.title"}];i.methods={query:{url:"/sn_sc/servicecatalog/items",verb:b,contentType:m,pathToContent:"result"}};break;case"ITEM":i.idFields=["sys_id"];i.nameField="name";i.label="Item By SysId";i.labelPlural="Items";i.fields=[{id:"short_description"},{id:"icon"},{id:"description"},{id:"show_price",displaytype:y},{id:"recurring_price"},{id:"type"},{id:"local_currency"},{id:"sys_id",displaytype:f},{id:"recurring_price_currency"},{id:"localized_price"},{id:"price"},{id:"recurring_frequency"},{id:"category_sysID",synonym:"category.sys_id",displaytype:f},{id:"category_title",synonym:"category.title"},{id:"price_currency"}];i.methods={query:{url:"/sn_sc/servicecatalog/items/{{sysId}}",verb:b,contentType:m,pathToContent:"result"}};i.defaultConditions=[{sourcetype:"param",sourceparam:"sysId",name:"SysId",label:"SysId",state:"filterableon",type:"fieldvalue",required:true,value:""}];break;case"CART":i.idFields=["cart_id"];i.label="Cart";i.fields=[{id:"cart_id",displaytype:f},{id:"subtotal_price"},{id:"subtotal_recurring_frequency"},{id:"subtotal_recurring_price"},{id:"total_title"},{id:"show_subtotal_price"},{id:"subtotal_title"}];i.methods={query:{url:"/sn_sc/servicecatalog/cart",verb:b,contentType:m,pathToContent:"result"}};i.defaultConditions=null;break;case"ITEMSINCART":i.idFields=["cart_id"];i.label="Items In Cart";i.nameField="item_name";i.fields=[{id:"cart_item_id",displaytype:f},{id:"catalog_item_id",displaytype:f},{id:"delivery_time"},{id:"item_name"},{id:"localized_price"},{id:"localized_recurring_price"},{id:"name"},{id:"order_guide"},{id:"picture"},{id:"price"},{id:"quantity"},{id:"recurring_frequency"},{id:"recurring_price"},{id:"recurring_subtotal"},{id:"recurring_subtotal_price"},{id:"short_description"},{id:"show_price",displaytype:y},{id:"show_quantity",displaytype:y},{id:"show_recurring_price",displaytype:y},{id:"subtotal",displaytype:p},{id:"subtotal_price"},{id:"sys_class_name"},{id:"sys_id"}];i.methods={query:{url:"/sn_sc/servicecatalog/cart",verb:b,contentType:m,pathToContent:"result"},delete:{url:"/sn_sc/servicecatalog/cart/{{cart_item_id}}",verb:_,contentType:m}};i.defaultConditions=null;break;case"USER":i.idFields=["user_name"];i.nameField="user_name";i.label="User Roles";i.fields=[{id:"user_name"},{id:"from_role"},{id:"from_group"}],i.methods={query:{url:"/global/user_role_inheritance?user_sysid={{userId}}",verb:b,contentType:m,pathToContent:"result"}};i.defaultConditions=[{sourcetype:"param",sourceparam:"userId",name:"UserId",label:"UserId",state:"filterableon",type:"fieldvalue",required:true,value:""}];break;default:i=null;return i}i.fields.forEach(function(e){if(!e.label)e.label=l.makeLabelFromId(e.id);if(!e.displaytype)e.displaytype=u;if(!e.editable)e.editable=false;if(!e.creatable)e.creatable=false;if(!e.accessible)e.accessible=true});return i},x=function e(t){t.pagination={pagable:true};return t},D=function e(t){let i=t+=E+(C+1);return i},U=function e(t){let i=t.split("_");i.pop();i.pop();t=i.join("_");t=l.makeLabelFromId(t+"s");return t},B=function e(t){let i=[],r=[],a=[],l=[],s=[];if(S(t,"","items"))r=t[""].items;if(S(t,"weekly","items"))a=t["weekly"].items;if(S(t,"monthly","items"))l=t["monthly"].items;if(S(t,"yearly","items"))s=t["yearly"].items;i=i.concat(r,a,l,s);return i};if(r.getDataSourceType(o))return;new r.core.RESTDataSourceTypeBase({name:o,coerceRequest:function e(t){let i=t.model,r=this.getEntityMetadataCacheKey(i);switch(r){case"CATALOGS":P(t);break;case"CATALOG":break;case"CATEGORIES":O(t);break;case"CATEGORY":break;case"ITEMS":w(t);break;case"ITEM":break;case"ITEMSINCART":R(t);break;case"CART":break;case"USER":break;default:A(t);break}},parseSuccessfulLoadResponse:function e(t,r,s,n){let d=a(t.body),o=r.pathToContent,u=o?i.getObjectProperty(d,o):d;u=a(u);if(n.objectName!=k){if(!u.length)u=[u]}else{u=B(u)}if(S(n,"pagination","pagable")){if(u){n.paginationToken?n.paginationToken+=u.length:n.paginationToken=u.length}}if(S(d,"errors","length")){throw Error("Model "+n.label+' had an error: "'+d.errors[0].message+'"')}l.safeEach(u,function(e,t){l.applySynonym(t,s)});return u},createActions:function e(){return{"add-item-to-cart":{label:"Add Item to Cart",builderProps:[{label:"Item SysId",id:"sysId",type:"string"},{label:"Quantity",id:"quantity",type:"string"}],runtimeExecution:function e(t,r,a){let l=a.model,s=l.dataSource,n=i.mergeAsDataInContext(t.attr("sysId"),a),d=i.mergeAsDataInContext(t.attr("quantity"),a),o=s.serviceUrl,u=o+"/sn_sc/servicecatalog/items/"+n+"/add_to_cart",y={sysparm_quantity:d},c=s.createHTTPRequest({url:u,method:"POST",body:y});if(!n||!d)return i.reject("You must specify both the item to be added and the quantity desired.");return s.makeRequest(c)}},"submit-order":{label:"Submit Order",runtimeExecution:function e(t,i,r){let a=r.model,l=a.dataSource,s=l.serviceUrl,n=s+"/sn_sc/servicecatalog/cart/submit_order",d=l.createHTTPRequest({url:n,method:"POST"});return l.makeRequest(d)}}}},getEntityList:function e(i){let r=i.dataSource,a="/now/table/sys_db_object";let l=r.getCacheProperty(a);if(l){return l}return M(r,a).then(function(e){e=F(e);let i=t.map(q,function(e,t){return{value:t,label:e}});i=i.concat(t.map(e,function(e){return{value:e.value,label:e.label}}));r.setPersistentCacheProperty(a,i);return i})},queryEntityMetadata:function e(r,a){let s=this.getEntityMetadataCacheKey(r);if(!s)return i.reject("No Entity was selected for this Model.");let n,d=G(s),o;if(d){let e="now/table/"+d+E+"10";o={fields:[]};return M(a.dataSource,e).then(function(e){if(!e.length)e=[e];n=j(e);return e}).then(function(){let e={};t.each(n,function(t,i){e[t]=i.displayType.type});t.each(e,function(e,t){let i=t,r=l.makeLabelFromId(e);o.fields.push({id:e,displaytype:i,createable:true,editable:true,filterable:true,required:false,label:r})});o.label=U(s,false);o.labelPlural=U(s,false);o.methods={query:{url:"now/table/"+d,verb:b,contentType:m,pathToContent:"result"},insert:{url:"now/table/"+d,verb:T,contentType:m,pathToContent:"result"},update:{url:"",verb:T,contentType:m,pathToContent:"result"},delete:{url:"",verb:T,contentType:m,pathToContent:"result"}};o.defaultConditions=[{sourcetype:"param",sourceparam:"sysId",name:"SysId",label:"SysId",state:"filterableon",type:"fieldvalue",required:true,value:""}];if(!o.fields.length){return i.reject("A table must have data in order to identify fields. Is your table empty?")}return o})}else{return i.resolve(N(s))}},getActions:l.getActionsStatic,extendedProperties:{composer:{unomittableFields:true,rebuildPropsOnSelectEntity:true},hasDefaultSearch:true,canServerSearch:true,hasGlobalSearchEntities:true,"x-metadata":{__skuid_fieldDefaults:{"*":{displaytype:u,editable:true,createable:true,accessible:true,filterable:true,sortable:true}}}},getPaginationToken:function e(t,i,r,l){let s=a(t&&t.body);if(l.pagination&&l.paginationToken){if(s.result&&s.result.length===C+1){l.paginationToken--;s.result.pop();return l.paginationToken}}},applyPaginationToken:function e(t,i){t.url+=v+i}})})(e)}});return t});