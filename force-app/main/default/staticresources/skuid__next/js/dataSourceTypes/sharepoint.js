skuid.runtime.registerApi("v2","dataSourceTypes/sharepoint",function(e){var t=function(e){var t={};function r(n){if(t[n]){return t[n].exports}var a=t[n]={i:n,l:false,exports:{}};e[n].call(a.exports,a,a.exports,r);a.l=true;return a.exports}r.m=e;r.c=t;r.d=function(e,t,n){if(!r.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:n})}};r.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};r.t=function(e,t){if(t&1)e=r(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n};r.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s=729)}({729:function(t,r){(function(e){const t="Sharepoint",r=e.$,n=e.lib.cookie,a=e.utils,o=a.makeXMLDoc,i=a.mergeAsTextInContext,u=e.dataSource.utils,s=a.Deferred,l="ID",d=function e(t,r){let n="_layouts/download.aspx?SourceUrl=",o="_api";if(t.indexOf(o)!==-1){t=t.substring(0,t.indexOf(o))}return a.combineUrls(t,n)+r},c=function e(t){return"SkuidSharepoint-"+t+"-Login-"},f=function e(t){if(!t)return"Error";let r=t.body,n=o(r),a=n.children("m\\:code").first().text().split(","),i=a[1]&&a[1].trim&&a[1].trim();return i},p=function e(t){if(!t)return;let r=c(t.name);n.remove(r+"FedAuth");n.remove(r+"rtFa");n.remove(r+"Digest");t.authentication.success=false;t.removeStoredAuthData()},h=function e(t){let r=t.dataSource,o=function e(){let t=r.authentication;return t.authMethod==="apex"&&t.providerName==="Sharepoint_SharedLogin"},i=c(r.name),u=function e(){return n.get(i+"FedAuth")&&n.get(i+"rtFa")&&n.get(i+"Digest")},s=function e(){if(!t.headers)t.headers={};let r=n.withConverter(function(e){return unescape(e)});t.headers.Cookie="FedAuth="+r.get(i+"FedAuth")+"; rtFa="+r.get(i+"rtFa")+";";t.headers["X-RequestDigest"]=r.get(i+"Digest")};if(!r.isAuthenticated()&&o()&&u()){r.authentication.success=true}return r.authenticate().then(function(){if(r.isAuthenticated()&&o(r)){s(r)}return t}).catch(function(e){p(r);return a.reject(e)})};if(e.dataSource.getType(t))return;let m=e.dataSource.core;new m.ODataDataSourceTypeBase({name:t,getKeyFields:function e(t){let n={},a=t.key,o,i;if(r.isArray(a))a=a[0];if(a&&a.propertyRef){o=a.propertyRef[0].name;i=t.propertyMap[o];if(i.type==="Edm.Boolean"){a.propertyRef[0].name=l}r.each(a.propertyRef,function(e,t){n[t.name]={id:t.name}})}return n},getEntityContainerToList:function e(){return"ListData"},supportsBatch:function e(){return a.resolve(true)},authenticateAndGetMetadata:function e(t){let r=this;return h(t).then(function(){return r.getMetadata(t)})},isDefFilterable:function e(t){return t.type==="Edm.String"&&t.name!=="BaseName"},coerceEntitySetList:function e(t){t.push("SP.Files")},_getFileMetadata:function e(t,n){if(!t){return{}}const o=t.split(",");const i={};r.each(o,(e,t)=>{const[r,o]=t.split(":");if(!r||!o)return;const u=a.mergeAsDataInContext(o.trim(),n);if(u!==undefined){i[r.trim()]=u}});return i},getUploadMethods:function t(){const n=this;function o(t,o,s,l,d,c){let p=encodeURIComponent(a.renameFileWhileKeepingExtension(t.name,i(s.filename,s))),m=s.uploadMethod.dataSource,y=m&&m.serviceUrl?m.serviceUrl:"",b={row:o.row,model:o.model},g={createFields:false},v=o.options.xmlDef.attr("foldername"),S=n._getFileMetadata(o.options.xmlDef.attr("fileMetadata"),b),T=v?u.mergeThenURLEncode(v,b,g):encodeURIComponent("/Shared Documents"),R="/web/getfolderbyserverrelativeurl('"+T+"')/files/getbyurl('"+p+"')/",x=a.rfc4122v4GUID(),A=t.size,O=e.platform.getMaxProxyRequestPayload(),D=1,P,_;if(p.includes("'")){p=p.split("'").join("''")}if(!A)return;s.dataSource=m;s.headers=s.headers||{};s.headers["skuid-base64-body"]=true;function F(e,t){let r=e.length,n=[],a=Math.ceil(r/t);for(let r=0;r<t;r++){n[r]=e.slice(a*r,a*(r+1))}return n}function M(e){if(e&&e.body){let t;if(a.isString(e.body))try{t=JSON.parse(e.body)}catch(t){return f(e)}else{t=e.body}if(a.grab(t,"error","message","value")){return t.error.message.value}else if(t&&t.message){return t.message}}return"Had an error"}function U(e,n){if(!n)n={};n=r.extend({overwrite:false},n);let a=n.overwrite;l({fileName:s.filename||t.name});let o=y+"/web/getfolderbyserverrelativeurl('"+T+"')/files/add(overwrite="+a+",url='"+p+"')";s.headers.Accept="application/json; odata=verbose";let i=m.createHTTPRequest({url:o,headers:s.headers,method:"POST",contentType:"application/octet-stream",body:e});return m.makeRequest(i)}function w(){c({loaded:D,total:P});let e=y+R+"startupload(uploadId=guid'"+x+"')",t=m.createHTTPRequest({url:e,headers:s.headers,method:"POST",contentType:"application/octet-stream",body:_[0]});return m.makeRequest(t).then(function(e){I(e)},function(e){d({message:M(e)})})}function I(e){let t=JSON.parse(e.body).d;let r=t.StartUpload?parseInt(t.StartUpload):parseInt(t.ContinueUpload);D++;c({loaded:D,total:P});h(s).then(function(){s.headers.Accept="application/json; odata=verbose";if(D===P){k(r)}else{let e=y+R+"continueupload(uploadId=guid'"+x+"',fileOffset="+r+")",t=m.createHTTPRequest({url:e,headers:s.headers,method:"POST",contentType:"application/octet-stream",body:_[D-1]});m.makeRequest(t).then(I,function(e){d({message:M(e)})})}})}function k(e){let t=y+R+"finishupload(uploadId=guid'"+x+"',fileOffset="+e+")",r=m.createHTTPRequest({url:t,headers:s.headers,method:"POST",contentType:"application/octet-stream",body:_[D-1]});m.makeRequest(r).then(function(e){d();if(a.size(S)){return q(a.parseAsJSONIfString(e.body).d,S)}},function(e){d({message:M(e)})})}function j(e){const t=e.ListItemAllFields.__deferred.uri;const r=m.createHTTPRequest({url:t,headers:s.headers,method:"GET",contentType:"application/json;odata=verbose"});return m.makeRequest(r)}function q(e,t){return j(e).then(e=>{const r=a.parseAsJSONIfString(e.body),n=r.d.__metadata.type,o=r.d.__metadata.uri,i=r.d.__metadata.etag;let u=t;u["__metadata"]={type:n};s.headers={};s.headers.Accept="application/json; odata=verbose";s.headers["X-HTTP-Method"]="MERGE";s.headers["If-Match"]=i;const l=m.createHTTPRequest({url:o,headers:s.headers,method:"POST",contentType:"application/json;odata=verbose",body:JSON.stringify(u)});return m.makeRequest(l)})}a.readFileAsBase64(t).then(function(e){_=e;P=Math.ceil(A/O);if(P===1){h(s).then(function(){return U(_,{overwrite:true}).then(function(e){d();if(a.size(S)){return q(a.parseAsJSONIfString(e.body).d,S)}},function(e){d({message:M(e)})})})}else{h(s).then(function(){_=F(_,P);s.headers.Accept="application/json; odata=verbose";U("42",{overwrite:false}).then(w,function(e){let t=M(e);if(t.includes("already exists")){w()}else{d({message:t})}})})}})}return{relative_server_url:{label:"Relative Server URL",upload:o,hasDescription:false,hasParent:false,builderProps:[{id:"foldername",type:"text",label:"Relative folder URL",defaultValue:"/Shared Documents",helptext:'This is the relative server url for the folder you want this file to be uploaded to. Example: "/Shared Documents/SubFolder1/SubFolder2"'},{id:"fileMetadata",type:"template",label:"Update Metadata",helptext:'Each field/value pair must be comma delimited and seperated by a colon, example: "RecordID: heyNow, OpportunityID: youreARockstar"',displayAs:"input",location:"attribute"}]}}},getActions:u.getActionsStatic,createActions:function e(t){return{"download-file":{builderProps:[{label:"File URL",id:"key",type:"template",location:"attribute",defaultValue:"{{Url}}"},{label:"Name of File",id:"name",type:"template",location:"attribute",defaultValue:"{{Name}}"}],runtimeExecution:function e(r,n,a){a=a||{};let o=s(),l=u.mergeThenURLEncode(r.attr("key")||"{{Url}}",a),c=i(r.attr("name")||"{{Name}}",a),f=d(t.serviceUrl,l);if(!c||!l)return o.reject().promise();u.downloadWithLink(c,f);return o.resolve().promise()},label:"Download File"}}}})})(e)}});return t});