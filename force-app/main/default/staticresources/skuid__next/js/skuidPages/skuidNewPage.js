skuid.runtime.registerApi("v2","skuidPages/skuidNewPage",function(e){var t=function(e){var t={};function n(r){if(t[r]){return t[r].exports}var o=t[r]={i:r,l:false,exports:{}};e[r].call(o.exports,o,o.exports,n);o.l=true;return o.exports}n.m=e;n.c=t;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(e,t){if(t&1)e=n(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var r=Object.create(null);n.r(r);Object.defineProperty(r,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=700)}({700:function(t,n){(function(e){const t=e.utils,n=e.$,r=e.constants,o=e.platform.getEntityFieldNames("page"),a=o["api_version"],s="skuid__Page_XML__c",i=e.snippet.register;function u(e){const t=e.getFirstRow();if(t&&t[a]&&t[a]!=="v1"){return"skuid__page"}return"skuidpage"}const c="skuid__Initial_State__c",l=o["master_page_id"];function d(e){e||(e={});let n=e.model,r=e.row,o=n.getFieldValue(r,c,true)||"none",a=u(n),i="<".concat(a,' unsavedchangeswarning="yes" personalizationmode="server"'),d;if(o==="masterpage"&&l!==""){d="<".concat(a,' unsavedchangeswarning="yes">\n<models/>\n<pageregioncontents/>\n<components/>\n<resources>\n\t<labels/>\n\t<javascript/>\n\t<css/>\n\t<actionsequences/>\n</resources>\n<styles>\n\t<styleitem type="background" bgtype="none"/>\n</styles>\n</').concat(a,">")}else if(o==="from-xml"||o==="from-xml-file"){let e=n.getFieldValue(r,s,true);if(e){t.writeXmlToPageLayoutFields(e,n,r)}return}if(!d){d="".concat(i,' showsidebar="true" showheader="true">\n<models/>\n<components/>\n<resources>\n\t<labels/>\n\t<javascript/>\n\t<css/>\n\t<actionsequences/>\n</resources>\n<styles>\n\t<styleitem type="background" bgtype="none"/>\n</styles>\n</').concat(a,">")}t.writeXmlToPageLayoutFields(d,n,r)}i("skuid.newPage.writeXMLToPageRecord",({model:e,row:t})=>{d({model:e,row:t})});n(document.body).one("pageload",function(){const n=e.$M("master__DataSourceReassign");let o;function a(){if(!o){if(t.inPlatform(r.NATIVE)){let t=e.$M("master__DataSources");return t.load().then(function(){o=t.getRows().map(e=>e.name).sort((e,t)=>e.localeCompare(t))})}else{const t=e.loader.getAllDataSources();o=Object.keys(t).sort((e,t)=>e.localeCompare(t))}}return t.resolve()}function u(e,r){let a=t.makeXMLDoc(e.getFieldValue(r,s,true)),i=[];n.emptyData();a.find("[datasource]").each(function(){let e=this.getAttribute("datasource");if(e!=="Ui-Only"&&e!=="SkuidLocal"&&!o.includes(e)&&!i.includes(e)){n.createRow({additionalConditions:[{field:"currentName",value:e}],doAppend:true});i.push(e)}})}i("skuid.newPage.reassignDataSources",e=>{let t=e.model,n=e.row;a().then(function(){u(t,n)})})});i("skuid.newPage.modifyXMLBeforeSave",function(){let n=e.$M("pgs__NewPage"),r=e.$M("master__DataSourceReassign"),o=n.getRows()[0],i=o[s],u={[a]:i.startsWith("<skuid__page")?"v2":"v1"};if(r.getRows().length){let e=t.makeXMLDoc(i);r.getRows().forEach(function(t){e.find('[datasource="'+t.currentName+'"]').attr("datasource",t.newName||t.currentName)});u[s]=e[0].outerHTML}n.updateRow(o,u);r.cancel()})})(e)}});return t});