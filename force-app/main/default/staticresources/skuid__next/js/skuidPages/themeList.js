skuid.runtime.registerApi("v2","skuidPages/themeList",function(e){var t=function(e){var t={};function s(i){if(t[i]){return t[i].exports}var n=t[i]={i:i,l:false,exports:{}};e[i].call(n.exports,n,n.exports,s);n.l=true;return n.exports}s.m=e;s.c=t;s.d=function(e,t,i){if(!s.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:i})}};s.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};s.t=function(e,t){if(t&1)e=s(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var i=Object.create(null);s.r(i);Object.defineProperty(i,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i};s.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};s.d(t,"a",t);return t};s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};s.p="";return s(s.s=704)}({704:function(t,s){(function(e){const t=e.$,s=e.snippet.registerSnippet,i=e.utils,n=i.inPlatform(e.constants.NATIVE);const r={THEME:"Theme",DESIGN_SYSTEM:"Design System"};function a(e){return e.skuid__Type__c==="Ink"||e.type==="Ink"}function o(e){return["Ink","Lightning","Skuid App"].includes(e)}s("skuid.loadJSZip",function(){if(typeof JSZip!=="undefined"){return i.resolve()}else{return i.loadJS(e.platform.getResourceUrl({ns:"skuid",path:"js/lib/jSZip.js"}))}});s("skuid.theme.createDSResource",function(){const s=e.$M("stng__Design_System_New"),r=s.getFirstRow(),u=e.platform.getEntityFieldNames("theme"),c=s.getFieldValue(r,u.name,true),_=s.getFieldValue(r,u.resource_name,true),l=a(r),m=s.getFieldValue(r,"ThemeToClone",true),f=d(m,l);s.updateRow(r,u.version_date,e.version.date);if(s.validateRequiredFields().length){return i.reject()}const p=["skuid_theme.json","resources.json","skuidtheme.css"],h=e.$.map(p,function(t){return e.$.ajax({url:e.platform.themeBuilder.getThemeResourceUrl({apiVersion:"v2",name:n?m:f,nestedPath:t,namespace:o(m)&&"skuid"})})});return Promise.all(h).then(function([a,o,d]){a=i.parseAsJSONIfString(a);a.id=c;a.baseTheme="Ink";a.timestamp=e.version.date;a.themeSettings=a.themeSettings||{};a.themeSettingsLocal=m==="Ink"?{}:a.themeSettingsLocal;a.lessVars=a.lessVars||{};a.cssResources=a.cssResources||[];const l=new e.lib.JSZip;l.file("skuid_theme.json",JSON.stringify(a,undefined,"\t"));l.file("resources.json",JSON.stringify(o));l.file("skuidtheme.css",d);const f=l.generate({type:"base64",compression:"DEFLATE"}),p={ContentType:"application/zip",Body:f,CacheControl:"Public"};if(n){p.FileName=_}else{p.Name=_;p.skuid__Resource_Namespace__c=r.skuid__Resource_Namespace__c}return t.ajax({type:"POST",url:n?"/api/v1/uploadTheme":"/services/data/v32.0/sobjects/StaticResource",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i.userInfo.sessionId},data:JSON.stringify(p),dataType:"json"}).then(function(t){if(n){s.updateRow(r,{file_id:t.id})}else{return e.sfdc.api.query("SELECT NamespacePrefix FROM StaticResource WHERE Id='"+t.id+"'").then(function(e){s.updateRow(r,u.resource_namespace,e.records[0].NamespacePrefix)})}})})});s("skuid.theme.exportTheme",function(){const t=arguments[0],s=i.Deferred(),r=t.row,o=t.model,u=o.getRecordForRow(r).get(),c=a(r);(n?["id","file_id","updated_at","updated_by","created_by","updated_by_id","created_by_id"]:["Id","LastModifiedById","LastModifiedBy","attributes"]).forEach(function(e){delete u[e]});let d=JSON.stringify(u),_,l,m;if(n){_=r.resource_name;m=e.platform.themeBuilder.getThemeResourceUrl({apiVersion:"v2",name:r.resource_name})}else{_=r.skuid__Resource_Name__c;l=r.skuid__Resource_Namespace__c;m=i.getStaticResourceUrl(_,l,undefined,(new Date).getTime())}e.lib.JSZipUtils.getBinaryContent(m,function(t,n){if(t){return s.reject()}let a=new e.lib.JSZip;a.load(n);a.file("objdef.json",d);let o=a.generate({type:"blob",compression:"DEFLATE"}),u="".concat(r[e.platform.getEntityFieldName("theme","name")],".").concat(c?"designsystem":"sktheme");i.saveAs(o,u);s.resolve()});return s.promise()});const u=()=>{return function(t){let s=t.record,n=s.id||s.Id,r=e.$M("stng__Themes_Import"),a=r.getConditionByName("ThemeId"),o=e.lib.JSZip(s.Body,{base64:true});r.cancel();const u=e.$C("themelist-feedback-block-custom");u&&u.set("show",false);const c=e=>{if(u){u.set({show:true,title:"Error Importing Theme",description:e.map((e,t)=>"".concat(t+1,". ").concat(e.message,".")).join(" ")})}};if(o.files["objdef.json"]){let t=JSON.parse(o.files["objdef.json"].asText()),s=e.$M("stng__Design_Systems"),u,d,_="SELECT Id FROM skuid__Theme__c WHERE Name='"+(t.Name||t.name)+"'",l,m;if(n){l="SELECT Id,NamespacePrefix,Name FROM StaticResource WHERE Id='"+n+"'";m=e.sfdc.api.query(l).then(function(e){if(e&&e.records&&e.records[0]){d=e.records[0];m.resolve&&m.resolve()}})}else{m=i.resolve()}let f=e.sfdc.api.query(_).then(function(e){if(e.records&&e.records[0]){u=e.records[0];return e}else{return i.reject()}});return Promise.all([f,m]).then(function(){r.setCondition(a,u.Id);if(d){t.skuid__Resource_Name__c=d.Name;t.skuid__Resource_Namespace__c=d.NamespacePrefix}else{delete t.skuid__Resource_Name__c;delete t.skuid__Resource_Namespace__c}["CreatedDate","CreatedById","CreatedBy","LastModifiedDate","LastModifiedById","LastModified"].forEach(e=>{if(t[e])delete t[e]});return r.updateData().then(()=>{r.updateRow({Id:u.Id,skuid__Type__c:t.skuid__Type__c||t.type,skuid__Active__c:t.skuid__Active__c||t.active,skuid__Skuid_Version_Date__c:t.skuid__Skuid_Version_Date__c||t.version_date},t);return r.save()}).then(e=>{if(e.messages.length){c(e.messages)}else{return s.updateData()}})}).catch(function(){r.createRow({additionalConditions:[{field:"Name",value:t.Name||t.name},{field:"skuid__Resource_Name__c",value:d.Name},{field:"skuid__Type__c",value:t.skuid__Type__c||t.type},{field:"skuid__Active__c",value:t.skuid__Active__c||t.active},{field:"skuid__Skuid_Version_Date__c",value:t.skuid__Skuid_Version_Date__c||t.version_date},{field:"skuid__Resource_Namespace__c",value:d.NamespacePrefix}]});r.save().then(e=>{if(e.messages.length){c(e.messages)}else{return s.updateData()}})})}else{alert("The uploaded file is not a valid skuid theme")}}};const c=s=>{return function(n){const r=i.Deferred(),a=e.$M(s),o=e.$M("stng__Themes_Import"),u=e.$M("stng__Themes_Import_File"),c=e.$M("stng__Themes_Existing"),d=n.apiExtensions.$Result.body;o.cancel();u.cancel();let _=false;function l(t){const s=e.constants.NATIVE;const i=t.skuid__Type__c?"SKUID":s;let n={};switch(i){case"SKUID":n.name=t.Name;n.type=t.skuid__Type__c;n.active=t.skuid__Active__c;break;case s:n=t;break;default:n=false;break}return n}e.$.ajax({url:"/themes/"+d.name+"/objdef.json",type:"GET",contentType:"application/json"}).then(function(e){_=l(e);if(_===false)return r.reject("The uploaded file is not a valid Skuid Theme.");c.setCondition(c.getConditionByName("ThemeName"),_.name);return c.updateData()},function(){return r.reject("The uploaded file is not a valid Skuid Theme. objdef.json not found.")}).then(function(){const t=c.getFirstRow();let s=a;if(t){s=c;s.updateRow(t,{file_id:d.id,resource_name:d.name})}else{s.updateRow(a.createRow(),{name:_.name,resource_name:d.name,version_date:e.version.date,file_id:d.id,type:_.type})}return s.save()}).then(function(s){if(s.messages&&s.messages.length){const i=t("#themeImportErrors").length?t("#themeImportErrors"):t('&lt;div id="themeImportErrors" class="nx-error"&gt;');i.prependTo(t("#importUploadTitle"));i.empty();t.each(s.messages,function(e,t){i.append("&lt;div&gt;"+t+"&lt;/div&gt;;")});e.$M("stng__Design_Systems").cancel();return r.reject()}r.resolve()});return r}};if(n){s("skuid.theme.importDesignSystem",c("stng__Design_Systems"))}else{s("skuid.theme.importTheme",u(r.THEME));s("skuid.theme.importDesignSystem",u(r.DESIGN_SYSTEM))}function d(e,t){const s=n?/[\w _\-]+/g:/[a-z]|[A-Z]|[0-9]/g;return e?o(e)?"SkuidTheme"+e.replace(/\s+/g,""):e.match(s).join("").replace(t?/DESIGNSYSTEM/g:/SKTHEME/g,"")+(t?"DESIGNSYSTEM":"SKTHEME"):""}s("skuid.theme.updateResourceName",function(t){const s=t.model,i=t.row,n=e.platform.getEntityFieldNames("theme"),r=a(i);if(!s||!i)return;const o=s.getFieldValue(i,n.name,true);const u=d(o,r);s.updateRow(i,n.resource_name,u)});s("skuid.theme.createThemeResource",function(){const s=e.$M("stng__Design_System_New"),r=s.getFirstRow(),o=a(r);if(n){r.version_date=e.version.date}else{r.skuid__Skuid_Version_Date__c=e.version.date}let u=r.BaseTheme,c,d=false,_;if(n){c=r.name;_=r.resource_name}else{c=r.Name;d=r.skuid__Type__c=="Mobile";_=r.skuid__Resource_Name__c}const l="SkuidTheme"+r.BaseTheme;const m=e.platform.themeBuilder.getThemeResourceUrl({apiVersion:o?"v2":"v1",name:l,namespace:"skuid"});const f=i.Deferred();e.lib.JSZipUtils.getBinaryContent(m,function(t,s){if(t)f.reject(t);let i;try{i=new e.lib.JSZip(s);f.resolve(i)}catch(e){console.error(e);f.reject(e)}});return f.then(a=>{let o=a.file("skuid_theme.json").asText();let l={id:c,lessVars:{},tempVars:{},webFonts:o.webFonts,baseTheme:u,isMobile:d,iconsets:o.iconsets,themeSettings:{}};a.file("skuid_theme.json",JSON.stringify(l,undefined,"\t"));let m=a.generate({type:"base64",compression:"DEFLATE"}),f={ContentType:"application/zip",Body:m,CacheControl:"Public"};if(n){f.FileName=_}else{f.Name=_;f.skuid__Resource_Namespace__c=r.skuid__Resource_Namespace__c}return t.ajax({type:"POST",url:n?"/api/v1/uploadTheme":"/services/data/v32.0/sobjects/StaticResource",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i.userInfo.sessionId},data:JSON.stringify(f),dataType:"json"}).then(function(t){if(n){s.updateRow(r,{version_date:e.version.date,file_id:t.id})}else{return e.sfdc.api.query("SELECT NamespacePrefix FROM StaticResource WHERE Id='"+t.id+"'").then(function(t){s.updateRow(r,{skuid__Skuid_Version_Date__c:e.version.date,skuid__Resource_Namespace__c:t.records[0].NamespacePrefix})})}})})})})(e)}});return t});