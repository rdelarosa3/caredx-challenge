skuid.runtime.registerApi("v2","skuidPages/skuidPageList",function(e){var t=function(e){var t={};function s(r){if(t[r]){return t[r].exports}var a=t[r]={i:r,l:false,exports:{}};e[r].call(a.exports,a,a.exports,s);a.l=true;return a.exports}s.m=e;s.c=t;s.d=function(e,t,r){if(!s.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};s.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};s.t=function(e,t){if(t&1)e=s(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var r=Object.create(null);s.r(r);Object.defineProperty(r,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r};s.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};s.d(t,"a",t);return t};s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};s.p="";return s(s.s=702)}({702:function(t,s){(function(e){const t=e.sfdc,s=t.api,r=e.utils,a=e.$,i=s.SObject,n=s.query,o=s.escapeMetadataBody,c=r.size,u=e.snippet.register;u("skuid.pageList.packagePages",function(){let t=e.$M("pgs__StaticResourceInfoForPackaging"),s=t.getFirstRow(),a=t&&t.getFieldValue(s,"Name"),c=t&&t.getFieldValue(s,"Description"),u="SELECT Id, Name, Description FROM StaticResource WHERE Name = '"+a+"'",_=e.$M("pgs__PagesForPagePack"),g=_.getRows(),d,l=e.component.getByType("skuid__page")[0],k="SELECT Id, Name, skuid__API_Version__c, skuid__Type__c, skuid__UniqueId__c, skuid__Module__c, skuid__Composer_Settings__c, "+"skuid__MasterPage__c, skuid__MasterPage__r.Name, skuid__MasterPage__r.skuid__UniqueId__c, skuid__IsMaster__c, "+"skuid__Layout__c, skuid__Layout2__c, skuid__Layout3__c, skuid__Layout4__c, skuid__Layout5__c "+"FROM skuid__Page__c "+"WHERE Id IN ('";d=g.filter(e=>_.getFieldValue(e,"is_selected")).map(e=>{return _.getFieldValue(e,"Id")});if(d.length==0){l._getCPI().blockUI({message:"Please select at least one Page for your Page Pack",styleSettingsVariant:"dark",timeout:2500});return}k+=d.join("','")+"') ORDER BY skuid__Module__c, Name";l._getCPI().blockUI({message:"Getting Page and StaticResource records...",styleSettingsVariant:"dark"});let f,P=n(u),m,p=n(k);Promise.all([P,p]).then(([t,s])=>{f=t.records;m=s.records;let n,u=r.Deferred();if(f.length>0){n=new i("StaticResource",{Id:f[0].Id,CacheControl:"Private"});u.resolve()}else{l._getCPI().blockUI({message:"Creating StaticResource...",styleSettingsVariant:"dark"});n=new i("StaticResource",{Name:a,Description:c,Body:o(JSON.stringify([])),CacheControl:"Private"});n.insert({success:function e(){u.resolve()},error:function e(t){u.reject({resourceName:a,errorMessage:t.responseJSON[0].message})}})}u.then(function(){l._getCPI().blockUI({message:"Packaging Pages into StaticResource...",styleSettingsVariant:"dark"});n.Body=o(JSON.stringify(m));n.ContentType="application/json";n.update().then(function(){l._getCPI().blockUI({message:"The "+a+" Page Pack was created/updated successfully!",styleSettingsVariant:"dark",timeout:3e3});let t=e.component.getByType("skuid__modal")[0];t.getCPI().close()},function(e){l._getCPI().blockUI({message:"There was an error creating the "+a+" Page Pack"+(e&&e.errorMessage?":\n\n"+e.errorMessage:"."),styleSettingsVariant:"dark",timeout:5e3})})},function(e){l._getCPI().blockUI({message:"There was an error creating the "+e.resourceName+" Page Pack:\n\n"+e.errorMessage,styleSettingsVariant:"dark",timeout:5e3})})},function(){l._getCPI().blockUI({message:"There was an error creating the Page Pack",styleSettingsVariant:"dark",timeout:5e3})})});u("skuid.page.packagePagesInModules",function(){let t=e.$M("pgs__PageGroupedByModule"),s=t.getRows(),u,_=e.component.getByType("skuid__page")[0];u=s.filter(e=>t.getFieldValue(e,"is_selected")).map(e=>{return t.getFieldValue(e,"skuidModulec")});if(u.length==0){_._getCPI().blockUI({message:"Please select a Module.",styleSettingsVariant:"dark",timeout:2500});return}_._getCPI().blockUI({message:"Retrieving Page and StaticResource records...",styleSettingsVariant:"dark"});let g="('"+u.join("','")+"') ",d="('"+u.join("Pages','")+"Pages') ",l=n("select Id, Name from StaticResource where Name in "+d),k=n("select Id, Name, skuid__API_Version__c, skuid__Type__c, skuid__UniqueId__c, skuid__Module__c, skuid__Composer_Settings__c, "+"skuid__MasterPage__c, skuid__MasterPage__r.Name, skuid__MasterPage__r.skuid__UniqueId__c, skuid__IsMaster__c, "+"skuid__Layout__c, skuid__Layout2__c, skuid__Layout3__c, skuid__Layout4__c, skuid__Layout5__c "+"from skuid__Page__c where skuid__Module__c in "+g+"order by skuid__Module__c, Name"),f,P;Promise.all([l,k]).then(([t,s])=>{P=t.records;f=s.records;_._getCPI().blockUI({message:"Checking for Resources that may need to be created...",styleSettingsVariant:"dark"});let n={},u={},g={};a.each(P,function(){n[this.Name.substring(0,this.Name.indexOf("Pages"))]=new i("StaticResource",{Name:this.Name,Id:this.Id,Body:this.Body,CacheControl:"Private"})});a.each(f,function(){let e=n[this.skuid__Module__c],t=g[this.skuid__Module__c];if(!e){u[this.skuid__Module__c]=1}if(!t){t=g[this.skuid__Module__c]=[]}t.push(this)});let d=r.Deferred(),l={};a.each(u,function(e){let t=e+"Pages",s=new i("StaticResource",{Name:t,Body:o(JSON.stringify([])),CacheControl:"Private"});n[e]=s;l[t]=1;s.insert({success:function e(){delete l[t];if(c(l)===0){d.resolve()}},error:function e(s){d.reject({resourceName:t,errorMessage:s.responseJSON[0].message})}})});if(c(u)===0){d.resolve()}d.then(function(){_._getCPI().blockUI({message:"Packaging Pages into StaticResources...",styleSettingsVariant:"dark"});let t=r.Deferred(),s=c(g);a.each(g,function(e,r){let a=n[e];if(a){a.Body=o(JSON.stringify(r));a.ContentType="application/json";a.update().then(function(){s--;if(s===0){t.resolve()}})}});t.then(function(){const t=[];a.each(g,function(e){t.push(e+"Pages")});_._getCPI().unblockUI();let s=e.component.getByType("skuid__modal")[0];s.getCPI().close()})},function(e){_._getCPI().blockUI({message:'There was an error creating the new StaticResource "'+e.resourceName+'":\n\n'+e.errorMessage,styleSettingsVariant:"dark",timeout:7500})})},function(){_._getCPI().blockUI({message:"There was an error creating the Page Pack",styleSettingsVariant:"dark",timeout:5e3})})});u("skuid.pageList.refreshPages",function(){let t,s=e.$M("pgs__PagesInStaticResources"),r=s.getRows(),i=e.component.getByType("skuid__page")[0];t=r.filter(e=>s.getFieldValue(e,"is_selected")).map(e=>{return s.getFieldValue(e,"Id")});if(t.length>0){i._getCPI().blockUI({message:"Refreshing Pages in selected Static Resources...",styleSettingsVariant:"dark",showPlaceholder:true});window.skuid.PageListControllerExtension.RefreshPagesFromStaticResource(JSON.stringify(t),function(t){e.$M("pgs__pagedata").updateData().then(function(){if(t&&t.isSuccess===true){i._getCPI().unblockUI()}else{let e="There was an error refreshing one or more pages";if(t&&t.errorList&&t.errorList.length>0){e+=":";a.each(t.errorList,function(t,s){e+="<br/>\n<br/>\n"+ ++t+". "+s})}i._getCPI().blockUI({message:e,styleSettingsVariant:"dark",timeout:7500})}})})}})})(e)}});return t});