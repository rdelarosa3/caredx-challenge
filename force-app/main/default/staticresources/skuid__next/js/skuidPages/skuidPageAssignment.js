skuid.runtime.registerApi("v2","skuidPages/skuidPageAssignment",function(e){var t=function(e){var t={};function s(i){if(t[i]){return t[i].exports}var n=t[i]={i:i,l:false,exports:{}};e[i].call(n.exports,n,n.exports,s);n.l=true;return n.exports}s.m=e;s.c=t;s.d=function(e,t,i){if(!s.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:i})}};s.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};s.t=function(e,t){if(t&1)e=s(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var i=Object.create(null);s.r(i);Object.defineProperty(i,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i};s.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};s.d(t,"a",t);return t};s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};s.p="";return s(s.s=701)}({701:function(t,s){(function(e){let t=e.$,s=e.$M,i=e.$L,n=e.snippet,r=n.registerSnippet,a=e.utils;r("skuid.snippets.utils.GetSObjectsAsItems",function(){return e.dataSource.get("salesforce").getEntityList().then(function(e){return t.map(e,function(e){return{value:e,label:e}})})});r("ExportAllPageAssignments",function(){let t=200;let s=e.model.initializeModel(new e.model.Model({fields:[{id:"skuid__Environment_Type__c"},{id:"skuid__SObject_Type__c"},{id:"skuid__Action_Type__c"},{id:"skuid__Context__c"},{id:"skuid__RecordTypeDeveloperName__c"},{id:"skuid__Page__c"},{id:"skuid__Page__r.Name"},{id:"skuid__Page__r.skuid__Module__c"},{id:"skuid__Page__r.skuid__UniqueId__c"},{id:"skuid__Use_Standard_Layouts__c"},{id:"skuid__IsActive__c"},{id:"OwnerId"}],data:[],id:"AllPageAssignmentsForExport",objectName:"skuid__Page_Assignment__c",orderByClause:"skuid__Environment_Type__c, skuid__SObject_Type__c, skuid__Action_Type__c",doQuery:true,doClone:false,recordsLimit:t,canRetrieveMoreRows:true}));let n=e.component.getByType("skuid__page")[0],r=i("Retrieving_data_for_export");n._getCPI().blockUI({message:"Retrieving data for export",styleSettingsVariant:"dark",showPlaceholder:true});function a(){s.exportData({useAPINamesForHeaders:true});r=e.label.merge(i("All_records_exported_to_CSV"),s.data.length);n._getCPI().blockUI({message:r,styleSettingsVariant:"dark",timeout:3e3})}function _(){if(s.canRetrieveMoreRows){s.loadAllRemainingRecords({stepCallback:function t(s,a){r=e.label.merge(i("Retrieving_records_a_to_b"),s,a);n._getCPI().blockUI({message:r,styleSettingsVariant:"dark",timeout:3e3})},finishCallback:function e(){a()}})}else{a()}}s.load(function(){_()})});let _=e.sfdc,o=_.api,c=o.SObject,u=o.query,l=o.escapeMetadataBody;r("skuid.pageAssignments.pack",function(){let i=arguments[0],n=s("Assignment_Adoption_UI_Only"),r,_=i.packAll,o=s("assign__PageAssignmentInfoForPackaging"),d=o.getFirstRow(),g=s("assign__StaticResourceInfoForPackaging"),p=g.getFirstRow(),k=g&&g.getFieldValue(p,"Name"),f=g&&g.getFieldValue(p,"Description"),m=e.component.getByType("skuid__page")[0];let y="SELECT Id, Name, Description FROM StaticResource WHERE Name = '"+k+"'",P="SELECT Id,Name,skuid__Environment_Type__c,skuid__SObject_Type__c,skuid__Action_Type__c,skuid__Context__c,"+"skuid__Assigned_To_User__c, skuid__Assigned_To_User__r.Name, skuid__RecordTypeDeveloperName__c,"+"skuid__Page__c,skuid__Page__r.skuid__UniqueId__c, skuid__Page__r.Name,"+"skuid__Page__r.skuid__Module__c,skuid__Use_Standard_Layouts__c, "+"skuid__IsActive__c "+"FROM skuid__Page_Assignment__c ";if(_){if(o&&d){let e=[];let t=o.getFieldValue(d,"EnvironmentTypesPackaging",true);if(t){e.push("skuid__Environment_Type__c IN ('"+t.split(";").join("','")+"')")}else{e.push("skuid__Environment_Type__c = null")}if(d.ObjectTypesPackaging==="specific"){let t=o.getFieldValue(d,"skuid__SObject_Type__c",true);if(t)e.push("skuid__SObject_Type__c IN ('"+t.split(";").join("','")+"')")}let s=d.ProfilesPackaging;if(s==="org")e.push("skuid__Context__c = null");else if(s==="organdprofile")e.push("(skuid__Context__c = null) OR (skuid__Context__c like '00e%')");if(e.length){P+="WHERE ("+e.join(") AND (")+")"}}}else{r=n.getRows();if(r&&r.length){P+="WHERE Id IN ('"+t.map(r,function(e){return e.Id}).join("','")+"')"}else{m._getCPI().blockUI({message:"Please select at least one Page Assignment to package.",timeout:2500,styleSettingsVariant:"dark"});return}}P+=" ORDER BY "+"skuid__RecordTypeDeveloperName__c NULLS LAST, "+"skuid__Context__c NULLS LAST, "+"skuid__Use_Standard_Layouts__c DESC, "+"skuid__Page__r.skuid__Module__c NULLS FIRST";m._getCPI().blockUI({message:"Getting Page Assignment and StaticResource records...",styleSettingsVariant:"dark",showPlaceholder:true});let S,I=u(y),A,b=u(P);b.then(function(e){A=e.records});I.then(function(e){S=e.records});Promise.all([I,b]).then(function(){let t,s=a.Deferred();if(S.length>0){t=new c("StaticResource",{Id:S[0].Id,CacheControl:"Private"});s.resolve()}else{m._getCPI().blockUI({message:"Creating StaticResource...",styleSettingsVariant:"dark",showPlaceholder:true});t=new c("StaticResource",{Name:k,Description:f,Body:l(JSON.stringify([])),CacheControl:"Private"});t.insert({success:function e(){s.resolve()},error:function e(t){s.reject({resourceName:k,errorMessage:t.responseJSON[0].message})}})}s.then(function(){m._getCPI().blockUI({message:"Packaging Page Assignments into StaticResource...",styleSettingsVariant:"dark",showPlaceholder:true});t.Body=l(JSON.stringify(A));t.ContentType="application/json";t.update().then(function(){let t=e.component.getByType("skuid__modal")[0];t.getCPI().close();m._getCPI().blockUI({message:"The "+k+" Page Assignments Pack was created/updated successfully!",styleSettingsVariant:"dark",timeout:3e3});o.cancel()},function(e){m._getCPI().blockUI({message:'There was an error creating the "'+k+'" Page Assignments Pack'+(e&&e.errorMessage?":\n\n"+e.errorMessage:"."),timeout:5e3,styleSettingsVariant:"dark"})})},function(e){m._getCPI().blockUI({message:'There was an error creating the "'+e.resourceName+'" Page Assignments Pack:\n\n'+e.errorMessage,timeout:5e3,styleSettingsVariant:"dark"})})})});r("skuid.pageAssignments.packAll",function(){let s=t.extend(arguments[0],{packAll:true});e.snippet.getSnippet("skuid.pageAssignments.pack")(s)});let d;r("skuid.pageAssignments.unpack",function(){let i,n=[],r=s("assign__PageAssignmentsInStaticResources"),_=r.getRows(),o=e.component.getByType("skuid__page")[0];n=_.filter(e=>r.getFieldValue(e,"is_selected")).map(e=>{return r.getFieldValue(e,"Id")});if(!n.length){o._getCPI().blockUI({message:"Please select one or more Page Assignment Packs.",styleSettingsVariant:"dark",timeout:2500});return false}else{i=a.Deferred();window.skuid.PageAssignment.RefreshFromPacks(JSON.stringify(n),function(e){let s=t.parseJSON(e);if(s){if(s.isSuccess){i.resolve()}else{if(s.errors&&s.errors.length){o._getCPI().blockUI({message:s.errors[0],styleSettingsVariant:"dark",timeout:5e3});i.reject()}d=s.recordFailures;i.reject()}}},{escape:false})}return i.promise()});r("skuid.pageAssignments.displayUnpackFailures",function(){if(d&&d.length>0){let e=s("assign__FailedAssignments"),i=[];t.each(d,function(){let e=this.record;t.extend(e,{Error:this.message});i.push(e)});e.adoptRows(i)}else{return false}})})(e)}});return t});